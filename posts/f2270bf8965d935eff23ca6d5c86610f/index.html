<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 Verilog 实现排序 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 Verilog 实现排序" />
<meta property="og:description" content="实现目标 输入 N = 4 N=4 N=4 个数，通过简单选择排序，对这个四个数进行简单选择排序：每次选择最小的，将最小的数移到起始位置，之后输出。这是同步时序电路和状态机的高级应用。
伪代码 设输入 N N N 个数，将其存在寄存器数组 R R R 中；两个循环变量 i , j i,j i,j；将每次遍历到的数分别赋值给 A , B A,B A,B。
简单选择排序的伪代码可以描述如下：
for i = 0 to N-2 do A = R[i]; for j = i to N-1 do B = R[j]; if B &lt; A then R[i] = B; R[j] = A; A = R[i]; end if; end for; end for; 数据通路设计 主要牵涉到两大块结构：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f2270bf8965d935eff23ca6d5c86610f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-06T17:01:22+08:00" />
<meta property="article:modified_time" content="2021-06-06T17:01:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 Verilog 实现排序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>实现目标</h3> 
<p>输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
         = 
        
       
         4 
        
       
      
        N=4 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">4</span></span></span></span></span> 个数，通过简单选择排序，对这个四个数进行简单选择排序：每次选择最小的，将最小的数移到起始位置，之后输出。这是同步时序电路和状态机的高级应用。</p> 
<h3><a id="_2"></a>伪代码</h3> 
<p>设输入 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
      
        N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span></span></span></span></span> 个数，将其存在寄存器数组 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         R 
        
       
      
        R 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span> 中；两个循环变量 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         i 
        
       
         , 
        
       
         j 
        
       
      
        i,j 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span></span></span></span></span>；将每次遍历到的数分别赋值给 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         , 
        
       
         B 
        
       
      
        A,B 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span></span></span></span></span>。<br> 简单选择排序的伪代码可以描述如下：</p> 
<pre><code class="prism language-clike"><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">0</span> to N<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
	A <span class="token operator">=</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> j <span class="token operator">=</span> i to N<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
		B <span class="token operator">=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> B <span class="token operator">&lt;</span> A then
			R<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> B<span class="token punctuation">;</span>
			R<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">;</span>
			A <span class="token operator">=</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		end <span class="token keyword">if</span><span class="token punctuation">;</span>
	end <span class="token keyword">for</span><span class="token punctuation">;</span>
end <span class="token keyword">for</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_19"></a>数据通路设计</h3> 
<p>主要牵涉到两大块结构：</p> 
<ul><li>状态机（控制逻辑）的设计</li><li>数据存储的设计</li></ul> 
<h3><a id="_23"></a>状态机的设计</h3> 
<p>总共设置9个状态，来执行完成该设计。状态图如下：<br> <img src="https://images2.imgbox.com/36/e5/9pJ4DC0i_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_26"></a>数据存储</h4> 
<p>设置4个 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span> bit 的寄存器，用来存储输入数据，至于存储的地址（寄存器编号）则作为输入端口，由用户给出。存储器的设计不光要照顾到对输入数据的存储，还需要对每次循环迭代到的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         , 
        
       
         B 
        
       
      
        A,B 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span></span></span></span></span> 进行存储，并且 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         , 
        
       
         B 
        
       
      
        A,B 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span></span></span></span></span> 还需要写回，尤其当 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         B 
        
       
         &lt; 
        
       
         A 
        
       
      
        B&lt;A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.72243em; vertical-align: -0.0391em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span></span></span></span></span> 成立的时候，需要交换写回。所以还需要设置两个 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span> bit 寄存器用来存储 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
         , 
        
       
         B 
        
       
      
        A,B 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span></span></span></span></span>。</p> 
<p>至于写回的地址设置，则需要根据判断条件给出。设计的存储模块如下：<br> <img src="https://images2.imgbox.com/13/49/7MdQQUfp_o.jpg" alt="在这里插入图片描述"><br> 其中有很多信号量，将会在代码里给出注释。</p> 
<h3><a id="_33"></a>代码编写</h3> 
<p>编写的 Verilog 代码如下：</p> 
<pre><code class="prism language-clike">module sort <span class="token punctuation">(</span>
	input			clk		<span class="token punctuation">,</span>
	input			rst_n	<span class="token punctuation">,</span>
	input			s		<span class="token punctuation">,</span>
	input			WrInit	<span class="token punctuation">,</span>
	input	<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	RAdd	<span class="token punctuation">,</span>
	input	<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	DataIn	<span class="token punctuation">,</span>
	input			Rd		<span class="token punctuation">,</span>

	output	<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	DataOut	<span class="token punctuation">,</span>
	output	reg		Done
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	localparam	<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	S1 <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">,</span>
						S2 <span class="token operator">=</span> <span class="token number">4</span>'b0001<span class="token punctuation">,</span>
						S3 <span class="token operator">=</span> <span class="token number">4</span>'b0010<span class="token punctuation">,</span>
						S4 <span class="token operator">=</span> <span class="token number">4</span>'b0011<span class="token punctuation">,</span>
						S5 <span class="token operator">=</span> <span class="token number">4</span>'b0100<span class="token punctuation">,</span>
						S6 <span class="token operator">=</span> <span class="token number">4</span>'b0101<span class="token punctuation">,</span>
						S7 <span class="token operator">=</span> <span class="token number">4</span>'b0110<span class="token punctuation">,</span>
						S8 <span class="token operator">=</span> <span class="token number">4</span>'b0111<span class="token punctuation">,</span>
						S9 <span class="token operator">=</span> <span class="token number">4</span>'b1000<span class="token punctuation">;</span>
	<span class="token comment">// 表示两个循环变量</span>
	wire <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> Ci<span class="token punctuation">,</span> Cj<span class="token punctuation">;</span>
	wire <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> CMux<span class="token punctuation">,</span> IMux<span class="token punctuation">;</span>
	<span class="token comment">// CMus is Ci or Cj </span>
	<span class="token comment">// IMux is the read adder</span>
	wire <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> R0<span class="token punctuation">,</span> R1<span class="token punctuation">,</span> R2<span class="token punctuation">,</span> R3<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> RData<span class="token punctuation">,</span> ABMux<span class="token punctuation">;</span>

	<span class="token comment">// A B 的大小判断和循环变量是否达到上界</span>
	wire BltA<span class="token punctuation">,</span> zi<span class="token punctuation">,</span> zj<span class="token punctuation">;</span>

	reg Int<span class="token punctuation">,</span> Csel<span class="token punctuation">,</span> Wr<span class="token punctuation">,</span> Ain<span class="token punctuation">,</span> Bin<span class="token punctuation">,</span> Bout<span class="token punctuation">;</span> 
	reg LI<span class="token punctuation">,</span> LJ<span class="token punctuation">,</span> EI<span class="token punctuation">,</span> EJ<span class="token punctuation">;</span> <span class="token comment">// ports for count</span>
	reg Rin0<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin3<span class="token punctuation">;</span> <span class="token comment">// enable for regs</span>

	reg <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> ABData<span class="token punctuation">;</span>
	
	reg <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> curr_state<span class="token punctuation">;</span>
	reg <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> next_state<span class="token punctuation">;</span>
	always@<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin<span class="token punctuation">:</span>state_ff
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> curr_state <span class="token operator">&lt;=</span> S1<span class="token punctuation">;</span>
		<span class="token keyword">else</span>		curr_state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span>
	end
	
	always@<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> begin<span class="token punctuation">:</span> state_table
		Int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> Done <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Csel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Wr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Ain <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Bin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Bout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		LI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> LJ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> EI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> EJ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
		<span class="token function">case</span><span class="token punctuation">(</span>curr_state<span class="token punctuation">)</span> 
			S1<span class="token punctuation">:</span> begin
				LI <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// make Ci be 0 </span>
				Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// indicate the initial process</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> next_state <span class="token operator">=</span> S1<span class="token punctuation">;</span>
				<span class="token keyword">else</span> next_state <span class="token operator">=</span> S2<span class="token punctuation">;</span>
			end
			S2<span class="token punctuation">:</span> begin
				<span class="token comment">//Int = 1;</span>
				<span class="token comment">//Csel = 0; // </span>
				Ain <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// make A  be R[Ci]</span>
				LJ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// make Cj be 0</span>
				next_state <span class="token operator">=</span> S3<span class="token punctuation">;</span>
			end
			S3<span class="token punctuation">:</span> begin
				EJ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// make Cj = Cj + 1</span>
				next_state <span class="token operator">=</span> S4<span class="token punctuation">;</span>
			end
			S4<span class="token punctuation">:</span> begin
				Bin  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// make B be R[Cj]</span>
				Csel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// </span>
				<span class="token comment">//Wr   = 1; // write enable</span>
				next_state <span class="token operator">=</span> S5<span class="token punctuation">;</span>
			end
			S5<span class="token punctuation">:</span> begin
				<span class="token keyword">if</span> <span class="token punctuation">(</span>BltA<span class="token punctuation">)</span> next_state <span class="token operator">=</span> S6<span class="token punctuation">;</span>
				<span class="token keyword">else</span> next_state <span class="token operator">=</span> S8<span class="token punctuation">;</span>
			end
			S6<span class="token punctuation">:</span> begin
				Csel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				Wr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				next_state <span class="token operator">=</span> S7<span class="token punctuation">;</span>
			end
			S7<span class="token punctuation">:</span> begin
				Wr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				Bout <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				next_state <span class="token operator">=</span> S8<span class="token punctuation">;</span>
			end
			S8<span class="token punctuation">:</span> begin
				Ain <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>zj<span class="token punctuation">)</span> begin     <span class="token comment">// Cj &lt; 3</span>
					EJ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					EI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					next_state <span class="token operator">=</span> S4<span class="token punctuation">;</span>
				end
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>zi<span class="token punctuation">)</span> begin <span class="token comment">// Ci &lt; 2</span>
					EJ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					EI <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
					next_state <span class="token operator">=</span> S2<span class="token punctuation">;</span>
				end
				<span class="token keyword">else</span> 
					next_state <span class="token operator">=</span> S9<span class="token punctuation">;</span>
			end
			S9<span class="token punctuation">:</span> begin
				Done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> next_state <span class="token operator">=</span> S9<span class="token punctuation">;</span>
				<span class="token keyword">else</span> next_state <span class="token operator">=</span> S1<span class="token punctuation">;</span>
			end
		endcase

	end
	
	<span class="token comment">// Instance Modules</span>
	
	reg16 Reg0 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> RData<span class="token punctuation">,</span> Rin0<span class="token punctuation">,</span> R0<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg16 Reg1 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> RData<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> R1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg16 Reg2 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> RData<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> R2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg16 Reg3 <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> RData<span class="token punctuation">,</span> Rin3<span class="token punctuation">,</span> R3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	reg16 RegA <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> ABData<span class="token punctuation">,</span> Ain<span class="token punctuation">,</span> A<span class="token punctuation">)</span><span class="token punctuation">;</span>
	reg16 RegB <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> rst_n<span class="token punctuation">,</span> ABData<span class="token punctuation">,</span> Bin<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>

	upcount OuterLoop <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> EI<span class="token punctuation">,</span> <span class="token number">2</span>'b0<span class="token punctuation">,</span> LI<span class="token punctuation">,</span> Ci<span class="token punctuation">)</span><span class="token punctuation">;</span>
	upcount InnerLoop <span class="token punctuation">(</span>clk<span class="token punctuation">,</span> EJ<span class="token punctuation">,</span>   Ci<span class="token punctuation">,</span> LJ<span class="token punctuation">,</span> Cj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	assign BltA <span class="token operator">=</span> <span class="token punctuation">(</span>B <span class="token operator">&lt;</span> A<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token comment">// when BltA == 1 then Bout will be 1</span>
	assign ABMux <span class="token operator">=</span> <span class="token punctuation">(</span>Bout   <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> A      <span class="token punctuation">:</span> B<span class="token punctuation">;</span>
	assign RData <span class="token operator">=</span> <span class="token punctuation">(</span>WrInit <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> DataIn <span class="token punctuation">:</span> ABMux<span class="token punctuation">;</span>

	<span class="token comment">// CMux decides the writing order of A and B</span>
	assign CMux <span class="token operator">=</span> <span class="token punctuation">(</span>Csel <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> Ci   <span class="token punctuation">:</span> Cj<span class="token punctuation">;</span>
	assign IMux <span class="token operator">=</span> <span class="token punctuation">(</span>Int  <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> CMux <span class="token punctuation">:</span> RAdd<span class="token punctuation">;</span>
	
	assign zi <span class="token operator">=</span> <span class="token punctuation">(</span>Ci <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	assign zj <span class="token operator">=</span> <span class="token punctuation">(</span>Cj <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// the regs' reading and writing</span>
	always@<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> begin
		<span class="token comment">// choose the regs out</span>
		<span class="token function">case</span><span class="token punctuation">(</span>IMux<span class="token punctuation">)</span>
			<span class="token number">0</span><span class="token punctuation">:</span> ABData <span class="token operator">=</span> R0<span class="token punctuation">;</span>
			<span class="token number">1</span><span class="token punctuation">:</span> ABData <span class="token operator">=</span> R1<span class="token punctuation">;</span>
			<span class="token number">2</span><span class="token punctuation">:</span> ABData <span class="token operator">=</span> R2<span class="token punctuation">;</span>
			<span class="token number">3</span><span class="token punctuation">:</span> ABData <span class="token operator">=</span> R3<span class="token punctuation">;</span>
		endcase

		<span class="token comment">// the write enable is valid</span>
		<span class="token comment">// WrInit for initial and Wr for the write back of A or B </span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>WrInit <span class="token operator">||</span> Wr<span class="token punctuation">)</span> begin
			case <span class="token punctuation">(</span>IMux<span class="token punctuation">)</span>
				<span class="token number">0</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>Rin3<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0001<span class="token punctuation">;</span>
				<span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>Rin3<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0010<span class="token punctuation">;</span>
				<span class="token number">2</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>Rin3<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0100<span class="token punctuation">;</span>
				<span class="token number">3</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>Rin3<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b1000<span class="token punctuation">;</span>
			endcase
		end
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>Rin3<span class="token punctuation">,</span> Rin2<span class="token punctuation">,</span> Rin1<span class="token punctuation">,</span> Rin0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">;</span>

	end
	<span class="token comment">// rd read data 信号有效时，将四个寄存器的数据依次读出（需要仿真给予激励信号）</span>
	assign DataOut <span class="token operator">=</span> <span class="token punctuation">(</span>Rd <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> 'bz <span class="token punctuation">:</span> ABData<span class="token punctuation">;</span>


endmodule
<span class="token comment">// 定义的 16 bit 寄存器</span>
module reg16 <span class="token punctuation">(</span>
	input				clk		<span class="token punctuation">,</span>
	input				rst_n	<span class="token punctuation">,</span>
	input		<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	D		<span class="token punctuation">,</span>
	input 				en		<span class="token punctuation">,</span>
	output	reg	<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	Q
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	always@<span class="token punctuation">(</span>posedge clk or negedge rst_n<span class="token punctuation">)</span> begin
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> 
			Q <span class="token operator">&lt;=</span> <span class="token number">16</span>'b0<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>en<span class="token punctuation">)</span>
			Q <span class="token operator">&lt;=</span> D<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			Q <span class="token operator">&lt;=</span> Q<span class="token punctuation">;</span>
	end

endmodule
<span class="token comment">// 定义的计数器，带使能、清零、起始值</span>
module upcount <span class="token punctuation">(</span>
	input 				clk		<span class="token punctuation">,</span>
	input				en		<span class="token punctuation">,</span>
	input		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	init	<span class="token punctuation">,</span>
	input				clear	<span class="token punctuation">,</span>
	output	reg	<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>	Q
<span class="token punctuation">)</span><span class="token punctuation">;</span>

	always@<span class="token punctuation">(</span>posedge clk<span class="token punctuation">)</span> begin
		<span class="token keyword">if</span> <span class="token punctuation">(</span>clear<span class="token punctuation">)</span>
			Q <span class="token operator">&lt;=</span> init<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>en<span class="token punctuation">)</span> 
			Q <span class="token operator">&lt;=</span> Q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			Q <span class="token operator">&lt;=</span> Q<span class="token punctuation">;</span>
	end

endmodule
</code></pre> 
<p>仿真结果如下图所示：<br> <img src="https://images2.imgbox.com/85/84/A7owVCjU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e2/98/MlaUN9QT_o.png" alt="在这里插入图片描述"></p> 
<p>附上仿真代码：</p> 
<pre><code class="prism language-clike">module sort_tb<span class="token punctuation">;</span>

reg clk<span class="token punctuation">;</span>
reg rst_n<span class="token punctuation">;</span>
reg s<span class="token punctuation">;</span>
reg WrInit<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> RAdd<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> DataIn<span class="token punctuation">;</span>
reg Rd<span class="token punctuation">;</span>

wire <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> DataOut<span class="token punctuation">;</span>
wire Done<span class="token punctuation">;</span>


initial begin
	clk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	forever begin
		#<span class="token number">5</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
	end
end

initial begin
	rst_n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	#<span class="token number">20</span> rst_n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	WrInit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	DataIn <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	Rd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> DataIn <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> DataIn <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> DataIn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> WrInit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	DataIn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	#<span class="token number">1200</span> Rd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	RAdd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> RAdd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> RAdd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> RAdd <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	#<span class="token number">10</span> RAdd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	#<span class="token number">100</span> $finish<span class="token punctuation">;</span>
end

initial begin
	$vcdpluson<span class="token punctuation">;</span>
end

sort ssort <span class="token punctuation">(</span>
	<span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">rst_n</span><span class="token punctuation">(</span>rst_n<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">s</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">WrInit</span><span class="token punctuation">(</span>WrInit<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">RAdd</span><span class="token punctuation">(</span>RAdd<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">DataIn</span><span class="token punctuation">(</span>DataIn<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">Rd</span><span class="token punctuation">(</span>Rd<span class="token punctuation">)</span><span class="token punctuation">,</span>

	<span class="token punctuation">.</span><span class="token function">DataOut</span><span class="token punctuation">(</span>DataOut<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span>Done<span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>
endmodule

</code></pre> 
<p>有错误欢迎指出。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/97c04f73b360a29440c00deadf8533ec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">七、confluence常见问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ac29341c9b4ab4e1c584f813339d0aec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2021-06-06</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>