<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux 60秒快速性能分析操作手册 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux 60秒快速性能分析操作手册" />
<meta property="og:description" content="写在前面 博文内容为 《BPF Performance Tools》 读书笔记整理，对原书提到的命令做了简单扩充
博文内容涉及 Linux 60秒快速性能分析命令的简单说明以及指标解释：
uptimedmesg | tail &amp;&amp; cat /var/log/messagesvmstat 1mpstat -P ALL 1pidstat 1iostat -xz 1free -msar -n DEV 1sar -n tcp，ETCP 1sar -n SOCK 1 3top 理解不足小伙伴帮忙指正
平平淡淡的接受这本就属于我的人生，每天不会想太多杞人忧天的事情，累了倒头就睡，醒了就接着继续自己没有走完的路，不再去过多的关注自己的结果，用心感受当下的每一天，感受自己走过的和正在走的路，不颓废，不折磨自己，真好！ —知乎(三冬三夏)
Linux 60秒分析 下面这个清单适用于任何性能问题的分析工作，也反映了笔者在实际工作中，当登录到一台表现不佳的 Linux 系统中后，在最初60秒内通常会进行的操作。
uptimedmesg | tail &amp;&amp; cat /var/log/messagesvmstat 1mpstat -P ALL 1pidstat 1iostat -xz 1free -msar -n DEV 1sar -n tcp，ETCP 1sar -n SOCK 1 3top uptime uptime 命令用于显示系统已运行的时间，并提供系统负载平均值的信息。以下是 uptime 命令提供的信息解释：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bd1a4bb87c3f2f0838797f044c307a3b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-24T17:09:11+08:00" />
<meta property="article:modified_time" content="2024-01-24T17:09:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux 60秒快速性能分析操作手册</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>写在前面</h3> 
<hr> 
<ul><li> <p>博文内容为 <code>《BPF Performance Tools》</code> 读书笔记整理，对原书提到的命令做了简单扩充</p> </li><li> <p>博文内容涉及 Linux 60秒快速性能分析命令的简单说明以及指标解释：</p> 
  <ol><li><code>uptime</code></li><li><code>dmesg | tail &amp;&amp; cat /var/log/messages</code></li><li><code>vmstat 1</code></li><li><code>mpstat -P ALL 1</code></li><li><code>pidstat 1</code></li><li><code>iostat -xz 1</code></li><li><code>free -m</code></li><li><code>sar -n DEV 1</code></li><li><code>sar -n tcp，ETCP 1</code></li><li><code>sar -n SOCK 1 3</code></li><li><code>top</code></li></ol> </li><li> <p>理解不足小伙伴帮忙指正</p> </li></ul> 
<p><strong><font color="009688"> 平平淡淡的接受这本就属于我的人生，每天不会想太多杞人忧天的事情，累了倒头就睡，醒了就接着继续自己没有走完的路，不再去过多的关注自己的结果，用心感受当下的每一天，感受自己走过的和正在走的路，不颓废，不折磨自己，真好！ —知乎(三冬三夏)</font></strong></p> 
<hr> 
<h2><a id="Linux_60_26"></a>Linux 60秒分析</h2> 
<p>下面这个清单适用于任何性能问题的分析工作，也反映了笔者在实际工作中，当登录到一台表现不佳的 Linux 系统中后，在最初60秒内通常会进行的操作。</p> 
<ol><li><code>uptime</code></li><li><code>dmesg | tail &amp;&amp; cat /var/log/messages</code></li><li><code>vmstat 1</code></li><li><code>mpstat -P ALL 1</code></li><li><code>pidstat 1</code></li><li><code>iostat -xz 1</code></li><li><code>free -m</code></li><li><code>sar -n DEV 1</code></li><li><code>sar -n tcp，ETCP 1</code></li><li><code>sar -n SOCK 1 3</code></li><li><code>top</code></li></ol> 
<h3><a id="uptime_42"></a>uptime</h3> 
<p><code>uptime</code> 命令用于显示系统已运行的时间，并提供系统负载平均值的信息。以下是 <code>uptime</code> 命令提供的信息解释：</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>liruilong@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$man</span> <span class="token function">uptime</span>
UPTIME<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                           User Commands                                           UPTIME<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

NAME
       <span class="token function">uptime</span> - Tell how long the system has been running.

SYNOPSIS
       <span class="token function">uptime</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

DESCRIPTION
       <span class="token function">uptime</span>  gives a one line display of the following information.  The current time, how long the system has been
       running, how many <span class="token function">users</span> are currently logged on, and the system load averages <span class="token keyword">for</span> the past <span class="token number">1</span>, <span class="token number">5</span>, and  <span class="token number">15</span>  min‐
       utes.

       This is the same information contained <span class="token keyword">in</span> the header line displayed by w<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.

       System  load  averages  is  the  average  number of processes that are either <span class="token keyword">in</span> a runnable or uninterruptable
       state.  A process <span class="token keyword">in</span> a runnable state is either using the CPU or waiting to use the CPU.  A process  <span class="token keyword">in</span>  unin‐
       terruptable  state is waiting <span class="token keyword">for</span> some I/O access, eg waiting <span class="token keyword">for</span> disk.  The averages are taken over the three
       <span class="token function">time</span> intervals.  Load averages are not normalized <span class="token keyword">for</span> the number of CPUs <span class="token keyword">in</span> a system, so a load average  of  <span class="token number">1</span>
       means a single CPU system is loaded all the <span class="token function">time</span> <span class="token keyword">while</span> on a <span class="token number">4</span> CPU system it means it was idle <span class="token number">75</span>% of the time.
       <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<p>uptime 可以快速查看<code>当前系统时间</code>以及<code>运行时间</code>，总的<code>登录用户</code>， 以及<code>平均负载</code>：</p> 
<ul><li>当前时间：显示执行uptime命令时的系统当前时间。</li><li>系统运行时间：显示系统自上次引导或重新启动以来的运行时间。以"X天X小时X分钟"的格式显示。</li><li>用户数量：表示当前登录到系统的用户数量。</li><li>系统负载平均值：显示过去1分钟、5分钟和15分钟的系统负载平均值。负载平均值代表处于运行状态或等待运行状态的平均进程数量。它指示系统的活动水平和资源利用程度。负载平均值并不针对系统中的CPU核数进行归一化</li></ul> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$uptime</span>
 <span class="token number">11</span>:14:26 up <span class="token number">16</span> min,  <span class="token number">1</span> user,  load average: <span class="token number">21.37</span>, <span class="token number">18.64</span>, <span class="token number">16.25</span>

</code></pre> 
<p>这里主要关注 <code>平均负载</code>：</p> 
<p>在Linux 系统中，这些数字包含了想要在 <code>CPU 上运行的进程</code>，同时也包含了<code>阻塞在不可中断IO(通常是磁盘 I/O)上的进程</code>。这给出了一个高层次视角的<code>资源负载(或者说资源需求)</code>。</p> 
<p><code>3个数字</code>分别是<code>指数衰减的1分钟/5分钟/15分钟滑动窗累积值</code>。通过这3个值可以大致了解<code>负载随时间变化的情况</code>。</p> 
<p>快速查看CPU核数可以通过<code>top</code>命令然后按<code>1</code>键查看</p> 
<pre><code class="prism language-bash"><span class="token function">top</span> - <span class="token number">11</span>:21:36 up <span class="token number">23</span> min,  <span class="token number">1</span> user,  load average: <span class="token number">22.36</span>, <span class="token number">19.03</span>, <span class="token number">17.14</span>
Tasks: <span class="token number">443</span> total,   <span class="token number">5</span> running, <span class="token number">438</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
%Cpu0  <span class="token builtin class-name">:</span>  <span class="token number">6.4</span> us,  <span class="token number">5.4</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">77.9</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">4.4</span> hi,  <span class="token number">5.9</span> si,  <span class="token number">0.0</span> st
%Cpu1  <span class="token builtin class-name">:</span>  <span class="token number">9.2</span> us, <span class="token number">12.2</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">71.9</span> id,  <span class="token number">3.6</span> wa,  <span class="token number">2.0</span> hi,  <span class="token number">1.0</span> si,  <span class="token number">0.0</span> st
%Cpu2  <span class="token builtin class-name">:</span>  <span class="token number">4.8</span> us,  <span class="token number">3.6</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">68.8</span> id,  <span class="token number">4.8</span> wa, <span class="token number">18.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st
%Cpu3  <span class="token builtin class-name">:</span>  <span class="token number">4.5</span> us,  <span class="token number">5.5</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">72.7</span> id,  <span class="token number">2.7</span> wa,  <span class="token number">0.5</span> hi, <span class="token number">14.1</span> si,  <span class="token number">0.0</span> st
MiB Mem <span class="token builtin class-name">:</span>  <span class="token number">15730.5</span> total,   <span class="token number">7489.9</span> free,   <span class="token number">6823.5</span> used,   <span class="token number">1417.2</span> buff/cache
MiB Swap:   <span class="token number">2068.0</span> total,   <span class="token number">2068.0</span> free,      <span class="token number">0.0</span> used.   <span class="token number">8496.2</span> avail Mem
</code></pre> 
<p>上面的例子显示负载最近有大幅的提升。一般情况下(<code>还受到其他因素的影响，I/O 操作等</code>)，<code>负载数与系统 CPU 核数</code>的关系可以用以下规则来理解：</p> 
<p>在<code>top</code>命令然后按<code>1</code>键的基础上可以按 <code>t</code> 键对数据进行可视化展示</p> 
<pre><code class="prism language-bash"><span class="token function">top</span> - <span class="token number">11</span>:22:26 up <span class="token number">24</span> min,  <span class="token number">1</span> user,  load average: <span class="token number">15.02</span>, <span class="token number">17.58</span>, <span class="token number">16.74</span>
Tasks: <span class="token number">449</span> total,  <span class="token number">19</span> running, <span class="token number">430</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
%Cpu0  <span class="token builtin class-name">:</span>  <span class="token number">24.5</span>/37.1   <span class="token number">62</span><span class="token punctuation">[</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">|</span>                                    <span class="token punctuation">]</span>
%Cpu1  <span class="token builtin class-name">:</span>  <span class="token number">15.5</span>/28.0   <span class="token number">43</span><span class="token punctuation">[</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span>                                                     <span class="token punctuation">]</span>
%Cpu2  <span class="token builtin class-name">:</span>  <span class="token number">37.9</span>/61.1   <span class="token number">99</span><span class="token punctuation">[</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span> <span class="token punctuation">]</span>
%Cpu3  <span class="token builtin class-name">:</span>  <span class="token number">15.8</span>/49.7   <span class="token number">66</span><span class="token punctuation">[</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">|</span>                                <span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p>如果负载数<code>小于 CPU 核数的70-80%</code>：这通常表示系统的负载较轻，有足够的处理能力来处理所有的任务。系统响应时间较短，性能较好。</p> </li><li> <p>如果负载数<code>接近或超过 CPU 核数的100%</code>：这表示系统的负载很高，正在接近或达到其处理能力的极限。系统可能会出现延迟或变慢的情况，响应时间变长。</p> </li><li> <p>如果负载数<code>远远超过 CPU 核数的100%</code>：这表示系统的<code>负载非常高</code>，超过了系统的处理能力。系统可能会出现严重的延迟，甚至崩溃或无法响应。</p> </li></ul> 
<p><code>负载的平均值</code>值得在排障过程中被首先进行检查，以确认性能问题是否还存在。在一个容错的环境中，一台存在性能问题的服务器，在你登录到机器上时，也许已经自动从服务列表中下线了。</p> 
<p><strong><code>一个较高的 15分钟负载</code>与一个<code>较低的1分钟负载</code>同时出现，可能意味着已经错过了问题发生的现场。</strong></p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$uptime</span>
 <span class="token number">11</span>:33:45 up <span class="token number">35</span> min,  <span class="token number">1</span> user,  load average: <span class="token number">1.39</span>, <span class="token number">6.06</span>, <span class="token number">11.64</span>
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ 
</code></pre> 
<h3><a id="dmesg__tail__cat_varlogmessages_149"></a><code>dmesg | tail</code> 或者 <code>cat /var/log/messages</code></h3> 
<p>或者 <code>journalctl -k | tail</code> 也可以结合 <code>cat /var/log/messages</code> 来排查</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>liruilong@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$dmesg</span> <span class="token operator">|</span> <span class="token function">tail</span>
<span class="token punctuation">[</span>   <span class="token number">12.216869</span><span class="token punctuation">]</span> vmwgfx 0000:00:0f.0: <span class="token punctuation">[</span>drm<span class="token punctuation">]</span> Available shader model: SM_5.
<span class="token punctuation">[</span>   <span class="token number">12.225954</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>drm<span class="token punctuation">]</span> Initialized vmwgfx <span class="token number">2.20</span>.0 <span class="token number">20211206</span> <span class="token keyword">for</span> 0000:00:0f.0 on minor <span class="token number">0</span>
<span class="token punctuation">[</span>   <span class="token number">12.233005</span><span class="token punctuation">]</span> Bluetooth: hci0: unexpected cc 0x0c12 length: <span class="token number">2</span> <span class="token operator">&lt;</span> <span class="token number">3</span>
<span class="token punctuation">[</span>   <span class="token number">12.233011</span><span class="token punctuation">]</span> Bluetooth: hci0: Opcode 0x c12 failed: -38
<span class="token punctuation">[</span>   <span class="token number">12.238757</span><span class="token punctuation">]</span> fbcon: vmwgfxdrmfb <span class="token punctuation">(</span>fb0<span class="token punctuation">)</span> is primary device
<span class="token punctuation">[</span>   <span class="token number">12.248762</span><span class="token punctuation">]</span> Console: switching to colour frame buffer device 160x50
<span class="token punctuation">[</span>   <span class="token number">12.269448</span><span class="token punctuation">]</span> vmwgfx 0000:00:0f.0: <span class="token punctuation">[</span>drm<span class="token punctuation">]</span> fb0: vmwgfxdrmfb frame buffer device
<span class="token punctuation">[</span>   <span class="token number">14.350586</span><span class="token punctuation">]</span> block dm-0: the capability attribute has been deprecated.
<span class="token punctuation">[</span>   <span class="token number">14.446480</span><span class="token punctuation">]</span> block nvme0n1: No UUID available providing old NGUID
<span class="token punctuation">[</span>   <span class="token number">14.498286</span><span class="token punctuation">]</span> block nvme0n1: No UUID available providing old NGUID
</code></pre> 
<p>这个命令显示过去 10 条系统日志，如果有的话。注意在这里寻找可能<code>导致性能问题的错误</code>。 添加 <code>T和t</code> 可以展示对应的时间</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$dmesg</span> -T<span class="token operator">|</span> <span class="token function">tail</span>
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:58:57 <span class="token number">2024</span><span class="token punctuation">]</span> vmxnet3 0000:1b:00.0 ens256: NIC Link is Up <span class="token number">10000</span> Mbps
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:38 <span class="token number">2024</span><span class="token punctuation">]</span> device ovs-system entered promiscuous mode
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:39 <span class="token number">2024</span><span class="token punctuation">]</span> Timeout policy base is empty
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:39 <span class="token number">2024</span><span class="token punctuation">]</span> Failed to associated <span class="token function">timeout</span> policy <span class="token variable"><span class="token variable">`</span>ovs_test_tp'
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:40 <span class="token number">2024</span><span class="token punctuation">]</span> device br-tun entered promiscuous mode
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:40 <span class="token number">2024</span><span class="token punctuation">]</span> device br-int entered promiscuous mode
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:40 <span class="token number">2024</span><span class="token punctuation">]</span> device ens224 entered promiscuous mode
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">10</span>:59:40 <span class="token number">2024</span><span class="token punctuation">]</span> device br-ex entered promiscuous mode
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">11</span>:03:14 <span class="token number">2024</span><span class="token punctuation">]</span> capability: warning: <span class="token variable">`</span></span>privsep-helper' uses deprecated v2 capabilities <span class="token keyword">in</span> a way that may be insecure
<span class="token punctuation">[</span>日 <span class="token number">1</span>月 <span class="token number">14</span> <span class="token number">11</span>:04:34 <span class="token number">2024</span><span class="token punctuation">]</span> hrtimer: interrupt took <span class="token number">11973872</span> ns
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<p>在日常维护中，往往结合 <code>grep</code> 快速定位问题</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">dmesg</span> -T <span class="token operator">|</span> <span class="token function">grep</span> -i error
<span class="token punctuation">[</span>五 <span class="token number">11</span>月 <span class="token number">10</span> <span class="token number">10</span>:32:57 <span class="token number">2023</span><span class="token punctuation">]</span> BERT: Boot Error Record Table support is disabled. Enable it by using bert_enable as kernel parameter.
┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">dmesg</span> -T <span class="token operator">|</span> <span class="token function">grep</span> -i warn
<span class="token punctuation">[</span>五 <span class="token number">11</span>月 <span class="token number">10</span> <span class="token number">10</span>:32:54 <span class="token number">2023</span><span class="token punctuation">]</span> Warning: Intel Processor - this hardware has not undergone upstream testing. Please consult http://wiki.centos.org/FAQ <span class="token keyword">for</span> <span class="token function">more</span> information
┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<p>比如 <code>内存不足引发</code>OOM和TCP 的丢弃`请求的记录。</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms83.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$cat</span> /var/log/messages <span class="token operator">|</span> <span class="token function">grep</span> -i memory
Aug <span class="token number">10</span> <span class="token number">20</span>:37:27 vms83 kernel: <span class="token punctuation">[</span><span class="token operator">&lt;</span>ffffffff81186bd<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span><span class="token punctuation">]</span> out_of_memory+0x4b6/0x4f0
Aug <span class="token number">10</span> <span class="token number">20</span>:37:27 vms83 kernel: Out of memory: Kill process <span class="token number">25143</span> <span class="token punctuation">(</span>bigmem<span class="token punctuation">)</span> score <span class="token number">1347</span> or sacrifice child
</code></pre> 
<p>TCP 的相关日志甚至指引了我们下一步的分析方向:查看SNMP 计数器值。</p> 
<h3><a id="vmstat_1_214"></a>vmstat 1</h3> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$man</span> <span class="token function">vmstat</span>
VMSTAT<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>                                       System Administration                                       VMSTAT<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>

NAME
       <span class="token function">vmstat</span> - Report virtual memory statistics

SYNOPSIS
       <span class="token function">vmstat</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>delay <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">]</span>

DESCRIPTION
       <span class="token function">vmstat</span> reports information about processes, memory, paging, block IO, traps, disks and cpu activity.

       The first report produced gives averages since the last reboot.  Additional reports give information on a sam‐
       pling period of length delay.  The process and memory reports are instantaneous <span class="token keyword">in</span> either case.
       <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$vmstat</span> <span class="token number">1</span>
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   <span class="token function">free</span>   buff  cache   si   so    bi    bo   <span class="token keyword">in</span>   cs us sy <span class="token function">id</span> wa st
<span class="token number">69</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7700836</span>   <span class="token number">4204</span> <span class="token number">1441648</span>    <span class="token number">0</span>    <span class="token number">0</span>   <span class="token number">369</span>   <span class="token number">101</span>  <span class="token number">569</span> <span class="token number">1819</span> <span class="token number">11</span> <span class="token number">35</span> <span class="token number">45</span>  <span class="token number">8</span>  <span class="token number">0</span>
<span class="token number">26</span>  <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">7711264</span>   <span class="token number">4204</span> <span class="token number">1441668</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">12</span> <span class="token number">1209</span> <span class="token number">1380</span>  <span class="token number">9</span> <span class="token number">24</span> <span class="token number">64</span>  <span class="token number">3</span>  <span class="token number">0</span>
 <span class="token number">8</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7710592</span>   <span class="token number">4204</span> <span class="token number">1441664</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">27</span>  <span class="token number">779</span> <span class="token number">1215</span>  <span class="token number">4</span> <span class="token number">11</span> <span class="token number">78</span>  <span class="token number">7</span>  <span class="token number">0</span>
<span class="token number">13</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7699752</span>   <span class="token number">4204</span> <span class="token number">1441668</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">766</span> <span class="token number">1313</span>  <span class="token number">3</span> <span class="token number">25</span> <span class="token number">72</span>  <span class="token number">0</span>  <span class="token number">0</span>
<span class="token number">31</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7696384</span>   <span class="token number">4204</span> <span class="token number">1442288</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">1412</span> <span class="token number">1157</span> <span class="token number">2928</span> <span class="token number">12</span> <span class="token number">32</span> <span class="token number">49</span>  <span class="token number">8</span>  <span class="token number">0</span>
<span class="token number">60</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7675296</span>   <span class="token number">4204</span> <span class="token number">1444292</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">26</span> <span class="token number">1068</span> <span class="token number">13824</span>  <span class="token number">9</span> <span class="token number">26</span> <span class="token number">51</span> <span class="token number">14</span>  <span class="token number">0</span>
<span class="token number">34</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7670552</span>   <span class="token number">4204</span> <span class="token number">1444280</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">17</span>  <span class="token number">798</span> <span class="token number">1514</span> <span class="token number">14</span> <span class="token number">52</span> <span class="token number">34</span>  <span class="token number">1</span>  <span class="token number">0</span>
<span class="token number">60</span>  <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">7686712</span>   <span class="token number">4204</span> <span class="token number">1444508</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>  <span class="token number">807</span> <span class="token number">2127</span>  <span class="token number">6</span> <span class="token number">24</span> <span class="token number">67</span>  <span class="token number">3</span>  <span class="token number">0</span>
<span class="token number">59</span>  <span class="token number">2</span>      <span class="token number">0</span> <span class="token number">7676624</span>   <span class="token number">4204</span> <span class="token number">1445232</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>  <span class="token number">620</span> <span class="token number">6830</span>  <span class="token number">7</span> <span class="token number">66</span> <span class="token number">22</span>  <span class="token number">5</span>  <span class="token number">0</span>
<span class="token number">68</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7677948</span>   <span class="token number">4204</span> <span class="token number">1442440</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">56</span> <span class="token number">1329</span> <span class="token number">3739</span> <span class="token number">13</span> <span class="token number">22</span> <span class="token number">59</span>  <span class="token number">7</span>  <span class="token number">0</span>
<span class="token number">100</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7677920</span>   <span class="token number">4204</span> <span class="token number">1442340</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">21</span> <span class="token number">1030</span> <span class="token number">3778</span> <span class="token number">16</span> <span class="token number">50</span> <span class="token number">29</span>  <span class="token number">5</span>  <span class="token number">0</span>
<span class="token number">19</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7669208</span>   <span class="token number">4204</span> <span class="token number">1443220</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">43</span>  <span class="token number">958</span> <span class="token number">3054</span> <span class="token number">19</span> <span class="token number">65</span> <span class="token number">10</span>  <span class="token number">6</span>  <span class="token number">0</span>
 <span class="token number">5</span>  <span class="token number">2</span>      <span class="token number">0</span> <span class="token number">7776028</span>   <span class="token number">4204</span> <span class="token number">1445364</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">40</span> <span class="token number">1124</span> <span class="token number">20039</span> <span class="token number">18</span> <span class="token number">33</span> <span class="token number">44</span>  <span class="token number">4</span>  <span class="token number">0</span>
<span class="token number">84</span>  <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">7764600</span>   <span class="token number">4204</span> <span class="token number">1447240</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">36</span>  <span class="token number">867</span> <span class="token number">23470</span> <span class="token number">14</span> <span class="token number">53</span> <span class="token number">27</span>  <span class="token number">5</span>  <span class="token number">0</span>
<span class="token number">22</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7711224</span>   <span class="token number">4204</span> <span class="token number">1447328</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">112</span> <span class="token number">1353</span> <span class="token number">11900</span> <span class="token number">13</span> <span class="token number">34</span> <span class="token number">50</span>  <span class="token number">4</span>  <span class="token number">0</span>
<span class="token number">36</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7734856</span>   <span class="token number">4204</span> <span class="token number">1447572</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">321</span> <span class="token number">1382</span> <span class="token number">11113</span> <span class="token number">10</span> <span class="token number">22</span> <span class="token number">47</span> <span class="token number">21</span>  <span class="token number">0</span>
<span class="token number">28</span>  <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">7738716</span>   <span class="token number">4204</span> <span class="token number">1446508</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">157</span>  <span class="token number">889</span> <span class="token number">5779</span>  <span class="token number">3</span> <span class="token number">15</span> <span class="token number">64</span> <span class="token number">18</span>  <span class="token number">0</span>
<span class="token number">30</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7719320</span>   <span class="token number">4204</span> <span class="token number">1446696</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">151</span> <span class="token number">1409</span> <span class="token number">8526</span>  <span class="token number">5</span> <span class="token number">27</span> <span class="token number">57</span> <span class="token number">10</span>  <span class="token number">0</span>
 <span class="token number">7</span>  <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">7713972</span>   <span class="token number">4204</span> <span class="token number">1447192</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">25</span> <span class="token number">1372</span> <span class="token number">23431</span> <span class="token number">13</span> <span class="token number">19</span> <span class="token number">63</span>  <span class="token number">5</span>  <span class="token number">0</span>
<span class="token number">18</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7715444</span>   <span class="token number">4204</span> <span class="token number">1447356</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">56</span>  <span class="token number">935</span> <span class="token number">7750</span>  <span class="token number">6</span> <span class="token number">19</span> <span class="token number">67</span>  <span class="token number">7</span>  <span class="token number">0</span>
<span class="token number">54</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7766760</span>   <span class="token number">4204</span> <span class="token number">1440632</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">64</span> <span class="token number">1237</span> <span class="token number">4686</span> <span class="token number">11</span> <span class="token number">26</span> <span class="token number">56</span>  <span class="token number">7</span>  <span class="token number">0</span>
<span class="token number">52</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">7712752</span>   <span class="token number">4204</span> <span class="token number">1441816</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span> <span class="token number">1265</span> <span class="token number">6567</span> <span class="token number">25</span> <span class="token number">33</span> <span class="token number">42</span>  <span class="token number">0</span>  <span class="token number">0</span>
^C
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<p>需要检查的列包括如下几个:</p> 
<ul><li><code>r</code>:CPU上正在执行的和<code>等待执行</code>的进程数量。相比<code>平均负载</code>来说，这是一个更好的排查<code>CPU饱和度</code>的指标，因为它不包含IO。可以这样解释:<code>一个比CPU数量多的 r 值代表 CPU 资源处于饱和状态</code>。</li><li><code>free</code>:空闲内存,单位是KB。<code>如果数字位数一眼数不过来,那么内存应该是够用的</code>。使用<code>free -m</code> 命令，可以更好地解释空闲内存。</li><li><code>si 和so</code>:页换入和页换出。<code>如果这些值不是零，那么意味着系统内存紧张</code>。这个值只有在配置<code>开启了交换分区</code>后才会起作用。</li><li><code>us、sy、id、wa和st</code>:这些都是 CPU运行时间的进一步细分，是对所有的CPU 取平均之后的结果。它们分别代表<code>用户态时间</code>、<code>系统态时间(内核)</code>、<code>空闲率</code>、<code>等待I/O</code>，以及<code>被窃取时间</code>(stolen time，指的是虚拟化环境下，被其他客户机所挤占的时间;或者是Xen 环境下客户机自身隔离的驱动域运行时间)。</li></ul> 
<p>上面的例子显示了CPU时间主要花在<code>系统态</code>上。这指引我们下一步将主要针对<code>系统态代码进行剖析</code>。</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$vmstat</span>
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   <span class="token function">free</span>   buff  cache   si   so    bi    bo   <span class="token keyword">in</span>   cs us sy <span class="token function">id</span> wa st
 <span class="token number">2</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">1057540</span>   <span class="token number">2072</span> <span class="token number">1761012</span>    <span class="token number">0</span>    <span class="token number">0</span>    <span class="token number">68</span>    <span class="token number">27</span> <span class="token number">1501</span>  <span class="token number">595</span>  <span class="token number">8</span>  <span class="token number">4</span> <span class="token number">87</span>  <span class="token number">1</span>  <span class="token number">0</span>
┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<p><strong>查看CPU平均值，当前系统中，可运行进程为2®，被阻塞的进程为0(b)，系统发生中断次数1501(in),系统发生上下文切换次数为595(cs)，系统代码消耗CPU为4%(sy)，用户代码消耗CPU为8%(us)，系统空闲占比87%(id),剩余1%属于等待IO消耗的CPU空闲状态(wa)</strong></p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$vmstat</span> -s
    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
       <span class="token number">206387</span> non-nice user cpu ticks
            <span class="token number">3</span> <span class="token function">nice</span> user cpu ticks
       <span class="token number">100381</span> system cpu ticks
      <span class="token number">2184710</span> idle cpu ticks
        <span class="token number">12604</span> IO-wait cpu ticks
            <span class="token number">0</span> IRQ cpu ticks
         <span class="token number">4699</span> softirq cpu ticks
            <span class="token number">0</span> stolen cpu ticks
    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
     <span class="token number">37633050</span> interrupts
     <span class="token number">64361523</span> CPU context switches
    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
       <span class="token number">210962</span> forks
</code></pre> 
<p>这里的ticks为一个时间单位，相关数据为自系统启动时间以来的数据。forks表示系统创建以来的进程数，CPU context switches表示上下文文切换次数，interrupts即中断次数，剩下的参数对应上面的列理解即可，stolen cpu 这个不太理解</p> 
<h3><a id="mpstat_P_ALL_l_311"></a>mpstat -P ALL l</h3> 
<p>需要装包</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$yum</span> <span class="token function">install</span> -y sysstat
</code></pre> 
<p>这个命令将每个<code>CPU分解到各个状态下的时间</code>打印出来。</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$mpstat</span> -P ALL <span class="token number">1</span>
Linux <span class="token number">4.18</span>.0-477.27.1.el8_8.x86_64 <span class="token punctuation">(</span>vms100.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2024</span>年01月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>
<span class="token number">11</span>时43分36秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
<span class="token number">11</span>时43分37秒  all   <span class="token number">12.89</span>    <span class="token number">0.00</span>   <span class="token number">14.84</span>   <span class="token number">50.00</span>    <span class="token number">6.25</span>    <span class="token number">4.30</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">11.72</span>
<span class="token number">11</span>时43分37秒    <span class="token number">0</span>   <span class="token number">21.57</span>    <span class="token number">0.00</span>   <span class="token number">15.69</span>   <span class="token number">50.98</span>    <span class="token number">5.88</span>    <span class="token number">1.96</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">3.92</span>
<span class="token number">11</span>时43分37秒    <span class="token number">1</span>   <span class="token number">12.68</span>    <span class="token number">0.00</span>    <span class="token number">9.86</span>   <span class="token number">76.06</span>    <span class="token number">1.41</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>
<span class="token number">11</span>时43分37秒    <span class="token number">2</span>   <span class="token number">12.70</span>    <span class="token number">0.00</span>   <span class="token number">25.40</span>    <span class="token number">3.17</span>   <span class="token number">17.46</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">41.27</span>
<span class="token number">11</span>时43分37秒    <span class="token number">3</span>    <span class="token number">7.04</span>    <span class="token number">0.00</span>    <span class="token number">9.86</span>   <span class="token number">64.79</span>    <span class="token number">1.41</span>   <span class="token number">14.08</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">2.82</span>

<span class="token number">11</span>时43分37秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
<span class="token number">11</span>时43分38秒  all    <span class="token number">8.65</span>    <span class="token number">0.00</span>   <span class="token number">13.16</span>   <span class="token number">31.58</span>    <span class="token number">1.50</span>   <span class="token number">12.78</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">32.33</span>
<span class="token number">11</span>时43分38秒    <span class="token number">0</span>   <span class="token number">17.65</span>    <span class="token number">0.00</span>   <span class="token number">25.49</span>    <span class="token number">5.88</span>    <span class="token number">1.96</span>   <span class="token number">25.49</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">23.53</span>
<span class="token number">11</span>时43分38秒    <span class="token number">1</span>    <span class="token number">8.00</span>    <span class="token number">0.00</span>   <span class="token number">10.67</span>   <span class="token number">24.00</span>    <span class="token number">2.67</span>   <span class="token number">10.67</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">44.00</span>
<span class="token number">11</span>时43分38秒    <span class="token number">2</span>    <span class="token number">4.17</span>    <span class="token number">0.00</span>    <span class="token number">9.72</span>   <span class="token number">77.78</span>    <span class="token number">0.00</span>    <span class="token number">2.78</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">5.56</span>
<span class="token number">11</span>时43分38秒    <span class="token number">3</span>    <span class="token number">7.35</span>    <span class="token number">0.00</span>   <span class="token number">10.29</span>   <span class="token number">10.29</span>    <span class="token number">1.47</span>   <span class="token number">16.18</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">54.41</span>

<span class="token number">11</span>时43分38秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
<span class="token number">11</span>时43分39秒  all    <span class="token number">8.06</span>    <span class="token number">0.00</span>   <span class="token number">10.89</span>   <span class="token number">52.42</span>   <span class="token number">11.29</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">17.34</span>
<span class="token number">11</span>时43分39秒    <span class="token number">0</span>   <span class="token number">12.31</span>    <span class="token number">0.00</span>   <span class="token number">12.31</span>   <span class="token number">69.23</span>    <span class="token number">6.15</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>
<span class="token number">11</span>时43分39秒    <span class="token number">1</span>    <span class="token number">4.41</span>    <span class="token number">0.00</span>    <span class="token number">4.41</span>   <span class="token number">67.65</span>    <span class="token number">8.82</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">14.71</span>
<span class="token number">11</span>时43分39秒    <span class="token number">2</span>    <span class="token number">8.33</span>    <span class="token number">0.00</span>   <span class="token number">13.33</span>   <span class="token number">65.00</span>    <span class="token number">8.33</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">5.00</span>
<span class="token number">11</span>时43分39秒    <span class="token number">3</span>    <span class="token number">7.27</span>    <span class="token number">0.00</span>   <span class="token number">14.55</span>    <span class="token number">0.00</span>   <span class="token number">23.64</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">54.55</span>

<span class="token number">11</span>时43分39秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
<span class="token number">11</span>时43分40秒  all   <span class="token number">24.69</span>    <span class="token number">0.00</span>    <span class="token number">7.11</span>   <span class="token number">18.83</span>    <span class="token number">2.93</span>   <span class="token number">25.94</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">20.50</span>
<span class="token number">11</span>时43分40秒    <span class="token number">0</span>   <span class="token number">46.67</span>    <span class="token number">0.00</span>   <span class="token number">17.78</span>   <span class="token number">31.11</span>    <span class="token number">2.22</span>    <span class="token number">2.22</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>
<span class="token number">11</span>时43分40秒    <span class="token number">1</span>   <span class="token number">11.11</span>    <span class="token number">0.00</span>    <span class="token number">6.94</span>   <span class="token number">37.50</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">44.44</span>
<span class="token number">11</span>时43分40秒    <span class="token number">2</span>   <span class="token number">41.46</span>    <span class="token number">0.00</span>    <span class="token number">7.32</span>    <span class="token number">9.76</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">41.46</span>
<span class="token number">11</span>时43分40秒    <span class="token number">3</span>   <span class="token number">16.05</span>    <span class="token number">0.00</span>    <span class="token number">1.23</span>    <span class="token number">0.00</span>    <span class="token number">7.41</span>   <span class="token number">75.31</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>

<span class="token number">11</span>时43分40秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
<span class="token number">11</span>时43分41秒  all   <span class="token number">24.04</span>    <span class="token number">0.00</span>   <span class="token number">16.35</span>   <span class="token number">12.98</span>   <span class="token number">12.50</span>    <span class="token number">6.25</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">27.88</span>
<span class="token number">11</span>时43分41秒    <span class="token number">0</span>   <span class="token number">28.12</span>    <span class="token number">0.00</span>   <span class="token number">21.88</span>    <span class="token number">0.00</span>   <span class="token number">31.25</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">18.75</span>
<span class="token number">11</span>时43分41秒    <span class="token number">1</span>   <span class="token number">21.67</span>    <span class="token number">0.00</span>   <span class="token number">20.00</span>    <span class="token number">0.00</span>   <span class="token number">20.00</span>   <span class="token number">11.67</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">26.67</span>
<span class="token number">11</span>时43分41秒    <span class="token number">2</span>    <span class="token number">7.58</span>    <span class="token number">0.00</span>   <span class="token number">16.67</span>   <span class="token number">16.67</span>    <span class="token number">6.06</span>    <span class="token number">1.52</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">51.52</span>
<span class="token number">11</span>时43分41秒    <span class="token number">3</span>   <span class="token number">46.00</span>    <span class="token number">0.00</span>    <span class="token number">8.00</span>   <span class="token number">32.00</span>    <span class="token number">0.00</span>   <span class="token number">10.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">4.00</span>
</code></pre> 
<p>对于比较高的 <code>%iowait(等待I/O操作完成占用CPU的百分比，表示CPU时间用于等待I/O操作完成的百分比。)</code> 时间也要注意，可以使用<code>磁盘 I/O工具</code>进一步分析</p> 
<p>如果出现较高的 <code>%sys</code> 值(系统态占用)，可以使用系统调用<code>(syscall)跟踪和内核跟踪</code>，以及CPU剖析等手段进一步分析。</p> 
<p><img src="https://images2.imgbox.com/65/2c/S77B5El1_o.png" alt="在这里插入图片描述"></p> 
<p><code>%idle</code>指CPU的<code>空闲率</code>,通过检查单个<code>热点(繁忙)CPU</code>，挑出一个可能的<code>线程扩展性</code>问题</p> 
<p><img src="https://images2.imgbox.com/d0/d7/E2T2QsVP_o.png" alt="在这里插入图片描述"></p> 
<p>上面的输出暴露了一个问题:<code>CPU0</code> 的用户态的占比高达 <code>100%</code>，这是<code>单个线程遇到瓶颈</code>的特征。</p> 
<h3><a id="pidstat_1_384"></a>pidstat 1</h3> 
<p><code>pidstat(1)</code>命令按每个进程展示 CPU的使用情况(包括<code>用户态</code>和<code>系统态</code>时间的分解)。top(l)命令虽然也很流行，但是pidstat(1)默认支持滚动打印输出，这样可以采集到不同时间段的数据变化。</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$pidstat</span> <span class="token number">3</span>
Linux <span class="token number">4.18</span>.0-477.27.1.el8_8.x86_64 <span class="token punctuation">(</span>vms100.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2024</span>年01月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>

<span class="token number">11</span>时31分10秒   <span class="token environment constant">UID</span>       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
<span class="token number">11</span>时31分13秒     <span class="token number">0</span>        <span class="token number">14</span>    <span class="token number">0.00</span>    <span class="token number">1.99</span>    <span class="token number">0.00</span>    <span class="token number">1.66</span>    <span class="token number">1.99</span>     <span class="token number">0</span>  rcu_sched
<span class="token number">11</span>时31分13秒     <span class="token number">0</span>        <span class="token number">33</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>     <span class="token number">3</span>  ksoftirqd/3
<span class="token number">11</span>时31分13秒     <span class="token number">0</span>       <span class="token number">718</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">2.65</span>    <span class="token number">0.33</span>     <span class="token number">3</span>  kworker/3:3-events
<span class="token number">11</span>时31分13秒     <span class="token number">0</span>       <span class="token number">970</span>    <span class="token number">1.99</span>    <span class="token number">0.66</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>    <span class="token number">2.65</span>     <span class="token number">0</span>  tuned
<span class="token number">11</span>时31分13秒 <span class="token number">42435</span>      <span class="token number">2133</span>    <span class="token number">0.66</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>    <span class="token number">0.66</span>     <span class="token number">2</span>  neutron-dhcp-ag
<span class="token number">11</span>时31分13秒 <span class="token number">42407</span>      <span class="token number">2134</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>     <span class="token number">2</span>  cinder-schedule
<span class="token number">11</span>时31分13秒 <span class="token number">42435</span>      <span class="token number">2137</span>    <span class="token number">0.66</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>    <span class="token number">0.99</span>     <span class="token number">0</span>  neutron-openvsw
<span class="token number">11</span>时31分13秒 <span class="token number">42435</span>      <span class="token number">2182</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>    <span class="token number">0.33</span>     <span class="token number">3</span>  neutron-metadat
<span class="token number">11</span>时31分13秒 <span class="token number">42418</span>      <span class="token number">2437</span>    <span class="token number">0.99</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">0.99</span>    <span class="token number">1.32</span>     <span class="token number">0</span>  heat-engine
<span class="token number">11</span>时31分13秒 <span class="token number">42415</span>      <span class="token number">2842</span>    <span class="token number">0.66</span>    <span class="token number">0.99</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>    <span class="token number">1.66</span>     <span class="token number">0</span>  glance-api
<span class="token number">11</span>时31分13秒 <span class="token number">42436</span>      <span class="token number">2936</span>    <span class="token number">0.99</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>    <span class="token number">0.99</span>     <span class="token number">3</span>  nova-conductor
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
平均时间: <span class="token number">42436</span>      <span class="token number">9819</span>    <span class="token number">0.33</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">1.50</span>    <span class="token number">0.33</span>     -  nova-conductor
平均时间: <span class="token number">42418</span>      <span class="token number">9951</span>    <span class="token number">0.17</span>    <span class="token number">0.50</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.66</span>     -  heat-engine
平均时间: <span class="token number">42418</span>      <span class="token number">9952</span>    <span class="token number">0.17</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.17</span>    <span class="token number">0.17</span>     -  heat-engine
平均时间:     <span class="token number">0</span>     <span class="token number">24178</span>    <span class="token number">0.00</span>    <span class="token number">0.17</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.17</span>     -  sshd
平均时间: <span class="token number">42435</span>     <span class="token number">42662</span>    <span class="token number">0.33</span>    <span class="token number">0.17</span>    <span class="token number">0.00</span>    <span class="token number">0.33</span>    <span class="token number">0.50</span>     -  neutron-l3-agen
平均时间:     <span class="token number">0</span>     <span class="token number">79775</span>    <span class="token number">0.17</span>    <span class="token number">0.66</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.83</span>     -  pidstat
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<p>这个输出显示了一个Java 进程每秒使用的CPU 资源在变化:<code>这个百分比是对全部CPU相加的和因此500%相当于5个100%运行的CPU</code>。</p> 
<p><img src="https://images2.imgbox.com/77/6e/JZlrlJM5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="iostat_xz_424"></a>iostat -xz</h3> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$iostat</span> -xz
Linux <span class="token number">4.18</span>.0-477.27.1.el8_8.x86_64 <span class="token punctuation">(</span>vms100.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2024</span>年01月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          <span class="token number">10.78</span>    <span class="token number">0.00</span>   <span class="token number">36.46</span>   <span class="token number">20.39</span>    <span class="token number">0.00</span>   <span class="token number">32.37</span>

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
nvme0n1        <span class="token number">101.86</span>   <span class="token number">23.92</span>   <span class="token number">4143.65</span>    <span class="token number">729.07</span>     <span class="token number">0.07</span>     <span class="token number">0.98</span>   <span class="token number">0.07</span>   <span class="token number">3.92</span>   <span class="token number">33.62</span>   <span class="token number">38.59</span>   <span class="token number">4.35</span>    <span class="token number">40.68</span>    <span class="token number">30.48</span>   <span class="token number">5.10</span>  <span class="token number">64.21</span>
nvme0n2          <span class="token number">0.55</span>    <span class="token number">0.00</span>     <span class="token number">15.62</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">28.66</span>    <span class="token number">0.00</span>   <span class="token number">0.02</span>    <span class="token number">28.50</span>     <span class="token number">0.00</span>  <span class="token number">19.27</span>   <span class="token number">1.06</span>
scd0             <span class="token number">0.05</span>    <span class="token number">0.00</span>      <span class="token number">0.01</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">0.00</span>     <span class="token number">0.17</span>     <span class="token number">0.00</span>   <span class="token number">0.56</span>   <span class="token number">0.00</span>
dm-0            <span class="token number">87.79</span>   <span class="token number">24.64</span>   <span class="token number">3865.46</span>    <span class="token number">718.38</span>     <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">37.96</span>   <span class="token number">42.92</span>   <span class="token number">4.39</span>    <span class="token number">44.03</span>    <span class="token number">29.16</span>   <span class="token number">5.59</span>  <span class="token number">62.87</span>
dm-1             <span class="token number">0.51</span>    <span class="token number">0.00</span>     <span class="token number">11.59</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">4.50</span>    <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">22.65</span>     <span class="token number">0.00</span>   <span class="token number">4.58</span>   <span class="token number">0.23</span>

</code></pre> 
<p>这个工具显示了<code>存储设备的IO 指标</code>。要检查的列包括如下几个。</p> 
<ul><li><code>r/s、w/s、rkB/s</code>和 <code>wkB/s</code>:这些是每秒向设备发送的<code>读、写次数</code>，以及<code>读、写字节数</code>。可以用这些指标对<code>业务负载画像</code>。某些性能问题仅仅是因为<code>超过了能够承受的最大负载</code>导致的。</li><li><code>await</code>:I/O 的<code>平均响应时间</code>，以毫秒为单位。这是应用需要承受的时间，它同时包含了<code>I/O 队列时间和服务时间</code>。超过预期的<code>平均响应时间</code>，可看作设备<code>已饱和或者设备层面有问题</code>的表征。</li><li><code>aqu-sz\avgqu-sz</code>:设备请求队列的平均长度。<code>比1大的值有可能是发生饱和的表征</code>(不过对有些设备，尤其是对基于多块磁盘的虚拟设备来说，通常以并行方式处理请求)。</li><li><code>%util</code>:设备使用率。这是<code>设备繁忙程度的百分比</code>，显示了每秒设备开展实际工作的时间占比。不过它展示的并不是容量规划意义下的使用率，因为设备可以并行处理请求。<code>大于60%的值通常会导致性能变差(可以通过await(完成对一个请求的服务所需的平均时间(按毫秒计),该平均时间为请求在磁盘队列中等待的时间加上磁盘对其服务所需的时间) 字段确认)</code>,不过这也取决于具体设备。<code>接近 100% 的值通常代表了设备达到饱和状态</code>。</li></ul> 
<p>iostat的扩展磁盘统计信息:</p> 
<table><thead><tr><th>统计数据</th><th>说明</th></tr></thead><tbody><tr><td>rrqm/s</td><td>在提交给磁盘前，被合并的读请求的数量</td></tr><tr><td>wrqm/s</td><td>在提交给磁盘前，被合并的写请求的数量</td></tr><tr><td>r/s</td><td>每秒提交给磁盘的读请求数量</td></tr><tr><td>w/s</td><td>每秒提交给磁盘的写请求数量</td></tr><tr><td>rsec/s</td><td>每秒读取的磁盘扇区数</td></tr><tr><td>wsec/s</td><td>每秒写入的磁盘扇区数</td></tr><tr><td>rkB/s</td><td>每秒从磁盘读取了多少KB的数据</td></tr><tr><td>wkB/s</td><td>每秒向磁盘写入了多少KB的数据</td></tr><tr><td>avgrq-sz</td><td>磁盘请求的平均大小(按扇区计)</td></tr><tr><td>avgqu-sz</td><td>磁盘请求队列的平均大小。</td></tr><tr><td>await</td><td>完成对一个请求的服务所需的平均时间(按毫秒计),该平均时间为请求在磁盘队列中等待的时间加上磁盘对其服务所需的时间</td></tr><tr><td>svctm</td><td>提交到磁盘的请求的平均服务时间(按毫秒计)。该项表明磁盘完成一个请求所花费的平均时间。与await不同，该项不包含在队列中等待的时间</td></tr><tr><td>%util</td><td>利用率</td></tr></tbody></table> 
<p><code>当avgqu-sz的值特别大的时候，且请求等待时间</code>await<code>远远高于请求服务</code>svctm<code>所花费时间，且利用率%util为100%的时候，表明该磁盘处于饱和状态。</code></p> 
<blockquote> 
 <p>这有时会引起困惑，比如当<code>iostat(1)</code>报告说某个设备已经达到<code>100%</code>的使用率后，还能够接受更高的负载。它只是报告某个设备在一段时间内<code>100%</code>繁忙，并没有说设备的使用率达到<code>100%</code>了:此时也许仍然可以接受更高的负载。在一个卷后面有多个磁盘设备支撑的情况下由于可以并行处理请求，<code>iostat(1)</code>中的<code>%util</code>这个指标就更加具有迷惑性。</p> 
</blockquote> 
<h3><a id="free_m_476"></a>free -m</h3> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$free</span> -m
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:          <span class="token number">15730</span>        <span class="token number">7564</span>        <span class="token number">6440</span>          <span class="token number">52</span>        <span class="token number">1725</span>        <span class="token number">7754</span>
Swap:          <span class="token number">2067</span>           <span class="token number">0</span>        <span class="token number">2067</span>
</code></pre> 
<p>这个输出显示了用兆字节(MB)作为单位的可用内存。检查可用内存<code> (available)是否接近0</code>;这个值显示了在系统中还有多少实际剩余内存可用，<code>包括缓冲区和页缓存区</code>。将一些内存用于缓存可以提升文件系统的性能。可以根据不同的参数更换单位</p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$free</span> -g
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:             <span class="token number">15</span>           <span class="token number">7</span>           <span class="token number">6</span>           <span class="token number">0</span>           <span class="token number">1</span>           <span class="token number">7</span>
Swap:             <span class="token number">2</span>           <span class="token number">0</span>           <span class="token number">2</span>
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<h3><a id="sar_n_DEV_1_500"></a>sar -n DEV 1</h3> 
<p><strong>显示每个设备发送和接收的数据包数和字节数信息</strong></p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$sar</span> -n DEV <span class="token number">1</span>
Linux <span class="token number">4.18</span>.0-477.27.1.el8_8.x86_64 <span class="token punctuation">(</span>vms100.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2024</span>年01月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>

<span class="token number">11</span>时40分16秒     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
<span class="token number">11</span>时40分17秒        lo     <span class="token number">17.54</span>     <span class="token number">17.54</span>      <span class="token number">0.98</span>      <span class="token number">0.98</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒    ens160     <span class="token number">50.88</span>     <span class="token number">58.77</span>      <span class="token number">3.79</span>      <span class="token number">4.07</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.88</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒    ens224    <span class="token number">224.56</span>      <span class="token number">0.00</span>     <span class="token number">18.85</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">1.75</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒    ens256      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒 ovs-system      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒    br-tun      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒 tap9f7d35c5-15      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒    br-int      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">11</span>时40分17秒     br-ex      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
^C

平均时间:     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
平均时间:        lo     <span class="token number">22.94</span>     <span class="token number">22.94</span>      <span class="token number">1.29</span>      <span class="token number">1.29</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:    ens160     <span class="token number">50.22</span>     <span class="token number">51.08</span>      <span class="token number">3.70</span>      <span class="token number">4.32</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.87</span>      <span class="token number">0.00</span>
平均时间:    ens224    <span class="token number">224.24</span>      <span class="token number">0.00</span>     <span class="token number">18.70</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">1.30</span>      <span class="token number">0.00</span>
平均时间:    ens256      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: ovs-system      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:    br-tun      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: tap9f7d35c5-15      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:    br-int      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:     br-ex      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$
</code></pre> 
<table><thead><tr><th>列</th><th>说明</th></tr></thead><tbody><tr><td>rxpck/s</td><td>数据包接收速率</td></tr><tr><td>txpck/s</td><td>数据包发送速率</td></tr><tr><td>rxkB/s</td><td>kb接收速率</td></tr><tr><td>txkB/s</td><td>kb发送速率</td></tr><tr><td>rxcmp/s</td><td>压缩包接收速率</td></tr><tr><td>txcmp/s</td><td>压缩包发送速率</td></tr><tr><td>rxmcst/s</td><td>多播包接收速率</td></tr></tbody></table> 
<p><strong>显示每个设备的发送和接收错误信息</strong></p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms81.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~/ansible<span class="token punctuation">]</span>
└─<span class="token variable">$sar</span> -n EDEV <span class="token number">1</span> <span class="token number">1</span>
Linux <span class="token number">3.10</span>.0-693.el7.x86_64 <span class="token punctuation">(</span>vms81.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2022</span>年05月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">2</span> CPU<span class="token punctuation">)</span>

<span class="token number">22</span>时53分07秒     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
<span class="token number">22</span>时53分08秒     ens32      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 cali86e7ca9e9c2      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 cali13a4549bf1e      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 cali5a282a7bbb0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 cali12cf25006b5      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 cali45e02b0b21e      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒        lo      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒 calicb34164ec79      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒     tunl0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
<span class="token number">22</span>时53分08秒   docker0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>

平均时间:     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
平均时间:     ens32      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: cali86e7ca9e9c2      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: cali13a4549bf1e      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: cali5a282a7bbb0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: cali12cf25006b5      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: cali45e02b0b21e      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:        lo      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间: calicb34164ec79      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:     tunl0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
平均时间:   docker0      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>
┌──<span class="token punctuation">[</span>root@vms81.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~/ansible<span class="token punctuation">]</span>
└─$
</code></pre> 
<table><thead><tr><th>列</th><th>说明</th></tr></thead><tbody><tr><td>rxerr/s</td><td>接收错误率</td></tr><tr><td>txerr/s</td><td>发送错误率</td></tr><tr><td>co11/s</td><td>发送时的以太网冲突率</td></tr><tr><td>rxdrop/s</td><td>由于Linux内核缓冲区不足而导致的接收帧丢弃率</td></tr><tr><td>txdrop/s</td><td>由于Linux内核缓冲区不足而导致的发送帧丢弃率</td></tr><tr><td>txcarr/s</td><td>由于载波错误而导致的发送帧丢弃率</td></tr><tr><td>rxfram/s</td><td>由于帧对齐错误而导致的接收帧丢弃率</td></tr><tr><td>rxfifo/s</td><td>由于FIFO错误而导致的接收帧丢弃率</td></tr><tr><td>txfifo/s</td><td>由于FIFO错误而导致的发送帧丢弃率</td></tr></tbody></table> 
<p><strong>显示使用套接字(TCP、UDP和RAW)的总数信息</strong></p> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms81.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~/ansible<span class="token punctuation">]</span>
└─<span class="token variable">$sar</span> -n SOCK <span class="token number">1</span> <span class="token number">3</span>
Linux <span class="token number">3.10</span>.0-693.el7.x86_64 <span class="token punctuation">(</span>vms81.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2022</span>年05月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">2</span> CPU<span class="token punctuation">)</span>

<span class="token number">22</span>时56分23秒    totsck    tcpsck    udpsck    rawsck   ip-frag    tcp-tw
<span class="token number">22</span>时56分24秒      <span class="token number">3487</span>       <span class="token number">245</span>         <span class="token number">9</span>         <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">163</span>
<span class="token number">22</span>时56分25秒      <span class="token number">3487</span>       <span class="token number">245</span>         <span class="token number">9</span>         <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">165</span>
<span class="token number">22</span>时56分26秒      <span class="token number">3487</span>       <span class="token number">245</span>         <span class="token number">9</span>         <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">167</span>
平均时间:      <span class="token number">3487</span>       <span class="token number">245</span>         <span class="token number">9</span>         <span class="token number">0</span>         <span class="token number">0</span>       <span class="token number">165</span>
┌──<span class="token punctuation">[</span>root@vms81.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~/ansible<span class="token punctuation">]</span>
└─$
</code></pre> 
<table><thead><tr><th>列</th><th>说明</th></tr></thead><tbody><tr><td>totsck</td><td>当前正在被使用的套接字总数</td></tr><tr><td>tcpsck</td><td>当前正在被使用的TCP套接字总数</td></tr><tr><td>udpsck</td><td>当前正在被使用的UDP套接字总数</td></tr><tr><td>rawsck</td><td>当前正在被使用的RAW套接字总数</td></tr><tr><td>ip-frag</td><td>IP分片的总数</td></tr></tbody></table> 
<h3><a id="sar_n_TCPETCP_1_617"></a>sar -n TCP,ETCP 1</h3> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$sar</span> -n TCP,ETCP <span class="token number">1</span>
Linux <span class="token number">4.18</span>.0-477.27.1.el8_8.x86_64 <span class="token punctuation">(</span>vms100.liruilongs.github.io<span class="token punctuation">)</span>        <span class="token number">2024</span>年01月14日  _x86_64_        <span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>

<span class="token number">11</span>时39分24秒  active/s passive/s    iseg/s    oseg/s
<span class="token number">11</span>时39分25秒      <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">16.50</span>     <span class="token number">16.50</span>

<span class="token number">11</span>时39分24秒  atmptf/s  estres/s retrans/s isegerr/s   orsts/s
<span class="token number">11</span>时39分25秒      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">15.53</span>

<span class="token number">11</span>时39分25秒  active/s passive/s    iseg/s    oseg/s
<span class="token number">11</span>时39分26秒      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">5.00</span>      <span class="token number">5.00</span>

<span class="token number">11</span>时39分25秒  atmptf/s  estres/s retrans/s isegerr/s   orsts/s
<span class="token number">11</span>时39分26秒      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">4.00</span>

<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
^C

平均时间:  active/s passive/s    iseg/s    oseg/s
平均时间:      <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">17.82</span>     <span class="token number">17.82</span>

平均时间:  atmptf/s  estres/s retrans/s isegerr/s   orsts/s
平均时间:      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">16.83</span>
┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$

</code></pre> 
<p>使用<code>sar(1)</code>工具来查看 <code>TCP 指标和TCP 错误信息</code>。相关的字段包括如下几个。</p> 
<ul><li><code>active/s</code>:每秒本地发起的 TCP连接的数量(通过调用connect0)创建)。</li><li><code>passive/s</code>:每秒远端发起的 TCP连接的数量(通过调用accept0创建)。</li><li><code>retrans/s</code>:每秒TCP 重传的数量。</li><li><code>orsts/s</code>：每秒的连接重置数。表示每秒钟发生的连接重置次数。</li><li><code>atmptf/s</code>：每秒的连接尝试次数。表示每秒钟有多少个连接尝试被发起。</li><li><code>estres/s</code>：每秒建立的连接数。表示每秒钟成功建立的连接数。</li></ul> 
<p><strong><code>主动和被动连接计数</code>对于<code>业务负载画像</code>很有用。<code>重传</code>则是<code>网络或者远端主机有问题的征兆</code>。</strong></p> 
<h3><a id="top_660"></a>top</h3> 
<pre><code class="prism language-bash">┌──<span class="token punctuation">[</span>root@vms100.liruilongs.github.io<span class="token punctuation">]</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token variable">$top</span>
<span class="token function">top</span> - <span class="token number">11</span>:46:44 up <span class="token number">8</span> min,  <span class="token number">1</span> user,  load average: <span class="token number">6.52</span>, <span class="token number">17.45</span>, <span class="token number">10.38</span>
Tasks: <span class="token number">449</span> total,   <span class="token number">1</span> running, <span class="token number">448</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
%Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:  <span class="token number">0.9</span> us,  <span class="token number">1.1</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">96.8</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.6</span> hi,  <span class="token number">0.5</span> si,  <span class="token number">0.0</span> st
MiB Mem <span class="token builtin class-name">:</span>  <span class="token number">15730.5</span> total,   <span class="token number">7503.6</span> free,   <span class="token number">7147.4</span> used,   <span class="token number">1079.5</span> buff/cache
MiB Swap:   <span class="token number">2068.0</span> total,   <span class="token number">2068.0</span> free,      <span class="token number">0.0</span> used.   <span class="token number">8177.7</span> avail Mem

    PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
   <span class="token number">1947</span> <span class="token number">42418</span>     <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">555196</span> <span class="token number">132972</span>  <span class="token number">20272</span> S   <span class="token number">1.3</span>   <span class="token number">0.8</span>   <span class="token number">0</span>:12.86 heat-engine
  <span class="token number">10320</span> <span class="token number">42436</span>     <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">540276</span> <span class="token number">122200</span>  <span class="token number">17492</span> S   <span class="token number">1.3</span>   <span class="token number">0.8</span>   <span class="token number">0</span>:08.95 nova-scheduler
    <span class="token number">949</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">694072</span>  <span class="token number">31640</span>  <span class="token number">16876</span> S   <span class="token number">1.0</span>   <span class="token number">0.2</span>   <span class="token number">0</span>:16.58 tuned
   <span class="token number">1945</span> <span class="token number">42415</span>     <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">749212</span> <span class="token number">142564</span>  <span class="token number">34988</span> S   <span class="token number">1.0</span>   <span class="token number">0.9</span>   <span class="token number">0</span>:12.38 glance-api
   <span class="token number">1965</span> <span class="token number">42436</span>     <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">540120</span> <span class="token number">121848</span>  <span class="token number">17324</span> S   <span class="token number">1.0</span>   <span class="token number">0.8</span>   <span class="token number">0</span>:12.16 nova-conductor
  <span class="token number">15567</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">269540</span>   <span class="token number">5228</span>   <span class="token number">4160</span> R   <span class="token number">1.0</span>   <span class="token number">0.0</span>   <span class="token number">0</span>:00.05 <span class="token function">top</span>
  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<p>以 <code>top</code> 命令作为结束，对<code>相关结果进行二次确认</code>，并能够浏览系统和进程的摘要信息运气好的话，这个<code>60 秒分析过程</code>会帮助你找到一些性能问题的线索。</p> 
<p>可以通过 t 键和 m 对数据进行可视化展示</p> 
<pre><code class="prism language-bash"><span class="token function">top</span> - <span class="token number">19</span>:32:22 up <span class="token number">2</span> days,  <span class="token number">3</span>:01,  <span class="token number">1</span> user,  load average: <span class="token number">0.00</span>, <span class="token number">0.02</span>, <span class="token number">0.05</span>
Tasks: <span class="token number">237</span> total,   <span class="token number">2</span> running, <span class="token number">235</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
%Cpu0  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu1  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu2  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.3     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span> 
%Cpu3  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu4  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu5  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu6  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
%Cpu7  <span class="token builtin class-name">:</span>   <span class="token number">0.0</span>/0.0     <span class="token number">0</span><span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>
KiB Mem <span class="token builtin class-name">:</span> <span class="token number">14.9</span>/8154892  <span class="token punctuation">[</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span><span class="token operator">||</span>                                                                               <span class="token punctuation">]</span>
KiB Swap:  <span class="token number">0.0</span>/0        <span class="token punctuation">[</span>                                                                                             <span class="token punctuation">]</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/2e/48/YKjfvakX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_707"></a>博文部分内容参考</h3> 
<p>© 文中涉及参考链接内容版权归原作者所有，如有侵权请告知，这是一个开源项目，如果你认可它，不要吝啬星星哦 😃</p> 
<hr> 
<p><code>《BPF Performance Tools》</code></p> 
<hr> 
<p>© 2018-2023 liruilonger@gmail.com, All rights reserved. 保持署名-非商用-相同方式共享(CC BY-NC-SA 4.0)</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a64a2f1bfe4e3cb52191808b43ca9812/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于cubeMX的正点原子miniSTM32对W25Q64的存储使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/394861f27d5fbf0231b897e024dfbd56/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c#模板设计模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>