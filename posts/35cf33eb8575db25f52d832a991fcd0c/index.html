<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java8 读取、写入、遍历、监控文件及目录 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java8 读取、写入、遍历、监控文件及目录" />
<meta property="og:description" content="JavaDoc：https://javadocs.techempower.com/
文章目录 一、读取文件1. Java 8 Stream按行读取文件2. FileReader 按行读取文件3. try-with-resources模式自动关闭流 二、写入文件1. Java 8使用BufferedWriter写入文件2. 使用Files.write（）写入文件 三、遍历迭代目录1. Files.list（）–遍历所有文件和子目录2. Files.list（）–仅列出不包括子目录的文件3. Files.newDirectoryStream（）–列出所有文件和子目录4. Files.newDirectoryStream（）–仅迭代不包含子目录的文件5. 仅列出一定范围的所有文件6. 查找目录中的所有隐藏文件 四、监视目录，子目录和文件中的更改1. 如何注册WatchService2. 观察变化事件3. 监视目录，子目录和文件中的更改示例 一、读取文件 参考链接：https://howtodoinjava.com/java8/read-file-line-by-line-in-java-8-streams-of-lines-example/
在下面的实例中，将使用Stream来一行一行的读取文件。将要读取的文件 data.txt 内容如下：
Never store password except in mind. 将上面的文件一行一行的读取，如果有一行包含 password ，将这行打印出来
1. Java 8 Stream按行读取文件 利用Java 8 Stream按行读取文件内容，过滤包含 password 的行，并取出第一条打印出来
private static void readStreamOfLinesUsingFiles() throws IOException { Stream&lt;String&gt; lines = Files.lines(Paths.get(&#34;c:/temp&#34;, &#34;data.txt&#34;)); Optional&lt;String&gt; hasPassword = lines.filter(s -&gt; s.contains(&#34;password&#34;)).findFirst(); if(hasPassword.isPresent()) { System.out.println(hasPassword.get()); } //Close the stream and it&#39;s underlying file as well lines." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/35cf33eb8575db25f52d832a991fcd0c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-20T16:23:20+08:00" />
<meta property="article:modified_time" content="2021-05-20T16:23:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java8 读取、写入、遍历、监控文件及目录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>JavaDoc：https://javadocs.techempower.com/</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_4" rel="nofollow">一、读取文件</a></li><li><ul><li><a href="#1_Java_8_Stream_20" rel="nofollow">1. Java 8 Stream按行读取文件</a></li><li><a href="#2_FileReader__41" rel="nofollow">2. FileReader 按行读取文件</a></li><li><a href="#3_trywithresources_65" rel="nofollow">3. try-with-resources模式自动关闭流</a></li></ul> 
   </li><li><a href="#_131" rel="nofollow">二、写入文件</a></li><li><ul><li><a href="#1_Java_8BufferedWriter_135" rel="nofollow">1. Java 8使用BufferedWriter写入文件</a></li><li><a href="#2_Fileswrite_150" rel="nofollow">2. 使用Files.write（）写入文件</a></li></ul> 
   </li><li><a href="#_160" rel="nofollow">三、遍历迭代目录</a></li><li><ul><li><a href="#1_Fileslist_168" rel="nofollow">1. Files.list（）–遍历所有文件和子目录</a></li><li><a href="#2_Fileslist_191" rel="nofollow">2. Files.list（）–仅列出不包括子目录的文件</a></li><li><a href="#3_FilesnewDirectoryStream_215" rel="nofollow">3. Files.newDirectoryStream（）–列出所有文件和子目录</a></li><li><a href="#4_FilesnewDirectoryStream_234" rel="nofollow">4. Files.newDirectoryStream（）–仅迭代不包含子目录的文件</a></li><li><a href="#5__251" rel="nofollow">5. 仅列出一定范围的所有文件</a></li><li><a href="#6__276" rel="nofollow">6. 查找目录中的所有隐藏文件</a></li></ul> 
   </li><li><a href="#_291" rel="nofollow">四、监视目录，子目录和文件中的更改</a></li><li><ul><li><a href="#1_WatchService_297" rel="nofollow">1. 如何注册WatchService</a></li><li><a href="#2__307" rel="nofollow">2. 观察变化事件</a></li><li><a href="#3__332" rel="nofollow">3. 监视目录，子目录和文件中的更改示例</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_4"></a>一、读取文件</h3> 
<blockquote> 
 <p>参考链接：https://howtodoinjava.com/java8/read-file-line-by-line-in-java-8-streams-of-lines-example/</p> 
</blockquote> 
<p>在下面的实例中，将使用Stream来一行一行的读取文件。将要读取的文件 <em><strong>data.txt</strong></em> 内容如下：</p> 
<pre><code>Never
store
password
except
in mind.
</code></pre> 
<p>将上面的文件一行一行的读取，如果有一行包含 <em><strong>password</strong></em> ，将这行打印出来</p> 
<h4><a id="1_Java_8_Stream_20"></a>1. Java 8 Stream按行读取文件</h4> 
<p>利用Java 8 Stream按行读取文件内容，过滤包含 <em><strong>password</strong></em> 的行，并取出第一条打印出来</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readStreamOfLinesUsingFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
<span class="token punctuation">{<!-- --></span>
    Stream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/temp"</span><span class="token punctuation">,</span> <span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    Optional<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hasPassword <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">if</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">//Close the stream and it's underlying file as well</span>
    lines<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_FileReader__41"></a>2. FileReader 按行读取文件</h4> 
<p>直到java7，可采用下面的方式来读取文件，实现方法有很多，但不是本文的重点，只是与上面的例子对比来看</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readLinesUsingFileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
<span class="token punctuation">{<!-- --></span>
    File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"c:/temp/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    FileReader fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>fr<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    String line<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    br<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fr<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_trywithresources_65"></a>3. try-with-resources模式自动关闭流</h4> 
<p>第一个例子已经能够满足我们在应用程序中逐行读取文件的需要了，但如果你还想让它变得更好，那么我们可以使用 <em><strong>try-with-resources</strong></em> 的方式，这样会省去最后关闭流 <em><strong>close()</strong></em> 的操作。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readStreamOfLinesUsingFilesWithTryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
<span class="token punctuation">{<!-- --></span>
    Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/temp"</span><span class="token punctuation">,</span> <span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">//The stream hence file will also be closed here</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span>Stream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> lines <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Optional<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hasPassword <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">if</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当一个Stream产生另外一个Stream的时候，<em><strong>close</strong></em> 方法会链式调用（它下面的Stream也会调用），可以采用下面的方法编写：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readStreamOfLinesUsingFilesWithTryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
<span class="token punctuation">{<!-- --></span>
    Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/temp"</span><span class="token punctuation">,</span> <span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">//When filteredLines is closed, it closes underlying stream as well as underlying file.</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span>Stream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> filteredLines <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Optional<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hasPassword <span class="token operator">=</span> filteredLines<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">if</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>你想测试一下它下面的Stream的有没有触发 <em><strong>close</strong></em> ，可以用 <em><strong>onClose</strong></em> 来测试一下</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readStreamOfLinesUsingFilesWithTryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
<span class="token punctuation">{<!-- --></span>
    Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/temp"</span><span class="token punctuation">,</span> <span class="token string">"data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//When filteredLines is closed, it closes underlying stream as well as underlying file.</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span>Stream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> filteredLines <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
                                    <span class="token comment">//test if file is closed or not</span>
                                    <span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"File closed"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        Optional<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hasPassword <span class="token operator">=</span> filteredLines<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hasPassword<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出</p> 
<pre><code>password
File closed
</code></pre> 
<h3><a id="_131"></a>二、写入文件</h3> 
<blockquote> 
 <p>参考链接：https://howtodoinjava.com/java8/java-8-write-to-file-example/</p> 
</blockquote> 
<h4><a id="1_Java_8BufferedWriter_135"></a>1. Java 8使用BufferedWriter写入文件</h4> 
<p><em><strong>BufferedWriter</strong></em> 用于将文本写入字符或字节流。在打印字符之前，它将字符存储在缓冲区中，并批量打印。如果没有缓冲，每次调用 <em><strong>print ()</strong></em> 方法都会导致字符转换为字节，然后立即写入文件，效率会很低。</p> 
<pre><code class="prism language-java"><span class="token comment">//Get the file reference</span>
Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/output.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//Use try-with-resource to get auto-closeable writer instance</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>BufferedWriter writer <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newBufferedWriter</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Hello World !!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_Fileswrite_150"></a>2. 使用Files.write（）写入文件</h4> 
<p>使用 <em><strong>Files.write()</strong></em> 也很漂亮简洁.</p> 
<pre><code class="prism language-java">String content <span class="token operator">=</span> <span class="token string">"Hello World !!"</span><span class="token punctuation">;</span>
 
Files<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/output.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_160"></a>三、遍历迭代目录</h3> 
<blockquote> 
 <p>参考链接：https://howtodoinjava.com/java8/java-8-list-all-files-example/</p> 
</blockquote> 
<p>学习使用Java 8 API，例如<code>Files.list()</code>和<code>DirectoryStream</code>，并递归列出目录中存在的所有文件，包括隐藏文件。</p> 
<blockquote> 
 <p>对于使用外部迭代（<a href="https://howtodoinjava.com/java/flow-control/for-loop-in-java/" rel="nofollow">用于循环</a>），请使用<code>DirectoryStream</code>。要使用<a href="https://howtodoinjava.com/java8/java-streams-by-examples/" rel="nofollow">Stream API</a>操作（映射，过滤，排序，收集），请<code>Files.list()</code>改用。</p> 
</blockquote> 
<h4><a id="1_Fileslist_168"></a>1. Files.list（）–遍历所有文件和子目录</h4> 
<p><em><strong>Files.list()</strong></em> 方法 遍历当前目录下所有的文件和子目录</p> 
<pre><code class="prism language-java">Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>File<span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dirLocation<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Path<span class="token operator">:</span><span class="token operator">:</span>toFile<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"> Output<span class="token operator">:</span>
 
<span class="token punctuation">.</span>\filename1<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\directory1
<span class="token punctuation">.</span>\filename2<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\Employee<span class="token punctuation">.</span>java
</code></pre> 
<h4><a id="2_Fileslist_191"></a>2. Files.list（）–仅列出不包括子目录的文件</h4> 
<p>使用<strong>过滤器表达式</strong> <code>Files::isRegularFile</code> 检查文件是否是普通文件，来过滤掉子目录，保留文件并打印</p> 
<pre><code class="prism language-java">Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Files<span class="token operator">:</span><span class="token operator">:</span>isRegularFile<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>File<span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Files<span class="token operator">:</span><span class="token operator">:</span>isRegularFile<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Path<span class="token operator">:</span><span class="token operator">:</span>toFile<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">Output<span class="token operator">:</span>

<span class="token punctuation">.</span>\filename1<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\filename2<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\Employee<span class="token punctuation">.</span>java
</code></pre> 
<h4><a id="3_FilesnewDirectoryStream_215"></a>3. Files.newDirectoryStream（）–列出所有文件和子目录</h4> 
<p>Java提供了一个更加灵活遍历目录内容的方式：<em><strong>Files.newDirectoryStream()</strong></em></p> 
<blockquote> 
 <p>注意，如果对一个大的目录进行操作，使用 <code>DirectoryStream</code> 将提高代码的运行速度</p> 
</blockquote> 
<pre><code class="prism language-java">Files<span class="token punctuation">.</span><span class="token function">newDirectoryStream</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">Output<span class="token operator">:</span>
<span class="token punctuation">.</span>\filename1<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\directory1
<span class="token punctuation">.</span>\filename2<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\Employee<span class="token punctuation">.</span>java
</code></pre> 
<h4><a id="4_FilesnewDirectoryStream_234"></a>4. Files.newDirectoryStream（）–仅迭代不包含子目录的文件</h4> 
<p>只遍历文件，排除掉目录，通过path filter的第二个参数来控制</p> 
<pre><code class="prism language-java">Files<span class="token punctuation">.</span><span class="token function">newDirectoryStream</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path <span class="token operator">-</span><span class="token operator">&gt;</span> path<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">Output<span class="token operator">:</span>

<span class="token punctuation">.</span>\filename1<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\filename2<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span>\Employee<span class="token punctuation">.</span>java
</code></pre> 
<h4><a id="5__251"></a>5. 仅列出一定范围的所有文件</h4> 
<p>要仅获取某些扩展名的所有文件的列表，请同时使用两个谓词 <code>Files::isRegularFile</code>和<code>path.toString().endsWith(".java")</code>。</p> 
<p>使用上述谓词，我们将列出<code>.java</code>文件夹中的所有文件。</p> 
<pre><code class="prism language-java">Files<span class="token punctuation">.</span><span class="token function">newDirectoryStream</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        path <span class="token operator">-</span><span class="token operator">&gt;</span> path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>File<span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dirLocation<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Files<span class="token operator">:</span><span class="token operator">:</span>isRegularFile<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>path <span class="token operator">-</span><span class="token operator">&gt;</span> path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Path<span class="token operator">:</span><span class="token operator">:</span>toFile<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">Output<span class="token operator">:</span>

<span class="token punctuation">.</span>\Employee<span class="token punctuation">.</span>java
</code></pre> 
<h4><a id="6__276"></a>6. 查找目录中的所有隐藏文件</h4> 
<p>要查找所有隐藏文件，可以<code>file -&gt; file.isHidden()</code>在上述任何示例中使用<strong>过滤器表达式</strong>。</p> 
<pre><code class="prism language-java"><span class="token keyword">final</span> File<span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span>file <span class="token operator">-</span><span class="token operator">&gt;</span> file<span class="token punctuation">.</span><span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者 方法引用写法</span>
<span class="token keyword">final</span> File<span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span>File<span class="token operator">:</span><span class="token operator">:</span>isHidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者 使用Files工具类</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>File<span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>path <span class="token operator">-</span><span class="token operator">&gt;</span> path<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Path<span class="token operator">:</span><span class="token operator">:</span>toFile<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_291"></a>四、监视目录，子目录和文件中的更改</h3> 
<blockquote> 
 <p>参考链接：https://howtodoinjava.com/java8/java-8-watchservice-api-tutorial/</p> 
</blockquote> 
<p>在此将使用 Java 7 <code>WatchService</code>API观察目录及其中的所有子目录和文件。<code>WatchService</code> 是jdk1.7版本引进的，位于 <em><strong>java.nio.file</strong></em> 包下。<code>WatchService</code> 是基于本机操作系统实现对文件的监控。</p> 
<h4><a id="1_WatchService_297"></a>1. 如何注册WatchService</h4> 
<p>要注册<code>WatchService</code>，请获取目录路径并使用<code>path.register()</code>方法。</p> 
<pre><code class="prism language-java">Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WatchService watchService <span class="token operator">=</span>  path<span class="token punctuation">.</span><span class="token function">getFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newWatchService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
path<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>watchService<span class="token punctuation">,</span> StandardWatchEventKinds<span class="token punctuation">.</span>ENTRY_MODIFY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2__307"></a>2. 观察变化事件</h4> 
<p>要获取目录及其中文件的更改，请使用<code>watchKey.pollEvents()</code>方法，该方法以流的形式返回所有更改事件的集合。</p> 
<pre><code class="prism language-java">WatchKey watchKey <span class="token operator">=</span> null<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    watchKey <span class="token operator">=</span> watchService<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>watchKey <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        watchKey<span class="token punctuation">.</span><span class="token function">pollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>event <span class="token operator">-</span><span class="token operator">&gt;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    watchKey<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>该密钥一直有效，直到：</p> 
<ul><li>通过调用它的<code>cancel</code>方法显式地取消它，或者</li><li>隐式取消，因为该对象不再可访问，或者</li><li>通过关闭手表服务。</li></ul> 
<p>如果要在循环中多次重复使用同一键来获取更改事件，请不要忘记调用 <code>watchKey.reset()</code> 将键重新设置为<strong>就绪</strong>状态的方法。</p> 
<blockquote> 
 <p>请注意，诸如如何检测事件，其及时性以及是否保留其顺序之类的几件事高度依赖于底层操作系统。某些更改可能导致一个操作系统中的单个条目，而类似的更改可能导致另一操作系统中的多个事件。</p> 
</blockquote> 
<h4><a id="3__332"></a>3. 监视目录，子目录和文件中的更改示例</h4> 
<p>在此示例中，我们将看到一个观看目录的示例，该目录中包含所有子目录和文件。我们将维护监视键和目录的映射，<code>Map&lt;WatchKey, Path&gt; keys</code>以正确识别已修改的目录。</p> 
<p>下面的方法将向观察者注册一个path，然后将<strong>path</strong>和<strong>key</strong>存储在<strong>map</strong>中。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException 
<span class="token punctuation">{<!-- --></span>
    WatchKey key <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>watcher<span class="token punctuation">,</span> ENTRY_CREATE<span class="token punctuation">,</span> ENTRY_DELETE<span class="token punctuation">,</span> ENTRY_MODIFY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    keys<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在遍历目录结构并为遇到的每个目录调用此方法时，将递归调用此方法。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">walkAndRegisterDirectories</span><span class="token punctuation">(</span><span class="token keyword">final</span> Path start<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// register directory and sub-directories</span>
    Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics function"><span class="token punctuation">&lt;</span>Path<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> FileVisitResult <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
            <span class="token function">registerDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>请注意，无论何时创建新目录，我们都会在 <code>watchservice</code> 中注册该目录，并将新<strong>key</strong>添加到<strong>map</strong>中。</p> 
<pre><code class="prism language-java">WatchEvent<span class="token punctuation">.</span>Kind kind <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> ENTRY_CREATE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">walkAndRegisterDirectories</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// do something useful</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>将以上所有内容与处理事件的逻辑放在一起，完整的示例如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>StandardWatchEventKinds<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
 
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>FileSystems<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>FileVisitResult<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Paths<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>SimpleFileVisitor<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>WatchEvent<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>WatchKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>WatchService<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>attribute<span class="token punctuation">.</span>BasicFileAttributes<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java8WatchServiceExample</span> <span class="token punctuation">{<!-- --></span>
 
    <span class="token keyword">private</span> <span class="token keyword">final</span> WatchService watcher<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>WatchKey<span class="token punctuation">,</span> Path<span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     * Creates a WatchService and registers the given directory
     */</span>
    <span class="token function">Java8WatchServiceExample</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>watcher <span class="token operator">=</span> FileSystems<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newWatchService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics function"><span class="token punctuation">&lt;</span>WatchKey<span class="token punctuation">,</span> Path<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token function">walkAndRegisterDirectories</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * Register the given directory with the WatchService; This function will be called by FileVisitor
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException 
    <span class="token punctuation">{<!-- --></span>
        WatchKey key <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>watcher<span class="token punctuation">,</span> ENTRY_CREATE<span class="token punctuation">,</span> ENTRY_DELETE<span class="token punctuation">,</span> ENTRY_MODIFY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keys<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * Register the given directory, and all its sub-directories, with the WatchService.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">walkAndRegisterDirectories</span><span class="token punctuation">(</span><span class="token keyword">final</span> Path start<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// register directory and sub-directories</span>
        Files<span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics function"><span class="token punctuation">&lt;</span>Path<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> FileVisitResult <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span>Path dir<span class="token punctuation">,</span> BasicFileAttributes attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
                <span class="token function">registerDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> FileVisitResult<span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * Process all events for keys queued to the watcher
     */</span>
    <span class="token keyword">void</span> <span class="token function">processEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 
            <span class="token comment">// wait for key to be signalled</span>
            WatchKey key<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                key <span class="token operator">=</span> watcher<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
 
            Path dir <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dir <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WatchKey not recognized!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
 
            <span class="token keyword">for</span> <span class="token punctuation">(</span>WatchEvent<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> event <span class="token operator">:</span> key<span class="token punctuation">.</span><span class="token function">pollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"rawtypes"</span><span class="token punctuation">)</span>
                WatchEvent<span class="token punctuation">.</span>Kind kind <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token comment">// Context for directory entry event is the file name of entry</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
                Path name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>WatchEvent<span class="token generics function"><span class="token punctuation">&lt;</span>Path<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>event<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Path child <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token comment">// print out event</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s: %s\n"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token comment">// if directory is created, and watching recursively, then register it and its sub-directories</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>kind <span class="token operator">==</span> ENTRY_CREATE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>Files<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">walkAndRegisterDirectories</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// do something useful</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
 
            <span class="token comment">// reset key and remove from set if directory no longer accessible</span>
            <span class="token keyword">boolean</span> valid <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                keys<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token comment">// all directories are inaccessible</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
        Path dir <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c:/temp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Java8WatchServiceExample</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行该程序，并在给定输入目录中，新增更改文件或者目录后，您将在控制台中注意到捕获的事件。</p> 
<pre><code class="prism language-java">输出：

ENTRY_CREATE：c：\ temp \ New文件夹
ENTRY_DELETE：c：\ temp \ New文件夹
ENTRY_CREATE：c：\ temp \ data
ENTRY_CREATE：c：\ temp \ data \ New <span class="token class-name">Text</span> Document<span class="token punctuation">.</span>txt
ENTRY_MODIFY：c：\ temp \ data
ENTRY_DELETE：c：\ temp \ data \ New <span class="token class-name">Text</span> Document<span class="token punctuation">.</span>txt
ENTRY_CREATE：c：\ temp \ data \ tempFile<span class="token punctuation">.</span>txt
ENTRY_MODIFY：c：\ temp \ data
ENTRY_MODIFY：c：\ temp \ data \ tempFile<span class="token punctuation">.</span>txt
ENTRY_MODIFY：c：\ temp \ data \ tempFile<span class="token punctuation">.</span>txt
ENTRY_MODIFY：c：\ temp \ data \ tempFile<span class="token punctuation">.</span>txt
</code></pre> 
<p><code>WatchService</code> 需要牢记两件事：</p> 
<ol><li><code>WatchService</code> 不会为监视目录的子目录拾取事件。</li><li>我们仍然需要轮询 <code>WatchService</code> 的事件，而不是接收异步通知。</li><li><code>WatchService</code>能立即监控到文件的改动。 如果事件是创建，删除或更新，并且该事件相对于监视目录，则 <code>WatchEvent.context</code> 方法将返回Path对象。 重要的是要知道，当收到事件时，不能保证执行该操作的程序已经完成，因此可能需要一定程度的协调，比如判断文件操作成功。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/114c9030c8803f361a2fd39ab90916cd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL Server2008 错误源:.net SqlClient data provider的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6be3fecc7b7ca702ad4d0edab405404/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win10下IDEA连接虚拟机上的HDFS实现文件操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>