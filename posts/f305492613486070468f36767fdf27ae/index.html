<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Java】gRPC与Spring boot继承实现示例 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Java】gRPC与Spring boot继承实现示例" />
<meta property="og:description" content="上篇文章介绍了如何通过一个简单的maven项目实现gRPC客户端与服务端通信协议测试。但是这个只是一个普通的Java工程，我们在Java web开发的今天大多数Java程序员都是通过SpringCloud及SpringBoot开启微服务或者单个应用的开发，我们最好通过springboot继承gRPC，这样一个工程既可以支持web开发，也可以支持gRPC协议通信。庆幸的是有大佬yidongnan早为我们准备好了grpc相关starter，对应的开源代码地址如下：
https://github.com/yidongnan/grpc-spring-boot-starter
grpc-client-spring-boot-starter：client端start，实现自动注入stub的实现
grpc-client-spring-boot-autoconfigure：client端grpc Springboot配置文件自动加载注入
grpc-server-spring-boot-starter：server端启动starter，实现自动注入XXXServiceGrpc
grpc-server-spring-boot-autoconfigure：server端grpc springboot配置文件自动加载注入
这里是大佬yidongnan维护的项目：gRPC-Spring-Boot-Starter 文档及源码
gRPC-Spring-Boot-Starter 文档 | grpc-spring 具体server端实现和client端实现完全可以参考大佬的examples，完全足够让你理解其实现的便捷性，你也可以按照其参考实现，提供maven和gradle两种构建方式。如果你在看的过程中还有些许不懂，下面是我按照自己的理解把之前gRPC逻辑重新实现了一下，看这篇文章之前，建议先看一下我之前的一篇文章：
【JAVA】protobuf在Java中代码测试用例-CSDN博客
我们主要做以下工作
创建一个父项目（springboot-rpc），包括以下几个module
定义服务调用接口程序（rpc-interface），一个普通工程创建server端Springboot服务（rpc- server），依赖接口程序创建client端Springboot服务（rpc-client），依赖接口程序 一、创建父项目
1.父项目pom.xml，在springboot-rpc工程配置子module需要用到的maven依赖
&lt;groupId&gt;org.example&lt;/groupId&gt; &lt;artifactId&gt;springboot-rpc&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;modules&gt; &lt;module&gt;rpc-interface&lt;/module&gt; &lt;module&gt;rpc-server&lt;/module&gt; &lt;module&gt;rpc-client&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;grpc.version&gt;1.59.1&lt;/grpc.version&gt;&lt;!-- CURRENT_GRPC_VERSION --&gt; &lt;protobuf.version&gt;3.24.0&lt;/protobuf.version&gt; &lt;protoc.version&gt;3.24.0&lt;/protoc.version&gt; &lt;!-- required for JDK 8 --&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-services&lt;/artifactId&gt; &lt;version&gt;${grpc.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.grpc&lt;/groupId&gt; &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt; &lt;version&gt;${grpc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f305492613486070468f36767fdf27ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-12T11:50:25+08:00" />
<meta property="article:modified_time" content="2023-12-12T11:50:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Java】gRPC与Spring boot继承实现示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>上篇文章介绍了如何通过一个简单的maven项目实现gRPC客户端与服务端通信协议测试。但是这个只是一个普通的Java工程，我们在Java web开发的今天大多数Java程序员都是通过SpringCloud及SpringBoot开启微服务或者单个应用的开发，我们最好通过springboot继承gRPC，这样一个工程既可以支持web开发，也可以支持gRPC协议通信。庆幸的是有大佬yidongnan早为我们准备好了grpc相关starter，对应的开源代码地址如下：</p> 
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter" title="https://github.com/yidongnan/grpc-spring-boot-starter">https://github.com/yidongnan/grpc-spring-boot-starter</a></p> 
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter/tree/master/grpc-client-spring-boot-starter" title="grpc-client-spring-boot-starter：client端start，实现自动注入stub的实现">grpc-client-spring-boot-starter：client端start，实现自动注入stub的实现</a></p> 
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter/tree/master/grpc-client-spring-boot-autoconfigure" title="grpc-client-spring-boot-autoconfigure：client端grpc Springboot配置文件自动加载注入">grpc-client-spring-boot-autoconfigure：client端grpc Springboot配置文件自动加载注入</a></p> 
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter/tree/master/grpc-server-spring-boot-starter" title="grpc-server-spring-boot-starter">grpc-server-spring-boot-starter</a>：server端启动starter，实现自动注入XXXServiceGrpc</p> 
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter/tree/master/grpc-server-spring-boot-autoconfigure" title="grpc-server-spring-boot-autoconfigure：server端grpc springboot配置文件自动加载注入">grpc-server-spring-boot-autoconfigure：server端grpc springboot配置文件自动加载注入</a></p> 
<p>这里是大佬yidongnan维护的项目：gRPC-Spring-Boot-Starter 文档及源码</p> 
<h2 id="grpc-spring-boot-starter-文档"><a href="https://grpc-ecosystem.github.io/grpc-spring/zh-CN/" rel="nofollow" title="gRPC-Spring-Boot-Starter 文档 | grpc-spring">gRPC-Spring-Boot-Starter 文档 | grpc-spring</a></h2> 
<p></p> 
<p>具体server端实现和client端实现完全可以参考大佬的examples，完全足够让你理解其实现的便捷性，你也可以按照其参考实现，提供maven和gradle两种构建方式。如果你在看的过程中还有些许不懂，下面是我按照自己的理解把之前gRPC逻辑重新实现了一下，看这篇文章之前，建议先看一下我之前的一篇文章：<br><a href="https://blog.csdn.net/smallbirdnq/article/details/134835984?spm=1001.2014.3001.5501" title="【JAVA】protobuf在Java中代码测试用例-CSDN博客">【JAVA】protobuf在Java中代码测试用例-CSDN博客</a></p> 
<p>我们主要做以下工作</p> 
<p>创建一个父项目（springboot-rpc），包括以下几个module</p> 
<ol><li>定义服务调用接口程序（rpc-interface），一个普通工程</li><li>创建server端Springboot服务（rpc- server），依赖接口程序</li><li>创建client端Springboot服务（rpc-client），依赖接口程序</li></ol> 
<p>一、创建父项目</p> 
<p>1.父项目pom.xml，在springboot-rpc工程配置子module需要用到的maven依赖</p> 
<pre><code class="hljs">    &lt;groupId&gt;org.example&lt;/groupId&gt;
    &lt;artifactId&gt;springboot-rpc&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;modules&gt;
        &lt;module&gt;rpc-interface&lt;/module&gt;
        &lt;module&gt;rpc-server&lt;/module&gt;
        &lt;module&gt;rpc-client&lt;/module&gt;
    &lt;/modules&gt;
    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;grpc.version&gt;1.59.1&lt;/grpc.version&gt;&lt;!-- CURRENT_GRPC_VERSION --&gt;
        &lt;protobuf.version&gt;3.24.0&lt;/protobuf.version&gt;
        &lt;protoc.version&gt;3.24.0&lt;/protoc.version&gt;
        &lt;!-- required for JDK 8 --&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.grpc&lt;/groupId&gt;
                &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt;
                &lt;version&gt;${grpc.version}&lt;/version&gt;
                &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.grpc&lt;/groupId&gt;
                &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;
                &lt;version&gt;${grpc.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.grpc&lt;/groupId&gt;
                &lt;artifactId&gt;grpc-services&lt;/artifactId&gt;
                &lt;version&gt;${grpc.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.grpc&lt;/groupId&gt;
                &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;
                &lt;version&gt;${grpc.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt; &lt;!-- necessary for Java 9+ --&gt;
                &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                &lt;artifactId&gt;annotations-api&lt;/artifactId&gt;
                &lt;version&gt;6.0.53&lt;/version&gt;
                &lt;scope&gt;provided&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
                &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
                &lt;version&gt;${protobuf.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
                &lt;artifactId&gt;protobuf-java-util&lt;/artifactId&gt;
                &lt;version&gt;${protobuf.version}&lt;/version&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;</code></pre> 
<p>二、定义接口程序</p> 
<p>1.定义接口定义程序rpc-interface maven依赖配置pom.xml</p> 
<pre><code class="hljs">    &lt;parent&gt;
        &lt;groupId&gt;org.example&lt;/groupId&gt;
        &lt;artifactId&gt;springboot-rpc&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;rpc-interface&lt;/artifactId&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;!-- required for JDK 8 --&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;


    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.grpc&lt;/groupId&gt;
            &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;
            &lt;!--&lt;version&gt;1.59.1&lt;/version&gt;--&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.grpc&lt;/groupId&gt;
            &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;
            &lt;!--&lt;version&gt;1.59.1&lt;/version&gt;--&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
            &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
            &lt;artifactId&gt;protobuf-java-util&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;!-- Java 9+ compatibility - Do NOT update to 2.0.0 --&gt;
            &lt;groupId&gt;jakarta.annotation&lt;/groupId&gt;
            &lt;artifactId&gt;jakarta.annotation-api&lt;/artifactId&gt;
            &lt;version&gt;1.3.5&lt;/version&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;extensions&gt;
            &lt;extension&gt;
                &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt;
                &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.7.1&lt;/version&gt;
            &lt;/extension&gt;
        &lt;/extensions&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.3.0&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;test&lt;/id&gt;
                        &lt;phase&gt;generate-sources&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;add-source&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;sources&gt;
                                &lt;source&gt;${project.basedir}/target/generated-sources&lt;/source&gt;
                            &lt;/sources&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;com.github.os72&lt;/groupId&gt;
                &lt;artifactId&gt;protoc-jar-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.11.4&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;generate-sources&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;protocCommand&gt;protoc&lt;/protocCommand&gt;&lt;!-- brew install protobuf --&gt;
                            &lt;optimizeCodegen&gt;true&lt;/optimizeCodegen&gt;
                            &lt;protocVersion&gt;${protobuf.version}&lt;/protocVersion&gt;
                            &lt;includeStdTypes&gt;true&lt;/includeStdTypes&gt;
                            &lt;!-- 导入其他proto文件
                            &lt;includeDirectories&gt;
                                &lt;include&gt;src/main/more_proto_imports&lt;/include&gt;
                            &lt;/includeDirectories&gt;
                            --&gt;
                            &lt;!--指定proto文件 --&gt;
                            &lt;inputDirectories&gt;
                                &lt;directory&gt;src/main/protobuf&lt;/directory&gt;
                            &lt;/inputDirectories&gt;
                            &lt;outputTargets&gt;
                                &lt;outputTarget&gt;
                                    &lt;type&gt;java&lt;/type&gt;
                                &lt;/outputTarget&gt;
                                &lt;outputTarget&gt;
                                    &lt;type&gt;grpc-java&lt;/type&gt;
                                    &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:1.48.1&lt;/pluginArtifact&gt;
                                &lt;/outputTarget&gt;
                            &lt;/outputTargets&gt;
                            &lt;!--生成代码输出目录--&gt;
                            &lt;outputDirectory&gt;src/main/java&lt;/outputDirectory&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;</code></pre> 
<p>2.定义proto文件</p> 
<p>生成源码需要依赖proto文件，文件内容如下：</p> 
<pre><code class="hljs">syntax="proto3";
option go_package="./;student"; //关于最后生成的go文件是处在哪个目录哪个包中，.代表在当前目录生成，student代表了生成的go文件的包名是student

option java_multiple_files = true; //表示下面的message需要编译成多个java文件
option java_package = "grpc.student"; //指定该proto文件编译成的java源文件的包名
option java_outer_classname = "StudentProto"; // 表示下面的message编译成的java类文件的名字

package student; // 定义作用域

service DemoService {
  rpc Sender(StudentRequest) returns (StudentResponse){}
}

message StudentRequest {
  string Id = 1;
}

message StudentResponse {
  bytes result =1;
}

message Student {
  int64 Id = 1;
  string Name =2;
  string No =3;
}</code></pre> 
<p>3.生成源码程序</p> 
<p>依赖student.proto文件，执行编译生成源码文件，执行如下命令</p> 
<pre><code class="hljs">mvn clean compile #当前rpc-interface工程执行</code></pre> 
<p>将生成的源码拷贝到src/main/grpc/student包下，工程结构如下：</p> 
<pre><code class="hljs">rpc-interface
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   │   └── grpc
    │   │       └── student
    │   │           ├── DemoServiceGrpc.java
    │   │           ├── Student.java
    │   │           ├── StudentOrBuilder.java
    │   │           ├── StudentProto.java
    │   │           ├── StudentRequest.java
    │   │           ├── StudentRequestOrBuilder.java
    │   │           ├── StudentResponse.java
    │   │           └── StudentResponseOrBuilder.java
    │   ├── protobuf
    │   │   └── student.proto
    │   └── resources
</code></pre> 
<p>三、创建gRPC Server服务</p> 
<p>server端为了能依赖spring自动注入我们需要的Service实现，需要加入依赖<strong>grpc-server-spring-boot-starter，此starter自动根据springboot配置文件自动注入我们需要的service。</strong></p> 
<p>1.rpc-server pom.xml配置如下</p> 
<pre><code class="hljs">    &lt;parent&gt;
        &lt;groupId&gt;org.example&lt;/groupId&gt;
        &lt;artifactId&gt;springboot-rpc&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;rpc-server&lt;/artifactId&gt;
    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;net.devh&lt;/groupId&gt;
            &lt;artifactId&gt;grpc-server-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.15.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--
            如果需要提供web服务可以加入此依赖，版本注意按照grpc-server-spring-boot-starter依赖的spring-boot版本保持一致即可。
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;version&gt;2.7.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--
            依赖接口定义
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.example&lt;/groupId&gt;
            &lt;artifactId&gt;rpc-interface&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre> 
<p>2.rpc-server配置文件application.yml</p> 
<pre><code class="hljs">spring:
  application:
    name: student-rpc-server  #rpc client根据此名称配置

server:
  servlet:
    context-path: /
  port: 9999

#grpc server端暴露的端口
grpc:
  server:
    port: 10005</code></pre> 
<p>3.编写server端的接口实现</p> 
<p>在rpc- interface中定义的接口sender()方法需要在这里实现，并标注@GrpcService注解，代码如下：</p> 
<pre><code class="language-java">@GrpcService
public class RpcServerImpl extends DemoServiceGrpc.DemoServiceImplBase {
    private Logger log = LoggerFactory.getLogger(RpcServerImpl.class.getName());
    @Override
    public void sender(StudentRequest request, StreamObserver&lt;StudentResponse&gt; responseObserver) {
        if (Strings.isNullOrEmpty(request.getId())){
            log.warn("request get param id is null");
            return;
        }
        int id = Integer.parseInt(request.getId());
        //build a student object then serialize it
//            Student student = Student.newBuilder().build().;
        Student.Builder builder = Student.newBuilder();
        builder.setId(id);
        builder.setName("easton");
        builder.setNo("10001");
        Student student = builder.build();
        //try catch 属于测试序列化与反序列化代码块
        ByteString jsonBs = null;
        try {
            //protobuf 序列化
            String jsonStr = JsonFormat.printer().print(student);
            log.info("json format:"+jsonStr);
            jsonBs =  ByteString.copyFromUtf8(jsonStr);
            //反序列化
            byte[] bytes = student.toByteArray();
            Student student1 = Student.parseFrom(bytes);

        } catch (InvalidProtocolBufferException e) {
            throw new RuntimeException(e);
        }
//            ByteString bs =  student.toByteString();
        StudentResponse response = StudentResponse.newBuilder().setResult(jsonBs).build();
        responseObserver.onNext(response);
        //需要告诉客户端数据写完，否则客户端会一直等待数据回传结束
        responseObserver.onCompleted();
        log.info("server method run  finish");
    }

}</code></pre> 
<p>4.编写rpc-server启动类 </p> 
<pre><code class="language-java">@SpringBootApplication
public class BootStrarpApplication {
    public static void main(String[] args) {
        SpringApplication.run(BootStrarpApplication.class,args);
    }
}
</code></pre> 
<p>四、创建gRPC client服务</p> 
<p>创建完server端后接着编写客户端springboot服务</p> 
<p>1.rpc-client pom.xml配置</p> 
<p>跟服务端相对应需要引入依赖：grpc-client-spring-boot-starter，此starter会自动注入客户端stub实现，依赖配置为：</p> 
<pre><code class="language-java">    &lt;parent&gt;
        &lt;groupId&gt;org.example&lt;/groupId&gt;
        &lt;artifactId&gt;springboot-rpc&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;rpc-client&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.devh&lt;/groupId&gt;
            &lt;artifactId&gt;grpc-client-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.15.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--
            web服务需要依赖此starter
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;version&gt;2.7.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--
            依赖接口定义
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.example&lt;/groupId&gt;
            &lt;artifactId&gt;rpc-interface&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre> 
<p>2.rpc-client stub注入的代码调用实现</p> 
<p>定义方法，此方法用来gRPC调用服务端sender()方法</p> 
<pre><code class="language-java">@Service
public class StudentClientService {

    //初始化student-rpc-server对应的stub，如果需要多个可以在这里注入
    @GrpcClient("student-rpc-server")
    private DemoServiceGrpc.DemoServiceBlockingStub blockingStub;

    Logger logger = LoggerFactory.getLogger(StudentClientService.class);
    public String sendToServer(int id){
        logger.info("Will try to send " + id + " ...");
        StudentRequest request = StudentRequest.newBuilder().setId(String.valueOf(id)).build();
        StudentResponse response;
        try{
            response = blockingStub.sender(request);

        }catch (StatusRuntimeException e){
            e.printStackTrace();
            logger.warn("RPC failed: {0}", e.getStatus());
            return "";
        }
        ByteString byteString = response.getResult();
        String result = byteString.toStringUtf8();
        logger.info("Result: " +result);
        return result;
    }
}</code></pre> 
<p>3.rpc-client启动类</p> 
<pre><code class="language-java">@SpringBootApplication
public class BootStrapApplication {
    public static void main(String[] args) {
        SpringApplication.run(BootStrapApplication.class,args);
    }
}</code></pre> 
<p>4.rpc-client 配置文件application.yml配置</p> 
<pre><code class="language-java">server:
  port: 8080
  servlet:
    context-path: /
spring:
  application:
    name: student-rpc-client
grpc:
  client:
    student-rpc-server:   #服务名称不能写错，这个需要和server端spring.application.name的定义的名称一致，否默认的negotiationType:tls
      address: 'static://localhost:10005'
      # 是否开启保持连接（长连接）
      enableKeepAlive: true
      # 保持连接时长（默认20s）
      keepAliveTimeout: 20s
      # 没有RPC调用时是否保持连接（默认false，可禁用避免额外消耗CPU）
      keepAliveWithoutCalls: false
      # 客户端负载均衡策略(round_robin（默认）, pick_first)
      defaultLoadBalancingPolicy: round_robin
      # 通信类型
      # plaintext | plaintext_upgrade | tls
      # 明文通信且http/2 | 明文通信且升级http/1.1为http/2 | 使用TLS（ALPN/NPN）通信
      negotiationType: plaintext
#    GLOBAL: 可以指定所有grpc通用配置
</code></pre> 
<p>5.定义一个测试接口</p> 
<p>由于rpc- client开启了web服务，为了模拟接口调用，以Restful协议请求rpc-client http接口，http接口调用grpc server服务，创建接口如下：</p> 
<pre><code class="language-java">@RestController
public class DemoClientController {

    @Autowired
    private StudentClientService clientService;
    @RequestMapping(value = "/getResult",method = RequestMethod.GET)
    public String getResult(@RequestParam("id") String id){
        return  clientService.sendToServer(Integer.valueOf(id));
    }
}</code></pre> 
<p>五、调用测试</p> 
<p>1.启动服务端rpc-server</p> 
<p>2.启动客户端rpc-client</p> 
<p>3.通过浏览器URL请求测试：<a href="http://localhost:8080/getResult?id=111" rel="nofollow" title="http://localhost:8080/getResult?id=111">http://localhost:8080/getResult?id=111</a></p> 
<pre><code class="language-java">{ "Id": "111", "Name": "easton", "No": "10001" }</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b4c25accf28f422a7288c483bec36ffb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决问题：ERROR: No matching distribution found for torch==1.12.1&#43;cu102</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8e6a8a92b4fcdeb3c69e72aa467d8f0b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ELK原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>