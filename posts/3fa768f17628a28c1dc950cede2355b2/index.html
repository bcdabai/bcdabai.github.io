<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用YOLOV3快速实现UAV视角的目标检测--VisDrone2019 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用YOLOV3快速实现UAV视角的目标检测--VisDrone2019" />
<meta property="og:description" content="目录： 1. Visdrone2018数据集的介绍及下载；
2. Visdrone2018数据集标签格式转换；
3. YoloV3算法模型代码的调整以及模型的训练；
4. 总结；
（按照VOC格式生成的图片XML文件有需要的可留言）
前言： 学渣的生活就是拿着各种数据集在算法上各种训练、各种玩……当然，个人觉得还是有意思的，在你有一台Bebop2无人机的情况下，结合本人前面的博客，搭建一个无人机实时目标检测平台，再配合这个检测模型，还是相对有点意思的。先看一下训练后模型的检测效果吧，无人机实时传输回来的图像在工作站上实时的检测效果(在视频上测试的，照片为截图)，你再决定是不是要看本篇博客接下来的内容。要是觉得效果不是你想要的，你就不会浪费时间了…………为什么要去掉检测框的名字，是因为有名字，整个检测的画面好难看，至于怎么去掉检测框的名字，只需要屏蔽image.c代码中
draw_label(im, top &#43; width, left, label, rgb) 函数即可！
(视频观看链接：https://www.youtube.com/watch?v=5EITG1rbAHc&amp;t=36s
B站：https://www.bilibili.com/video/av54517585?from=search&amp;seid=11504153865247579114)
一．Visdrone2018数据集的介绍及下载 1.数据集的介绍：http://www.aiskyeye.com/views/index
2.数据下载的主页：http://www.aiskyeye.com/my/downloadD
3.在本次训练中，用到了Task1：Object Detection in Images的两部分实验数据：
Trainset(1.44GB)、Valset(0.07GB) 数据分别可通过百度云和google云下载；
4.数据下载好后解压放在同一文件夹内，以便后面的步骤使用；
二．Visdrone2018数据集标签格式转换 在该部分，实验中通过代码将Visdrone数据集标签格式转换至Darknet所需要的格式；
该部分代码，需要运行两次，放在两部分实验数据集(Train、Val)的目录下，分别运行即可；
运行后，每个文件夹里面会生成image.txt文件。(为了后面更加容易区分训练和验证的数据，在运行代码时可以修改改文件的名字，例如：train.txt、val.txt)
代码如下：（脚本参考来源于github，若有侵权，将及时删除！感谢每一位开源分享的大神！）
import os from pathlib import Path from PIL import Image import csv def convert(size, box): dw = 1. / size[0] dh = 1. / size[1] x = (box[0] &#43; box[2] / 2) * dw y = (box[1] &#43; box[3] / 2) * dh w = box[2] * dw h = box[3] * dh return (x, y, w, h) wd = os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3fa768f17628a28c1dc950cede2355b2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-12T17:26:23+08:00" />
<meta property="article:modified_time" content="2019-05-12T17:26:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用YOLOV3快速实现UAV视角的目标检测--VisDrone2019</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>目录：</h3> 
<p><strong>1. Visdrone2018数据集的介绍及下载；</strong><br> <strong>2. Visdrone2018数据集标签格式转换；</strong><br> <strong>3. YoloV3算法模型代码的调整以及模型的训练；</strong><br> <strong>4. 总结；</strong><br> <strong>（按照VOC格式生成的图片XML文件有需要的可留言）</strong></p> 
<h3><a id="_8"></a>前言：</h3> 
<p>学渣的生活就是拿着各种数据集在算法上各种训练、各种玩……当然，个人觉得还是有意思的，在你有一台Bebop2无人机的情况下，结合本人前面的博客，<a href="https://blog.csdn.net/weixin_38106878/article/details/88166969">搭建一个无人机实时目标检测平台</a>，再配合这个检测模型，还是相对有点意思的。先看一下训练后模型的检测效果吧，无人机实时传输回来的图像在工作站上实时的检测效果(在视频上测试的，照片为截图)，你再决定是不是要看本篇博客接下来的内容。要是觉得效果不是你想要的，你就不会浪费时间了…………为什么要去掉检测框的名字，是因为有名字，整个检测的画面好难看，至于怎么去掉检测框的名字，只需要屏蔽image.c代码中</p> 
<pre><code>draw_label(im, top + width, left, label, rgb) 
</code></pre> 
<p>函数即可！<br> <strong>(视频观看链接：https://www.youtube.com/watch?v=5EITG1rbAHc&amp;t=36s<br> B站：https://www.bilibili.com/video/av54517585?from=search&amp;seid=11504153865247579114)</strong><br> <img src="https://images2.imgbox.com/64/2e/Vh8cg9t0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Visdrone2018_19"></a>一．Visdrone2018数据集的介绍及下载</h3> 
<p>1.数据集的介绍：http://www.aiskyeye.com/views/index<br> 2.数据下载的主页：http://www.aiskyeye.com/my/downloadD<br> 3.在本次训练中，用到了Task1：Object Detection in Images的两部分实验数据：<br> Trainset(1.44GB)、Valset(0.07GB) 数据分别可通过百度云和google云下载；<br> 4.数据下载好后解压放在同一文件夹内，以便后面的步骤使用；</p> 
<h3><a id="Visdrone2018_27"></a>二．Visdrone2018数据集标签格式转换</h3> 
<p>在该部分，实验中通过代码将Visdrone数据集标签格式转换至Darknet所需要的格式；<br> 该部分代码，需要运行两次，放在两部分实验数据集(Train、Val)的目录下，分别运行即可；<br> 运行后，每个文件夹里面会生成image.txt文件。(为了后面更加容易区分训练和验证的数据，在运行代码时可以修改改文件的名字，例如：train.txt、val.txt)<br> <strong>代码如下：（脚本参考来源于github，若有侵权，将及时删除！感谢每一位开源分享的大神！）</strong></p> 
<pre><code>import os
from pathlib import Path
from PIL import Image
import csv


def convert(size, box):
    dw = 1. / size[0]
    dh = 1. / size[1]
    x = (box[0] + box[2] / 2) * dw
    y = (box[1] + box[3] / 2) * dh
    w = box[2] * dw
    h = box[3] * dh
    return (x, y, w, h)
            
wd = os.getcwd()

if not os.path.exists('labels'):
    os.makedirs('labels')


train_file = 'images.txt'  
train_file_txt = ''
    
anns = os.listdir('annotations')
for ann in anns:
    ans = ''
    outpath = wd + '/labels/' + ann
    if ann[-3:] != 'txt':
        continue
    with Image.open(wd + '/images/' + ann[:-3] + 'jpg') as Img:
        img_size = Img.size
    with open(wd + '/annotations/' + ann, newline='') as csvfile:
        spamreader = csv.reader(csvfile)
        for row in spamreader:
            if row[4] == '0':
                continue
            bb = convert(img_size, tuple(map(int, row[:4])))
            ans = ans + str(int(row[5])-1) + ' ' + ' '.join(str(a) for a in bb) + '\n'
            with open(outpath, 'w') as outfile:
                outfile.write(ans)
    train_file_txt = train_file_txt + wd + '/images/' + ann[:-3] + 'jpg\n'

with open(train_file, 'w') as outfile:
    outfile.write(train_file_txt)
</code></pre> 
<h3><a id="YoloV3_82"></a>三．YoloV3算法模型代码的调整以及模型的训练</h3> 
<p><strong>1.创建visdrone.data文件(按照如下方式修改)</strong></p> 
<pre><code>classes= 10
train  = /path/to/visdrone_train_dataset/images.txt
valid  = /path/to/visdrone_val_dataset/images.txt
names = data/visdrone.names
backup = backup
</code></pre> 
<p><strong>2.修改yolov3-voc.cfg文件</strong><br> 修改三处：(random参数可根据自己电脑GPU性能调整)</p> 
<pre><code>(第一部分)
[convolutional]
size=1
stride=1
pad=1
filters=45 ##255  f=3*(class+5)
activation=linear
[yolo]
mask = 6,7,8
achors=10,13, 16,30, 33,23, 30,61, 62, 45, 50.119, 116,90, 156,198, 373,326
classes=10 ##80
num=9
jitter=.3
ignore_thresh=.7
truth_thresh=1
random=1

(第二部分)
[convolutional]
size=1
stride=1
pad=1
filters=45 ##255  f=3*(class+5)
activation=linear
[yolo]
mask = 3,4,5
achors=10,13, 16,30, 33,23, 30,61, 62, 45, 50.119, 116,90, 156,198, 373,326
classes=10 ##80
num=9
jitter=.3
ignore_thresh=.7
truth_thresh=1
random=1

(第三部分)
[convolutional]
size=1
stride=1
pad=1
filters=45 ##255  f=3*(class+5)
activation=linear
[yolo]
mask = 0,1,2
achors=10,13, 16,30, 33,23, 30,61, 62, 45, 50.119, 116,90, 156,198, 373,326
classes=10 ##80
num=9
jitter=.3
ignore_thresh=.7
truth_thresh=1
random=1
</code></pre> 
<p><strong>3.修改.names文件</strong><br> 阅读Visdrone官方.md文件可知道共计10类目标，visdrone.names:</p> 
<pre><code>pedestrian
people
bicycle
car
van
truck
tricycle
awning-tricycle
bus
motor
</code></pre> 
<p><strong>4.模型Train起来(用的是darknet53.conv.74这个pretrain_model)</strong></p> 
<pre><code>./darknet detector train cfg/visdrone.data cfg/yolov3-voc-visdrone.cfg darknet53.conv.74
</code></pre> 
<p><strong>注：若你有需求将txt转为xml<br> 将visdrone数据集的txt标签装换为voc格式的xml的脚本在<a href="https://blog.csdn.net/weixin_38106878/article/details/105580678">这篇博客上</a>，博客底部有数据集下载的baidu网盘地址：</strong><br> https://blog.csdn.net/weixin_38106878/article/details/105580678</p> 
<h3><a id="_169"></a>四．总结</h3> 
<p>最终，模型在一块1060显卡上迭代了50200次，大概花费了四天左右的时间，得到了最终的模型。<strong>对了，最终的loss没有很理想的收敛下来，貌似记的是在15的样子，不知道是不是数据太复杂了，还是迭代的次数不够。要是你们能够更好的收敛，欢迎交流！！**<strong>若需要数据的可通过本人百度网盘分享！</strong><br> 本篇博客若有不足，请多多谅解，互相学习，互相进步～未来会做更多相关的算法的实验！</strong>（预计下一篇博客的内容：改进YOLO网络框架来实现更加高效的检测（实验已经做完，有时间就把博客写上来！））**<br> <strong>最后再来一张检测结果的截图！！</strong><br> <img src="https://images2.imgbox.com/ac/74/c4FO5o5q_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/404c43ddf321cb7a17fc8d111af1614e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">重温世界杯</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8a14be38ce5be5bf09966366030e5466/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第一阶段SCRUM冲刺-07</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>