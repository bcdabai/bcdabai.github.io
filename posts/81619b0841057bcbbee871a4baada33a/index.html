<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sqlplus 中的spool命令 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sqlplus 中的spool命令" />
<meta property="og:description" content="一、Spool常用的设置 set arraysize 5000; //此参数可提高SPOOL卸载的速度，最大可以设置为5000
set autotrace on; //设置允许对执行的sql进行分析
set colsep &#39;,&#39;;　//域输出分隔符
set echo off;　//显示start启动的脚本中的每个sql命令，缺省为on
set feedback off;　//回显本次sql命令处理的记录条数，缺省为on，设置显示“已选择XX行”
set heading off;　//输出域标题，字段的名称，缺省为on
SET LINESIZE 2500; //每行允许的最大字符数，设置大些，免得数据被截断，但不宜过大，太大会大大降低导出的速度(注意必须与trimspool结合使用防止导出的文本有太多的尾部空格)
set newpage 1; //设置页与页之间的分隔{1|n|NONE};当值为0时在每页开头有一个小的黑方框;当值为n时在页和页之间隔着n个空行;当为none时，会在页和页之间没有任何间隔；
set newp none; //设置查询出来的数据分多少页显示，如果需要连续的数据，中间不要出现空行就把newp设置为none，这样输出的数据行都是连续的，中间没有空行之类的
set num 18; //设置数字的长度，如果不够大，则用科学记数法显示
set numwidth 12;　//输出number类型域长度，缺省为10
SET NULL text; //显示时,用text值代替NULL值
set pagesize 2000;　//输出每页行数，页面大小，缺省为24,为了避免分页，可设定为0
set serveroutput on; //设置允许显示输出类似dbms_output;--编写存储过程时,大多会将必要的信息输出；
SET SPACE 0;
set term off; //不在屏幕上输出执行结果
set termout off;　//显示脚本中的命令的执行结果，缺省为on
set timing on; //显示每个sql语句花费的执行时间，设置显示“已用时间：XXXX”" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/81619b0841057bcbbee871a4baada33a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-19T10:46:57+08:00" />
<meta property="article:modified_time" content="2020-11-19T10:46:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sqlplus 中的spool命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、Spool常用的设置</h2> 
<blockquote> 
 <p>set arraysize 5000;  //此参数可提高SPOOL卸载的速度，最大可以设置为5000<br> set autotrace on;    //设置允许对执行的sql进行分析<br> set colsep ',';　　　//域输出分隔符<br> set echo off;　　　　//显示start启动的脚本中的每个sql命令，缺省为on<br> set feedback off;　　//回显本次sql命令处理的记录条数，缺省为on，设置显示“已选择XX行”<br> set heading off;　　 //输出域标题，字段的名称，缺省为on<br> SET LINESIZE 2500;   //每行允许的最大字符数，设置大些，免得数据被截断，但不宜过大，太大会大大降低导出的速度(注意必须与trimspool结合使用防止导出的文本有太多的尾部空格)<br> set newpage 1;       //设置页与页之间的分隔{1|n|NONE};当值为0时在每页开头有一个小的黑方框;当值为n时在页和页之间隔着n个空行;当为none时，会在页和页之间没有任何间隔；<br> set newp none;       //设置查询出来的数据分多少页显示，如果需要连续的数据，中间不要出现空行就把newp设置为none，这样输出的数据行都是连续的，中间没有空行之类的<br> set num 18;          //设置数字的长度，如果不够大，则用科学记数法显示<br> set numwidth 12;　   //输出number类型域长度，缺省为10<br> SET NULL text;       //显示时,用text值代替NULL值<br> set pagesize 2000;　 //输出每页行数，页面大小，缺省为24,为了避免分页，可设定为0<br> set serveroutput on; //设置允许显示输出类似dbms_output;--编写存储过程时,大多会将必要的信息输出；<br> SET SPACE 0;<br> set term off;        //不在屏幕上输出执行结果<br> set termout off;　　 //显示脚本中的命令的执行结果，缺省为on<br> set timing on;       //显示每个sql语句花费的执行时间，设置显示“已用时间：XXXX”<br> set trimout on;　　　//去除标准输出每行的拖尾空格，缺省为off<br> set trimspool on;　　//去除重定向（spool）输出每行的拖尾空格，缺省为off<br> set verify off       //是否显示替代变量被替代前后的语句<br> SET wrap on;         //输出行长度大于设置行长度时(用set linesize n命令设置);值为on时,多余的字符另起一行显示,否则多余的字符将被切除，不予显示；</p> 
</blockquote> 
<pre><code class="language-sql">sqlplus /nolog &lt;&lt;- EOF
    set linesize 2500
	set pagesize 0
	set heading off
	set feedback off
	set echo off
	set termout off
	set trimout on
	set trimspool on
	SET SQLPROMPT #SQL&gt;
    CONN SECURITY/$securitypassword@$ORACLE_SID
	SPOOL 2-exp.sh
	@@ ./sql/2-gen_exp_security.sql
	SPOOL OFF 
	CONN TRADE/$tradepassword@$ORACLE_SID
	SPOOL 2-exp.sh APPEND
	@@ ./sql/2-gen_exp_trade.sql
	SPOOL OFF 
	CONN INTERFACE/$interfacepassword@$ORACLE_SID
	SPOOL 2-exp.sh APPEND
	@@ ./sql/2-gen_exp_interface.sql
	SPOOL OFF 
	CONN ULOG/$ulogpassword@$ORACLE_SID
	SPOOL 2-exp.sh APPEND
	@@ ./sql/2-gen_exp_ulog.sql
	SPOOL OFF 
	CONN CLEAR/$clearpassword@$ORACLE_SID
	SPOOL 2-exp.sh APPEND
	@@ ./sql/2-gen_exp_clear.sql
	SPOOL OFF 
	
	CONN SECURITY/$securitypassword@$ORACLE_SID
	SPOOL 5-imp.sh
	@@ ./sql/5-gen_imp_security.sql
	SPOOL OFF 
	CONN TRADE/$tradepassword@$ORACLE_SID
	SPOOL 5-imp.sh APPEND
	@@ ./sql/5-gen_imp_trade.sql
	SPOOL OFF 
	CONN INTERFACE/$interfacepassword@$ORACLE_SID
	SPOOL 5-imp.sh APPEND
	@@ ./sql/5-gen_imp_interface.sql
	SPOOL OFF 
	CONN ULOG/$ulogpassword@$ORACLE_SID
	SPOOL 5-imp.sh APPEND
	@@ ./sql/5-gen_imp_ulog.sql
	SPOOL OFF 
	CONN CLEAR/$clearpassword@$ORACLE_SID
	SPOOL 5-imp.sh APPEND
	@@ ./sql/5-gen_imp_clear.sql
    SPOOL OFF  
EOF
</code></pre> 
<p><strong>1 &lt;&lt;- EOF EOF</strong></p> 
<blockquote> 
 <p>在shell脚本中，通常将EOF与 &lt;&lt; 结合使用，表示后续的输入作为子命令或子Shell的输入，直到遇到EOF为止，再返回到主Shell。<br> EOF只是一个分界符，当然也可以用abcde替换。<br> 当shell遇到&lt;&lt;时，它知道下一个词是一个分界符。在该分界符以后的内容都被当作输入，直到shell又看到该分界符(位于单独的一行)。<br> 此分界符可以是所定义的任何字符串，其实，不一定要用EOF，只要是“内容段”中没有出现的字符串，都可以用来替代EOF，完全可以换成abcde之类的字符串，只是一个起始和结束的标志罢了。</p> 
</blockquote> 
<p><strong>2 set linesize 2500</strong></p> 
<blockquote> 
 <p>设置每行的字符输出个数为2500，放置换行（缺省为80 ）</p> 
</blockquote> 
<p><strong>3 set pagesize 0</strong></p> 
<blockquote> 
 <p>禁止分页输出</p> 
</blockquote> 
<p><strong>4 set heading off</strong></p> 
<blockquote> 
 <p>禁止输出标题（缺省为on）</p> 
</blockquote> 
<p><strong>5 set feedback off</strong></p> 
<blockquote> 
 <p>禁止回显sql命令处理的记录条数（缺省为on）</p> 
</blockquote> 
<p><strong>6 set echo off</strong></p> 
<blockquote> 
 <p>不显示脚本中的每个sql 命令（缺省为on）</p> 
</blockquote> 
<p><strong>7 set termout off</strong></p> 
<blockquote> 
 <p>禁止屏幕显示脚本中命令的执行结果（缺省为on）<br> 对实际输出文本没有影响</p> 
</blockquote> 
<p><strong>8 set trimout on</strong></p> 
<blockquote> 
 <p>去除标准输出每行的行尾空格（缺省为off）</p> 
</blockquote> 
<p><strong>9 set trimspool on</strong></p> 
<blockquote> 
 <p>去除spool 输出结果中每行的结尾空格（缺省为off）</p> 
</blockquote> 
<p><strong>10 SET SQLPROMPT #SQL&gt;</strong></p> 
<blockquote> 
 <p>去除开头和结尾的sql查询和结束命令</p> 
</blockquote> 
<p><strong>11 SPOOL xxxx.xx APPEND</strong></p> 
<blockquote> 
 <p>将内容附加到一个已经存在的文件中</p> 
</blockquote> 
<h3><a name="t0"></a><a id="_96"></a>引申</h3> 
<p><strong>12 set newpage 1</strong></p> 
<blockquote> 
 <p>设置页与页之间的分隔{1|n|NONE};当值为0时在每页开头有一个小的黑方框;当值为n时在页和页之间隔着n个空行;当为none时，会在页和页之间没有任何间隔；</p> 
</blockquote> 
<p><strong>13 set colsep |</strong>　　　</p> 
<blockquote> 
 <p>域输出分隔符</p> 
</blockquote> 
<p><strong>14 set sqlblankline off|on</strong></p> 
<blockquote> 
 <p>off 对SQL语句中的空行不处理<br> on 会正确处理空行</p> 
</blockquote> 
<p><strong>15 col column_name format a50</strong>**</p> 
<blockquote> 
 <p>设置column_name为50个字符宽</p> 
</blockquote> 
<h2>二、Spool 使用方法</h2> 
<p>说明：spool不但可以把数据导出到txt，也可以导出到csv等；不但可以导数据，也可以导出字符，拼装成sql文件等<br> 1.采用设置分隔符的方法<br> 说明：设定分隔符后，由sqlplus自己使用设定的分隔符对字段进行分割，这种方法不怎么用，在此不详述。</p> 
<blockquote> 
 <p>set colsep '|' --设置|为列分隔符 　　<br> set trimspool on 　　<br> set linesize 120 　　<br> set pagesize 2000 　　<br> set newpage 1 　　<br> set heading off 　　<br> set term off <br> set num 18 <br> set feedback off 　　<br> spool e:\temp.txt<br> select * from tablename; 　　<br> spool off</p> 
</blockquote> 
<p>2.采用分隔符并接，手工控制输出格式<br> 说明：最佳方法，该方法可以运用各种oracle函数处理导入时的字符。</p> 
<blockquote> 
 <p>set trimspool on<br> set linesize 120<br> set pagesize 2000<br> set newpage 1<br> set heading off<br> set term OFF<br> spool e:\fs_temp_tb_cm_serv_20120703.txt<br> select '地市,县区,用户,时间,流量,费用' form dual;<br> SELECT a_name||','||replace(replace(replace(b_name,chr(9)),chr(10)),chr(13))||','||replace(c_name,'\"')||','||to_char(create_time,'yyyy-mm-dd hh24:mi:ss')||','||net_flux||','||all_fee FROM temp_ltao10;<br> spool off</p> 
 <p>上面from dual语句会被当做表头字段先导出排在第一行<br> (SPOOL OUT比SPOOL OFF多了一个把文件发送到标准打印输出的动作。记得ItPub论坛上有位大虾总结得更简练“OUT = OFF + PRINT”。)<br> 10g以前的版本，spool会将文件覆盖，10g后，为追加。</p> 
</blockquote> 
<p>3.spool不但可以导出数据，也可以生成sql文件</p> 
<blockquote> 
 <p>spool c:\table.sql;   <br> select 'insert into changetable values('|| id||',',changedate||',',areaid||',',workunit||',',dept||',',post||',',address||',',zip||',',note||',',city||',',province||',',country||',',status||',',lawpeopleid||',',reason||',',feedback||');' from change where lawpeopleid not in (select id from LAWPEOPLE t );  <br> spool off</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/37810c94e0ccd82774bb6a4a58059c20/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python canvas画弧度_编程作战丨如何利用python绘制可爱皮卡丘？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ee2bffd3ad1e4e73d068327b350245b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ORACLE 碎片整理小结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>