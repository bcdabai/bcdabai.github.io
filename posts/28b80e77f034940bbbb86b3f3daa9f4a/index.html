<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在Spring-boot中操作MongoDB - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在Spring-boot中操作MongoDB" />
<meta property="og:description" content="MongoDB是一个基于分布式文件存储的数据库。由C&#43;&#43;语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。在使用spring-boot操作MongoDB数据库前，先了解一些MongoDB的基本概念和增删改查操作。下面是MongDB中某些概念与关系性数据库中概念类别。
在安装MongoDB数据库后，在terminal中输入mongodb命令，即可进入命令行模式，对mongDB进行增删改查操作，如下图所示，切换到myDB数据库，并对col collection进行查询操作。
这里整理了几个常用的增删改查脚本，可以在命令行中逐一输入验证，另外，除了操作数据外，还可以创建各种管理权限的用户。
db.mycol2.insert({&#34;name&#34; : &#34;Demo教程&#34;}) //自动创建集合
db.createCollection(&#34;mycol&#34;, { capped : true, max : 10000 } ) //创建集合并插入数据
db.COLLECTION_NAME.insert(document)或db.COLLECTION_NAME.save(document) //插入Document
db.col.insert({title: &#39;MongoDB教程&#39;, description: &#39;Nosql&#39;,tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;]}) db.col.update({&#39;title&#39;:&#39;MongoDB教程&#39;},{$set:{&#39;title&#39;:&#39;MongoDBNew&#39;}}) //updateDocument
db.col.find().pretty() //查询Document
db.createUser({user: &#34;Guru99&#34;,pwd: &#34;password&#34;,roles:[{role: &#34;userAdminAnyDatabase&#34; , db:&#34;admin&#34;}]}) //在admin数据库中创建管理员用户Guru99，用户角色是userAdminAnyDatabase，该角色允许用户对MongoDB中的所有数据库具有管理特权。
db.createUser({user: &#34;Employeeadmin&#34;,pwd: &#34;password&#34;,roles:[{role: &#34;userAdmin&#34; , db:&#34;Employee&#34;}]}) //在Employee数据库中创建普通用户Employeeadmin，角色是userAdmin，该角色允许用户仅对db选项中指定的数据库具有管理特权。
db.createUser({user: &#34;Mohan&#34;,pwd: &#34;password&#34;,roles:[{role: &#34;read&#34; , db:&#34;Marketing&#34;},role: &#34;readWrite&#34; , db:&#34;Sales&#34;}}]})
//创建用户Mohan，对Marketing数据库具备只读权限，对Sales数据库具备读写权限
上面的查询只是简单查询，如果要进行更加复杂的条件，应该如何编写了呢？下面总结了常用的查询条件
除了查询操作，还可以对Collection进行聚合操作，例如groupby等，具体如下所示：
聚合操作和管道相集合，例如$project控制显示的结果的数据结构字段，具体如下所示：
聚合操作除了上面的使用场景外，还可以通过$lookup支持多表关联查询，语法规则如下所示
{ $lookup: { from: &lt;collection to join&gt;, localField: &lt;field from the input documents&gt;, foreignField: &lt;field from the documents of the &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/28b80e77f034940bbbb86b3f3daa9f4a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-14T16:50:25+08:00" />
<meta property="article:modified_time" content="2023-02-14T16:50:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在Spring-boot中操作MongoDB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style=""> MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。在使用spring-boot操作MongoDB数据库前，先了解一些MongoDB的基本概念和增删改查操作。下面是MongDB中某些概念与关系性数据库中概念类别。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:473px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.145874%;height:0;"> 
    <img src="https://images2.imgbox.com/5f/59/sGvmngrA_o.png" style="margin-left:;display:block;width:473px;margin-top:-47.145874%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""> 在安装MongoDB数据库后，在terminal中输入mongodb命令，即可进入命令行模式，对mongDB进行增删改查操作，如下图所示，切换到myDB数据库，并对col collection进行查询操作。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:353px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:60.906513%;height:0;"> 
    <img src="https://images2.imgbox.com/45/f5/WBRBli6D_o.png" style="margin-left:;display:block;width:353px;margin-top:-60.906513%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""> 这里整理了几个常用的增删改查脚本，可以在命令行中逐一输入验证，另外，除了操作数据外，还可以创建各种管理权限的用户。</p> 
 <p style="">db.mycol2.insert({"name" : "Demo教程"}) //<span class="kdocs-color" style="color:#DB7800;">自动创建集合</span></p> 
 <p style="">db.createCollection("mycol", { capped : true, max : 10000 } ) //<span class="kdocs-color" style="color:#DB7800;">创建集合并插入数据</span></p> 
 <p style="">db.COLLECTION_NAME.insert(document)或db.COLLECTION_NAME.save(document) </p> 
 <p style="">//<span class="kdocs-color" style="color:#DB7800;">插入Document</span></p> 
 <p style="">db.col.insert({title: 'MongoDB教程', description: 'Nosql',tags: ['mongodb', 'database', 'NoSQL']}) </p> 
 <p style="">db.col.update({'title':'MongoDB教程'},{$set:{'title':'MongoDBNew'}}) //<span class="kdocs-color" style="color:#DB7800;">updateDocument</span></p> 
 <p style="">db.col.find().pretty() //<span class="kdocs-color" style="color:#DB7800;">查询Document</span></p> 
 <p style="">db.createUser({user: "Guru99",pwd: "password",roles:[{role: "userAdminAnyDatabase" , db:"admin"}]}) //<span class="kdocs-color" style="color:#DB7800;">在admin数据库中创建管理员用户Guru99，用户角色是userAdminAnyDatabase，该角色允许用户对MongoDB中的所有数据库具有管理特权</span>。</p> 
 <p style="">db.createUser({user: "Employeeadmin",pwd: "password",roles:[{role: "userAdmin" , db:"Employee"}]}) //<span class="kdocs-color" style="color:#DB7800;">在Employee数据库中创建普通用户Employeeadmin，角色是userAdmin，该角色允许用户仅对db选项中指定的数据库具有管理特权</span>。</p> 
 <p style="">db.createUser({user: "Mohan",pwd: "password",roles:[{role: "read" , db:"Marketing"},role: "readWrite" , db:"Sales"}}]})</p> 
 <p style="">//<span class="kdocs-color" style="color:#DB7800;">创建用户Mohan，对Marketing数据库具备只读权限，对Sales数据库具备读写权限</span></p> 
 <p style="">上面的查询只是简单查询，如果要进行更加复杂的条件，应该如何编写了呢？下面总结了常用的查询条件</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2468px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:28.93031%;height:0;"> 
    <img src="https://images2.imgbox.com/1b/09/PndE5bcE_o.png" style="margin-left:;display:block;width:2468px;margin-top:-28.93031%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">除了查询操作，还可以对Collection进行聚合操作，例如groupby等，具体如下所示：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2574px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:19.96892%;height:0;"> 
    <img src="https://images2.imgbox.com/19/ce/tiFBfR6v_o.png" style="margin-left:;display:block;width:2574px;margin-top:-19.96892%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">聚合操作和管道相集合，例如$project控制显示的结果的数据结构字段，具体如下所示：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1796px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:26.948774%;height:0;"> 
    <img src="https://images2.imgbox.com/95/bf/QMrhn57S_o.png" style="margin-left:;display:block;width:1796px;margin-top:-26.948774%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">聚合操作除了上面的使用场景外，还可以通过$lookup支持多表关联查询，语法规则如下所示</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">{
   $lookup:
     {
       from: &lt;collection to join&gt;,
       localField: &lt;field from the input documents&gt;,
       foreignField: &lt;field from the documents of the "from" collection&gt;,
       as: &lt;output array field&gt;
     }
}</code></pre> 
 <p style="">例如，创建order表和inventory表，执行联合查询脚本，如下所示：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">db.orders.aggregate([{
     $lookup:{from:"inventory",
         localField:"item",
         foreignField:"sku",as:"inventory_docs"}}])</code></pre> 
 <p style="">查询结果如下图所示：从结果可以看到,上面的多表查询和关系性数据库中的left join相似。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:2332px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:17.667238%;height:0;"> 
    <img src="https://images2.imgbox.com/29/d1/M9YoqAoS_o.png" style="margin-left:;display:block;width:2332px;margin-top:-17.667238%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""> 上面介绍的都是MongoDB的基础知识，接下来看看如果要在Spring-boot框架中操作MongoDB数据，应该如何进行。在初始化项目时首先需要引入"spring-boot-starter-data-mongodb"依赖，接着定义Model对象和Repository,代码片段如下图所示：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:601px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:84.69218%;height:0;"> 
    <img src="https://images2.imgbox.com/39/59/419tg4PD_o.png" style="margin-left:;display:block;width:601px;margin-top:-84.69218%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">和Spring Data JPA操作关系型数据库一样，Repository继承MongoRepository后，提供了数据写入查询等方法，所以CoffeRepository interface中无需写任何代码即可完成对mongodb的数据写入的查询操作。除了集成MongoRepository的方式，还可以使用MongoTemplate操作数据库数据，如下图所示：利用MongeTemplate提供的方法可以CRUD collection/document/view等。下图是部分利用MongoTempalte进行查询操作的代码片段，更多信息可查看<a class="kdocs-link" style="color:#0A6CFF;" href="https://github.com/tlqiao/spring-learning/tree/master/database/mongo-repository-demo" target="_blank" rel="noopener noreferrer">demo</a>。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1752px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:58.56164%;height:0;"> 
    <img src="https://images2.imgbox.com/a1/94/0xNCjNyq_o.png" style="margin-left:;display:block;width:1752px;margin-top:-58.56164%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">在实际项目中如果是简单查询可以直接使用Repository中提供的方法，如果是更灵活的查询可借助MongoTemplate完成。总结而言，如果要在spring-boot中操作MongoDB数据库中的数据，比较简单。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/457bc3b4b0788e321e0cf6acf271ab2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">elisa数据用什么分析方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/14b4fae8cd743afb81d13fd385db3210/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql-mmm集群</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>