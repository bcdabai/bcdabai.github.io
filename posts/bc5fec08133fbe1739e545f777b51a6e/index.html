<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UDS 34/36/37 服务 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UDS 34/36/37 服务" />
<meta property="og:description" content="从成本等角度考虑，汽车ECU中用于缓存诊断服务数据的buffer大小有限，所以当我们需要读取或写入超过buffer大小的数据时，就无法简单地使用2E和22服务了，UDS据此定义了几个将大块数据写入或读出的服务，即数据下载和上传。
UDS的第六类诊断服务：存储数据传输。该类型服务包含SID如下：
RequestDownload (0x34)：请求下载数据，诊断仪向ECU请求下载数据
RequestUpload (0x35)：请求上传数据，诊断仪向ECU请求上传数据
TransferData (0x36)：数据传输，诊断仪向ECU传数据（下载），或者ECU向诊断仪传数据（上传）
RequestTransferExit (0x37)：数据传输完成，请求退出
RequestFileTransfer (0x38)：请求文件传输，可以用于替代上传下载的服务
1. RequestDownload (0x34) service
该服务用于启动下载传输，作用是告知ECU准备接受数据，ECU则通过0x74 response告诉诊断仪自己是否允许传输，以及自己的接受能力是多大。
1.1 请求格式
由上图可知，请求格式分为5部分
第一部分：请求SID（1byte）：0x34
第二部分：dataFormatIdentifier（1byte）：这里面标识了数据格式相关的信息，比如数据是否有压缩，是否有加密，用的什么算法加密等，由主机厂与供应商约定好，用哪个bit来表示压缩、加密等信息。
第三部分：addressAndLengthFormatIdentifier（1byte）：该参数是代表后续的两个部分memoryAddress和memorySize所占的字节长度。addressAndLengthFormatIdentifier的低4bit表示memoryAddress，高4bit表示memorySize。如：memoryAddress参数占用0xm个字节，memorySize参数占用0xn个字节，则addressAndLengthFormatIdentifier值为0xnm
第四部分：memoryAddress（m个byte）：诊断仪向ECU请求下载写入数据的逻辑地址值。如：诊断仪请求ECU写入数据的内存逻辑地址为0x12345678（memoryAddress占4个字节），则memoryAddress值为0x12345678，对应addressAndLengthFormatIdentifier低4bit值为0x04.
第五部分：memorySize（n个字节）：诊断仪向ECU请求下载写入数据的字节数。如：诊断仪写入ECU数据的字节数为0x01234567（memorySize占4字节），则memorySize值为0x01234567，对应的addressAndLengthFormatIdentifier高4bit值为0x4。
1.2 响应格式
由上图可知响应格式分为三个部分
第一部分：response SID （1byte）： 0x74
第二部分：lengthFormatIdentifier（1byte）：高4bit为maxNumberOfBlockLength有效字节长度，低4bit保留为0.
lengthFormatIdentifier每半个字节单独编码。高半字节指定maxNumberOfBlockLength，低半字节设置为0保留。
maxNumberOfBlockLength长度取决于lengthFormatIdentifier的高半字节，此参数包括完整的消息长度（服务ID&#43;blocksequencecounter(1字节)）
第三分部：maxNumberOfBlockLength：字节长度不定，表示0x36服务一次传输一个block的最大的字节数。如：maxNumberOfBlockLength=0x202，则应用层36服务一次最多发送字节数为0x202（字节数：0x202 &gt;= 36 （1byte）&#43; parameter（x个byte））。后续36服务会细讲。
1.3 举例
诊断仪向ECU请求下载数据，dataFormatIdentifier值为0x00，该值有厂家或供应商协商制定，此处暂定为0x00。memoryAddress值为0x0x12345678（占4个字节），memorySize值为0x01234567（占4字节），则addressAndLengthFormatIdentifier值为0x44（该值计算方式上述请求格式中以说明）。
上图中不同颜色代表不同的参数
橙色：addressAndLengthFormatIdentifier（0x44）
紫色：memoryAddress（0x12345678）
绿色：memorySize（0x01234567）
青色：maxNumberOfBlockLength（0x0202）
2. TransferData (0x36) service
如果34服务得到了正确响应，诊断仪就要启动数据传输过程了，使用的就是36服务。
2.1 请求格式
上图可知请求格式分为三个部分
第一部分：请求SID ：0x36（1个byte）
第二部分：blockSequenceCounter（1个byte），34服务后，发送的第一个36服务时clockSequenceCounter=0x01，每次36服务请求便自增1，当增加到0xFF，此时下次请求36服务发送数据时blockSequenceCounter=0x00。
第三部分：transferRequestParameterRecord：字节长短和参数格式不定，由厂家制定。发送请求的数据。
2.2 响应格式
由上图可知响应格式分为三个部分
第一部分：response SID：0x76
第二部分：blockSequenceCounter：对请求的blockSequenceCounter的echo
第三部分：transferResponseParameterRecord，当36服务用于上传数据时，该参数必须的。36服务用于下载数据时，该参数非必须，此处不解析。
2.3 举例" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/bc5fec08133fbe1739e545f777b51a6e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-09T15:28:40+08:00" />
<meta property="article:modified_time" content="2023-02-09T15:28:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UDS 34/36/37 服务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>从成本等角度考虑，汽车ECU中用于缓存诊断服务数据的buffer大小有限，所以当我们需要读取或写入超过buffer大小的数据时，就无法简单地使用2E和22服务了，UDS据此定义了几个将大块数据写入或读出的服务，即数据下载和上传。</p> 
<p>UDS的第六类诊断服务：存储数据传输。该类型服务包含SID如下：</p> 
<p>RequestDownload (0x34)：请求下载数据，诊断仪向ECU请求下载数据<br> RequestUpload (0x35)：请求上传数据，诊断仪向ECU请求上传数据<br> TransferData (0x36)：数据传输，诊断仪向ECU传数据（下载），或者ECU向诊断仪传数据（上传）<br> RequestTransferExit (0x37)：数据传输完成，请求退出<br> RequestFileTransfer (0x38)：请求文件传输，可以用于替代上传下载的服务</p> 
<p>1. RequestDownload (0x34) service</p> 
<p>该服务用于启动下载传输，作用是告知ECU准备接受数据，ECU则通过0x74 response告诉诊断仪自己是否允许传输，以及自己的接受能力是多大。</p> 
<p>1.1 请求格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/db/cb/58QBqefM_o.png"></p> 
<p> </p> 
<p>由上图可知，请求格式分为5部分</p> 
<p>第一部分：请求SID（1byte）：0x34<br> 第二部分：dataFormatIdentifier（1byte）：这里面标识了数据格式相关的信息，比如数据是否有压缩，是否有加密，用的什么算法加密等，由主机厂与供应商约定好，用哪个bit来表示压缩、加密等信息。<br> 第三部分：addressAndLengthFormatIdentifier（1byte）：该参数是代表后续的两个部分memoryAddress和memorySize所占的字节长度。addressAndLengthFormatIdentifier的低4bit表示memoryAddress，高4bit表示memorySize。如：memoryAddress参数占用0xm个字节，memorySize参数占用0xn个字节，则addressAndLengthFormatIdentifier值为0xnm<br> 第四部分：memoryAddress（m个byte）：诊断仪向ECU请求下载写入数据的逻辑地址值。如：诊断仪请求ECU写入数据的内存逻辑地址为0x12345678（memoryAddress占4个字节），则memoryAddress值为0x12345678，对应addressAndLengthFormatIdentifier低4bit值为0x04.<br> 第五部分：memorySize（n个字节）：诊断仪向ECU请求下载写入数据的字节数。如：诊断仪写入ECU数据的字节数为0x01234567（memorySize占4字节），则memorySize值为0x01234567，对应的addressAndLengthFormatIdentifier高4bit值为0x4。</p> 
<p>1.2 响应格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d3/5d/aeQRDNMf_o.png"><br> 由上图可知响应格式分为三个部分</p> 
<p> </p> 
<p>第一部分：response SID （1byte）： 0x74<br> 第二部分：lengthFormatIdentifier（1byte）：高4bit为maxNumberOfBlockLength有效字节长度，低4bit保留为0.</p> 
<p>lengthFormatIdentifier每半个字节单独编码。高半字节指定maxNumberOfBlockLength，低半字节设置为0保留。</p> 
<p>maxNumberOfBlockLength长度取决于lengthFormatIdentifier的高半字节，此参数包括完整的消息长度（服务ID+blocksequencecounter(1字节)）<br>  </p> 
<p>第三分部：maxNumberOfBlockLength：字节长度不定，表示0x36服务一次传输一个block的最大的字节数。如：maxNumberOfBlockLength=0x202，则应用层36服务一次最多发送字节数为0x202（字节数：0x202 &gt;= 36 （1byte）+ parameter（x个byte））。后续36服务会细讲。</p> 
<p>1.3 举例<br> 诊断仪向ECU请求下载数据，dataFormatIdentifier值为0x00，该值有厂家或供应商协商制定，此处暂定为0x00。memoryAddress值为0x0x12345678（占4个字节），memorySize值为0x01234567（占4字节），则addressAndLengthFormatIdentifier值为0x44（该值计算方式上述请求格式中以说明）。</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/4d/cc/VExF8qga_o.png"></p> 
<p> </p> 
<p>上图中不同颜色代表不同的参数<br> 橙色：addressAndLengthFormatIdentifier（0x44）<br> 紫色：memoryAddress（0x12345678）<br> 绿色：memorySize（0x01234567）<br> 青色：maxNumberOfBlockLength（0x0202）</p> 
<p>2. TransferData (0x36) service</p> 
<p>如果34服务得到了正确响应，诊断仪就要启动数据传输过程了，使用的就是36服务。</p> 
<p>2.1 请求格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/6d/51/vGEf6SZC_o.png"><br> 上图可知请求格式分为三个部分</p> 
<p> </p> 
<p>第一部分：请求SID ：0x36（1个byte）<br> 第二部分：blockSequenceCounter（1个byte），34服务后，发送的第一个36服务时clockSequenceCounter=0x01，每次36服务请求便自增1，当增加到0xFF，此时下次请求36服务发送数据时blockSequenceCounter=0x00。<br> 第三部分：transferRequestParameterRecord：字节长短和参数格式不定，由厂家制定。发送请求的数据。</p> 
<p>2.2 响应格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/07/4d/NUemDXRC_o.png"><br> 由上图可知响应格式分为三个部分</p> 
<p> </p> 
<p>第一部分：response SID：0x76<br> 第二部分：blockSequenceCounter：对请求的blockSequenceCounter的echo<br> 第三部分：transferResponseParameterRecord，当36服务用于上传数据时，该参数必须的。36服务用于下载数据时，该参数非必须，此处不解析。</p> 
<p>2.3 举例</p> 
<p>假设诊断仪34服务请求下载30字节，ECU反馈每次最大下载maxNumberOfBlockLength为0x0A，则诊断仪使用36服务下载数据如下图所示：</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/99/39/8o3nM8T5_o.png"><br> 3. RequestTransferExit (0x37) service</p> 
<p> </p> 
<p>37服务用于退出上传下载，即诊断仪通过该诊断服务停止与ECU之间的数据传输。如果之前的34和36服务都顺利执行完成，那么37服务就可以得到ECU的positive response。否则ECU会负响应NRC 0x7F 37 24，表示诊断序列执行有错误。</p> 
<p>3.1 请求格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/4c/6b/74ybcYol_o.png"><br> 由上图可知请求格式分为两个部分</p> 
<p> </p> 
<p>第一部分：请求SID：0x37<br> 第二部分：transferRequestParameterRecord，字节长度和参数格式，厂家自定义，没有定义则默认字节数据为0。</p> 
<p>3.2 响应格式</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b6/09/BHi0Tlb8_o.png"><br> 由上图可知响应格式分为两个部分</p> 
<p> </p> 
<p>第一部分：response SID：0x77<br> 第二部分：transferResponseParameterRecord，字节长度和参数格式，厂家自定义，没有定义则默认字节数据为0。</p> 
<p>3.3 举例</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c4/ee/YkGBxdXK_o.png"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6773c0284f1afb1cb6f5a92b490f433c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">bash多进程执行python脚本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3c9bb1ea10289eea29b2c2c3275f577d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第十三届蓝桥杯省赛 JAVA B组（真题解析&#43;个人体会）（已更新完G题）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>