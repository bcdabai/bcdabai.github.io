<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>redis cluster搭建 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="redis cluster搭建" />
<meta property="og:description" content="准备服务器和端口号 IP 地址端口号路径192.168.0.2016001/app/redis-5.0.14/redis-6001192.168.0.2016002/app/redis-5.0.14/redis-6002192.168.0.2026001/app/redis-5.0.14/redis-6001192.168.0.2036002/app/redis-5.0.14/redis-6002192.168.0.2036001/app/redis-5.0.14/redis-6001192.168.0.2036002/app/redis-5.0.14/redis-6002 所有节点操作：准备工作下载一些用到的工具: yum -y install wget gcc 所有节点操作：下载 redis 的版本 下载用到的 redis 的源码包 wget https://download.redis.io/releases/redis-5.0.14.tar.gz tar redis-5.0.14.tar.gz cd redis-5.0.14 进行编译源码包会生成几个二进制文件： mkdir -p /app/redis-5.0.14/redis-service # 这个的编译后二进制存放的路径 make PREFIX=&#34;/app/redis-5.0.14/redis-service&#34; install # 编译没有问题之后会在/app/redis-5.0.14/redis-service/bin下面生成一个文件 # redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server 开始进行配置配置文件 192.168.0.201 配置 2 个redis 第一个redis 的6001 端口的操作 进行配置配置文件 cd /app/redis-5.0.14 mkdir -p redis-6001/redis-log mkdir redis-6001/redis-conf mkdir redis-6001/redis-data # 开始进行配置配置文件： cat &lt;&lt; EOF &gt;&gt; /app/redis-5.0.14/redis-6001/redis-conf/redis.conf protected-mode yes tcp-backlog 511 timeout 600 tcp-keepalive 300 daemonize yes supervised no loglevel notice syslog-enabled yes syslog-ident &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/3d7f69b5e2bdb8f406f014fe77d4d9aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-18T14:44:56+08:00" />
<meta property="article:modified_time" content="2024-01-18T14:44:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">redis cluster搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>准备服务器和端口号</h2> 
<table><thead><tr><th>IP 地址</th><th>端口号</th><th>路径</th></tr></thead><tbody><tr><td>192.168.0.201</td><td>6001</td><td>/app/redis-5.0.14/redis-6001</td></tr><tr><td>192.168.0.201</td><td>6002</td><td>/app/redis-5.0.14/redis-6002</td></tr><tr><td>192.168.0.202</td><td>6001</td><td>/app/redis-5.0.14/redis-6001</td></tr><tr><td>192.168.0.203</td><td>6002</td><td>/app/redis-5.0.14/redis-6002</td></tr><tr><td>192.168.0.203</td><td>6001</td><td>/app/redis-5.0.14/redis-6001</td></tr><tr><td>192.168.0.203</td><td>6002</td><td>/app/redis-5.0.14/redis-6002</td></tr></tbody></table> 
<h2><a id="_11"></a>所有节点操作：准备工作下载一些用到的工具:</h2> 
<pre><code class="prism language-shell">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">wget</span> gcc
</code></pre> 
<h2><a id="_redis__17"></a>所有节点操作：下载 redis 的版本</h2> 
<h3><a id="_redis__19"></a>下载用到的 redis 的源码包</h3> 
<pre><code class="prism language-shell"><span class="token function">wget</span> https://download.redis.io/releases/redis-5.0.14.tar.gz
<span class="token function">tar</span> redis-5.0.14.tar.gz
<span class="token builtin class-name">cd</span> redis-5.0.14
</code></pre> 
<h3><a id="_27"></a>进行编译源码包会生成几个二进制文件：</h3> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /app/redis-5.0.14/redis-service <span class="token comment"># 这个的编译后二进制存放的路径</span>
<span class="token function">make</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token string">"/app/redis-5.0.14/redis-service"</span> <span class="token function">install</span>
<span class="token comment"># 编译没有问题之后会在/app/redis-5.0.14/redis-service/bin下面生成一个文件</span>
<span class="token comment"># redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server</span>
</code></pre> 
<h2><a id="_36"></a>开始进行配置配置文件</h2> 
<h3><a id="1921680201__2_redis_38"></a>192.168.0.201 配置 2 个redis</h3> 
<h4><a id="redis_6001__40"></a>第一个redis 的6001 端口的操作</h4> 
<h5><a id="_42"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6001/redis-log
<span class="token function">mkdir</span> redis-6001/redis-conf
<span class="token function">mkdir</span> redis-6001/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6001/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6001/redis-6001.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6001/redis-log/redis-6001.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.201
# Redis 监听端口，默认为6379
port 6001
# 数据库快照文件（RDB）的文件名
dbfilename dump-6001.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6001/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6001.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_146"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6001/redis-conf/redis.conf
</code></pre> 
<h4><a id="redis_6002__153"></a>第二个redis 的6002 端口的操作</h4> 
<h5><a id="_155"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6002/redis-log
<span class="token function">mkdir</span> redis-6002/redis-conf
<span class="token function">mkdir</span> redis-6002/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6002/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6002/redis-6002.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6002/redis-log/redis-6002.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.201
# Redis 监听端口，默认为6379
port 6002
# 数据库快照文件（RDB）的文件名
dbfilename dump-6002.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6002/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6002.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_259"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6002/redis-conf/redis.conf
</code></pre> 
<h3><a id="1921680202__2_redis_266"></a>192.168.0.202 配置 2 个redis</h3> 
<h4><a id="redis__6001__268"></a>第一个redis 的 6001 端口的操作</h4> 
<h5><a id="_270"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6001/redis-log
<span class="token function">mkdir</span> redis-6001/redis-conf
<span class="token function">mkdir</span> redis-6001/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6001/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6001/redis-6001.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6001/redis-log/redis-6001.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.202
# Redis 监听端口，默认为6379
port 6001
# 数据库快照文件（RDB）的文件名
dbfilename dump-6001.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6001/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6001.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_374"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6001/redis-conf/redis.conf
</code></pre> 
<h4><a id="redis_6002__381"></a>第二个redis 的6002 端口的操作</h4> 
<h5><a id="_383"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6002/redis-log
<span class="token function">mkdir</span> redis-6002/redis-conf
<span class="token function">mkdir</span> redis-6002/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6002/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6002/redis-6002.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6002/redis-log/redis-6002.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.202
# Redis 监听端口，默认为6379
port 6002
# 数据库快照文件（RDB）的文件名
dbfilename dump-6002.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6002/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6002.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_487"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6002/redis-conf/redis.conf
</code></pre> 
<h3><a id="1921680203__2_redis_494"></a>192.168.0.203 配置 2 个redis</h3> 
<h4><a id="redis_6001__496"></a>第一个redis 6001 端口的操作</h4> 
<h5><a id="_498"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6001/redis-log
<span class="token function">mkdir</span> redis-6001/redis-conf
<span class="token function">mkdir</span> redis-6001/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6001/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6001/redis-6001.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6001/redis-log/redis-6001.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.203
# Redis 监听端口，默认为6379
port 6001
# 数据库快照文件（RDB）的文件名
dbfilename dump-6001.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6001/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6001.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_602"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6001/redis-conf/redis.conf
</code></pre> 
<h4><a id="redis_6002__609"></a>第二个redis 的6002 端口的操作</h4> 
<h5><a id="_611"></a>进行配置配置文件</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> redis-6002/redis-log
<span class="token function">mkdir</span> redis-6002/redis-conf
<span class="token function">mkdir</span> redis-6002/redis-data
<span class="token comment"># 开始进行配置配置文件：</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span> /app/redis-5.0.14/redis-6002/redis-conf/redis.conf</span>
protected-mode yes
tcp-backlog 511
timeout 600
tcp-keepalive 300
daemonize yes
supervised no
loglevel notice
syslog-enabled yes
syslog-ident "redis"
syslog-facility local0
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
repl-backlog-size 100mb
replica-priority 100
# 有一些危险操作我们给重写了一下如下面所示
rename-command FLUSHDB REDIS_FLUSHDB
rename-command FLUSHALL REDIS_FLUSHALL
rename-command CONFIG REDIS_CONFIG
rename-command SHUTDOWN b840dd429941cc15f59
rename-command KEYS REDIS_KEYS
maxmemory 30gb
maxmemory-policy allkeys-lfu
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
appendonly no
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-node-timeout 15000
cluster-require-full-coverage no
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events ""
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
activedefrag no
active-defrag-ignore-bytes 100mb
# 下面的操作个节点都不一样 ！！！！！！！！！！！！！！！！！！！！
# Redis 服务器进程 ID 文件位置
pidfile /app/redis-5.0.14/redis-6002/redis-6002.pid
# Redis 服务器日志文件位置
logfile /app/redis-5.0.14/redis-6002/redis-log/redis-6002.log
# 绑定 IP 地址  这个需要更具业务进行配置
bind 192.168.0.203
# Redis 监听端口，默认为6379
port 6002
# 数据库快照文件（RDB）的文件名
dbfilename dump-6002.rdb
# RDB和AOF 快照文件的保存路径
dir /app/redis-5.0.14/redis-6002/redis-data
# 集群配置文件的保存路径
cluster-config-file nodes-6002.conf
# Redis 连接密码
requirepass 1231
# 主从同步时的密码
masterauth 1231
EOF</span>
</code></pre> 
<h5><a id="_redis_715"></a>进行启动 redis</h5> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-server ./redis-6002/redis-conf/redis.conf
</code></pre> 
<h3><a id="_722"></a>统一进行验证是否启动成功：</h3> 
<p><img src="https://images2.imgbox.com/d6/ca/iUKCcVWB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_725"></a>配置启动成功后开始进行初始化集群</h2> 
<pre><code class="prism language-shell"><span class="token comment"># 该操作是任意的一个节点执行即可，我这边是在192.168.0.201节点中执行：</span>
<span class="token comment"># 其中 --cluster 是刚刚部署里面的所有节点:</span>
<span class="token comment"># 启动-a 是指定密码：也就是刚刚配置文件中的requirepass和masterauth 后面的字段</span>
<span class="token comment"># 启动的1 代表一主一从，如果是2的话，就需要9个节点，代码1主2从</span>
<span class="token comment"># 启动--cluster-yes 就代表忽略输入密码</span>
<span class="token builtin class-name">cd</span> /app/redis-5.0.14
./redis-service/bin/redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">192.168</span>.0.201:6001 <span class="token number">192.168</span>.0.202:6001 <span class="token number">192.168</span>.0.203:6001 <span class="token number">192.168</span>.0.201:600 <span class="token number">192.168</span>.0.202:6002 <span class="token number">192.168</span>.0.203:6002    <span class="token parameter variable">-a</span>  <span class="token string">'1231'</span> --cluster-replicas <span class="token number">1</span> --cluster-yes


<span class="token comment"># 执行的结果如下</span>
<span class="token punctuation">[</span>root@localhost redis-5.0.14<span class="token punctuation">]</span><span class="token comment"># ./redis-service/bin/redis-cli --cluster create 192.168.0.201:6001 192.168.0.202:6001 192.168.0.203:6001 192.168.0.201:6002 192.168.0.202:6002 192.168.0.203:6002 -a  '1231' --cluster-replicas 1 --cluster-yes</span>
Warning: Using a password with <span class="token string">'-a'</span> or <span class="token string">'-u'</span> option on the <span class="token builtin class-name">command</span> line interface may not be safe.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">192.168</span>.0.202:6002 to <span class="token number">192.168</span>.0.201:6001
Adding replica <span class="token number">192.168</span>.0.203:6002 to <span class="token number">192.168</span>.0.202:6001
Adding replica <span class="token number">192.168</span>.0.201:6002 to <span class="token number">192.168</span>.0.203:6001
M: a7225e5a8e0679b817d6dcd61c6fbe3d536d9773 <span class="token number">192.168</span>.0.201:6001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: 89899b803c16440a6e76ca40013d3398efb65d12 <span class="token number">192.168</span>.0.202:6001
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: c3a32ea951879ac21e08734be9fd8d2f79479962 <span class="token number">192.168</span>.0.203:6001
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: f219764395e53d5bc34fe1d556dfa57023a0357a <span class="token number">192.168</span>.0.201:6002
   replicates c3a32ea951879ac21e08734be9fd8d2f79479962
S: 239963029f6aafedf873301a27d9156b6ff12dfa <span class="token number">192.168</span>.0.202:6002
   replicates a7225e5a8e0679b817d6dcd61c6fbe3d536d9773
S: 4c803454f7cf6b372c955728665ca2f914aaf65b <span class="token number">192.168</span>.0.203:6002
   replicates 89899b803c16440a6e76ca40013d3398efb65d12
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.0.201:6001<span class="token punctuation">)</span>
M: a7225e5a8e0679b817d6dcd61c6fbe3d536d9773 <span class="token number">192.168</span>.0.201:6001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 239963029f6aafedf873301a27d9156b6ff12dfa <span class="token number">192.168</span>.0.202:6002
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates a7225e5a8e0679b817d6dcd61c6fbe3d536d9773
S: 4c803454f7cf6b372c955728665ca2f914aaf65b <span class="token number">192.168</span>.0.203:6002
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 89899b803c16440a6e76ca40013d3398efb65d12
M: c3a32ea951879ac21e08734be9fd8d2f79479962 <span class="token number">192.168</span>.0.203:6001
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 89899b803c16440a6e76ca40013d3398efb65d12 <span class="token number">192.168</span>.0.202:6001
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: f219764395e53d5bc34fe1d556dfa57023a0357a <span class="token number">192.168</span>.0.201:6002
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates c3a32ea951879ac21e08734be9fd8d2f79479962
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token punctuation">[</span>root@localhost redis-5.0.14<span class="token punctuation">]</span><span class="token comment"># ls</span>
redis-6001  redis-6002  redis-service  <span class="token comment"># 这些是目录</span>


</code></pre> 
<h2><a id="_793"></a>进行验证是否创建成功集群：</h2> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost redis-5.0.14<span class="token punctuation">]</span><span class="token comment"># ./redis-service/bin/redis-cli -h 192.168.0.201 -p 6001 -c -a '1231'  # -a 是指定密码</span>
Warning: Using a password with <span class="token string">'-a'</span> or <span class="token string">'-u'</span> option on the <span class="token builtin class-name">command</span> line interface may not be safe.
<span class="token number">192.168</span>.0.201:600<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER nodes
239963029f6aafedf873301a27d9156b6ff12dfa <span class="token number">192.168</span>.0.202:6002@16002 slave a7225e5a8e0679b817d6dcd61c6fbe3d536d9773 <span class="token number">0</span> <span class="token number">1705559824067</span> <span class="token number">5</span> connected
4c803454f7cf6b372c955728665ca2f914aaf65b <span class="token number">192.168</span>.0.203:6002@16002 slave 89899b803c16440a6e76ca40013d3398efb65d12 <span class="token number">0</span> <span class="token number">1705559826071</span> <span class="token number">6</span> connected
c3a32ea951879ac21e08734be9fd8d2f79479962 <span class="token number">192.168</span>.0.203:6001@16001 master - <span class="token number">0</span> <span class="token number">1705559825000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
89899b803c16440a6e76ca40013d3398efb65d12 <span class="token number">192.168</span>.0.202:6001@16001 master - <span class="token number">0</span> <span class="token number">1705559824000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
f219764395e53d5bc34fe1d556dfa57023a0357a <span class="token number">192.168</span>.0.201:6002@16002 slave c3a32ea951879ac21e08734be9fd8d2f79479962 <span class="token number">0</span> <span class="token number">1705559825067</span> <span class="token number">4</span> connected
a7225e5a8e0679b817d6dcd61c6fbe3d536d9773 <span class="token number">192.168</span>.0.201:6001@16001 myself,master - <span class="token number">0</span> <span class="token number">1705559823000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
<span class="token number">192.168</span>.0.201:600<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03d61dd4e748d8037b0ddaf72400011e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">提取微信聊天记录详细教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/298ccf85533d7c0554e8ff5978bbd6c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python文件移动的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>