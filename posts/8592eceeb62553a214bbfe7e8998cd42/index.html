<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OSS上传（Java和Js） - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OSS上传（Java和Js）" />
<meta property="og:description" content="OSS上传（Java和Js） 准备工作创建RAM用户创建角色创建权限策略给角色授予权限策略 获取临时访问凭证Java普通上传OSSJava分片上传OSSJS普通上传OSSJS分片上传OSS 使用RAM用户或STS方式访问
由于阿里云账号AccessKey拥有所有API访问权限，建议遵循阿里云安全最佳实践。如果部署在服务端可以使用RAM用户或STS来进行API访问或日常运维管控操作，如果部署在客户端请使用STS方式来进行API访问。
本文采用STS方式来实现上传功能，STS可以给第三方提供权限，在考虑接口安全的前提下，还是很合适的，当然如果是自己企业使用的话，也可以直接用RAM用户方式。代码都是类似的
准备工作 登录控制台进入RAM控制台
创建RAM用户 创建完成之后记得复制密钥后面代码里面要用到
返回用户列表，点击添加权限，现在下面权限后点击确定
创建角色 选择阿里云账号，点击下一步
输入名称，点击下一步
点击完成创建
然后角色列表，找到刚刚创建的角色，点击进入
复制角色的ARN，后面的代码里面会用到
创建权限策略 输入脚本
PutObject就是用form表单的方式上传，resource就是bucket资源路径，这个自行修改
{ &#34;Version&#34;: &#34;1&#34;, &#34;Statement&#34;: [ { &#34;Effect&#34;: &#34;Allow&#34;, &#34;Action&#34;: &#34;oss:PutObject&#34;, &#34;Resource&#34;: [ &#34;acs:oss:*:*:test/img/*&#34;, &#34;acs:oss:*:*:test/mp4/*&#34; ] } ] } 然后点击继续编辑，添加名称后点击 确定即可
给角色授予权限策略 进入角色列表找到刚刚新建的角色，点击添加权限
选择刚刚创建的权限策略，点击确定
获取临时访问凭证 &lt;!--阿里云oss--&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt; &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt; &lt;version&gt;3.10.2&lt;/version&gt; &lt;/dependency&gt; 注意替换你自己的id 和 secret，这个生成的token有效期默认是3600秒，可以根据业务场景自己调整
public static void main(String[] args) { // STS接入地址，例如sts.cn-hangzhou.aliyuncs.com。 String endpoint = &#34;sts.cn-hangzhou.aliyuncs.com&#34;; // 填写步骤1生成的RAM用户访问密钥AccessKey ID和AccessKey Secret。 String accessKeyId = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8592eceeb62553a214bbfe7e8998cd42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-21T17:32:01+08:00" />
<meta property="article:modified_time" content="2023-02-21T17:32:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OSS上传（Java和Js）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>OSS上传（Java和Js）</h4> 
 <ul><li><a href="#_8" rel="nofollow">准备工作</a></li><li><ul><li><a href="#RAM_12" rel="nofollow">创建RAM用户</a></li><li><a href="#_22" rel="nofollow">创建角色</a></li><li><a href="#_38" rel="nofollow">创建权限策略</a></li><li><a href="#_65" rel="nofollow">给角色授予权限策略</a></li></ul> 
  </li><li><a href="#_72" rel="nofollow">获取临时访问凭证</a></li><li><a href="#JavaOSS_154" rel="nofollow">Java普通上传OSS</a></li><li><a href="#JavaOSS_195" rel="nofollow">Java分片上传OSS</a></li><li><a href="#JSOSS_290" rel="nofollow">JS普通上传OSS</a></li><li><a href="#JSOSS_357" rel="nofollow">JS分片上传OSS</a></li></ul> 
</div> 
<p></p> 
<p>使用RAM用户或STS方式访问<br> 由于阿里云账号AccessKey拥有所有API访问权限，建议遵循阿里云安全最佳实践。如果部署在服务端可以使用RAM用户或STS来进行API访问或日常运维管控操作，如果部署在客户端请使用STS方式来进行API访问。</p> 
<p>本文采用STS方式来实现上传功能，STS可以给第三方提供权限，在考虑接口安全的前提下，还是很合适的，当然如果是自己企业使用的话，也可以直接用RAM用户方式。代码都是类似的</p> 
<h2><a id="_8"></a>准备工作</h2> 
<p>登录控制台进入RAM控制台<br> <img src="https://images2.imgbox.com/fe/a4/cgw68jus_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="RAM_12"></a>创建RAM用户</h3> 
<p><img src="https://images2.imgbox.com/e9/5d/7l3dIm8v_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/42/6f/49HcBDpF_o.png" alt="在这里插入图片描述"><br> 创建完成之后记得复制密钥后面代码里面要用到<br> <img src="https://images2.imgbox.com/0d/1b/D6hlndLw_o.png" alt="在这里插入图片描述"><br> 返回用户列表，点击添加权限，现在下面权限后点击确定</p> 
<p><img src="https://images2.imgbox.com/5c/2e/9DjPPtQX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_22"></a>创建角色</h3> 
<p><img src="https://images2.imgbox.com/32/3d/dNXTwTuY_o.png" alt="在这里插入图片描述"><br> 选择阿里云账号，点击下一步<br> <img src="https://images2.imgbox.com/ac/7a/ZRouYYGe_o.png" alt="在这里插入图片描述"><br> 输入名称，点击下一步<br> <img src="https://images2.imgbox.com/8f/a2/BwUfybuh_o.png" alt="在这里插入图片描述"><br> 点击完成创建<br> <img src="https://images2.imgbox.com/f0/b6/RTAd1N0Z_o.png" alt="在这里插入图片描述"></p> 
<p>然后角色列表，找到刚刚创建的角色，点击进入<br> <img src="https://images2.imgbox.com/5a/91/oTqwDFn8_o.png" alt="在这里插入图片描述"><br> 复制角色的ARN，后面的代码里面会用到<br> <img src="https://images2.imgbox.com/85/e7/bsyFux4Q_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_38"></a>创建权限策略</h3> 
<p><img src="https://images2.imgbox.com/00/62/cbxVuqC2_o.png" alt="在这里插入图片描述"></p> 
<p>输入脚本<br> PutObject就是用form表单的方式上传，resource就是bucket资源路径，这个自行修改</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Version"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token string">"oss:PutObject"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"acs:oss:*:*:test/img/*"</span><span class="token punctuation">,</span>
                <span class="token string">"acs:oss:*:*:test/mp4/*"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/17/eDWdjCho_o.png" alt="在这里插入图片描述"><br> 然后点击继续编辑，添加名称后点击 确定即可</p> 
<p><img src="https://images2.imgbox.com/c2/d9/Q9VkVcxz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_65"></a>给角色授予权限策略</h3> 
<p>进入角色列表找到刚刚新建的角色，点击添加权限<br> <img src="https://images2.imgbox.com/8a/d8/Kh3Rtufg_o.png" alt="在这里插入图片描述"><br> 选择刚刚创建的权限策略，点击确定</p> 
<p><img src="https://images2.imgbox.com/96/aa/wF2JtbYw_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_72"></a>获取临时访问凭证</h2> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>阿里云oss<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>aliyun<span class="token operator">-</span>sdk<span class="token operator">-</span>oss<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.10</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>注意替换你自己的id 和 secret，这个生成的token有效期默认是3600秒，可以根据业务场景自己调整</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// STS接入地址，例如sts.cn-hangzhou.aliyuncs.com。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"sts.cn-hangzhou.aliyuncs.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写步骤1生成的RAM用户访问密钥AccessKey ID和AccessKey Secret。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"你刚刚创建的RAM用户的AccessKey ID"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"你刚刚创建的RAM用户的AccessKey Secret"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写步骤3获取的角色ARN。</span>
    <span class="token class-name">String</span> roleArn <span class="token operator">=</span> <span class="token string">"你刚刚创建的RAM用户的ARN"</span><span class="token punctuation">;</span>
    <span class="token comment">// 自定义角色会话名称，用来区分不同的令牌，例如可填写为SessionTest。</span>
    <span class="token class-name">String</span> roleSessionName <span class="token operator">=</span> <span class="token string">"SessionTest"</span><span class="token punctuation">;</span>
    <span class="token comment">// 以下Policy用于限制仅允许使用临时访问凭证向目标存储空间examplebucket上传文件。</span>
    <span class="token comment">// 临时访问凭证最后获得的权限是步骤4设置的角色权限和该Policy设置权限的交集，即仅允许将文件上传至目标存储空间examplebucket下的exampledir目录。</span>
    <span class="token comment">// 如果policy为空，则用户将获得该角色下所有权限。</span>
    <span class="token class-name">String</span> policy <span class="token operator">=</span> <span class="token string">"{\n"</span> <span class="token operator">+</span>
            <span class="token string">"    \"Version\": \"1\", \n"</span> <span class="token operator">+</span>
            <span class="token string">"    \"Statement\": [\n"</span> <span class="token operator">+</span>
            <span class="token string">"        {\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"Action\": [\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"oss:PutObject\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            ], \n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"Resource\": [\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"acs:oss:*:*:test/*\" \n"</span> <span class="token operator">+</span>
            <span class="token string">"            ], \n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"Effect\": \"Allow\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"        }\n"</span> <span class="token operator">+</span>
            <span class="token string">"    ]\n"</span> <span class="token operator">+</span>
            <span class="token string">"}"</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置临时访问凭证的有效时间为3600秒。</span>
    <span class="token class-name">Long</span> durationSeconds <span class="token operator">=</span> <span class="token number">3600L</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// regionId表示RAM的地域ID。以华东1（杭州）地域为例，regionID填写为cn-hangzhou。也可以保留默认值，默认值为空字符串（""）。</span>
        <span class="token class-name">String</span> regionId <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加endpoint。适用于Java SDK 3.12.0及以上版本。</span>
        <span class="token comment">//DefaultProfile.addEndpoint(regionId, "Sts", endpoint);</span>
        <span class="token comment">// 添加endpoint。适用于Java SDK 3.12.0以下版本。</span>
        <span class="token class-name">DefaultProfile</span><span class="token punctuation">.</span><span class="token function">addEndpoint</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span>regionId<span class="token punctuation">,</span> <span class="token string">"Sts"</span><span class="token punctuation">,</span> endpoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构造default profile。</span>
        <span class="token class-name">IClientProfile</span> profile <span class="token operator">=</span> <span class="token class-name">DefaultProfile</span><span class="token punctuation">.</span><span class="token function">getProfile</span><span class="token punctuation">(</span>regionId<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构造client。</span>
        <span class="token class-name">DefaultAcsClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAcsClient</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">AssumeRoleRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AssumeRoleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 适用于Java SDK 3.12.0及以上版本。</span>
        <span class="token comment">//request.setSysMethod(MethodType.POST);</span>
        <span class="token comment">// 适用于Java SDK 3.12.0以下版本。</span>
        request<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token class-name">MethodType</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setRoleArn</span><span class="token punctuation">(</span>roleArn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setRoleSessionName</span><span class="token punctuation">(</span>roleSessionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setPolicy</span><span class="token punctuation">(</span>policy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setDurationSeconds</span><span class="token punctuation">(</span>durationSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">AssumeRoleResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getAcsResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Expiration: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Access Key Id: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessKeyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Access Key Secret: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessKeySecret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Security Token: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSecurityToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RequestId: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Failed："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error code: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getErrCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error message: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getErrMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RequestId: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行main方法，控制台输出<br> <mark>下面上传代码里用到的id secret token都是用这里生成的，而不是RAM用户的，千万别搞错了</mark></p> 
<p><img src="https://images2.imgbox.com/47/90/GDr0KsIH_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="JavaOSS_154"></a>Java普通上传OSS</h2> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">SimpleDateFormat</span> dateFormat<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Date</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传开始---"</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"oss-cn-hangzhou.aliyuncs.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写步骤五获取的临时访问密钥AccessKey ID和AccessKey Secret，非阿里云账号AccessKey ID和AccessKey Secret。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"上一步获取的id"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"上一步获取的secret"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写步骤五获取的安全令牌SecurityToken。</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">"上一步获取的token"</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span> securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将本地文件exampletest.txt上传至目标存储空间examplebucket下的目录exampledir。</span>
    <span class="token class-name">PutObjectRequest</span> putObjectRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PutObjectRequest</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"mp4/111.mp4"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:\\test\\111.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ObjectMetadata metadata = new ObjectMetadata();</span>
    <span class="token comment">// 上传文件时设置存储类型。</span>
    <span class="token comment">// metadata.setHeader(OSSHeaders.OSS_STORAGE_CLASS, StorageClass.Standard.toString());</span>
    <span class="token comment">// 上传文件时设置读写权限ACL。</span>
    <span class="token comment">// metadata.setObjectAcl(CannedAccessControlList.Private);</span>
    <span class="token comment">// putObjectRequest.setMetadata(metadata);</span>

    <span class="token comment">// 上传文件。</span>
    ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>putObjectRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 关闭OSSClient。</span>
    ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Date</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传结束---"</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行mian方法成功，去控制台查看是否上传成功，如果没有看到上传的文件，看看是不是路径写错了，或者token过期了，</p> 
<h2><a id="JavaOSS_195"></a>Java分片上传OSS</h2> 
<p>分片只有在大文件才能发挥出他的功效，例如1G的文件，如果是几百兆的文件是看不出效果的，有分片上传比普通上传还要慢一些</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">SimpleDateFormat</span> dateFormat<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Date</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传开始---"</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。</span>
    <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"oss-cn-hangzhou.aliyuncs.com"</span><span class="token punctuation">;</span>
    <span class="token comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
    <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"刚刚获取的id"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"刚刚获取的secret"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> securityToken <span class="token operator">=</span> <span class="token string">"刚刚获取的token"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
    <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span>
    <span class="token comment">// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token string">"mp4/111.mp4"</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建OSSClient实例。</span>
    <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">,</span>securityToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建InitiateMultipartUploadRequest对象。</span>
        <span class="token class-name">InitiateMultipartUploadRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitiateMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 初始化分片。</span>
        <span class="token class-name">InitiateMultipartUploadResult</span> upresult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">initiateMultipartUpload</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 返回uploadId，它是分片上传事件的唯一标识。您可以根据该uploadId发起相关的操作，例如取消分片上传、查询分片上传等。</span>
        <span class="token class-name">String</span> uploadId <span class="token operator">=</span> upresult<span class="token punctuation">.</span><span class="token function">getUploadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// partETags是PartETag的集合。PartETag由分片的ETag和分片号组成。</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span> partETags <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartETag</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 每个分片的大小，用于计算文件有多少个分片。单位为字节。</span>
        <span class="token keyword">final</span> <span class="token keyword">long</span> partSize <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024L</span><span class="token punctuation">;</span>   <span class="token comment">//1 MB。</span>

        <span class="token comment">// 填写本地文件的完整路径。</span>
        <span class="token keyword">final</span> <span class="token class-name">File</span> sampleFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:\\test\\111.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> fileLength <span class="token operator">=</span> sampleFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> partCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>fileLength <span class="token operator">/</span> partSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileLength <span class="token operator">%</span> partSize <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            partCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 遍历分片上传。</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> partCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">long</span> startPos <span class="token operator">=</span> i <span class="token operator">*</span> partSize<span class="token punctuation">;</span>
            <span class="token keyword">long</span> curPartSize <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> partCount<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>fileLength <span class="token operator">-</span> startPos<span class="token punctuation">)</span> <span class="token operator">:</span> partSize<span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> instream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>sampleFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 跳过已经上传的分片。</span>
            instream<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>startPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">UploadPartRequest</span> uploadPartRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UploadPartRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setBucketName</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setUploadId</span><span class="token punctuation">(</span>uploadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span>instream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置分片大小。除了最后一个分片没有大小限制，其他的分片最小为100 KB。</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartSize</span><span class="token punctuation">(</span>curPartSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置分片号。每一个上传的分片都有一个分片号，取值范围是1~10000，如果超出此范围，OSS将返回InvalidArgument错误码。</span>
            uploadPartRequest<span class="token punctuation">.</span><span class="token function">setPartNumber</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 每个分片不需要按顺序上传，甚至可以在不同客户端上传，OSS会按照分片号排序组成完整的文件。</span>
            <span class="token class-name">UploadPartResult</span> uploadPartResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">uploadPart</span><span class="token punctuation">(</span>uploadPartRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 每次上传分片之后，OSS的返回结果包含PartETag。PartETag将被保存在partETags中。</span>
            partETags<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uploadPartResult<span class="token punctuation">.</span><span class="token function">getPartETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 创建CompleteMultipartUploadRequest对象。</span>
        <span class="token comment">// 在执行完成分片上传操作时，需要提供所有有效的partETags。OSS收到提交的partETags后，会逐一验证每个分片的有效性。当所有的数据分片验证通过后，OSS将把这些分片组合成一个完整的文件。</span>
        <span class="token class-name">CompleteMultipartUploadRequest</span> completeMultipartUploadRequest <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">CompleteMultipartUploadRequest</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> uploadId<span class="token punctuation">,</span> partETags<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"分片---"</span> <span class="token operator">+</span> partETags<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 完成分片上传。</span>
        <span class="token class-name">CompleteMultipartUploadResult</span> completeMultipartUploadResult <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">completeMultipartUpload</span><span class="token punctuation">(</span>completeMultipartUploadRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completeMultipartUploadResult<span class="token punctuation">.</span><span class="token function">getETag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OSSException</span> oe<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Caught an OSSException, which means your request made it to OSS, "</span>
                <span class="token operator">+</span> <span class="token string">"but was rejected with an error response for some reason."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error Message:"</span> <span class="token operator">+</span> oe<span class="token punctuation">.</span><span class="token function">getErrorMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error Code:"</span> <span class="token operator">+</span> oe<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Request ID:"</span> <span class="token operator">+</span> oe<span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Host ID:"</span> <span class="token operator">+</span> oe<span class="token punctuation">.</span><span class="token function">getHostId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> ce<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Caught an ClientException, which means the client encountered "</span>
                <span class="token operator">+</span> <span class="token string">"a serious internal problem while trying to communicate with OSS, "</span>
                <span class="token operator">+</span> <span class="token string">"such as not being able to access the network."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error Message:"</span> <span class="token operator">+</span> ce<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ossClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Date</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传结束---"</span> <span class="token operator">+</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="JSOSS_290"></a>JS普通上传OSS</h2> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--导入SDK文件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span>
      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://gosspublic.alicdn.com/aliyun-oss-sdk-6.16.0.min.js<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSS</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// yourRegion填写Bucket所在地域。以华东1（杭州）为例，yourRegion填写为oss-cn-hangzhou。</span>
        <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">'oss-cn-hangzhou'</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
        <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> <span class="token string">'刚刚获取的id'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">accessKeySecret</span><span class="token operator">:</span> <span class="token string">'刚刚获取的secret'</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
        <span class="token literal-property property">stsToken</span><span class="token operator">:</span> <span class="token string">'刚刚获取的token'</span><span class="token punctuation">,</span>
        <span class="token comment">// 填写Bucket名称。</span>
        <span class="token literal-property property">bucket</span><span class="token operator">:</span> <span class="token string">'test'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 从输入框获取file对象，例如&lt;input type="file" id="file" /&gt;。</span>
      <span class="token keyword">let</span> data<span class="token punctuation">;</span>
      <span class="token comment">// 创建并填写Blob数据。</span>
      <span class="token comment">//const data = new Blob(['Hello OSS']);</span>
      <span class="token comment">// 创建并填写OSS Buffer内容。</span>
      <span class="token comment">//const data = new OSS.Buffer(['Hello OSS']);</span>

      <span class="token keyword">const</span> upload <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

       <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">putObject</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 填写Object完整路径。Object完整路径中不能包含Bucket名称。</span>
           <span class="token comment">// 您可以通过自定义文件名（例如exampleobject.txt）或文件完整路径（例如exampledir/exampleobject.txt）的形式实现将数据上传到当前Bucket或Bucket中的指定目录。</span>
           <span class="token comment">// data对象可以自定义为file对象、Blob数据或者OSS Buffer。</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>
            <span class="token string">"mp4/111.mp4"</span><span class="token punctuation">,</span>
            data
            <span class="token comment">//{headers}</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      upload<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        data <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">putObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="JSOSS_357"></a>JS分片上传OSS</h2> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--导入sdk文件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span>
      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://gosspublic.alicdn.com/aliyun-oss-sdk-6.16.0.min.js<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSS</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// yourRegion填写Bucket所在地域。以华东1（杭州）为例，Region填写为oss-cn-hangzhou。</span>
        <span class="token literal-property property">region</span><span class="token operator">:</span> <span class="token string">"oss-cn-hangzhou"</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span>
        <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> <span class="token string">"刚刚获取的id"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">accessKeySecret</span><span class="token operator">:</span> <span class="token string">"刚刚获取的secret"</span><span class="token punctuation">,</span>
        <span class="token comment">// 从STS服务获取的安全令牌（SecurityToken）。</span>
        <span class="token literal-property property">stsToken</span><span class="token operator">:</span> <span class="token string">"刚刚获取的token"</span><span class="token punctuation">,</span>
        <span class="token comment">// 填写Bucket名称，例如examplebucket。</span>
        <span class="token literal-property property">bucket</span><span class="token operator">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 指定该Object被下载时的网页缓存行为。</span>
        <span class="token string-property property">"Cache-Control"</span><span class="token operator">:</span> <span class="token string">"no-cache"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定该Object被下载时的名称。</span>
        <span class="token string-property property">"Content-Disposition"</span><span class="token operator">:</span> <span class="token string">"111.mp4"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定该Object被下载时的内容编码格式。</span>
        <span class="token string-property property">"Content-Encoding"</span><span class="token operator">:</span> <span class="token string">"utf-8"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定过期时间，单位为毫秒。</span>
        <span class="token string-property property">"Expires"</span><span class="token operator">:</span> <span class="token string">"1000"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定Object的存储类型。</span>
        <span class="token string-property property">"x-oss-storage-class"</span><span class="token operator">:</span> <span class="token string">"Standard"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定Object标签，可同时设置多个标签。</span>
        <span class="token string-property property">"x-oss-tagging"</span><span class="token operator">:</span> <span class="token string">"Tag1=1&amp;Tag2=2"</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定初始化分片上传时是否覆盖同名Object。此处设置为true，表示禁止覆盖同名Object。</span>
        <span class="token string-property property">"x-oss-forbid-overwrite"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 指定上传到examplebucket的Object名称，例如exampleobject.txt。</span>
      <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"111.mp4"</span><span class="token punctuation">;</span>
      <span class="token comment">// 获取DOM。</span>
      <span class="token keyword">const</span> submit <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"submit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取分片上传进度、断点和返回值。</span>
        <span class="token function-variable function">progress</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> cpt<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置并发上传的分片数量。</span>
        <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置分片大小。默认值为1 MB，最小值为100 KB。</span>
        <span class="token literal-property property">partSize</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
        <span class="token comment">// headers,</span>
        <span class="token comment">// 自定义元数据，通过HeadObject接口可以获取Object的元数据。</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span> <span class="token literal-property property">people</span><span class="token operator">:</span> <span class="token string">"test"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mime</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 监听按钮。</span>
      submit<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> data <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token comment">// 分片上传。</span>
          <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">multipartUpload</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token operator">...</span>options<span class="token punctuation">,</span>
            <span class="token comment">// 设置上传回调。</span>
      
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/993e0d6044f86b23d365da86a7257d14/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SPDK vhost target</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/09c898fe1c4ccf5bed154f6df2cd1ea1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS 基本数据类型和引用数据类型的区别及浅拷贝和深拷贝</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>