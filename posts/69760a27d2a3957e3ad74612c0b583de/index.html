<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C# （江湖小新）- 连接Mysql数据库 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C# （江湖小新）- 连接Mysql数据库" />
<meta property="og:description" content="依赖插件 MySql.Data安装 使用之前需要先在 vs中安装MySql.Data 插件，本文采用 Nuget 方式安装 ，步骤如下：
选中项目右键——》管理Nuget程序包 输入 MySql.Data ，搜索安装即可
连接数据库的基本对象介绍 MySqlConnection： 数据库连接对象MySqlCommand： sql语句执行对象MySqlDataReader：包含sql语句执⾏的结果，并提供⼀个⽅法从结果中阅读⼀⾏MySqlTransaction： sql事务管理对象MySqlException： 报错时返回的Exception。MySqlCommandBuilder：自动生成命令，该命令用于MySQL数据库协调对数据集所做的更改MySqlDataAdapter： 表示一组数据命令和数据库连接，用于填充数据集和更新MySQL数据库MySqlHelper：提供帮助的工具类 sql执行方法 ExcuteNonQuery：执行【insert（增）】、【updata（改）】、【delete（删）】语句ExcuteReader：执行多行查询，返回DataReader对象ExcuteScalar：执行单行查询，返回查询结果的首行数据 DataTable和DataSet 容器 可以把DataTable和DataSet看做是数据容器，比如你查询数据库后得到一些结果，可以放到这种容器里DataSet 可以比作一个内存中的数据库DataTable 是一个内存中的数据表DataSet 里可以存储多个DataTable数据结果 直接放到 dataTable中 DataTable dt = new DataTable(); MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn); // 将数据填充到dataTable中 DataAdapter.Fill(dt); 数据结果 直接放到 dateSet 中 DataSet ds = new DataSet(); MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn); // 将数据填充到dataSet中 DataAdapter.Fill(ds); 数据结果放到dataset中，若要用那个datatable,可以这样：dataset[0] DataSet ds = new DataSet(); MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn); // 将数据填充到dataSet中 DataAdapter." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/69760a27d2a3957e3ad74612c0b583de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-06T10:12:02+08:00" />
<meta property="article:modified_time" content="2023-01-06T10:12:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C# （江湖小新）- 连接Mysql数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>依赖插件</h3> 
<h4><strong>MySql.Data安装 </strong></h4> 
<ul><li> <p><strong>使用之前需要先在 vs中安装MySql.Data 插件，本文采用 Nuget 方式安装 ，步骤如下：</strong></p> 
  <ul><li> <p><strong>选中项目右键——》管理Nuget程序包 </strong></p> </li><li> <p><strong>输入 MySql.Data ，搜索安装即可</strong></p> </li></ul></li></ul> 
<p><img alt="" height="453" src="https://images2.imgbox.com/bc/a0/K7JTxNuI_o.png" width="1200"></p> 
<p></p> 
<h4>连接数据库的基本对象介绍</h4> 
<ul><li>MySqlConnection： 数据库连接对象</li><li>MySqlCommand： sql语句执行对象</li><li>MySqlDataReader：包含sql语句执⾏的结果，并提供⼀个⽅法从结果中阅读⼀⾏</li><li>MySqlTransaction： sql事务管理对象</li><li>MySqlException：  报错时返回的Exception。</li><li>MySqlCommandBuilder：自动生成命令，该命令用于MySQL数据库协调对数据集所做的更改</li><li>MySqlDataAdapter： 表示一组数据命令和数据库连接，用于填充数据集和更新MySQL数据库</li><li>MySqlHelper：提供帮助的工具类  </li></ul> 
<h4>sql执行方法</h4> 
<ul><li><strong><code>ExcuteNonQuery</code>：</strong>执行【insert（增）】、【updata（改）】、【delete（删）】语句</li><li><strong><code>ExcuteReader</code>：</strong>执行多行查询，返回DataReader对象</li><li><strong><code>ExcuteScalar</code>：</strong>执行单行查询，返回查询结果的首行数据</li></ul> 
<h4></h4> 
<h4>DataTable和DataSet 容器</h4> 
<ul><li>可以把DataTable和DataSet看做是数据容器，比如你查询数据库后得到一些结果，可以放到这种容器里</li><li><strong>DataSet </strong>可以比作一个内存中的数据库</li><li><strong>DataTable </strong>是一个内存中的数据表</li><li>DataSet 里可以存储多个DataTable</li><li>数据结果 直接放到 <strong>dataTable中</strong> 
  <ul><li> <pre><code class="language-cs">DataTable dt = new DataTable();
MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn);
// 将数据填充到dataTable中
DataAdapter.Fill(dt);</code></pre> </li></ul></li><li>数据结果 直接放到 <strong>dateSet 中</strong> 
  <ul><li> <pre><code class="language-cs">DataSet ds = new DataSet();
MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn);
// 将数据填充到dataSet中
DataAdapter.Fill(ds);</code></pre> <p></p> </li></ul></li><li>数据结果放到dataset中，若要用那个datatable,可以这样：dataset[0]   
  <ul><li> <pre><code class="language-cs">DataSet ds = new DataSet();
MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn);
// 将数据填充到dataSet中
DataAdapter.Fill(ds);
DataTable td = ds.Tables[0]</code></pre> <p></p> </li></ul></li></ul> 
<h3><strong>Mysql的增删改查(CRUD)</strong></h3> 
<h4>创建Mysql连接</h4> 
<ul><li><strong>方式一：</strong> 通过 MySqlConnectionStringBuilder  对象</li></ul> 
<pre><code class="language-cs">public MySqlConnection createConnect()
{
	// 数据连接的基本信息对象
	MySqlConnectionStringBuilder scsb = new MySqlConnectionStringBuilder();
	scsb.UserID = "root";
	scsb.Server = "127.0.0.1";
	scsb.Port = 3306;
	scsb.Password = "123456";
	scsb.Database = "account_center";

	MySqlConnection mySqlConnection = new MySqlConnection(scsb.ConnectionString);

	mySqlConnection.Open();
	Console.WriteLine("数据库连接成功！");
	return mySqlConnection;
}</code></pre> 
<ul><li> <p><strong>方式二：直接通过字符串，然后new MySqlConnection</strong></p> </li></ul> 
<pre><code class="language-cs">public MySqlConnection createConnect2()
{
	// 数据连接的基本信息对象
	string conStr = "server=127.0.0.1;database=account_center;username=root;password=123456;";
	MySqlConnection mySqlConnection = new MySqlConnection(conStr);
	mySqlConnection.Open();
	return mySqlConnection;
}</code></pre> 
<h4></h4> 
<h3>MySqlDataAdapter 方式</h3> 
<h4>查询数据表数据（无参数）</h4> 
<pre><code class="language-cs">public void queryNoArg(MySqlConnection conn)
{
	string sql = "select * from user_test ";
	DataTable dt = new DataTable();
	try
	{
		MySqlDataAdapter DataAdapter = new MySqlDataAdapter(sql, conn);
		// 将数据填充到dataTable中
		DataAdapter.Fill(dt);
	}
	catch (Exception ex)
	{
		Console.WriteLine(ex.Message);
	}
	finally
	{
		// 关闭连接
		conn.Close();
	}

	// 打印表数据
	printData(dt);
}</code></pre> 
<p><strong>打印数据方法</strong></p> 
<pre><code class="language-cs">public void printData(DataTable dt)
{
	if (dt.Rows.Count &lt; 0)
	{
		return;
	}

	//打印所有列名
	string columnName = string.Empty;
	for (int i = 0; i &lt; dt.Columns.Count; i++)
	{
		columnName += dt.Columns[i].ColumnName + " | ";
	}
	Console.WriteLine(columnName);
	Console.WriteLine("-------------------------");

	//打印每一行的数据
	foreach (DataRow row in dt.Rows)
	{
		string columnStr = string.Empty;
		foreach (DataColumn column in dt.Columns)
		{
			columnStr += row[column] + " | ";
		}
		Console.WriteLine(columnStr);
	}
}</code></pre> 
<p><strong>输出结果</strong></p> 
<pre><code class="language-cs">name | age | create_date |
-------------------------
张三 | 12 | 2023/1/4 17:17:24 |
李四 | 33 | 2023/1/4 17:17:24 |</code></pre> 
<p></p> 
<h4>查询数据表数据（带参数）</h4> 
<pre><code class="language-cs">public void queryByArg(MySqlConnection conn)
{
	string sql = "select * from user_test where name=@p1 and age=@p2  ";
	DataTable dt = new DataTable();
	try
	{
		// 建立命令执行对象
		MySqlCommand cmd = new MySqlCommand();
		cmd.Connection = conn;
		cmd.CommandText = sql;
		// 设置命令的类型，普通的sql命令是字符串的用Text即可 ，如果是存储过程则用 CommandType.StoredProcedure
		cmd.CommandType = CommandType.Text;
		cmd.Parameters.AddWithValue("@p1", "张三");
		cmd.Parameters.AddWithValue("@p2", 12);

		MySqlDataAdapter DataAdapter = new MySqlDataAdapter(cmd);
		// 将数据填充到dataTable中
		DataAdapter.Fill(dt);
		// 释放资源
		DataAdapter.Dispose();
	}
	catch (Exception ex)
	{
		Console.WriteLine(ex.Message);
	}
	finally
	{
		// 关闭连接
		conn.Close();
	}

	// 打印表数据
	printData(dt);
}</code></pre> 
<p><strong>输出结果</strong></p> 
<pre><code class="language-cs">name | age | create_date |
-------------------------
张三 | 12 | 2023/1/4 17:17:24 |</code></pre> 
<p></p> 
<h3>MySqlDataReader 方式</h3> 
<h4>查询数据表数据</h4> 
<pre><code class="language-cs">public void ExecuteReader(MySqlConnection connection)
{
	string sql = "select * from user_test ";
	MySqlCommand cmd = new MySqlCommand(sql, connection);
	MySqlDataReader myReader = null;
	try
	{
		myReader = cmd.ExecuteReader();
		// 打印数据
		printByReader(myReader);
	}
	catch (Exception e)
	{
		throw new Exception(e.Message);
	}
	finally
	{
		connection.Close();
		cmd.Dispose();
	}
}</code></pre> 
<p><strong>打印数据方法</strong></p> 
<pre><code class="language-cs">public void printByReader(MySqlDataReader myReader)
{
	if (myReader==null)
	{
		return;
	}

	//打印所有列名
	string columnName = string.Empty;
	for (int i = 0; i &lt; myReader.FieldCount; i++)
	{
		columnName += myReader.GetName(i) + " | ";
	}
	Console.WriteLine(columnName);
	Console.WriteLine("-------------------------");

	//打印每一行的数据
	while (myReader.Read())
	{
		string columnStr = string.Empty;
		for (int i = 0; i &lt; myReader.FieldCount; i++)
		{
			columnStr += myReader[i].ToString() + " | ";
		}
		Console.WriteLine(columnStr);
	}
	// 释放资源
	myReader.Close();
}</code></pre> 
<p><strong>输出结果</strong></p> 
<pre><code class="language-cs">name | age | create_date |
-------------------------
张三 | 12 | 2023/1/4 17:17:24 |
李四 | 33 | 2023/1/4 17:17:24 |</code></pre> 
<p></p> 
<h3>修改表数据都用 ExecuteNonQuery() 方法</h3> 
<h4>ExecuteNonQuery()  适用于 添加、修改、删除 相关的sql操作</h4> 
<pre><code class="language-cs">public int updateData(MySqlConnection conn)
{
	// 添加数据
	string addSql = "insert into user_test(name,age,create_date) values('王五',14,now())";
	// 修改数据
	string updateSql = "update user_test set age=55 where name='李四'";
	// 删除数据
	string delSql = "delete from user_test where name = '张三'";

	MySqlCommand cmd = new MySqlCommand(addSql, conn);
	try
	{
		int rows = cmd.ExecuteNonQuery();
		return rows;
	}
	catch (Exception e)
	{
		conn.Close();
		//throw e;
		Console.WriteLine(e.Message);
	}
	finally
	{
		cmd.Dispose();
		conn.Close();
	}
	return -1;
}</code></pre> 
<p></p> 
<h3>数据库事务（MySqlTransaction类）</h3> 
<h4><strong>事务执行过程:</strong> </h4> 
<ul><li> <p>开启</p> </li><li> <p>提交  -- 正常</p> </li><li> <p>回滚  -- 出现问题</p> </li></ul> 
<h4>事务管理 </h4> 
<ul><li><strong>BeginTransaction()：</strong>开启事务, 只要未提交，期间执行的数据更新相关的操作都不会生效</li><li><strong>transaction.Commit()：</strong> 提交事务，提交后，数据更新</li><li><strong>transaction.Rollback()：</strong>回滚事务，回滚后，之前执行的数据更新操作都将失效</li></ul> 
<pre><code class="language-cs">public void TransactionTest(MySqlConnection conn)
{
	string sql = "insert into user_test(name,age,create_date) values('bbb',224,now())";

	// 开启事务
	MySqlTransaction transaction = conn.BeginTransaction();
	try
	{
		MySqlCommand cmd = new MySqlCommand(sql, conn);
		cmd.ExecuteNonQuery();
	}
	catch (Exception ex)
	{
		Console.WriteLine(ex.Message);
        // 事务回滚
		transaction.Rollback();
		conn.Close();
	}
	finally
	{
		if (conn.State != ConnectionState.Closed)
		{
			//事务要么回滚要么提交，即Rollback()与Commit()只执行一个
			transaction.Commit();
			conn.Close();
		}
	}
}

// 更多**好看的内容**和**好玩的案例**请关注**我的微信公众号： 程序猿知秋**</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9aac3b5c04ca1c133177233b503c1517/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[JavaMailSender that could not be found] 之终极坑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4724a0feddda36807f12504290e76d92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Excel 快捷键</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>