<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>J1939协议解读 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="J1939协议解读" />
<meta property="og:description" content="一、报文格式 1.1协议数据单元(Protocol Data Unit, PDU) J1939报文使用的基于CAN2.0B的拓展帧格式定义了一个完整的标准化通讯策略，通过PDU定义了一个框架，用来组织数据帧中J1939协议相关的信息。PDU由数据帧中的ID和数据场组成，数据帧和PDU的对应关系如下图所示。
P(Priority)，优先级字段，用于在仲裁过程中控制报文优先级。EDP(Extended Data Page)，为扩展数据页位，在J1939中固定取值为0。P(Data Page)，数据页位，可用来扩展参数组的数量。PF(PDU Format)，为PDU格式字段，通过不同的取值来确定参数组编号(Parameter Group Number, PGN)是按照PDU1格式还是PDU2格式。PS(PDU Specific)，特定协议数据单元字段，当PF的值为0-239时PS表示目标地址（PDU1格式），当PF的值为240-255时PS字段表示组扩展（PDU2格式），且报文只能广播。SA(Source Address)，源地址字段，整个网络中SA的值必须是唯一的。Data Field，数据场，对于Classic CAN来说是8个字节，而CANFD则最多有64个字节数据。如果需要传输更多的数据，则需要借助J1939的传输协议。 图2. CAN2.0B帧格式与J1939PDU的对应关系
1.2参数组编号(PGN) 参数组是应用层中定义的与某个ECU相关的具有相同控制功能的若干个参数的组合，而PGN是用于唯一标识参数组的号码，在应用层中定义。PGN由三个字节组成，从最高位开始的前6个比特默认值为0，然后是EDP位和DP位，接下来两个字节分别是PF和PS。
图3. PDU与PGN的对应关系
1.3实例分析 实例分析1
typedef struct{
uint8 pf; //PF:为PDU格式字段，通过不同的取值来确定
//参数组编号(Parameter Group Number, PGN)是按照PDU1格式还是PDU2格式。
uint8 ps; //PS:特定协议数据单元字段，当PF的值为0-239时PS表示目标地址（PDU1格式），
//当PF的值为240-255时PS字段表示组扩展（PDU2格式），且报文只能广播。
uint8 prior; //优先级
uint8 framtype; //数据帧格式：标准帧还是扩展帧
uint8 transtype; //传递格式：规定传输方向
uint16 rate; //通信速率
}CCS_SLAVE_PROTOCAL_CONST_PARA;
CCS_SLAVE_PROTOCAL_CONST_PARA const CCS_SLAVE_TX_PARA[CCS_SLAVE_TX_TOTAL]={
{0xE1,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,150}, //WL
{0xE2,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,160}, //WL
{0xE3,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,170}, //WL
{0xE4,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,180}, //WL {0xE5,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,190}, //WL" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/53cb7ae9950c1e25d63eef0d6821fcf0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-12T20:49:18+08:00" />
<meta property="article:modified_time" content="2023-12-12T20:49:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">J1939协议解读</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3><strong>一、报文格式</strong></h3> 
<h3>1.1协议数据单元(Protocol Data Unit, PDU)</h3> 
<p>J1939报文使用的基于CAN2.0B的拓展帧格式定义了一个完整的标准化通讯策略，通过PDU定义了一个框架，用来组织数据帧中J1939协议相关的信息。PDU由数据帧中的ID和数据场组成，数据帧和PDU的对应关系如下图所示。</p> 
<ul><li>P(Priority)，优先级字段，用于在仲裁过程中控制报文优先级。</li><li>EDP(Extended Data Page)，为扩展数据页位，在J1939中固定取值为0。</li><li>P(Data Page)，数据页位，可用来扩展参数组的数量。</li><li>PF(PDU Format)，为PDU格式字段，通过不同的取值来确定参数组编号(Parameter Group Number, PGN)是按照PDU1格式还是PDU2格式。</li><li>PS(PDU Specific)，特定协议数据单元字段，当PF的值为0-239时PS表示目标地址（PDU1格式），当PF的值为240-255时PS字段表示组扩展（PDU2格式），且报文只能广播。</li><li>SA(Source Address)，源地址字段，整个网络中SA的值必须是唯一的。</li><li>Data Field，数据场，对于Classic CAN来说是8个字节，而CANFD则最多有64个字节数据。如果需要传输更多的数据，则需要借助J1939的传输协议。</li></ul> 
<p></p> 
<p class="img-center"><img alt="" height="337" src="https://images2.imgbox.com/a4/7a/NsrWNmjO_o.png" width="640"></p> 
<p>图2. CAN2.0B帧格式与J1939PDU的对应关系</p> 
<h3>1.2参数组编号(PGN)</h3> 
<p>参数组是应用层中定义的与某个ECU相关的具有相同控制功能的若干个参数的组合，而PGN是用于唯一标识参数组的号码，在应用层中定义。PGN由三个字节组成，从最高位开始的前6个比特默认值为0，然后是EDP位和DP位，接下来两个字节分别是PF和PS。</p> 
<p></p> 
<p class="img-center"><img alt="" height="377" src="https://images2.imgbox.com/3c/d3/0YjLfNAa_o.png" width="640"></p> 
<p>图3. PDU与PGN的对应关系</p> 
<h3>1.3实例分析</h3> 
<blockquote> 
 <p>实例分析1</p> 
 <p></p> 
 <p>typedef struct{<!-- --><br>     uint8 pf;           //PF:为PDU格式字段，通过不同的取值来确定<br>                         //参数组编号(Parameter Group Number, PGN)是按照PDU1格式还是PDU2格式。<br>     uint8 ps;           //PS:特定协议数据单元字段，当PF的值为0-239时PS表示目标地址（PDU1格式），<br>                         //当PF的值为240-255时PS字段表示组扩展（PDU2格式），且报文只能广播。<br>     uint8 prior;        //优先级<br>     uint8 framtype;     //数据帧格式：标准帧还是扩展帧<br>     uint8 transtype;    //传递格式：规定传输方向<br>     uint16 rate;        //通信速率<br> }CCS_SLAVE_PROTOCAL_CONST_PARA;</p> 
 <p>CCS_SLAVE_PROTOCAL_CONST_PARA    const    CCS_SLAVE_TX_PARA[CCS_SLAVE_TX_TOTAL]={<!-- --><br>   <br>     {0xE1,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,150},    //WL<br>     {0xE2,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,160},    //WL<br>     {0xE3,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,170},    //WL<br>     {0xE4,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,180},    //WL <br>     {0xE5,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,190},    //WL<br>     {0xE6,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,200},    //WL <br>   <br>     {0xEA,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,110},    //18<br>     {0xEB,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,120},    //18<br>     {0xEC,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,130},    //18<br>     {0xED,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,140},    //18 <br> //   {0xEE,0xE0,6, CAN_FRAMTYPE_EXT,TT_ASYNC,550},    //18      <br> };</p> 
</blockquote> 
<p>将CCS_SLAVE_PROTOCAL_CONST_PARA结构体进行赋值，并进行初始化。CCS_SLAVE_TX_TOTAL代表了结构体的数量，了解枚举结构体的使用方法；</p> 
<blockquote> 
 <p>typedef enum{    <br>     CCS_SLAVE_TX_18E1E0XX=0,//WL<br>     CCS_SLAVE_TX_18E2E0XX,//WL<br>     CCS_SLAVE_TX_18E3E0XX,//WL<br>     CCS_SLAVE_TX_18E4E0XX,//WL<br>     CCS_SLAVE_TX_18E5E0XX,//WL<br>     CCS_SLAVE_TX_18E6E0XX,//WL</p> 
 <p>    CCS_SLAVE_TX_18EAE0XX,//WL<br>     CCS_SLAVE_TX_18EBE0XX,<br>     CCS_SLAVE_TX_18ECE0XX,<br>     CCS_SLAVE_TX_18EDE0XX,<br>     <br> //    CCS_SLAVE_TX_18EEE0XX,</p> 
 <p>    CCS_SLAVE_TX_TOTAL<br> }CCS_SLAVEGAPP_PGN_TX;</p> 
</blockquote> 
<p>枚举（enum）是一种数据类型，它的语法定义格式为：</p> 
<blockquote> 
 <p>enum        枚举名{枚举元素1，枚举元素2，......};</p> 
</blockquote> 
<p>例如，一个星期有七天，使用枚举法进行定义为：</p> 
<blockquote> 
 <p>enum Day<br> {<!-- --><br>     Mon,Tue,Wed,Thu,Fri,Sat,Sun<br> };</p> 
 <p></p> 
</blockquote> 
<p><br> 需要注意的是，第一个枚举元素的默认值为0，后面的枚举元素的值在上一枚举元素的值上加1。因此，Mon=0，Tue=1，Wed=2，Thu=3，Fri=4，Sat=5，Sun=6.</p> 
<p>但是，在定义枚举类型时，可以改变枚举元素的值：</p> 
<blockquote> 
 <p>enum Day<br> {<!-- --><br>     Mon=1,Tue,Wed,Thu,Fri,Sat,Sun<br> };<br> 此时，Mon=1，Tue=2依次往后推；</p> 
</blockquote> 
<blockquote> 
 <p>enum Day<br> {<!-- --><br>     Mon,Tue,Wed=3,Thu,Fri,Sat,Sun<br> };<br> 此时，Mon=0，Tue=1，Wed=3，Thu=4，Fri=5，Sat=6，Sun=7.<br>  </p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd526570f46aefd45521d4c814b9a275/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TransactionScope的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9132bb9e436ae53d2107a7e1798cd75f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">三天精通Selenium Web 自动化 - Selenium(Java)环境搭建 （new）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>