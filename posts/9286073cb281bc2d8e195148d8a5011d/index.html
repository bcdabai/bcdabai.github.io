<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>局域网冗余备份技术 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="局域网冗余备份技术" />
<meta property="og:description" content="局域网冗余备份
冗余备份 链路捆绑
理解并掌握
单星形 容易单点故障 接入和核心 交换机
链路故障和设备故障 经过核心交换机 故障 引擎故障 电源故障等
引擎冗余 电源冗余 设备冗余
链路冗余避免单链路故障
引擎冗余 设备启动后 一块工作 另一块备份 保存配置时 两块引擎 50毫秒内 切换接替
设备电源模块 供电 双电路方式 采购时 注意 耗电量 决定电源的过滤 避免某些板卡不可用
设备荣誉
冷备份 一般冷备份 在线冷备份 备份设备 不参与业务 策略技术没有把流量引入
热备份 平滑接替
故障恢复时间短 不需要人为参与 自动接替
数据应用冗余备份 网络里面的 互联网公司 腾讯 用户的账户信息 小型和 应用集群 存储设备
动态滑接 镜像存储 普通数据 操作系统 应用 导致业务中断 应用中断时体现作用
记录 数据丢失 快照进行数据恢复
冗余备份技术选择
业务可靠性要求
使用一种或多种双引擎单设备 多链路捆绑
数据可靠性要求 核心设备 容灾能力" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9286073cb281bc2d8e195148d8a5011d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-17T20:07:39+08:00" />
<meta property="article:modified_time" content="2020-03-17T20:07:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">局域网冗余备份技术</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>局域网冗余备份<br> 冗余备份 链路捆绑<br> 理解并掌握<br> 单星形 容易单点故障 接入和核心 交换机<br> 链路故障和设备故障 经过核心交换机 故障 引擎故障 电源故障等<br> 引擎冗余 电源冗余 设备冗余<br> 链路冗余避免单链路故障<br> 引擎冗余 设备启动后 一块工作 另一块备份 保存配置时 两块引擎 50毫秒内 切换接替<br> 设备电源模块 供电 双电路方式 采购时 注意 耗电量 决定电源的过滤 避免某些板卡不可用<br> 设备荣誉<br> 冷备份 一般冷备份 在线冷备份 备份设备 不参与业务 策略技术没有把流量引入<br> 热备份 平滑接替<br> 故障恢复时间短 不需要人为参与 自动接替<br> 数据应用冗余备份 网络里面的 互联网公司 腾讯 用户的账户信息 小型和 应用集群 存储设备<br> 动态滑接 镜像存储 普通数据 操作系统 应用 导致业务中断 应用中断时体现作用<br> 记录 数据丢失 快照进行数据恢复<br> 冗余备份技术选择<br> 业务可靠性要求<br> 使用一种或多种双引擎单设备 多链路捆绑<br> 数据可靠性要求 核心设备 容灾能力<br> 成本 网络维护人员技术水平 复杂出现故障之后如何恢复</p> 
<p>以太网链路捆绑<br> 贷款需求增长<br> 增加两台设备的可用带宽<br> 数据通道 更高带宽的 端口类型<br> 万兆 交换机<br> 低水平的设备进行端口链路捆绑 以太网通道 链路带宽倍增<br> 既能增加带宽 又能提高冗余能力<br> 速率/双工：所有捆绑的接口都应具有相同的速率和双工模式<br> access链路：所有捆绑的链路必须在同一vlan<br> trunk：封装模式，vlan nativevlan必须一样<br> 报文过滤 qos必须一样<br> Ether Channel 2层接口捆绑<br> Ether Channel 3层链路捆绑 可以直接炮IP流量<br> 使用<br> 拓扑图 终端 接入 汇聚 核心 运行 动态路由协议<br> 路由方式 收敛 三层链路 捆绑</p> 
<p>以太通道配置<br> EC<br> 手动链路捆绑<br> 两边不需要链路捆绑协议的协商，直接进行捆绑<br> interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group 2 mode on</p> 
<p>interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group mode on</p> 
<p>PAGP 端口聚合 思科私有<br> auto 主动要求对方<br> desirable<br> 两边主动 可以<br> 一边主动 一边期望 可以<br> 两边期望 不可以<br> interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group 2 mode desirable<br> interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group 2 mode desirable</p> 
<p>LACP 链路聚合 IEEE共有标准<br> 思科产品 和 其他厂商 滑接<br> passive<br> active<br> interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group 2 mode active<br> interface range fastehernet 0/1-2<br> switch mode trunk<br> switch trunk allowed vlan all<br> channel-group 2 mode active</p> 
<p>三层链路捆绑<br> interface range fastehernet 0/1-2<br> no switchport<br> channel-group 5 mode on<br> interface port-channel 5<br> ip address 10.1.1.1 255.255.255.252 //IP 配载逻辑端口 三层IP对接</p> 
<p>show etherchannel summary<br> group port-channel protocol</p> 
<p>以太网通道负载均衡<br> 基于目标IP或MAC的负载均衡 某一条链路比较雍塞 串行<br> 基于源IP或MAC的负载均衡 相同的原 一个设备发送的 链路分离 并行 两个不同的实现 轮询<br> 默认基于源MAC<br> Ether channel<br> Switch(config)#prot-channel load-balance ?<br> Switch#show ehterchannel load-balance</p> 
<p>局域网网关冗余应用<br> 局域网默认网关缺陷<br> 网关作为网络边界<br> 两台互为备份 更换网关<br> 早期解决方案<br> 静态配置默认网关 手动或通过DHCP为主机配置一个默认网关<br> 代理ARP 三层设备收到ARP请求 以自身MAC地址作为最终解析的地址 300s<br> 存在大量的ARP报文 不利于网段子网IP规划</p> 
<p>PC启用 动态路由协议 rip 三层设备 路由发送 为PC 构成 路由表 交换机<br> 消耗占用PC处理资源 占用链路带宽</p> 
<p>主流方案<br> HSRP 思科私有<br> 热备份路由协议<br> 使用一组设备沟通提供网关服务 保证业务不间断<br> HSRP 组<br> 一组参与HSRP的路由器<br> HSRP组中角色<br> 虚拟路由器 拟化出来的<br> 活跃路由器 组中真正用来处理数据的设备 最终 由活跃路由器<br> 备份路由器 活跃路由器的替代 网关从来不变<br> 其他路由器 多个设备路由器共同组成 一般用两个设备<br> HSRP角色选取 比较优先级 端口指定的权值 0-255 默认100 0表示不参与选举 大优<br> IP地址越大越优先<br> 注意事项 同一个HSRP组必须在同一个广播域 hello组播地址224.0.0.2<br> 同一个HSRP成员必须在同一个子网<br> 工作原理 MAC地址 计算生成 一个设备上面可以有多个编号 备份路由器不作回应<br> 活跃路由器回应</p> 
<p>HSRP的消息类型<br> 底层协议 UDP：1985 非面向连接 尽力而为 不可靠<br> 无法知道对方的状态 协议本身需要可靠保证<br> HSRP是上层协议 由底层提供<br> 报文<br> hello消息 选举不同设备角色 判断对方状态 3S interval 10S hold time<br> 政变消息：coup 备份路由器 变为活跃路由器 发送一个coup<br> 辞职消息 当活跃路由器要宕机或者当有优先级更高的路由器发送hello消息时，活跃路由器发送一个resign<br> HSRP状态<br> initial 第一次启用<br> learn 不知道虚拟IP地址，等待活跃路由器发送过来的Hello消息<br> listen 路由器知道了虚拟IP地址但还不是活跃路由器额备份路由器，同时监听hello消息<br> speak 周期发送hello消息，并积极参与活跃路由器和备份路由器选举<br> standby 备用状态 该路由器是下一个活跃路由器的候选设备，并周期发送hello消息<br> active 路由器负责转发到HSRP组的虚拟MAC地址的数据包，并周期发送hello消息<br> HSRP消息详细格式<br> Op编码<br> 状态 设备 hello实践<br> HSRP配置和命令<br> 一、进接口模式配置路由器为HSRP的成员<br> Switch(config-if)#standby 10 ip ?//同vlan号，便于区分；虚拟IP address第一个地址<br> Switch(config-if)#standby 10 priority ？//优先级<br> Switch(config-if)#standby 10 preempt //开启抢占，活跃设备故障，备份设备顶上 恢复也不重新顶上<br> Switch(config-if)#standby 10 timers ？ //更改hello time 计时器<br> 查看<br> Switch#show standby brief</p> 
<p>案例 HSRP负载均衡配置案例<br> 组 1 和组2 的 活跃路由器和 备份路由器分离<br> 4个vlan<br> PC1 10<br> PC2 20<br> PC3 30<br> PC4 40<br> 三层交换机<br> 规范定义<br> SW1配置命令<br> SW1(config)#interface vlan 10<br> SW1(config-if)#ip address 192.168.10.1 255.255.255.0<br> SW1(config-if)#standby 10 ip 192.168.10.254<br> SW1(config-if)#standby 10 priority 200<br> SW1(config-if)#standby 10 preempt</p> 
<p>SW1(config)#interface vlan 20<br> SW1(config-if)#ip address 192.168.20.1 255.255.255.0<br> SW1(config-if)#standby 20 ip 192.168.20.254<br> SW1(config-if)#standby 20 priority 200<br> SW1(config-if)#standby 20 preempt</p> 
<p>SW1(config)#interface vlan 30<br> SW1(config-if)#ip address 192.168.30.1 255.255.255.0<br> SW1(config-if)#standby 30 ip 192.168.30.254<br> SW1(config)#interface vlan 40<br> SW1(config-if)#ip address 192.168.40.1 255.255.255.0<br> SW1(config-if)#standby 40 ip 192.168.40.254</p> 
<p>SW2配置命令<br> SW2(config)#interface vlan 30<br> SW2(config-if)#ip address 192.168.30.2 255.255.255.0<br> SW2(config-if)#standby 30 ip 192.168.30.254<br> SW2(config-if)#standby 30 priority 200<br> SW2(config-if)#standby 30 preempt</p> 
<p>SW2(config)#interface vlan 40<br> SW2(config-if)#ip address 192.168.40.2 255.255.255.0<br> SW2(config-if)#standby 40 ip 192.168.40.254<br> SW2(config-if)#standby 40 priority 200<br> SW2(config-if)#standby 40 preempt</p> 
<p>SW2(config)#interface vlan 10<br> SW2(config-if)#ip address 192.168.10.2 255.255.255.0<br> SW2(config-if)#standby 10 ip 192.168.10.254<br> SW2(config)#interface vlan 20<br> SW2(config-if)#ip address 192.168.20.2 255.255.255.0<br> SW2(config-if)#standby 20 ip 192.168.20.254<br> show standby brief 查看HSRP的状态</p> 
<p>HSRP的端口跟踪技术<br> HSRP负载分担<br> 交换机接口坏了而非设备本身坏了<br> 角色 被动机制 收到对方的<br> 需要设置端口跟踪 自我惩罚<br> 启用HSRP端口跟踪<br> 基于被跟踪端口的可用性而自动进行调整<br> 如果端口变为不可用 自我惩罚<br> 规定时间 自我惩罚 阀值范围 自我惩罚 减少<br> 恢复之后 可以再抢占回来<br> 设置<br> SW1(config)#interface vlan 10<br> SW1(config-if)#ip address 192.168.10.1 255.255.255.0<br> SW1(config-if)#standby 10 ip 192.168.10.254<br> SW1(config-if)#standby 10 priority 200<br> SW1(config-if)#standby 10 preempt<br> SW1(config-if)#standby 10 track fastEthernet 0/1 110</p> 
<p>SW2(config)#interface vlan 10<br> SW2(config-if)#ip address 192.168.10.2 255.255.255.0<br> SW2(config-if)#standby 10 ip 192.168.10.254<br> SW2(config-if)#standby 10 preempt</p> 
<p>VRRP协议概述<br> 虚拟路由冗余协议 IEEE公有标准<br> 多厂商设备环境 避免出现兼容性问题<br> IP报文 作为传输协议 进行 协议报文的传送<br> 传输效率更高 不可靠的协议<br> 被动等待计时器 认为失效<br> 协议号 112 访问控制列表 过滤 HSRP 1985端口 ， 过滤 VRRP 过滤协议号112<br> 只有通告报文<br> 1S<br> hold time 3S 切换更快 网络拥塞 可能导致设备误判<br> 地址 0.0.0.2<br> initialize<br> master 类似于 active<br> backup 类似于standby<br> 交互通告报文<br> VRRP选择原则 优先级越大越优先 IP地址越大越优先<br> 虚拟网关可以使用实际的接口 但实际指定<br> R1(config)#interface FastEthernet0/1.10<br> R1(config-if)#ip address 192.168.8.1 255.255.255.0<br> R1(config-if)#encapsulation dot1Q 10<br> R1(config-if)#vrrp 1 ip 192.168.8.254<br> R1(config-if)#vrrp 1 preempt<br> R1(config-if)#vrrp 1 priority 200<br> R1(config-if)#vrrp 1 track 1 decrement 120<br> R1(config-if)#vrrp 1 interface FastEthernet0/2 line-protocol</p> 
<p>R2(config)#interface FastEthernet0/1.10<br> R2(config-if)#ip address 192.168.8.2 255.255.255.0<br> R2(config-if)#encapsulation dot1Q 10<br> R2(config-if)#vrrp 1 ip 192.168.8.254<br> R2(config-if)#vrrp 1 preempt</p> 
<p>查看 show vrrp brief</p> 
<p>STP与HSRP结合案例分析</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/35934f707f2e63f9a8213bb04ec33c82/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c语言输出等腰三角形</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ab2db6c18567e454a341105baf76f50/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">eclipse在java环境基础上配置C&#43;&#43;环境（MinGW安装包&#43;详细步骤）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>