<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx学习笔记" />
<meta property="og:description" content="文章目录 一、Nginx初始二、正向代理和反向代理（一）正向代理（二）正向代理的使用场景（三）反向代理（四）反向代理的使用场景 三、Nginx的安装（一）：Linux下安装Nginx（二）：Windows下安装Nginx 四、Nginx常用命令五、Nginx配置（nginx.conf文件内容模块及作用）（一）文件内容及模块（1）、全局块的作用（2）、events块的作用（3）、Http块的作用（3.1、虚拟主机的配置（3.2、日志的配置 六、反向代理配置（一）配置反向代理的nginx.conf文件（二）实现在同一域名下，根据不同的访问路径访问不同的项目 七、负载均衡（一）概念（二）负载均衡器可以处理的四大类型的请求（三）负载均衡的调度算法（四）负载均衡的使用 八、动静分离（一）概念（二）实现方式（三）动静分离的应用 九、location块补充（一）、匹配规则（二） URL重写 一、Nginx初始 Nginx是一个高性能的Http和反向代理服务器，也是一个IMAP/POP3/SMTP等邮件代理服务器
二、正向代理和反向代理 如果客户端（client）不能直接访问服务端(server)，则需要代理服务器(proxy)进行访问
（一）正向代理 正向代理：客户端通过设置，使用代理服务器去访问远程服务器
（二）正向代理的使用场景 1、可以访问原来无法访问的资源
2、可以做缓存使用，加快访问速度
3、对客户端授权或记录访问信息等
（三）反向代理 反向代理：服务器通过代理服务接收连接请求，然后再转发给内部网络的服务器，将服务器的结果返回给客户端，此时这种代理叫反向代理
（四）反向代理的使用场景 1、保证内网的安全，阻止web攻击
2、负载均衡，优化网站的负载（处理能力）
注意：正向代理知道是通过代理服务器访问服务端的，但是反向代理不知道是通过代理服务器访问服务端的
一句话总结：代理服务器站在客户端一边（客户端知道是通过代理服务器访问的）就是正向代理，代理服务器站在服务器端一边（客户端不知道是通过代理服务器访问的），就是反向代理
三、Nginx的安装 （一）：Linux下安装Nginx 以openssl为例：
1、在各官网下载相关组件： Nginx 、openssl 、 zlib 、 pcre等
2、通过rz 上传压缩包
3、通过tar -xvf *.tar.gz进行解压缩
4、通过cd 文件夹名 进入解压后的文件夹中
5、通过 ./config 执行配置相关的检查
6、通过make &amp; make install进行编译和安装
注意：如上过程适用于zlib和pcre ,对于pcre而言，执行检查命令为./configure
7、安装nginx过程中、执行配置检查
图片：
8、仍然执行make以及make install
9、nginx安装成功，./nginx进行验证
注意事项：nginx服务器，需要虚拟机开放80端口的访问
防火墙配置（同样适用于tomcat开放8080 8081端口）：
firewall-cmd --list-all 查看当前配置
firewall-cmd --add-service=http --permanent 开放http访问
firewall-cmd --add-port=80/tcp --permanent 开放80端口" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9a8e63135a3088fe37093b06293750d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-12T21:46:43+08:00" />
<meta property="article:modified_time" content="2022-09-12T21:46:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Nginx_4" rel="nofollow">一、Nginx初始</a></li><li><a href="#_7" rel="nofollow">二、正向代理和反向代理</a></li><li><ul><li><a href="#_10" rel="nofollow">（一）正向代理</a></li><li><a href="#_13" rel="nofollow">（二）正向代理的使用场景</a></li><li><a href="#_19" rel="nofollow">（三）反向代理</a></li><li><a href="#_22" rel="nofollow">（四）反向代理的使用场景</a></li></ul> 
  </li><li><a href="#Nginx_30" rel="nofollow">三、Nginx的安装</a></li><li><ul><li><a href="#LinuxNginx_32" rel="nofollow">（一）：Linux下安装Nginx</a></li><li><a href="#WindowsNginx_63" rel="nofollow">（二）：Windows下安装Nginx</a></li></ul> 
  </li><li><a href="#Nginx_66" rel="nofollow">四、Nginx常用命令</a></li><li><a href="#Nginxnginxconf_85" rel="nofollow">五、Nginx配置（nginx.conf文件内容模块及作用）</a></li><li><ul><li><a href="#_88" rel="nofollow">（一）文件内容及模块</a></li><li><a href="#1_212" rel="nofollow">（1）、全局块的作用</a></li><li><a href="#2events_232" rel="nofollow">（2）、events块的作用</a></li><li><a href="#3Http_242" rel="nofollow">（3）、Http块的作用</a></li><li><a href="#31_247" rel="nofollow">（3.1、虚拟主机的配置</a></li><li><a href="#32_321" rel="nofollow">（3.2、日志的配置</a></li></ul> 
  </li><li><a href="#_356" rel="nofollow">六、反向代理配置</a></li><li><ul><li><a href="#nginxconf_368" rel="nofollow">（一）配置反向代理的nginx.conf文件</a></li><li><a href="#_391" rel="nofollow">（二）实现在同一域名下，根据不同的访问路径访问不同的项目</a></li></ul> 
  </li><li><a href="#_424" rel="nofollow">七、负载均衡</a></li><li><ul><li><a href="#_426" rel="nofollow">（一）概念</a></li><li><a href="#_436" rel="nofollow">（二）负载均衡器可以处理的四大类型的请求</a></li><li><a href="#_440" rel="nofollow">（三）负载均衡的调度算法</a></li><li><a href="#_446" rel="nofollow">（四）负载均衡的使用</a></li></ul> 
  </li><li><a href="#_543" rel="nofollow">八、动静分离</a></li><li><ul><li><a href="#_545" rel="nofollow">（一）概念</a></li><li><a href="#_551" rel="nofollow">（二）实现方式</a></li><li><a href="#_555" rel="nofollow">（三）动静分离的应用</a></li></ul> 
  </li><li><a href="#location_629" rel="nofollow">九、location块补充</a></li><li><ul><li><a href="#_631" rel="nofollow">（一）、匹配规则</a></li><li><a href="#_URL_643" rel="nofollow">（二） URL重写</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="Nginx_4"></a>一、Nginx初始</h2> 
<p>Nginx是一个高性能的Http和反向代理服务器，也是一个IMAP/POP3/SMTP等邮件代理服务器</p> 
<h2><a id="_7"></a>二、正向代理和反向代理</h2> 
<p>如果客户端（client）不能直接访问服务端(server)，则需要代理服务器(proxy)进行访问</p> 
<h3><a id="_10"></a>（一）正向代理</h3> 
<p>正向代理：客户端通过设置，使用代理服务器去访问远程服务器</p> 
<h3><a id="_13"></a>（二）正向代理的使用场景</h3> 
<p>1、可以访问原来无法访问的资源<br> 2、可以做缓存使用，加快访问速度<br> 3、对客户端授权或记录访问信息等</p> 
<h3><a id="_19"></a>（三）反向代理</h3> 
<p>反向代理：服务器通过代理服务接收连接请求，然后再转发给内部网络的服务器，将服务器的结果返回给客户端，此时这种代理叫反向代理</p> 
<h3><a id="_22"></a>（四）反向代理的使用场景</h3> 
<p>1、保证内网的安全，阻止web攻击<br> 2、负载均衡，优化网站的负载（处理能力）</p> 
<p><strong>注意</strong>：正向代理知道是通过代理服务器访问服务端的，但是反向代理不知道是通过代理服务器访问服务端的<br> <strong>一句话总结</strong>：代理服务器站在客户端一边（客户端知道是通过代理服务器访问的）就是正向代理，代理服务器站在服务器端一边（客户端不知道是通过代理服务器访问的），就是反向代理</p> 
<h2><a id="Nginx_30"></a>三、Nginx的安装</h2> 
<h3><a id="LinuxNginx_32"></a>（一）：Linux下安装Nginx</h3> 
<p>以openssl为例：<br> 1、在各官网下载相关组件： Nginx 、openssl 、 zlib 、 pcre等<br> 2、通过rz 上传压缩包<br> 3、通过tar -xvf *.tar.gz进行解压缩<br> 4、通过cd 文件夹名 进入解压后的文件夹中<br> 5、通过 ./config 执行配置相关的检查<br> 6、通过make &amp; make install进行编译和安装</p> 
<p><strong>注意</strong>：如上过程适用于zlib和pcre ,对于pcre而言，执行检查命令为./configure<br> 7、安装nginx过程中、执行配置检查<br> 图片：<br> 8、仍然执行make以及make install<br> 9、nginx安装成功，./nginx进行验证<br> <strong>注意事项</strong>：nginx服务器，需要虚拟机开放80端口的访问<br> <strong>防火墙配置（同样适用于tomcat开放8080 8081端口）</strong>：<br> firewall-cmd --list-all 查看当前配置<br> firewall-cmd --add-service=http --permanent 开放http访问<br> firewall-cmd --add-port=80/tcp --permanent 开放80端口<br> firewall-cmd --reload 重启防护墙保护<br> <strong>JDK的安装：</strong><br> 1、解压缩—拷贝目录到/usr/local/java<br> 2、更改环境变量 vim /etc/profile<br> 图片<br> 3、让环境变量生效 source /ect/profile<br> 4、验证版本 java --version<br> <strong>Tomcat的安装</strong><br> 1、解压缩—拷贝目录到 /usr/local/tomcat<br> 2、直接执行 ./startup.sh 启动</p> 
<h3><a id="WindowsNginx_63"></a>（二）：Windows下安装Nginx</h3> 
<h2><a id="Nginx_66"></a>四、Nginx常用命令</h2> 
<p>nginx安装包所在目录 /usr/local/src/<br> nginx安装目录：/usr/local/nginx/<br> 启动命令：./nginx<br> 验证方式：浏览器访问 虚拟机ip地址（出现nginx欢迎页面）<br> 关闭方式：<br> 1、./nginx -s stop 原生命令<br> 2、也可以通过linux关闭进程的命令关闭,<br> 查看文件 cat nginx.pid<br> 杀死进程：kill +参数+pid 形式 （pid表示进程的id）<br> 如：kill -9 pid 强行停止服务<br> kill -TERM pid 快速停止服务<br> kill -QUIT pid 平缓停止服务<br> <strong>注意</strong>：启动后，进程id存放位置 /usr/local/nginx/nginx.pid<br> 查看所有命令： ./nginx -h<br> 信号处理命令：./nginx -s +(stop,quit,reopen,reload)<br> 其中reload 是重新加载命令，在更改配置后使用<br> quit仍然是平缓停止的意思（完整有序），stop快速停止</p> 
<h2><a id="Nginxnginxconf_85"></a>五、Nginx配置（nginx.conf文件内容模块及作用）</h2> 
<p>查看nginx配置：cat nginx.conf</p> 
<h3><a id="_88"></a>（一）文件内容及模块</h3> 
<pre><code class="prism language-java">
#user  nobody<span class="token punctuation">;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  notice<span class="token punctuation">;</span>
#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  info<span class="token punctuation">;</span>

#pid        logs<span class="token operator">/</span>nginx<span class="token punctuation">.</span>pid<span class="token punctuation">;</span>


events <span class="token punctuation">{<!-- --></span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    #log_format  main  '$remote_addr <span class="token operator">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> <span class="token string">"$request"</span> '
    #                  '$status $body_bytes_sent <span class="token string">"$http_referer"</span> '
    #                  '<span class="token string">"$http_user_agent"</span> <span class="token string">"$http_x_forwarded_for"</span>'<span class="token punctuation">;</span>

    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    #tcp_nopush     on<span class="token punctuation">;</span>

    #keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    #gzip  on<span class="token punctuation">;</span>

    server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        #charset koi8<span class="token operator">-</span>r<span class="token punctuation">;</span>

        #access_log  logs<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            root   html<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        #error_page  <span class="token number">404</span>              <span class="token operator">/</span><span class="token number">404.</span>html<span class="token punctuation">;</span>

        # redirect server error pages <span class="token keyword">to</span> <span class="token namespace">the</span> <span class="token keyword">static</span> page <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html
        #
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{<!-- --></span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        # proxy the PHP scripts <span class="token keyword">to</span> <span class="token class-name">Apache</span> listening on <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">80</span>
        #
        #location <span class="token operator">~</span> \<span class="token punctuation">.</span>php$ <span class="token punctuation">{<!-- --></span>
        #    proxy_pass   http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>
        #<span class="token punctuation">}</span>

        # pass the PHP scripts <span class="token keyword">to</span> <span class="token class-name">FastCGI</span> server listening on <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9000</span>
        #
        #location <span class="token operator">~</span> \<span class="token punctuation">.</span>php$ <span class="token punctuation">{<!-- --></span>
        #    root           html<span class="token punctuation">;</span>
        #    fastcgi_pass   <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
        #    fastcgi_index  index<span class="token punctuation">.</span>php<span class="token punctuation">;</span>
        #    fastcgi_param  SCRIPT_FILENAME  <span class="token operator">/</span>scripts$fastcgi_script_name<span class="token punctuation">;</span>
        #    include        fastcgi_params<span class="token punctuation">;</span>
        #<span class="token punctuation">}</span>

        # deny access <span class="token keyword">to</span> <span class="token punctuation">.</span>htaccess files<span class="token punctuation">,</span> <span class="token keyword">if</span> <span class="token class-name">Apache</span>'s document root
        # concurs <span class="token keyword">with</span> <span class="token namespace">nginx</span>'s one
        #
        #location <span class="token operator">~</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>ht <span class="token punctuation">{<!-- --></span>
        #    deny  all<span class="token punctuation">;</span>
        #<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    # another virtual host using mix of IP<span class="token operator">-</span><span class="token punctuation">,</span> name<span class="token operator">-</span><span class="token punctuation">,</span> and port<span class="token operator">-</span>based configuration
    #
    #server <span class="token punctuation">{<!-- --></span>
    #    listen       <span class="token number">8000</span><span class="token punctuation">;</span>
    #    listen       somename<span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    #    server_name  somename  alias  another<span class="token punctuation">.</span>alias<span class="token punctuation">;</span>

    #    location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
    #        root   html<span class="token punctuation">;</span>
    #        index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    #    <span class="token punctuation">}</span>
    #<span class="token punctuation">}</span>


    # HTTPS server
    #
    #server <span class="token punctuation">{<!-- --></span>
    #    listen       <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    #    server_name  localhost<span class="token punctuation">;</span>

    #    ssl_certificate      cert<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    #    ssl_certificate_key  cert<span class="token punctuation">.</span>key<span class="token punctuation">;</span>

    #    ssl_session_cache    shared<span class="token operator">:</span>SSL<span class="token operator">:</span><span class="token number">1</span>m<span class="token punctuation">;</span>
    #    ssl_session_timeout  <span class="token number">5</span>m<span class="token punctuation">;</span>

    #    ssl_ciphers  HIGH<span class="token operator">:</span><span class="token operator">!</span>aNULL<span class="token operator">:</span><span class="token operator">!</span>MD5<span class="token punctuation">;</span>
    #    ssl_prefer_server_ciphers  on<span class="token punctuation">;</span>

    #    location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
    #        root   html<span class="token punctuation">;</span>
    #        index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    #    <span class="token punctuation">}</span>
    #<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>分为三个部分：全局块、events块、http块。</p> 
<h3><a id="1_212"></a>（1）、全局块的作用</h3> 
<p>全局块：全局指令，指定运行时的用户组、进程id存在位置、日志存放位置、worker process数量等<br> 如：</p> 
<pre><code class="prism language-java">#配置用户或者用户组
#user  nobody<span class="token punctuation">;</span>

#允许生成的进程数（支持的并发数量）
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

#配置日志的路径 可以配置日志级别 （debug <span class="token operator">|</span> info <span class="token operator">|</span> notice <span class="token operator">|</span> warn <span class="token operator">|</span> error <span class="token operator">|</span> crit）
#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  notice<span class="token punctuation">;</span>
#error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  info<span class="token punctuation">;</span>

#配置存储进程id的文件地址
#pid        logs<span class="token operator">/</span>nginx<span class="token punctuation">.</span>pid<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2events_232"></a>（2）、events块的作用</h3> 
<p>影响nginx服务器和用户网络连接的配置，比如每个进程的最大连接数、选取哪种事件驱动模型、以及在网络连接过程中，是否开启多个，是否序列化等</p> 
<pre><code class="prism language-java">events <span class="token punctuation">{<!-- --></span>
	#配置每个进程的最大连接数，默认为<span class="token number">1024</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3Http_242"></a>（3）、Http块的作用</h3> 
<p>配置代理、缓存、日志等绝大部分功能的地方，可以嵌套多个server块，而且不同的server可以对应不同的域名（就是在一个nginx服务器上配置多个域名，这种方式通常称为虚拟主机)，</p> 
<p><strong>虚拟主机</strong>：同一台Nginx服务器，可以支持多个网站的运行，每个虚拟主机之间都相互独立，具有完整功能。（可以节约使用成本）</p> 
<h3><a id="31_247"></a>（3.1、虚拟主机的配置</h3> 
<pre><code class="prism language-java">http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
	
	#
    #log_format  main  '$remote_addr <span class="token operator">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> <span class="token string">"$request"</span> '
    #                  '$status $body_bytes_sent <span class="token string">"$http_referer"</span> '
    #                  '<span class="token string">"$http_user_agent"</span> <span class="token string">"$http_x_forwarded_for"</span>'<span class="token punctuation">;</span>
	
	#配置日志文件地址，声明日志格式
    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    #tcp_nopush     on<span class="token punctuation">;</span>

    #keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    #gzip  on<span class="token punctuation">;</span>
    
	#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  localhost<span class="token punctuation">;</span>
        	
		#定位出路径或文件地址
        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
        	#部署项目jar包的相对路径
            root   html<span class="token punctuation">;</span>
            #默认跳转的首页地址
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>

</code></pre> 
<p>配置指定域名（www.ceshi.com），访问到虚拟机的页面<br> 1、在安装目录下，创建一个存放要部署的项目文件夹，如：mkdir ceshi<br> 2、将要部署的文件存放在ceshi文件夹中<br> 3、注意在配置config文件时记得备份一份，防止配置出错<br> 更改配置如下</p> 
<pre><code class="prism language-java"> server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
            root   ceshi<span class="token punctuation">;</span>
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
</code></pre> 
<p>4、给域名配置ip地址的映射（更改C:\Windows\System32\drivers\etc 下的host文件）</p> 
<pre><code class="prism language-java"># <span class="token class-name">Copyright</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1993</span><span class="token operator">-</span><span class="token number">2009</span> <span class="token class-name">Microsoft</span> <span class="token class-name">Corp</span><span class="token punctuation">.</span>
#
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		
# localhost name resolution is handled within DNS itself<span class="token punctuation">.</span>
#	<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>       localhost
#	<span class="token operator">::</span><span class="token number">1</span>             localhost

#给域名配置ip地址的映射
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span>		www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com
</code></pre> 
<p>5、浏览器输入虚拟机地址或者域名，均能返回项目首页</p> 
<h3><a id="32_321"></a>（3.2、日志的配置</h3> 
<p>通过日志，可以获取用户的地址信息、跳转来源、终端、以及url访问量的</p> 
<pre><code class="prism language-java">	
	#log_format  main  '$remote_addr <span class="token operator">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> <span class="token string">"$request"</span> '
    #                  '$status $body_bytes_sent <span class="token string">"$http_referer"</span> '
    #                  '<span class="token string">"$http_user_agent"</span> <span class="token string">"$http_x_forwarded_for"</span>'<span class="token punctuation">;</span>
	
	#配置日志文件地址，声明日志格式
    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>
</code></pre> 
<p><strong>日志的demo</strong></p> 
<pre><code class="prism language-java"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token operator">/</span><span class="token class-name">Sep</span><span class="token operator">/</span><span class="token number">2022</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">56</span><span class="token operator">:</span><span class="token number">58</span> <span class="token operator">+</span><span class="token number">0800</span><span class="token punctuation">]</span> <span class="token string">"GET /favicon.ico HTTP/1.1"</span> <span class="token number">404</span> <span class="token number">555</span> <span class="token string">"http://localhost/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36 Edg/105.0.1343.33"</span>
</code></pre> 
<p><strong>log_format main 参数说明</strong></p> 
<table><thead><tr><th>名字</th><th>用途</th></tr></thead><tbody><tr><td>remote_addr</td><td>客户端的ip地址</td></tr><tr><td>remote_user</td><td>客户端的用户名称</td></tr><tr><td>time_local</td><td>访问时间和时区</td></tr><tr><td>request</td><td>请求方法</td></tr><tr><td>status</td><td>响应状态码 如：200</td></tr><tr><td>body_bytes_sent</td><td>主体内容字节数 如：612</td></tr><tr><td>http_referer</td><td>记录是从哪个链接访问过来的</td></tr><tr><td>http_user_agent</td><td>代表用户使用的代理，一般为浏览器</td></tr><tr><td>http_x_forwarded_for</td><td>通过代理服务器来记录客户端的ip地址</td></tr></tbody></table> 
<p>可以通过脚本实现日志切割（每天生成一份日志）<br> 1、重命名日志文件<br> 2、让nginx重新从配置文件总读取日志文件名，这样就可以达到在新的日志文件中记录日志效果</p> 
<h2><a id="_356"></a>六、反向代理配置</h2> 
<p>前提：在linux系统中安装好jdk和tomcat（配置好环境变量）<br> 安装路径：<br> 1、jdk路径：/usr/local/java/<br> 2、tomcat路径：/usr/local/tomcat/<br> 启动方式：/usr/local/tomcat/bin 执行 ./startup.sh<br> 关闭方式：执行 ./shutdown.sh<br> 验证方式： 虚拟机ip：8080 可以看到tomcat页面</p> 
<p><strong>需求：</strong><br> 访问www.ceshi.com 显示百度的页面</p> 
<h3><a id="nginxconf_368"></a>（一）配置反向代理的nginx.conf文件</h3> 
<pre><code class="prism language-java">	#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        	
		#定位出路径或文件地址
        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
        	#部署项目jar包的相对路径
            root   ceshi<span class="token punctuation">;</span>
            #将域名请求，跳转发送到百度上，相当于直接访问https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
            proxy_pass  https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
            #默认跳转的首页地址
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
</code></pre> 
<p>注意：更改配置文件nginx.conf文件后，执行重加载命令 ./nginc -s reload</p> 
<h3><a id="_391"></a>（二）实现在同一域名下，根据不同的访问路径访问不同的项目</h3> 
<p>**需求：**一个nginx服务器连接多个项目，当域名对应的路径不同时，跳转不同的项目</p> 
<p><strong>配置nginx.conf配置文件</strong></p> 
<pre><code class="prism language-java">#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        	
		#定位出路径或文件地址
        location <span class="token operator">~</span><span class="token operator">/</span>baidu1 <span class="token punctuation">{<!-- --></span>  #<span class="token operator">~</span><span class="token operator">/</span>baidu1 表示当访问www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token operator">+</span>baidu1时跳转的页面为https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>baidu<span class="token punctuation">.</span>com
        	#部署项目jar包的相对路径
            root   ceshi<span class="token punctuation">;</span>
            #将域名请求，跳转发送到百度上，相当于直接访问https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
            proxy_pass  https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
            #默认跳转的首页地址
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        #定位出路径或文件地址
        location <span class="token operator">~</span><span class="token operator">/</span>guge1 <span class="token punctuation">{<!-- --></span>  #<span class="token operator">~</span><span class="token operator">/</span>guge1 表示当访问www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token operator">+</span>guge时跳转的页面为https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>guge<span class="token punctuation">.</span>com
        	#部署项目jar包的相对路径
            root   guge1<span class="token punctuation">;</span>
            #将域名请求，跳转发送到百度上，相当于直接访问https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
            proxy_pass  https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>guge<span class="token punctuation">.</span>com
            #默认跳转的首页地址
            index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
</code></pre> 
<h2><a id="_424"></a>七、负载均衡</h2> 
<h3><a id="_426"></a>（一）概念</h3> 
<p>早期使用DNS（域名解析系统）做负载，具体而言，给客户端解析不同的ip地址，让流量直接到达服务器。<br> clientN 先到达负载均衡器（load balancer） 再通过调度算法 分配到不同的serverN<br> <strong>优点：</strong><br> 1、通过健康检测，避免单点故障<br> 2、当发现节点故障时，从集群中移除，保证应用的高可用<br> 四层负载均衡，在OSI模型的传输层，主要是转发<br> 七层负载均衡，在OSI模型的应用层，主要是代理</p> 
<h3><a id="_436"></a>（二）负载均衡器可以处理的四大类型的请求</h3> 
<p>HTTP/HTTPS/TCP/UDP等</p> 
<h3><a id="_440"></a>（三）负载均衡的调度算法</h3> 
<p>1、轮询：相当于将服务器从第一台到最后一台形成一个环状，每接收一个请求，则从第一台开始循环遍历。<br> 2、最小连接，优先选择连接数最小的服务器，适用于会话时间较长的业务处理<br> 3、ip映射，根据请求的ip地址进行散列，让同一个ip下的请求都映射到同一服务器上，可以解决session问题（粘性会话）</p> 
<h3><a id="_446"></a>（四）负载均衡的使用</h3> 
<p><strong>需求</strong>：当访问虚拟机ip 192.168.2.10/lb/index.html时，通过负载均衡，让请求平均分配到8080和8081tomcat端口中<br> 1、分别找到两个tomcat的安装目录，如/usr/local/tomcat/webapps<br> 创建lb目录， mkdir lb<br> 创建访问页面 ，cp tomcat1/index.html<br> 查看页面内容， cat lb/index.html<br> 2、配置nginx.conf<br> 注意：使用负载均衡时，需要在http块下创建一个upstream 名字 块，如</p> 
<pre><code class="prism language-java">http<span class="token punctuation">{<!-- --></span>
	#创建upstream块，用来记录server列表的的地址和端口
	upstream  myserver<span class="token punctuation">{<!-- --></span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8080</span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8081</span>
	<span class="token punctuation">}</span>
	server<span class="token punctuation">{<!-- --></span>
	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>再增加一个location</p> 
<pre><code class="prism language-java">location <span class="token operator">~</span><span class="token operator">/</span>lb<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
	#将请求映射到负载均衡器中 参数为配置的upstream名称
	proxy_pass  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>myserver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>完整如：</p> 
<pre><code class="prism language-java">http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
	
	#
    #log_format  main  '$remote_addr <span class="token operator">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> <span class="token string">"$request"</span> '
    #                  '$status $body_bytes_sent <span class="token string">"$http_referer"</span> '
    #                  '<span class="token string">"$http_user_agent"</span> <span class="token string">"$http_x_forwarded_for"</span>'<span class="token punctuation">;</span>
	
	#配置日志文件地址，声明日志格式
    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    #tcp_nopush     on<span class="token punctuation">;</span>

    #keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    #gzip  on<span class="token punctuation">;</span>
    
    #创建upstream块，用来记录server列表的的地址和端口
	upstream  myserver<span class="token punctuation">{<!-- --></span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8080</span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8081</span>
	<span class="token punctuation">}</span>
    
	#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  localhost<span class="token punctuation">;</span>
        	
		location <span class="token operator">~</span><span class="token operator">/</span>lb<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
			#将请求映射到负载均衡器中  参数为配置的upstream名称
			proxy_pass  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>myserver<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre> 
<p>以上时默认的轮询调度算法</p> 
<p>如果需要某个服务器处理的更多些，则需要额外设置权重，则在server 后面加 weigth=数字，weight的默认值是1</p> 
<p><strong>如：</strong></p> 
<pre><code class="prism language-java">     upstream  myserver<span class="token punctuation">{<!-- --></span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8080</span> weight<span class="token operator">=</span><span class="token number">2</span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8081</span> weigth<span class="token operator">=</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>如果需要根据ip地址，固定server处理，可以使用ip_hash。<br> <strong>如：</strong></p> 
<pre><code class="prism language-java">upstream  myserver<span class="token punctuation">{<!-- --></span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8080</span> weight<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8081</span> weigth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		ip_hash<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_543"></a>八、动静分离</h2> 
<h3><a id="_545"></a>（一）概念</h3> 
<p>将动态和静态请求分离开，不能单纯的理解为动态页面和静态页面的物理分离。<br> 如果是静态资源请求，直接查找nginx上的静态资源地址<br> 如果是动态资源请求，通过反向代理，映射到tomcat路径下的资源</p> 
<h3><a id="_551"></a>（二）实现方式</h3> 
<p>1、单独把静态文件放在独立的服务器及独立的域名下，推荐方案<br> 2、将动态资源和静态资源混合在一起，通过nginx来分开</p> 
<h3><a id="_555"></a>（三）动静分离的应用</h3> 
<p><strong>需求：</strong><br> 访问图片等静态资源时，可以直接从nginx中获取，访问jsp等动态资源时，通过tomcat返回结果<br> <strong>处理流程</strong><br> 1、在/usr/local/tomcat/webapps下通过rz命令上传本地的index.jsp<br> 2、在/usr/local/nginx/image下通过rz命令上传本地的test.png图片<br> 3、配置nginx.conf文件<br> <strong>如：</strong></p> 
<pre><code class="prism language-java">#配置动态资源的请求转发	
		location <span class="token operator">~</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>jsp$ <span class="token punctuation">{<!-- --></span>
			#将请求映射到负载均衡器中  参数为配置的upstream名称
			proxy_pass  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>myserver<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		#配置静态资源的请求转发	
		location <span class="token operator">~</span><span class="token punctuation">.</span>*\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>css<span class="token punctuation">)</span>$ <span class="token punctuation">{<!-- --></span>
			#配置静态资源的存放路径
			root <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>image
			#在浏览器端使用缓存，配置过期时间，相当于redis <span class="token number">3d</span>表示三天
			ecpire <span class="token number">3d</span>；
		<span class="token punctuation">}</span>
</code></pre> 
<p><strong>完整配置</strong></p> 
<pre><code class="prism language-java">http <span class="token punctuation">{<!-- --></span>
    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>
    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>
	
	#
    #log_format  main  '$remote_addr <span class="token operator">-</span> $remote_user <span class="token punctuation">[</span>$time_local<span class="token punctuation">]</span> <span class="token string">"$request"</span> '
    #                  '$status $body_bytes_sent <span class="token string">"$http_referer"</span> '
    #                  '<span class="token string">"$http_user_agent"</span> <span class="token string">"$http_x_forwarded_for"</span>'<span class="token punctuation">;</span>
	
	#配置日志文件地址，声明日志格式
    #access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    #tcp_nopush     on<span class="token punctuation">;</span>

    #keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    #gzip  on<span class="token punctuation">;</span>
    
    #创建upstream块，用来记录server列表的的地址和端口
	upstream  myserver<span class="token punctuation">{<!-- --></span>
		server <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.20</span><span class="token operator">:</span><span class="token number">8080</span>
	<span class="token punctuation">}</span>
    
	#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  localhost<span class="token punctuation">;</span>
        #配置动态资源的请求转发	
		location <span class="token operator">~</span><span class="token punctuation">.</span>*<span class="token punctuation">.</span>jsp$ <span class="token punctuation">{<!-- --></span>
			#将请求映射到负载均衡器中  参数为配置的upstream名称
			proxy_pass  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>myserver<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		#配置静态资源的请求转发	
		location <span class="token operator">~</span><span class="token punctuation">.</span>*\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>css<span class="token punctuation">)</span>$ <span class="token punctuation">{<!-- --></span>
			#配置静态资源的存放路径
			root <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>image
			#在浏览器端使用缓存，配置过期时间，相当于redis <span class="token number">3d</span>表示三天
			ecpire <span class="token number">3d</span>；
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre> 
<p>4、验证方式：分别访问：http://192.168.1.20/jsp/index.html和http://192.168.1.20/test.png</p> 
<h2><a id="location_629"></a>九、location块补充</h2> 
<h3><a id="_631"></a>（一）、匹配规则</h3> 
<p>1、location=/uri 精确匹配<br> 2、location^~ /uri 前缀匹配 顺序在正则之前<br> 3、location /uri 前缀匹配，顺序在正则匹配之后<br> 4、location -pattern 区别大小写的正则匹配<br> 5、location -*pattern 不区分大小写的正则匹配<br> 6、location / 通用匹配，接受未匹配到其他location的请求</p> 
<p><strong>匹配顺序：</strong><br> 首先会精确匹配，然后会进行前缀匹配，具体顺序按照指令长度，从长到短的顺序依次匹配。但是在正则匹配时，是按照配置文件的顺序依次匹配的，如果不希望前缀匹配进行正则匹配，那么使用^~</p> 
<h3><a id="_URL_643"></a>（二） URL重写</h3> 
<p>对url的规范处理，域名更换时的新旧跳转，一些额外的参数调整等</p> 
<pre><code class="prism language-java">#配置对应的虚拟主机
    server <span class="token punctuation">{<!-- --></span>
    	#监听的端口
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        #监听的域名
        server_name  www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        #url重写，当访问www<span class="token punctuation">.</span>ceshi<span class="token punctuation">.</span>com 时，地址栏会变成www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
      	rewrite <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span>*<span class="token punctuation">)</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>$<span class="token number">1</span> pernanent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7a672ae54e3b015e41bb17c6ab94d9b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">重定向丢失cookie问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03bccc57a8ba223690034b7fe4712f0e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">5.Mybatis 缓存详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>