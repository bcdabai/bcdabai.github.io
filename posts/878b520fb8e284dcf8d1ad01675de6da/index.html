<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue3 &#43; Three.js &#43; gltf-pipeline大型园区场景渲染与3D业务 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue3 &#43; Three.js &#43; gltf-pipeline大型园区场景渲染与3D业务" />
<meta property="og:description" content="在非使用unity作为3D渲染方案的前提下，对与目前web开发者比较友好的除了canvas场景需要的2D babylon.js，fabric.js, Three.js是目前针对于jsWeb用户最直接且比较友好的3D引擎方案了。
准备工作：
1.明确需要用的场景方案都有那些，模型需要的加载器是什么
2.模型的场景大小已经相关的交互业务
3.场景的工作环境（浏览器及硬件要求)
step1:
以.glb模型为例
import * as THREE from &#34;three&#34;; import {GLTFLoader} from &#34;three/examples/jsm/loaders/GLTFLoader&#34;; import {OrbitControls} from &#34;three/examples/jsm/controls/OrbitControls&#34;; 以上就是一个场景绘制需要的基本3个要素
模型压缩
由于建模工程师因为场景规模的原因模型在建立时过多了使用了面，导致整个模型的体积很大，一个校区或者大园区为例，建筑加环境要素及周边地形都整体的模型体积已经达到了100M&#43;,这个时候就需要我们在开发前就考虑模型的压缩问题了
DRACO压缩算法
npm install -g gltf-pipeline --input, -i Path to the glTF or glb file.[string] [required] --output, -o Output path of the glTF or glb file. Separate resources will be saved to the same directory. [string] --binary, -b Convert the input glTF to glb. //将输入的glTF转换为glb [boolean] [default: false] --json, -j Convert the input glb to glTF." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/878b520fb8e284dcf8d1ad01675de6da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-13T15:26:42+08:00" />
<meta property="article:modified_time" content="2023-11-13T15:26:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue3 &#43; Three.js &#43; gltf-pipeline大型园区场景渲染与3D业务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在非使用<em><strong>unity</strong></em>作为3D渲染方案的前提下，对与目前web开发者比较友好的除了canvas场景需要的2D <code>babylon.js</code>，<code>fabric.js</code>, <em><strong>Three.js</strong></em>是目前针对于jsWeb用户最直接且比较友好的3D引擎方案了。<br> 准备工作：<br> 1.明确需要用的场景方案都有那些，模型需要的加载器是什么<br> 2.模型的场景大小已经相关的交互业务<br> 3.场景的工作环境（浏览器及硬件要求)<br> <em><strong>step1:</strong></em><br> 以.glb模型为例</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">"three"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>GLTFLoader<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"three/examples/jsm/loaders/GLTFLoader"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>OrbitControls<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"three/examples/jsm/controls/OrbitControls"</span><span class="token punctuation">;</span>
</code></pre> 
<p>以上就是一个场景绘制需要的基本3个要素<br> <strong>模型压缩</strong><br> 由于建模工程师因为场景规模的原因模型在建立时过多了使用了面，导致整个模型的体积很大，一个校区或者大园区为例，建筑加环境要素及周边地形都整体的模型体积已经达到了100M+,这个时候就需要我们在开发前就考虑模型的压缩问题了<br> <em><strong>DRACO压缩算法</strong></em></p> 
<pre><code class="prism language-javascript">npm install <span class="token operator">-</span>g gltf<span class="token operator">-</span>pipeline
</code></pre> 
<pre><code class="prism language-javascript"><span class="token operator">--</span>input<span class="token punctuation">,</span> <span class="token operator">-</span>i                   Path to the glTF or glb file<span class="token punctuation">.</span><span class="token punctuation">[</span>string<span class="token punctuation">]</span> <span class="token punctuation">[</span>required<span class="token punctuation">]</span>
<span class="token operator">--</span>output<span class="token punctuation">,</span> <span class="token operator">-</span>o                  Output path <span class="token keyword">of</span> the glTF or glb file<span class="token punctuation">.</span> Separate   
                               resources will be saved to the same directory<span class="token punctuation">.</span>  
                                                                       <span class="token punctuation">[</span>string<span class="token punctuation">]</span>
<span class="token operator">--</span>binary<span class="token punctuation">,</span> <span class="token operator">-</span>b                  Convert the input glTF to glb<span class="token punctuation">.</span>                                      <span class="token comment">//将输入的glTF转换为glb</span>
                                                     <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>json<span class="token punctuation">,</span> <span class="token operator">-</span>j                    Convert the input glb to glTF<span class="token punctuation">.</span>                                      <span class="token comment">//将输入的glb转换为glTF</span>
                                                     <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>separate<span class="token punctuation">,</span> <span class="token operator">-</span>s                Write separate buffers<span class="token punctuation">,</span> shaders<span class="token punctuation">,</span> and textures                       <span class="token comment">//编写单独的缓冲区、着色器和纹理而不是把它们嵌入到glTF中</span>
                               instead <span class="token keyword">of</span> embedding them <span class="token keyword">in</span> the glTF<span class="token punctuation">.</span>          
                                                     <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>separateTextures<span class="token punctuation">,</span> <span class="token operator">-</span>t        Write out separate textures only<span class="token punctuation">.</span>                                   <span class="token comment">//只写出单独的纹理</span>
                                                     <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>stats                       Print statistics to console <span class="token keyword">for</span> output glTF                         <span class="token comment">//将统计信息打印到控制台以输出glTF文件</span>
                               file<span class="token punctuation">.</span>                 <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>     
<span class="token operator">--</span>keepUnusedElements          Keep unused materials<span class="token punctuation">,</span> nodes and meshes<span class="token punctuation">.</span>                            <span class="token comment">//保留未使用的材质、节点和网格</span>
                                                      <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>draco<span class="token punctuation">.</span>compressMeshes<span class="token punctuation">,</span> <span class="token operator">-</span>d    Compress the meshes using Draco<span class="token punctuation">.</span> Adds the                            <span class="token comment">//使用Draco压缩网格。添加KHR_draco_mesh_压缩扩展</span>
                                KHR_draco_mesh_compression extension<span class="token punctuation">.</span>
                                                      <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token operator">--</span>draco<span class="token punctuation">.</span>compressionLevel      Draco compression level <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> most is <span class="token number">10</span><span class="token punctuation">,</span>                           <span class="token comment">//Draco压缩级别[0-10]，大多数是10，最小值为0。值为0将会连续应用 编码并保留face顺序。</span>
                                least is <span class="token number">0.</span> <span class="token constant">A</span> value <span class="token keyword">of</span> <span class="token number">0</span> will apply sequential
                                encoding and preserve face order<span class="token punctuation">.</span>
                                                           <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">]</span>   
<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizePositionBits  Quantization bits <span class="token keyword">for</span> position attribute when                        <span class="token comment">//位置坐标属性的量化位使用Draco压缩。</span>
                                using Draco compression<span class="token punctuation">.</span>  <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">]</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizeNormalBits    Quantization bits <span class="token keyword">for</span> normal attribute when                           <span class="token comment">//法线属性的量化位使用Draco压缩</span>
                                using Draco compression<span class="token punctuation">.</span>   <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">]</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizeTexcoordBits  Quantization bits <span class="token keyword">for</span> texture coordinate                               <span class="token comment">//纹理坐标的量化位属性。</span>
                                attribute when using Draco compression<span class="token punctuation">.</span>
                                                          <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">]</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizeColorBits     Quantization bits <span class="token keyword">for</span> color attribute when using                        <span class="token comment">//使用时颜色属性的量化位德拉科压缩</span>
                                Draco compression<span class="token punctuation">.</span>         <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">]</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizeGenericBits   Quantization bits <span class="token keyword">for</span> skinning <span class="token function">attribute</span> <span class="token punctuation">(</span>joint                        <span class="token comment">//蒙皮属性（关节的量化位索引和关节权重）ad自定义属性使用Draco压缩时。</span>
                                indices and joint weights<span class="token punctuation">)</span> ad custom attributes
                                when using Draco compression<span class="token punctuation">.</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">]</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>uncompressedFallback  Adds uncompressed fallback versions <span class="token keyword">of</span> the                            <span class="token comment">//添加未压缩的回退版本压缩网格</span>
                                compressed meshes<span class="token punctuation">.</span>    <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>

  <span class="token operator">--</span>draco<span class="token punctuation">.</span>unifiedQuantization   Quantize positions <span class="token keyword">of</span> all primitives using the            <span class="token comment">//统一定义的量化网格所有基本体的边界框。 如果这个选项未设置，对每个应用量化原始的可能会导致差距出现在不同图元之间。</span>
                                same quantization grid defined by the unified
                                bounding box <span class="token keyword">of</span> all primitives<span class="token punctuation">.</span> If <span class="token keyword">this</span> option
                                is not set<span class="token punctuation">,</span> quantization is applied on each
                                primitive separately which can result <span class="token keyword">in</span> gaps
                                appearing between different primitives<span class="token punctuation">.</span>
                                                      <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/16/7d/QSMVB2ed_o.png" alt="在这里插入图片描述"><br> <em><strong>gltf-pipeline</strong></em>的参数有很多这里我们只需要提炼出一个满足我们需要的就够了</p> 
<pre><code class="prism language-javascript">gltf<span class="token operator">-</span>pipeline <span class="token operator">-</span>i <span class="token punctuation">.</span>\<span class="token keyword">public</span>\tep\<span class="token number">23</span><span class="token punctuation">.</span>glb <span class="token operator">-</span>o <span class="token punctuation">.</span>\<span class="token keyword">public</span>\tep\<span class="token number">23</span><span class="token operator">-</span>main<span class="token punctuation">.</span>glb  <span class="token operator">-</span>d <span class="token operator">--</span>draco<span class="token punctuation">.</span>compressionLevel <span class="token number">9</span> <span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizePositionBits <span class="token number">10</span> <span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizeColorBits <span class="token number">10</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token operator">-</span>i <span class="token punctuation">.</span>\<span class="token keyword">public</span>\cascl\caa4<span class="token punctuation">.</span>glb   <span class="token comment">//输入路径</span>

<span class="token operator">-</span>o <span class="token punctuation">.</span>\<span class="token keyword">public</span>\cascl\caa4<span class="token operator">-</span>main<span class="token punctuation">.</span>glb  <span class="token comment">//输出路径及名称</span>

<span class="token operator">-</span>d <span class="token operator">--</span>draco<span class="token punctuation">.</span>compressionLevel <span class="token number">10</span> <span class="token comment">//压缩等级</span>

<span class="token operator">--</span>draco<span class="token punctuation">.</span>quantizePositionBits <span class="token number">20</span>  <span class="token comment">//量化  0 标识无损压缩 </span>
</code></pre> 
<p>需要注意的是安装好之后是不可以直接运行的我们需要一个three.js为我们提供的基本依赖<em>draco_decoder.js</em> 这个文件一般就放在<em>node_module/three/examples/js/libs/draco</em>目录下cpoy出来与模型文件一起放在public文件夹下即可</p> 
<p>完成上述这些准备工作之后我们开始渲染我们的第一个大园区场景，因为我们使用了压缩算法所以我们需要额外再引入一个解压加载器，并将我们copy出来的<em>draco_decoder.js</em>文件与我们压缩好的模型都放在public下</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>DRACOLoader<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"three/examples/jsm/loaders/DRACOLoader"</span>
</code></pre> 
<p><em><strong>step2</strong></em><br> 初始一个加载模型的方法</p> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initMod</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>filePath<span class="token punctuation">,</span>fun</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
   container<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">alpha</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token string">'#6fc0ec'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  renderer<span class="token punctuation">.</span>outputEncoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding<span class="token punctuation">;</span>
  <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> dracoLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DRACOLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dracoLoader<span class="token punctuation">.</span><span class="token function">setDecoderPath</span><span class="token punctuation">(</span><span class="token string">"/cascl/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置public下的解码路径，注意最后面的/</span>
  dracoLoader<span class="token punctuation">.</span><span class="token function">setDecoderConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"js"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dracoLoader<span class="token punctuation">.</span><span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  loader<span class="token punctuation">.</span><span class="token function">setDRACOLoader</span><span class="token punctuation">(</span>dracoLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
    filePath<span class="token punctuation">,</span>
    <span class="token parameter">gltf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 将模型放到中间</span>
      <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Box3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromObject</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> size <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> center <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gltf<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-=</span> center<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      gltf<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-=</span> center<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
      gltf<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">-=</span> center<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>near <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>far <span class="token operator">=</span> size <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">+=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---加载的模型'</span><span class="token punctuation">,</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
      <span class="token keyword">const</span> ambient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ambient<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//添加在模型的右上角高三倍设置一个光源 太阳</span>
      <span class="token keyword">const</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 模型宽度</span>
      <span class="token keyword">const</span> width <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>x <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      <span class="token comment">// 模型高度</span>
      <span class="token keyword">const</span> height <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>y <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
      <span class="token comment">// 模型深度</span>
      <span class="token keyword">const</span> depth <span class="token operator">=</span> box<span class="token punctuation">.</span>max<span class="token punctuation">.</span>z <span class="token operator">-</span> box<span class="token punctuation">.</span>min<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
      light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>width <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> depth <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 点光源</span>
      <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'#74beee'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      point<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span>width <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span>height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> depth <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点光源位置</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点光源添加到场景中</span>
      <span class="token comment">//多设置几个光源</span>
      <span class="token keyword">const</span> light3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token string">'#8dccee'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      light3<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span>width <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span>height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> depth <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> light4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>HemisphereLight</span><span class="token punctuation">(</span><span class="token string">'#8dccee'</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light4<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//包含关键帧动画的模型作为参数创建一个播放器</span>
      mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//  获取gltf.animations[0]的第一个clip动画对象</span>
      clipAction <span class="token operator">=</span> mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建动画clipAction对象</span>
      clipAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//播放动画</span>
<span class="token comment">//不循环播放</span>
      clipAction<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>LoopOnce<span class="token punctuation">;</span>
<span class="token comment">// 物体状态停留在动画结束的时候</span>
      clipAction<span class="token punctuation">.</span>clampWhenFinished <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 如果想播放动画,需要周期性执行`mixer.update()`更新AnimationMixer时间数据</span>
      clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token comment">// 添加OrbitControls控制器</span>
  controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span>dampingFactor <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span>screenSpacePanning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span>minDistance <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  controls<span class="token punctuation">.</span>maxDistance <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token function">labelTag</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">580</span><span class="token punctuation">,</span><span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">705</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tagList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加到指定的场景里</span>
  <span class="token function">renderLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleModClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上方的初始方案中包含了一个基本的动画加载器由此我们可以完成一个基本的模型加载的场景创建<br> <img src="https://images2.imgbox.com/ed/35/dHDtFONs_o.png" alt="在这里插入图片描述"><br> 这是一个可以执行楼层分层爆炸的模型内置的动画由：</p> 
<pre><code class="prism language-javascript">   <span class="token comment">//包含关键帧动画的模型作为参数创建一个播放器</span>
      mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>完成捕捉及后续播放<br> <em><strong>step3</strong></em><br> 接下来我们完成园区的业务需求建设<br> 1.场景需要有天空背景<br> 2.场景需要有关键建筑的标注<br> 3.场景的交互具有高亮环绕<br> 4.场景具有漫游功能<br> 基于以上我们开始增加需要的工具</p> 
<ol><li>场景漫游动画处理库</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token constant">TWEEN</span> <span class="token keyword">from</span> <span class="token string">'@tweenjs/tween.js'</span><span class="token punctuation">;</span>
</code></pre> 
<p>2.场景天空环境即天空盒</p> 
<pre><code class="prism language-javascript">    <span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'../sky/Above Day B_Cam_3_Right-X.png'</span><span class="token punctuation">,</span><span class="token comment">//x正方形</span>
        <span class="token string">'../sky/Above Day B_Cam_2_Left+X.png'</span><span class="token punctuation">,</span><span class="token comment">//x负方向</span>
        <span class="token string">'../sky/Above Day B_Cam_4_Up+Y.png'</span><span class="token punctuation">,</span><span class="token comment">//y正方形</span>
        <span class="token string">'../sky/Above Day B_Cam_5_Down-Y.png'</span><span class="token punctuation">,</span><span class="token comment">//y负方向</span>
        <span class="token string">'../sky/Above Day B_Cam_0_Front+Z.png'</span><span class="token punctuation">,</span><span class="token comment">//z正方形</span>
        <span class="token string">'../sky/Above Day B_Cam_1_Back-Z.png'</span><span class="token comment">//z负方形</span>
    <span class="token punctuation">]</span>
        <span class="token keyword">const</span> textureCube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>
        scene<span class="token punctuation">.</span>background <span class="token operator">=</span> textureCube
</code></pre> 
<p>3.场景后处理器</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>EffectComposer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/postprocessing/EffectComposer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>RenderPass<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/postprocessing/RenderPass'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>OutlinePass<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/postprocessing/OutlinePass'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在使用了后处理器后因为模型抗拒齿原因我们需要在额外补充一个</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>SMAAPass<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/postprocessing/SMAAPass'</span><span class="token punctuation">;</span>
      <span class="token comment">//抗锯齿后处理</span>
 <span class="token keyword">const</span> smaaPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SMAAPass</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>clientWidth <span class="token operator">*</span> pixelRatio<span class="token punctuation">,</span> container<span class="token punctuation">.</span>clientHeight <span class="token operator">*</span> pixelRatio<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>4.一个漫游动画控制的方法</p> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createCameraTween</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pos2<span class="token punctuation">,</span> pos</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    tween <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 相机开始坐标</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        <span class="token literal-property property">z</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
        <span class="token comment">// 相机开始指向的目标观察点</span>
        <span class="token literal-property property">tx</span><span class="token operator">:</span>  current<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        <span class="token literal-property property">ty</span><span class="token operator">:</span>   current<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        <span class="token literal-property property">tz</span><span class="token operator">:</span>   current<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 相机结束坐标</span>
            <span class="token literal-property property">x</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
            <span class="token literal-property property">y</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
            <span class="token literal-property property">z</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
            <span class="token comment">// 相机结束指向的目标观察点</span>
            <span class="token literal-property property">tx</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
            <span class="token literal-property property">ty</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
            <span class="token literal-property property">tz</span><span class="token operator">:</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 动态改变相机位置</span>
            camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>x<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>y<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 动态计算相机视线</span>
            camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">animates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">animates</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">TWEEN</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animates<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在使用glb/gltf模型中我们也常常会需要处理模型加载发暗，材质渲染失真的情况这里我们也一并加入到初始化的方案内</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>GammaCorrectionShader<span class="token punctuation">}</span> <span class="token keyword">from</span><span class="token string">'three/examples/jsm/shaders/GammaCorrectionShader'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ShaderPass<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/postprocessing/ShaderPass'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>RoomEnvironment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/environments/RoomEnvironment'</span><span class="token punctuation">;</span>
</code></pre> 
<p>由此我们以及基本完成了所有的加载需要的必备条件即要求，我们渲染一个大园区场景<br> <img src="https://images2.imgbox.com/7c/48/KayGTvaP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/de/9a/2WYz1hY5_o.png" alt="在这里插入图片描述"><br> 场景后处理的效果业务由：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">renderOutline</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>buildIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建后处理对象EffectComposer，WebGL渲染器作为参数</span>
        composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EffectComposer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        renderPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RenderPass</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
        composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>renderPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建OutlinePass通道</span>
        container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mod'</span><span class="token punctuation">)</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mod'</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mod2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> v2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector2</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outlinePass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutlinePass</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建伽马校正通道</span>
        <span class="token keyword">const</span> gammaPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShaderPass</span><span class="token punctuation">(</span>GammaCorrectionShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>gammaPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> pixelRatio <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token function">getPixelRatio</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//抗锯齿后处理</span>
        <span class="token keyword">const</span> smaaPass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SMAAPass</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>clientWidth <span class="token operator">*</span> pixelRatio<span class="token punctuation">,</span> container<span class="token punctuation">.</span>clientHeight <span class="token operator">*</span> pixelRatio<span class="token punctuation">)</span><span class="token punctuation">;</span>
        composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>smaaPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        outlinePass<span class="token punctuation">.</span>selectedObjects <span class="token operator">=</span> <span class="token punctuation">[</span>mod<span class="token punctuation">]</span><span class="token punctuation">;</span>
        outlinePass<span class="token punctuation">.</span>visibleEdgeColor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'#a838ef'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outlinePass<span class="token punctuation">.</span>edgeThickness <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        outlinePass<span class="token punctuation">.</span>edgeStrength <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
        outlinePass<span class="token punctuation">.</span>pulsePeriod <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        composer<span class="token punctuation">.</span><span class="token function">addPass</span><span class="token punctuation">(</span>outlinePass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">animateOutline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'showMod'</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">clearOutline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>由于业务延展很多不再过的的赘述，解决方案包含了动态标签切换，标记交互，灯光动态，场景灯光随相机，标签随相机，场景模型过滤，场景模型设备等状态动态更新，单楼层模型，室内模型控制切换即各类物联网设备交互等等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fdcd374d1ac52f2843621b1b11b7b6e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">拼多多商品详情API接口接入流程如下：</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcfea4fb6af87069a8a1eca14b4df256/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UEditor(版本号1.4.3) 在vue中使用导致内存泄漏问题优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>