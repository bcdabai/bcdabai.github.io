<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>打包的文件可以在C盘写入&#43;C# WInForm项目打包为exe文件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="打包的文件可以在C盘写入&#43;C# WInForm项目打包为exe文件" />
<meta property="og:description" content="第一部分：使得打包的文件可以在C盘写入 内容来源：添加/删除/读写c盘文件——c# - vv彭 - 博客园 (cnblogs.com)
一、前言： 有时候我们为自己的程序添加配置文件，如tet、ini、xml等文件，又或者保存软件运行时的日志
当我们把软件打包后，默认安装在c盘，而配置文件也会跟随生成在安装目录下
此时你会发现，配置文件无法生成/修改
这是因为操作c盘文件需要管理员身份
二、写入C盘方法： 有两种方法可以达到目的，一种是修改安装后的软件属性，另一种是修改打包前的程序属性
（一）方法一：修改安装后的软件属性 步骤：1.右键需要运行的exe文件选择属性
2.选择兼容性目录栏
3.勾选以管理员身份运行此软件
4.点击“应用”，“确定”
注：此方法操作简单，不用重新打包，对只有一次安装该软件比较友好，但如果需要多次安装，就显得很繁琐，每安装一次都要去修改一次，发行给别人不推荐 ；
（二）方法二：在项目中配置管理员权限（相关步骤进行完后，记得生成一下解决方案哦） （1）来到相关的解决方案，右键选中需要提升权级的项目——&gt;属性——&gt;安全性——&gt;勾选启动ClickOnce安全设置选项。
相关项目的“Properties”会出现app.manifest配置。
（2）双击打开Properties下的app.manifest文件，按照按照注释把requestedExecutionLevel 节点的 level=&#34;asInvoker&#34;替换成level=&#34;requireAdministrator&#34; 即可。
其中权限解析如下：
asInvoker 当前权限，可以理解为只有一般用户的权限；requireAdministrator 管理员权限，如果运行此程序的账户没有管理员权限则直接不运行；highestAvailable 用户所能拿到的最高权限，如果用户不是管理员也会运行。 下图是修改后的截图：
（3）将之前勾选的ClickOnce取消掉：右键项目——&gt;属性——&gt;安全性——&gt;取消勾选启动ClickOnce安全设置选项。如果不取消，会报错误：“ClickOnce 不支持请求执行级别“requireAdministrator”“
（4）注意，生成一下解决方案和项目。
第二部分：如何将C# WInform打包为exe让User在本地运行 第一步：下载扩展Microsoft Visual Studio Installer Projects 1.工具=&gt;扩展和更新=&gt;扩展 =&gt; 管理扩展 2.搜索框输入：Microsoft Visual Studio Installer Projects 3.点击下载，然后按着指示安装（此图是已经下载安装完成） 第二步：右击选中项目的解决方案 =&gt; 添加 =&gt; 新建项目
选中“Setup Project”，点击“确定”
第三步：项目创建成功之后，添加文件 1.右击Application Folder（应用程序文件夹） =&gt; Add =&gt; 文件 把你需要打包的项目下 =&gt; bin =&gt; Debug文件夹下的所有文件一个一个添加到Application Folder（应用程序文件夹）中（注：项目不同文件多少不一致，全部添加）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/194d6b02d3d43b91dbb9b5232d66f140/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-11T13:46:44+08:00" />
<meta property="article:modified_time" content="2023-11-11T13:46:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">打包的文件可以在C盘写入&#43;C# WInForm项目打包为exe文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>第一部分：使得打包的文件可以在C盘写入</h2> 
<p><a href="https://www.cnblogs.com/eve612/p/14255179.html" rel="nofollow" title="内容来源：添加/删除/读写c盘文件——c# - vv彭 - 博客园 (cnblogs.com)">内容来源：添加/删除/读写c盘文件——c# - vv彭 - 博客园 (cnblogs.com)</a></p> 
<h3>一、前言：</h3> 
<p>　　有时候我们为自己的程序添加配置文件，如tet、ini、xml等文件，又或者保存软件运行时的日志</p> 
<p>　　当我们把软件打包后，默认安装在c盘，而配置文件也会跟随生成在安装目录下</p> 
<p>　　此时你会发现，配置文件无法生成/修改</p> 
<p>　　这是因为操作c盘文件需要管理员身份</p> 
<h3>二、写入C盘方法：</h3> 
<p>有两种方法可以达到目的，一种是修改安装后的软件属性，另一种是修改打包前的程序属性</p> 
<h4>  （一）方法一：修改安装后的软件属性</h4> 
<p>　　步骤：1.右键需要运行的exe文件选择属性</p> 
<p>                  2.选择兼容性目录栏</p> 
<p>　　　　　3.勾选以管理员身份运行此软件</p> 
<p>　               4.点击“应用”，“确定”</p> 
<p><img alt="" height="759" src="https://images2.imgbox.com/96/ee/j4OW2yLf_o.png" width="1200"></p> 
<p>注：此方法操作简单，不用重新打包，对只有一次安装该软件比较友好，但如果需要多次安装，就显得很繁琐，每安装一次都要去修改一次，发行给别人不推荐 ；</p> 
<h4>  （二）方法二：在项目中配置管理员权限（<span style="color:#4da8ee;">相关步骤进行完后，记得生成一下解决方案哦</span>）</h4> 
<p>（1）来到相关的解决方案，右键选中需要提升权级的项目——&gt;属性——&gt;安全性——&gt;勾选启动ClickOnce安全设置选项。</p> 
<p>相关项目的“Properties”会出现app.manifest配置。</p> 
<p><img alt="" height="550" src="https://images2.imgbox.com/06/85/sAgF7apt_o.png" width="1200"></p> 
<p>（2）双击打开Properties下的app.manifest文件，按照按照注释把requestedExecutionLevel 节点的 level="asInvoker"替换成level="requireAdministrator" 即可。</p> 
<p>　　其中权限解析如下：</p> 
<ul><li>asInvoker 当前权限，可以理解为只有一般用户的权限；</li><li>requireAdministrator  管理员权限，如果运行此程序的账户没有管理员权限则直接不运行；</li><li>highestAvailable 用户所能拿到的最高权限，如果用户不是管理员也会运行。</li></ul> 
<p>下图是修改后的截图：</p> 
<p><img alt="" height="709" src="https://images2.imgbox.com/b9/9a/FHdD3RNY_o.png" width="1200"></p> 
<p>　　　　         </p> 
<p>（3）将之前勾选的ClickOnce取消掉：右键项目——&gt;属性——&gt;安全性——&gt;取消勾选启动ClickOnce安全设置选项。如果不取消，会报错误：“ClickOnce 不支持请求执行级别“requireAdministrator”“</p> 
<p>  <img alt="" height="700" src="https://images2.imgbox.com/86/17/Dfra8aQa_o.png" width="1200"></p> 
<p></p> 
<p>（4）注意，生成一下解决方案和项目。</p> 
<p></p> 
<h2>  第二部分：如何将C# WInform打包为exe让User在本地运行     </h2> 
<p></p> 
<h4><strong>第一步：下载扩展Microsoft Visual Studio Installer Projects</strong></h4> 
<h5><br> 1.工具=&gt;扩展和更新=&gt;扩展 =&gt; 管理扩展</h5> 
<h5>           <img alt="" height="155" src="https://images2.imgbox.com/23/8a/Lx1U8ZXE_o.png" width="1200"> 2.搜索框输入：Microsoft Visual Studio Installer Projects</h5> 
<p><img alt="" height="918" src="https://images2.imgbox.com/ee/bf/lXuz4nnb_o.png" width="1200"></p> 
<h5>3.点击下载，然后按着指示安装（此图是已经下载安装完成）</h5> 
<p><img alt="" height="370" src="https://images2.imgbox.com/86/bb/titWtNQR_o.png" width="1181"></p> 
<h4><strong>第二步：右击选中项目的解决方案 =&gt; 添加 =&gt; 新建项目</strong><br><img alt="" height="862" src="https://images2.imgbox.com/e1/28/Anpt7lMF_o.png" width="1200"></h4> 
<p>选中“Setup Project”，点击“确定”</p> 
<h6><img alt="" height="653" src="https://images2.imgbox.com/a4/51/fUb03LDv_o.png" width="967"></h6> 
<h4><strong>第三步：项目创建成功之后，添加文件</strong></h4> 
<h5><br> 1.右击Application Folder（应用程序文件夹） =&gt; Add =&gt; 文件</h5> 
<p><img alt="" height="895" src="https://images2.imgbox.com/17/a6/bgc8BzW0_o.png" width="1200"></p> 
<p>把你需要打包的项目下 =&gt; bin =&gt; Debug文件夹下的所有文件一个一个添加到Application Folder（应用程序文件夹）中（注：项目不同文件多少不一致，全部添加）</p> 
<p><img alt="" height="641" src="https://images2.imgbox.com/11/18/2MWZ6rF3_o.png" width="816"></p> 
<p>勾选的文件被显示到右侧。（我需要打包的项目里的文件全部添加后如下）</p> 
<p><img alt="" height="458" src="https://images2.imgbox.com/d5/aa/XHgZ5Fes_o.png" width="1160"></p> 
<p>注：文件夹的话虽然在添加的时候有勾选，但是实际未能成功添加到里面。建议在程式里运用如下Code去判断bin下是否有相关(如BackUp)文件夹，如果没有则创建。</p> 
<pre><code class="language-cs">            if (!System.IO.Directory.Exists(AppDomain.CurrentDomain.SetupInformation.ApplicationBase + @"\BackUp"))
            {
                System.IO.Directory.CreateDirectory(AppDomain.CurrentDomain.SetupInformation.ApplicationBase + @"\BackUp");
            }</code></pre> 
<h5><strong>2.添加卸载程序 （C:\Windows\System32）msiexec.exe</strong></h5> 
<p><img alt="" height="714" src="https://images2.imgbox.com/15/8b/YxK8eAJD_o.png" width="781"></p> 
<p>右击Application Folder（应用程序文件夹） =&gt; Add =&gt; 文件 =&gt;把msiexec.exe文件添加到Application Folder（应用程序文件夹）</p> 
<p><img alt="" height="707" src="https://images2.imgbox.com/47/39/LSnsx3RX_o.png" width="848"></p> 
<p></p> 
<p>添加后如下</p> 
<p><img alt="" height="749" src="https://images2.imgbox.com/e0/df/EFn1CHNU_o.png" width="1200">右击msiexec.exe文件 =&gt; 点击Create Shortcut to msiexec.exe</p> 
<p><img alt="" height="731" src="https://images2.imgbox.com/0c/f0/qqzJerMo_o.png" width="1200"></p> 
<p>得到以下文件</p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/47/ee/G3YpuIiR_o.png" width="1200"></p> 
<p>点击Setup1（您建的项目）将ProductCode 属性的值复制</p> 
<p><img alt="" height="717" src="https://images2.imgbox.com/16/bc/dlKYg5yn_o.png" width="518"></p> 
<p>点击Shortcut to msiexec.exe =&gt; 将复制的ProductCode 属性值 粘贴在Arguments 属性中，然后在最前面加上 /X （注：/X后有一个空格）</p> 
<p><img alt="" height="533" src="https://images2.imgbox.com/f2/64/IqH6eqjF_o.png" width="1200"></p> 
<p>.最后将卸载拖动到User‘s Programs Menu（用户的程序菜单，即将快捷方式添加到开始面板中）</p> 
<p>（注：如果不需要在开始面板中放，可以不用生成相关快捷方式；或依旧将快捷方式放在Application Folder文件夹不迁移位置，也是可以的。）<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/8a/0d/3dezBeJL_o.png"></p> 
<h5>3.选择项目=&gt;主输出 =&gt; 点击确定</h5> 
<p><img alt="" height="187" src="https://images2.imgbox.com/37/7f/PC2rOgyL_o.png" width="698"></p> 
<p><img alt="" height="495" src="https://images2.imgbox.com/32/25/PBCshlDU_o.png" width="382"></p> 
<p>得到以下文件</p> 
<p><img alt="" height="587" src="https://images2.imgbox.com/ff/33/8k2UJPLU_o.png" width="1200"></p> 
<p>将主输出文件拖到User’s Desktop（用户的桌面）中，这样可以形成桌面快捷方式的形式。</p> 
<p>（注：如果不想生成桌面快捷方式，就不用将其拖拽到“User's Desktop”中，还保留在"Application Folder"中也是可以的）<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/dc/7d/SDnEG9wM_o.png"></p> 
<p></p> 
<h4>第四步，更改框架</h4> 
<p><span style="color:#4da8ee;"><strong>（注：该步骤只是为了修改采用的框架，如果选用本机默认框架的话，请跳过本步骤，到第五步,</strong></span></p> 
<h5>1.右击Setup1（您建的项目）=&gt; 属性</h5> 
<p>（注：该步骤只是为了修改采用的框架，如果选用本机默认框架的话，请跳过本步骤）<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b4/14/0Hpn7sdG_o.png"></p> 
<h5><br> 2.点击Prerequisites…</h5> 
<p>（注：该步骤只是为了修改采用的框架，如果选用本机默认框架的话，请跳过本步骤）<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/a7/42/foVx8xiM_o.png"></p> 
<h5><strong>3.选择如下选项 =&gt; 确定</strong></h5> 
<p>（注：该步骤只是为了修改采用的框架，如果选用本机默认框架的话，请跳过本步骤）</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/90/ce/H8LGebsl_o.png"></p> 
<h4>第五步:右击Setup1（您建的项目）=&gt; 生成<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/04/aa/NKkZheNT_o.png"></h4> 
<h4><br> 第六步：在项目中多了Setup1=&gt;Debug=&gt;setup.exe即可安装exe并运行</h4> 
<p><img alt="" height="212" src="https://images2.imgbox.com/cb/1e/DBUADuHU_o.png" width="879"></p> 
<p><img alt="" height="137" src="https://images2.imgbox.com/f2/12/3TIAeB4j_o.png" width="972"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f4a7bf2ab10ec8dc44b3457b166ccfb1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【CASS精品教程】cass3d基于DOM和DEM生成倾斜三维模型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3e2ec97bfc5421cf0f5c17896354f64e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity&amp;&amp;C#学习笔记-抽象方法虚方法抽象类:</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>