<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenGl L3着色器 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenGl L3着色器" />
<meta property="og:description" content="—.着色器 着色器又叫Shader,是一种运行在GPU上的小程序。为图形渲染管线的某个特定部分运行。
着色器作用是处理输入并转换为输出。各个着色器之间不能相互影响，之间通过输入和输出进行沟通。
着色器对应的语言为 GLSL
二.GLSL GSL是一种类C语言，是为图形计算量身定制的。
着色器的开头是输入变量，输出变量，uniform和main函数。
结构如下：
#version version_number in type in_variable_name; in type in_variable_name; out type out_variable_name; uniform type uniform_name; int main() { // 处理输入并进行一些图形操作 ... // 输出处理过的结果到输出变量 out_variable_name = weird_stuff_we_processed; } 数据类型
除了C语言中默认的基础数据类型外，GLSL还有Vector(向量)和Matrix(矩阵)两种容器。
向量
GLSL的向量最多可以包含四分量，分量类型和分量个数都在定义分量名时体现：
vecn n个floativecn n个intbvecn n个bool 访问这些分量时，用.,如 vec4.x。同样，我们可以直接对GLSL中表示的颜色或者纹理坐标使用.来访问其分量。
向量支持重组和类似的拷贝操作：
vec2 someVec; vec4 differentVec = someVec.xyxx; vec3 anotherVec = differentVec.zyw; vec4 otherVec = someVec.xxxx &#43; anotherVec.yxzy; vec2 vect = vec2(0.5, 0.7); vec4 result = vec4(vect, 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7b87f828982892b17e8b7822cd1638a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-13T19:20:14+08:00" />
<meta property="article:modified_time" content="2021-10-13T19:20:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenGl L3着色器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>—.着色器</h2> 
<blockquote> 
 <p>着色器又叫Shader,是一种运行在GPU上的小程序。为图形渲染管线的某个特定部分运行。<br> 着色器作用是处理输入并转换为输出。各个着色器之间不能相互影响，之间通过输入和输出进行沟通。<br> 着色器对应的语言为 GLSL</p> 
</blockquote> 
<h2><a id="GLSL_5"></a>二.GLSL</h2> 
<blockquote> 
 <p>GSL是一种类C语言，是为图形计算量身定制的。<br> 着色器的开头是输入变量，输出变量，uniform和main函数。<br> 结构如下：</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#version version_number</span>
<span class="token keyword">in</span> <span class="token builtin class-name">type</span> in_variable_name<span class="token punctuation">;</span>
<span class="token keyword">in</span> <span class="token builtin class-name">type</span> in_variable_name<span class="token punctuation">;</span>

out <span class="token builtin class-name">type</span> out_variable_name<span class="token punctuation">;</span>

uniform <span class="token builtin class-name">type</span> uniform_name<span class="token punctuation">;</span>

int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  // 处理输入并进行一些图形操作
  <span class="token punctuation">..</span>.
  // 输出处理过的结果到输出变量
  out_variable_name <span class="token operator">=</span> weird_stuff_we_processed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li> <p>数据类型<br> 除了C语言中默认的基础数据类型外，GLSL还有Vector(向量)和Matrix(矩阵)两种容器。</p> </li><li> <p>向量<br> GLSL的向量最多可以包含四分量，分量类型和分量个数都在定义分量名时体现：</p> 
  <ul><li>vecn n个float</li><li>ivecn n个int</li><li>bvecn n个bool</li></ul> <p>访问这些分量时，用<code>.</code>,如 vec4.x。同样，我们可以直接对GLSL中表示的颜色或者纹理坐标使用<code>.</code>来访问其分量。<br> 向量支持重组和类似的拷贝操作：</p> </li></ol> 
<pre><code class="prism language-bash">vec2 someVec<span class="token punctuation">;</span>
vec4 differentVec <span class="token operator">=</span> someVec.xyxx<span class="token punctuation">;</span>
vec3 anotherVec <span class="token operator">=</span> differentVec.zyw<span class="token punctuation">;</span>
vec4 otherVec <span class="token operator">=</span> someVec.xxxx + anotherVec.yxzy<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">vec2 vect <span class="token operator">=</span> vec2<span class="token punctuation">(</span><span class="token number">0.5</span>, <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 result <span class="token operator">=</span> vec4<span class="token punctuation">(</span>vect, <span class="token number">0.0</span>, <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 otherResult <span class="token operator">=</span> vec4<span class="token punctuation">(</span>result.xyz, <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>输入与输出</li></ol> 
<ul><li>每个着色器都有输入输入和输出，使用 <code>in</code>,<code>out</code>来控制。只要一个输出变量和下一个阶段的出入变量匹配，就会传递下去。</li><li>注意，在使用顶点着色器时，每个输入变量叫做顶点属性，要使用 <code>location</code>指定输入变量，这样才可以在CPU上配置顶点属性。而在配置过程中，我们要为输入提供一个额外的<code>layout</code>标识，这样才可以链接到顶点数据。</li><li>注意，在使用片段着色器时，需要一个vec4颜色作为输出变量，不然的话最后物体只能默认渲染为黑色或者白色。<br> 例如：<br> <strong>顶点着色器源码：</strong></li></ul> 
<pre><code class="prism language-bash"><span class="token comment">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">in</span> vec3 aPos<span class="token punctuation">;</span> // 位置变量的属性位置值为0
out vec4 vertexColor<span class="token punctuation">;</span> // 为片段着色器指定一个颜色输出
void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> vec4<span class="token punctuation">(</span>aPos, <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 注意我们如何把一个vec3作为vec4的构造器的参数
    vertexColor <span class="token operator">=</span> vec4<span class="token punctuation">(</span><span class="token number">0.5</span>, <span class="token number">0.0</span>, <span class="token number">0.0</span>, <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 把输出变量设置为暗红色
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>片段着色器</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">#version 330 core</span>
out vec4 FragColor<span class="token punctuation">;</span>
<span class="token keyword">in</span> vec4 vertexColor<span class="token punctuation">;</span> // 从顶点着色器传来的输入变量（名称相同、类型相同）
void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> vertexColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后得到如下结果：<br> <img src="https://images2.imgbox.com/ff/b2/BUskkPun_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>Uniform</li></ol> 
<blockquote> 
 <p>Uniform也是一种从CPU中向GPU发送数据的方式，但uniform和顶点属性不同。主要在于Uniform是全局的，可以在程序的任意阶段被任意程序所访问，和顶点属性只能依次传给下一个阶段不同。</p> 
</blockquote> 
<p>我们可以在着色器中添加uniform 关键字类型类声明一个 uniform类型变量，这样我们就可以在在程序中对这个变量进行赋值了。<br> <strong>片段着色器:</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">#version 330 core</span>
out vec4 FragColor<span class="token punctuation">;</span>
uniform vec4 ourColor<span class="token punctuation">;</span> // 在OpenGL程序代码中设定这个变量
void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> ourColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里，我们通过uniform声明了片段着色器的颜色，那么我们就无需通过顶点着色器对它传值了。</p> 
<p><mark>注意，如果定义了uniform变量不使用的话，可能会造成严重的错误</mark><br> 接下来，我们对uniform变量进行赋值：<br> 首先，我们需要在指定的着色器程序中查找对应的uniform变量的位置值。<br> 然后，我们激活着色器程序并在其中设置uniform值</p> 
<pre><code class="prism language-bash">   int vertexColorLocation <span class="token operator">=</span> glGetUniformLocation<span class="token punctuation">(</span>shaderProgram,<span class="token string">"ourColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   glUserProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
   glUniform4f<span class="token punctuation">(</span>vertexColorLocation,0.0f, <span class="token number">1</span>.0f, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>注意GLSL没有重载，都是通过下标来的。</p> 
</blockquote> 
<p>当然，我们也可以在loop绘制的过程中不断改变uniform变量值</p> 
<pre><code class="prism language-bash">while<span class="token punctuation">(</span><span class="token operator">!</span>glfwWindowShouldClose<span class="token punctuation">(</span>window<span class="token punctuation">))</span>
<span class="token punctuation">{<!-- --></span>
    // 输入
    processInput<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 渲染
    // 清除颜色缓冲
    glClearColor<span class="token punctuation">(</span><span class="token number">0</span>.2f, <span class="token number">0</span>.3f, <span class="token number">0</span>.3f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glClear<span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 记得激活着色器
    glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 更新uniform颜色
    float timeValue <span class="token operator">=</span> glfwGetTime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float greenValue <span class="token operator">=</span> sin<span class="token punctuation">(</span>timeValue<span class="token punctuation">)</span> / <span class="token number">2</span>.0f + <span class="token number">0</span>.5f<span class="token punctuation">;</span>
    int vertexColorLocation <span class="token operator">=</span> glGetUniformLocation<span class="token punctuation">(</span>shaderProgram, <span class="token string">"ourColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glUniform4f<span class="token punctuation">(</span>vertexColorLocation, <span class="token number">0</span>.0f, greenValue, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 绘制三角形
    glBindVertexArray<span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDrawArrays<span class="token punctuation">(</span>GL_TRIANGLES, <span class="token number">0</span>, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 交换缓冲并查询IO事件
    glfwSwapBuffers<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glfwPollEvents<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>uniform完整代码：</p> 
<pre><code class="prism language-bash">//窗口创建头文件
<span class="token comment">#include &lt;glad/glad.h&gt;</span>
<span class="token comment">#include &lt;GLFW/glfw3.h&gt;</span>
<span class="token comment">#include &lt;iostream&gt;</span>
//设置一个窗口回调函数
void framebuffer_size_callback<span class="token punctuation">(</span>GLFWwindow* window, int width, int height<span class="token punctuation">)</span><span class="token punctuation">;</span>
void framebuffer_size_callback<span class="token punctuation">(</span>GLFWwindow* window, int width, int height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    glViewport<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, width, height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
//检测用户输入
void processInput<span class="token punctuation">(</span>GLFWwindow* window<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>glfwGetKey<span class="token punctuation">(</span>window, GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        glfwSetWindowShouldClose<span class="token punctuation">(</span>window, <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
//顶点着色器源码
//<span class="token string">"out vec4 VertexColor;<span class="token entity" title="\n">\n</span>"</span>
//<span class="token string">"   VertexColor = vec4(0.5, 0.0, 0.0, 1.0);<span class="token entity" title="\n">\n</span>"</span>
const char* vertexShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"layout (location = 0) in vec3 aPos;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"void main()<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"{<!-- --><span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0);<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"}<span class="token entity" title="\0">\0</span>"</span><span class="token punctuation">;</span>
//片段着色器源码
//<span class="token string">"in vec4 VertexColor; <span class="token entity" title="\n">\n</span>"</span>
const char* fragmentShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"uniform vec4 ourColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"out vec4 FragColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"void main()<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"{<!-- --><span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"FragColor = ourColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"}<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span>
//实例化窗口
int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    //*********************L1********************************//
    glfwInit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glfwWindowHint<span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glfwWindowHint<span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //使用核心模式
    glfwWindowHint<span class="token punctuation">(</span>GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //glfCreateWindow函数设置窗口的宽和高，以及标题
    //GLFWwindow类存放窗口对象的指针
    GLFWwindow* window <span class="token operator">=</span> glfwCreateWindow<span class="token punctuation">(</span><span class="token number">800</span>, <span class="token number">600</span>, <span class="token string">"LearnOPenGL"</span>, NULL, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window <span class="token operator">==</span> NULL<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"faild"</span> <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> -1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    //将当前窗口的上下文设置为当前线程的上下文,上下文：OpenGL在其中存储渲染信息的一个数据结构
    glfwMakeContextCurrent<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //初始化GLAD
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gladLoadGLLoader<span class="token variable"><span class="token punctuation">((</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">))</span></span>
    <span class="token punctuation">{<!-- --></span>
        std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Faild"</span> <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> -1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    //设置渲染窗口,p1,p2设置窗口左下角的位置，p3,p4设置窗口的宽度和高度（按像素算）
    glViewport<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">800</span>, <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //使用这个函数可以调用设置视口的函数
    //glfwSetFramebufferSizeCallback<span class="token punctuation">(</span>window, framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //***************************L1***********************************//


    //***************************L2**********************************//
    //创建一个顶点着色器，用ID来引用
    unsigned int vertexShader<span class="token punctuation">;</span>
    vertexShader <span class="token operator">=</span> glCreateShader<span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //把着色器源码赋到着色器对象上，然后编译它
    glShaderSource<span class="token punctuation">(</span>vertexShader, <span class="token number">1</span>, <span class="token operator">&amp;</span>vertexShaderSource, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glCompileShader<span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //创建一个片段着色器，用ID来引用
    unsigned int fragmentShader<span class="token punctuation">;</span>
    fragmentShader <span class="token operator">=</span> glCreateShader<span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //把着色器源码附加到着色器对象上，然后编译它
    glShaderSource<span class="token punctuation">(</span>fragmentShader, <span class="token number">1</span>, <span class="token operator">&amp;</span>fragmentShaderSource, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glCompileShader<span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //把编译后的两个着色器链接到一个程序对象上.
    //注意，当链接到下一个着色器时，它会把这个着色器的输出作为下一个着色器的输入
    unsigned int shaderProgram<span class="token punctuation">;</span>
    shaderProgram <span class="token operator">=</span> glCreateProgram<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  //创建一个程序对象

    glAttachShader<span class="token punctuation">(</span>shaderProgram, vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>//附加着色器
    glAttachShader<span class="token punctuation">(</span>shaderProgram, fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glLinkProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span> //链接着色器

    //然后激活就可以使用了，这时我们调用着色器进行渲染的时候就是使用这个程序对象了
    glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //之前定义的着色器对象就可以删除了
    glDeleteShader<span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteShader<span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    int vertexColorLocation <span class="token operator">=</span> glGetUniformLocation<span class="token punctuation">(</span>shaderProgram,<span class="token string">"ourColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glUniform4f<span class="token punctuation">(</span>vertexColorLocation, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
   


    //缓存弄好了，接下来就是将数据弄到缓存上去了
    float vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    -0.5f, -0.5f, <span class="token number">0</span>.0f,
     <span class="token number">0</span>.5f, -0.5f, <span class="token number">0</span>.0f,
     <span class="token number">0</span>.0f,  <span class="token number">0</span>.5f, <span class="token number">0</span>.0f
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    //定义一个顶点缓存对象
   //GPU上有一个特定的缓冲ID,通过引用申请一个VBO对象
    unsigned int VBO<span class="token punctuation">;</span>
    glGenBuffers<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //下一步就是把缓冲对象绑定到对应的缓存中去,这里我们绑定的缓存类型为GL_ARRAY_BUFFER
    glBindBuffer<span class="token punctuation">(</span>GL_ARRAY_BUFFER, VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //定义一个顶点数组对象
    //该对象也可以被绑定，任何随后的顶点属性都会被绑定在这个VAO中
    unsigned int VAO<span class="token punctuation">;</span>
    glGenVertexArrays<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //下一步也就是把这个数组对象绑定到缓存上去
    glBindVertexArray<span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //GL_STATIC_DRAW ：数据不会或几乎不会改变。
    //GL_DYNAMIC_DRAW：数据会被改变很多。
    //GL_STREAM_DRAW ：数据每次绘制时都会改变。
    glBufferData<span class="token punctuation">(</span>GL_ARRAY_BUFFER, sizeof<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>, vertices, GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span> //绑定数据到缓存


    //由于顶点着色器的输入很灵活，我们必须定义输入的值对应的顶点属性
   //glVertexAttribPointer<span class="token punctuation">(</span><span class="token punctuation">)</span>函数定义了Opengl中该如何分析我们输入的顶点数据
   //p1表示位置值,p2表示顶点属性的大小vec3对应的就是3，p3对应我们输入的数据类型，p4对应我们是否要标准化
   //也就是对应是否要将数据映射到-1到1的空间中去，p5表示数据在缓冲区的位移
    glVertexAttribPointer<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">3</span>, GL_FLOAT, GL_FALSE, <span class="token number">3</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">)</span>, <span class="token punctuation">(</span>void*<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glEnableVertexAttribArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//启用顶点属性函数，参数为对应的顶点属
  
    //加入循环
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>glfwWindowShouldClose<span class="token punctuation">(</span>window<span class="token punctuation">))</span> //用于检查window对象是否还在，也就是还没退出渲染
    <span class="token punctuation">{<!-- --></span>
        //*****************************************L1*************************************//
        //在渲染中不断检测用户动作
        processInput<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
   //清空缓存并设置一个默认缓存色
        glClearColor<span class="token punctuation">(</span><span class="token number">0</span>.2f, <span class="token number">0</span>.3f, <span class="token number">0</span>.3f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        glClear<span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //这里是对颜色缓存进行清空，其他还有深度缓等GL_DEPTH_BUFFER_BIT和GL_STENCIL_BUFFER_BIT
        //*****************************************L1*************************************//

        //***************************************L2************************************//
        glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
        glBindVertexArray<span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //注意，这里定义的图元为一个三角形
        glDrawArrays<span class="token punctuation">(</span>GL_TRIANGLES, <span class="token number">0</span>, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        glfwSwapBuffers<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>//用于交换前缓存和后缓存：也就是绘制图像的过程
        glfwPollEvents<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//用于检测有没有什么触发事件，并更新窗口状态  
    <span class="token punctuation">}</span>
    //清空顶点数据
    glDeleteVertexArrays<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteBuffers<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //释放资源
    glfwTerminate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //<span class="token punctuation">..</span>.
    <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>结果：<br> <img src="https://images2.imgbox.com/49/c2/ZmWAPqkL_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>顶点属性</li></ol> 
<blockquote> 
 <p>我们之前讲到，我们可以自定义顶点属性，接下来将演示如何让顶点着色器同时对输入的位置值和颜色值进行读取。</p> 
</blockquote> 
<p>这里，我们定义了一个 1X6的数组，同时传入顶点位置信息和RGB信息。</p> 
<pre><code class="prism language-bash">float vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    // 位置              // 颜色
     <span class="token number">0</span>.5f, -0.5f, <span class="token number">0</span>.0f,  <span class="token number">1</span>.0f, <span class="token number">0</span>.0f, <span class="token number">0</span>.0f,   // 右下
    -0.5f, -0.5f, <span class="token number">0</span>.0f,  <span class="token number">0</span>.0f, <span class="token number">1</span>.0f, <span class="token number">0</span>.0f,   // 左下
     <span class="token number">0</span>.0f,  <span class="token number">0</span>.5f, <span class="token number">0</span>.0f,  <span class="token number">0</span>.0f, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f    // 顶部
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>对应的顶点着色器代码改为：</p> 
<pre><code class="prism language-bash"><span class="token comment">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">in</span> vec3 aPos<span class="token punctuation">;</span>   // 位置变量的属性位置值为 <span class="token number">0</span> 
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> vec3 aColor<span class="token punctuation">;</span> // 颜色变量的属性位置值为 <span class="token number">1</span>
out vec3 ourColor<span class="token punctuation">;</span> // 向片段着色器输出一个颜色
void <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> vec4<span class="token punctuation">(</span>aPos, <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ourColor <span class="token operator">=</span> aColor<span class="token punctuation">;</span> // 将ourColor设置为我们从顶点数据那里得到的输入颜色
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>这里定义了位置0 和位置1 ，我们可以理解为对这个1X6 数组，我们先读取属性位置为0的vec3作为第一个顶点的位置，然后读取下一个位置的vec3，也就是属性位置值为1的vec3作为第一个顶点的颜色，然后这一个顶点的信息读取完了，接着换下一个顶点按照同样的相对位置进行读取赋值。<br> <img src="https://images2.imgbox.com/13/5d/JZbM25GR_o.png" alt="在这里插入图片描述"><br> 由于更新了顶点属性，所以我们必须重新规定GPU对顶点属性的读取规则：</p> 
</blockquote> 
<pre><code class="prism language-bash">// 位置属性
glVertexAttribPointer<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">3</span>, GL_FLOAT, GL_FALSE, <span class="token number">6</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">)</span>, <span class="token punctuation">(</span>void*<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glEnableVertexAttribArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  //激活
// 颜色属性
glVertexAttribPointer<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, GL_FLOAT, GL_FALSE, <span class="token number">6</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">)</span>, <span class="token punctuation">(</span>void*<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span>* sizeof<span class="token punctuation">(</span>float<span class="token punctuation">))</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glEnableVertexAttribArray<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  //激活
</code></pre> 
<p>完整代码：</p> 
<pre><code class="prism language-bash">//窗口创建头文件
<span class="token comment">#include &lt;glad/glad.h&gt;</span>
<span class="token comment">#include &lt;GLFW/glfw3.h&gt;</span>
<span class="token comment">#include &lt;iostream&gt;</span>
//设置一个窗口回调函数
void framebuffer_size_callback<span class="token punctuation">(</span>GLFWwindow* window, int width, int height<span class="token punctuation">)</span><span class="token punctuation">;</span>
void framebuffer_size_callback<span class="token punctuation">(</span>GLFWwindow* window, int width, int height<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    glViewport<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, width, height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
//检测用户输入
void processInput<span class="token punctuation">(</span>GLFWwindow* window<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>glfwGetKey<span class="token punctuation">(</span>window, GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        glfwSetWindowShouldClose<span class="token punctuation">(</span>window, <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
//顶点着色器源码
//<span class="token string">"   VertexColor = vec4(0.5, 0.0, 0.0, 1.0);<span class="token entity" title="\n">\n</span>"</span>
const char* vertexShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"layout (location = 0) in vec3 aPos;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"layout(location = 1) in vec3 aColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"out vec3 ourColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"void main()<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"{<!-- --><span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0);<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"   ourColor = aColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"}<span class="token entity" title="\0">\0</span>"</span><span class="token punctuation">;</span>
//片段着色器源码

const char* fragmentShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"in vec3 ourColor; <span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"out vec4 FragColor;<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"void main()<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"{<!-- --><span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"FragColor = vec4(ourColor,1.0f);<span class="token entity" title="\n">\n</span>"</span>
<span class="token string">"}<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span>
//实例化窗口
int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    //*********************L1********************************//
    glfwInit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glfwWindowHint<span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glfwWindowHint<span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //使用核心模式
    glfwWindowHint<span class="token punctuation">(</span>GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //glfCreateWindow函数设置窗口的宽和高，以及标题
    //GLFWwindow类存放窗口对象的指针
    GLFWwindow* window <span class="token operator">=</span> glfwCreateWindow<span class="token punctuation">(</span><span class="token number">800</span>, <span class="token number">600</span>, <span class="token string">"LearnOPenGL"</span>, NULL, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window <span class="token operator">==</span> NULL<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"faild"</span> <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> -1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    //将当前窗口的上下文设置为当前线程的上下文,上下文：OpenGL在其中存储渲染信息的一个数据结构
    glfwMakeContextCurrent<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //初始化GLAD
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gladLoadGLLoader<span class="token variable"><span class="token punctuation">((</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">))</span></span>
    <span class="token punctuation">{<!-- --></span>
        std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Faild"</span> <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> -1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    //设置渲染窗口,p1,p2设置窗口左下角的位置，p3,p4设置窗口的宽度和高度（按像素算）
    glViewport<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">800</span>, <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //使用这个函数可以调用设置视口的函数
    //glfwSetFramebufferSizeCallback<span class="token punctuation">(</span>window, framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //***************************L1***********************************//


    //***************************L2**********************************//
    //创建一个顶点着色器，用ID来引用
    unsigned int vertexShader<span class="token punctuation">;</span>
    vertexShader <span class="token operator">=</span> glCreateShader<span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //把着色器源码赋到着色器对象上，然后编译它
    glShaderSource<span class="token punctuation">(</span>vertexShader, <span class="token number">1</span>, <span class="token operator">&amp;</span>vertexShaderSource, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glCompileShader<span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //创建一个片段着色器，用ID来引用
    unsigned int fragmentShader<span class="token punctuation">;</span>
    fragmentShader <span class="token operator">=</span> glCreateShader<span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //把着色器源码附加到着色器对象上，然后编译它
    glShaderSource<span class="token punctuation">(</span>fragmentShader, <span class="token number">1</span>, <span class="token operator">&amp;</span>fragmentShaderSource, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glCompileShader<span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //把编译后的两个着色器链接到一个程序对象上.
    //注意，当链接到下一个着色器时，它会把这个着色器的输出作为下一个着色器的输入
    unsigned int shaderProgram<span class="token punctuation">;</span>
    shaderProgram <span class="token operator">=</span> glCreateProgram<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  //创建一个程序对象

    glAttachShader<span class="token punctuation">(</span>shaderProgram, vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>//附加着色器
    glAttachShader<span class="token punctuation">(</span>shaderProgram, fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glLinkProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span> //链接着色器

    //然后激活就可以使用了，这时我们调用着色器进行渲染的时候就是使用这个程序对象了
    glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //之前定义的着色器对象就可以删除了
    glDeleteShader<span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteShader<span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

   /*
    int vertexColorLocation <span class="token operator">=</span> glGetUniformLocation<span class="token punctuation">(</span>shaderProgram,<span class="token string">"ourColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glUniform4f<span class="token punctuation">(</span>vertexColorLocation, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>*/
   


    //缓存弄好了，接下来就是将数据弄到缓存上去了
    float vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        // 位置              // 颜色
        <span class="token number">0</span>.5f, -0.5f, <span class="token number">0</span>.0f,  <span class="token number">1</span>.0f, <span class="token number">0</span>.0f, <span class="token number">0</span>.0f,   // 右下
       -0.5f, -0.5f, <span class="token number">0</span>.0f,  <span class="token number">0</span>.0f, <span class="token number">1</span>.0f, <span class="token number">0</span>.0f,   // 左下
        <span class="token number">0</span>.0f,  <span class="token number">0</span>.5f, <span class="token number">0</span>.0f,  <span class="token number">0</span>.0f, <span class="token number">0</span>.0f, <span class="token number">1</span>.0f    // 顶部
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    //定义一个顶点缓存对象
   //GPU上有一个特定的缓冲ID,通过引用申请一个VBO对象
    unsigned int VBO<span class="token punctuation">;</span>
    glGenBuffers<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //下一步就是把缓冲对象绑定到对应的缓存中去,这里我们绑定的缓存类型为GL_ARRAY_BUFFER
    glBindBuffer<span class="token punctuation">(</span>GL_ARRAY_BUFFER, VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //定义一个顶点数组对象
    //该对象也可以被绑定，任何随后的顶点属性都会被绑定在这个VAO中
    unsigned int VAO<span class="token punctuation">;</span>
    glGenVertexArrays<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //下一步也就是把这个数组对象绑定到缓存上去
    glBindVertexArray<span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //GL_STATIC_DRAW ：数据不会或几乎不会改变。
    //GL_DYNAMIC_DRAW：数据会被改变很多。
    //GL_STREAM_DRAW ：数据每次绘制时都会改变。
    glBufferData<span class="token punctuation">(</span>GL_ARRAY_BUFFER, sizeof<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>, vertices, GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span> //绑定数据到缓存


    //由于顶点着色器的输入很灵活，我们必须定义输入的值对应的顶点属性
   //glVertexAttribPointer<span class="token punctuation">(</span><span class="token punctuation">)</span>函数定义了Opengl中该如何分析我们输入的顶点数据
   //p1表示位置值,p2表示顶点属性的大小vec3对应的就是3，p3对应我们输入的数据类型，p4对应我们是否要标准化
   //也就是对应是否要将数据映射到-1到1的空间中去，p5表示我们读取一个顶点属性的位移，p6表示数据在缓冲区的位移
    glVertexAttribPointer<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">3</span>, GL_FLOAT, GL_FALSE, <span class="token number">6</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">)</span>, <span class="token punctuation">(</span>void*<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glEnableVertexAttribArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//启用顶点属性函数，参数为对应的顶点属性位置

    //添加对RGB顶点属性的读取
    glVertexAttribPointer<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, GL_FLOAT, GL_FALSE, <span class="token number">6</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">)</span>, <span class="token punctuation">(</span>void*<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> * sizeof<span class="token punctuation">(</span>float<span class="token punctuation">))</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    glEnableVertexAttribArray<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  //激活
  
 




    //加入循环
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>glfwWindowShouldClose<span class="token punctuation">(</span>window<span class="token punctuation">))</span> //用于检查window对象是否还在，也就是还没退出渲染
    <span class="token punctuation">{<!-- --></span>
        //*****************************************L1*************************************//
        //在渲染中不断检测用户动作
        processInput<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
   //清空缓存并设置一个默认缓存色
        glClearColor<span class="token punctuation">(</span><span class="token number">0</span>.2f, <span class="token number">0</span>.3f, <span class="token number">0</span>.3f, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        glClear<span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //这里是对颜色缓存进行清空，其他还有深度缓等GL_DEPTH_BUFFER_BIT和GL_STENCIL_BUFFER_BIT
        //*****************************************L1*************************************//

        //***************************************L2************************************//
        glUseProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
        glBindVertexArray<span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //注意，这里定义的图元为一个三角形
        glDrawArrays<span class="token punctuation">(</span>GL_TRIANGLES, <span class="token number">0</span>, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        glfwSwapBuffers<span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>//用于交换前缓存和后缓存：也就是绘制图像的过程
        glfwPollEvents<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//用于检测有没有什么触发事件，并更新窗口状态  
    <span class="token punctuation">}</span>
    //清空顶点数据
    glDeleteVertexArrays<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteBuffers<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glDeleteProgram<span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    //释放资源
    glfwTerminate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //<span class="token punctuation">..</span>.
    <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后结果：<br> <img src="https://images2.imgbox.com/cc/60/SVhHQGWT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_552"></a>三.封装着色器程序对象</h2> 
<blockquote> 
 <p>为了方便我们管理着色器，我们可以把着色器对象封装到一个抽象类里面，让它可以从硬盘里面读取着色器，然后编译链接它们，并进行错误检测。</p> 
</blockquote> 
<ol><li>定义结构</li></ol> 
<blockquote> 
 <p>注意，这里的#ifndef #define #endif 是为了防止出现重复引用的问题，含义如下：<br> #ifndef SHADER_H 如果没有引用 shader.h<br> #define SHADER_H 那么就引用 shader.h<br> #endif 否者不引用<br> 如果不这样重复引用后可能会报重定义错误</p> 
</blockquote> 
<p>说明：我们在定义shader的时候，指定了顶点着色器和片段着色器的路径，这样在构造着色器程序的时候我们就可以把源码的文本存储在硬盘上了。另外，定义成员函数 use激活着色器程序对象，set()用于查找着色器位置并赋值。</p> 
<pre><code class="prism language-bash"><span class="token comment">#ifndef SHADER_H</span>
<span class="token comment">#define SHADER_H</span>
<span class="token comment">#include &lt;glad/glad.h&gt;; // 包含glad来获取所有的必须OpenGL头文件</span>
<span class="token comment">#include &lt;string&gt;</span>
<span class="token comment">#include &lt;fstream&gt;</span>
<span class="token comment">#include &lt;sstream&gt;</span>
<span class="token comment">#include &lt;iostream&gt;</span>
class Shader
<span class="token punctuation">{<!-- --></span>
public:
    // 程序ID
    unsigned int ID<span class="token punctuation">;</span>

    // 构造器读取并构建着色器
    Shader<span class="token punctuation">(</span>const GLchar* vertexPath, const GLchar* fragmentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    // 使用/激活程序
    void use<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    // uniform工具函数
    void setBool<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, bool value<span class="token punctuation">)</span> const<span class="token punctuation">;</span>  
    void setInt<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, int value<span class="token punctuation">)</span> const<span class="token punctuation">;</span>   
    void setFloat<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, float value<span class="token punctuation">)</span> const<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">#endif</span>
</code></pre> 
<ol start="2"><li>构造函数（一）读取着色器内容<br> 这里我们使用c++文件流读取文件内容，访问对应位置的着色器源码。</li></ol> 
<pre><code class="prism language-bash">Shader<span class="token punctuation">(</span>const char* vertexPath, const char* fragmentPath<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    // <span class="token number">1</span>. 从文件路径中获取顶点/片段着色器
    std::string vertexCode<span class="token punctuation">;</span>
    std::string fragmentCode<span class="token punctuation">;</span>
    std::ifstream vShaderFile<span class="token punctuation">;</span>
    std::ifstream fShaderFile<span class="token punctuation">;</span>
    // 保证ifstream对象可以抛出异常：
    vShaderFile.exceptions <span class="token punctuation">(</span>std::ifstream::failbit <span class="token operator">|</span> std::ifstream::badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fShaderFile.exceptions <span class="token punctuation">(</span>std::ifstream::failbit <span class="token operator">|</span> std::ifstream::badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    try 
    <span class="token punctuation">{<!-- --></span>
        // 打开文件
        vShaderFile.open<span class="token punctuation">(</span>vertexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderFile.open<span class="token punctuation">(</span>fragmentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std::stringstream vShaderStream, fShaderStream<span class="token punctuation">;</span>
        // 读取文件的缓冲内容到数据流中
        vShaderStream <span class="token operator">&lt;&lt;</span> vShaderFile.rdbuf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderStream <span class="token operator">&lt;&lt;</span> fShaderFile.rdbuf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
        // 关闭文件处理器
        vShaderFile.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderFile.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 转换数据流到string
        vertexCode   <span class="token operator">=</span> vShaderStream.str<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fragmentCode <span class="token operator">=</span> fShaderStream.str<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span>
    catch<span class="token punctuation">(</span>std::ifstream::failure e<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::FILE_NOT_SUCCESFULLY_READ"</span> <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    const char* vShaderCode <span class="token operator">=</span> vertexCode.c_str<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    const char* fShaderCode <span class="token operator">=</span> fragmentCode.c_str<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre> 
<ol start="3"><li>构造函数（二）编译和链接着色器</li></ol> 
<pre><code class="prism language-bash">// <span class="token number">2</span>. 编译着色器
unsigned int vertex, fragment<span class="token punctuation">;</span>
int success<span class="token punctuation">;</span>
char infoLog<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

// 顶点着色器
vertex <span class="token operator">=</span> glCreateShader<span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
glShaderSource<span class="token punctuation">(</span>vertex, <span class="token number">1</span>, <span class="token operator">&amp;</span>vShaderCode, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
glCompileShader<span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
// 打印编译错误（如果有的话）
glGetShaderiv<span class="token punctuation">(</span>vertex, GL_COMPILE_STATUS, <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
if<span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    glGetShaderInfoLog<span class="token punctuation">(</span>vertex, <span class="token number">512</span>, NULL, infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::VERTEX::COMPILATION_FAILED<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

// 片段着色器也类似
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>

// 着色器程序
ID <span class="token operator">=</span> glCreateProgram<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glAttachShader<span class="token punctuation">(</span>ID, vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
glAttachShader<span class="token punctuation">(</span>ID, fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
glLinkProgram<span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
// 打印连接错误（如果有的话）
glGetProgramiv<span class="token punctuation">(</span>ID, GL_LINK_STATUS, <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
if<span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    glGetProgramInfoLog<span class="token punctuation">(</span>ID, <span class="token number">512</span>, NULL, infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std::cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::PROGRAM::LINKING_FAILED<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> std::endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 删除着色器，它们已经链接到我们的程序中了，已经不再需要了
glDeleteShader<span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
glDeleteShader<span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li>激活函数和对uniform赋值函数的定义</li></ol> 
<pre><code class="prism language-bash"> void <span class="token function-name function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
   glUseProgram<span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
//
void setBool<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, bool value<span class="token punctuation">)</span> const
<span class="token punctuation">{<!-- --></span>
    glUniform1i<span class="token punctuation">(</span>glGetUniformLocation<span class="token punctuation">(</span>ID, name.c_str<span class="token punctuation">(</span><span class="token punctuation">))</span>, <span class="token punctuation">(</span>int<span class="token punctuation">)</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
void setInt<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, int value<span class="token punctuation">)</span> const
<span class="token punctuation">{<!-- --></span> 
    glUniform1i<span class="token punctuation">(</span>glGetUniformLocation<span class="token punctuation">(</span>ID, name.c_str<span class="token punctuation">(</span><span class="token punctuation">))</span>, value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
void setFloat<span class="token punctuation">(</span>const std::string <span class="token operator">&amp;</span>name, float value<span class="token punctuation">)</span> const
<span class="token punctuation">{<!-- --></span> 
    glUniform1f<span class="token punctuation">(</span>glGetUniformLocation<span class="token punctuation">(</span>ID, name.c_str<span class="token punctuation">(</span><span class="token punctuation">))</span>, value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 

</code></pre> 
<h2><a id="_686"></a>四.使用封装的着色器类</h2> 
<pre><code class="prism language-bash">//构造一个着色器程序
Shader ourShader<span class="token punctuation">(</span><span class="token string">"path/to/shaders/shader.vs"</span>, <span class="token string">"path/to/shaders/shader.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">..</span>.
while<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
//激活并对uniform赋值
    ourShader.use<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ourShader.setFloat<span class="token punctuation">(</span><span class="token string">"someUniform"</span>, <span class="token number">1</span>.0f<span class="token punctuation">)</span><span class="token punctuation">;</span>
//绘制图元
    DrawStuff<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9cbc222b4a16e90826cdc570d5f6c11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【渗透测试】CS4.0的使用（四）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a43541f01c023ad5a24e332ad06c8d28/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity导出exe时遇到的两个问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>