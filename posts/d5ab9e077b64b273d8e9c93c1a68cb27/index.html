<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android应用隐私合规检测实现方案 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android应用隐私合规检测实现方案" />
<meta property="og:description" content="一、准备工作 1、安装夜神模拟器安卓7.0版本，自带Xposed框架
二、编写Xposed模块 1、在Android Studio新建一个Android App项目
2、在build.gradle中添加xposed的编译依赖
dependencies { compileOnly &#39;de.robv.android.xposed:api:82&#39; } 3、记得配置阿里云或者jcenter()仓库
4、在AndroidManifest.xml application标签下添加对应属性的设置
&lt;!--告诉xposed框架这是一个xposed模块--&gt; &lt;meta-data android:name=&#34;xposedmodule&#34; android:value=&#34;true&#34; /&gt; &lt;!--模块描述--&gt; &lt;meta-data android:name=&#34;xposeddescription&#34; android:value=&#34;隐私合规检测工具&#34; /&gt; &lt;!--模块支持Xposed的最低版本--&gt; &lt;meta-data android:name=&#34;xposedminversion&#34; android:value=&#34;53&#34; /&gt; 5、新建一个类实现IXposedHookLoadPackage接口的handleLoadPackage方法
public class PrivacyHook implements IXposedHookLoadPackage { @Override public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable { if (loadPackageParam.packageName.startsWith(&#34;com.sswl&#34;)) { XposedBridge.log(&#34;PrivacyHook has Hooked!&#34;); //检测mac的获取 Class&lt;?&gt; NetworkInterfaceCls = XposedHelpers.findClass(&#34;java.net.NetworkInterface&#34;, loadPackageParam.classLoader); XposedHelpers.findAndHookMethod(NetworkInterfaceCls, &#34;getNetworkInterfaces&#34;, new XC_MethodHook() { protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Throwable { super." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d5ab9e077b64b273d8e9c93c1a68cb27/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-27T15:20:46+08:00" />
<meta property="article:modified_time" content="2023-09-27T15:20:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android应用隐私合规检测实现方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、准备工作</h2> 
<p>1、安装夜神模拟器安卓7.0版本，自带Xposed框架</p> 
<h2>二、编写Xposed模块</h2> 
<p>1、在Android Studio新建一个Android App项目</p> 
<p>2、在build.gradle中添加xposed的编译依赖</p> 
<pre><code class="hljs">dependencies {
    compileOnly 'de.robv.android.xposed:api:82'
}</code></pre> 
<p>3、记得配置阿里云或者jcenter()仓库</p> 
<p><img alt="" height="518" src="https://images2.imgbox.com/48/dd/jUO1AwGt_o.png" width="1200"></p> 
<p>4、在AndroidManifest.xml application标签下添加对应属性的设置</p> 
<pre><code class="hljs"> &lt;!--告诉xposed框架这是一个xposed模块--&gt;
    &lt;meta-data
        android:name="xposedmodule"
        android:value="true" /&gt;
    &lt;!--模块描述--&gt;
    &lt;meta-data
        android:name="xposeddescription"
        android:value="隐私合规检测工具" /&gt;
    &lt;!--模块支持Xposed的最低版本--&gt;
    &lt;meta-data
        android:name="xposedminversion"
        android:value="53" /&gt;</code></pre> 
<p>5、新建一个类实现IXposedHookLoadPackage接口的handleLoadPackage方法</p> 
<pre><code class="hljs">public class PrivacyHook implements IXposedHookLoadPackage {
    @Override
    public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable {
        if (loadPackageParam.packageName.startsWith("com.sswl")) {

            XposedBridge.log("PrivacyHook  has Hooked!");

            //检测mac的获取
            Class&lt;?&gt; NetworkInterfaceCls = XposedHelpers.findClass("java.net.NetworkInterface", loadPackageParam.classLoader);
            XposedHelpers.findAndHookMethod(NetworkInterfaceCls, "getNetworkInterfaces", new XC_MethodHook() {

                protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    Log.w("Xposed", "=============================================================");
                    XposedBridge.log("调用getNetworkInterfaces");
                    StackTraceElement[] stackTrace = new Exception().getStackTrace();
                    for (int i = 0; i &lt; stackTrace.length; i++) {
                        Log.e("Xposed", "" + stackTrace[i]);
                    }
                }

                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                }

            });

            //获取IMEI
            Class&lt;?&gt; Imei = XposedHelpers.findClass("android.telephony.TelephonyManager", loadPackageParam.classLoader);
            XposedHelpers.findAndHookMethod(Imei, "getDeviceId", new XC_MethodHook() {

                protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    Log.w("Xposed1", "=============================================================");
                    XposedBridge.log("调用getDeviceId");
                    StackTraceElement[] stackTrace = new Exception().getStackTrace();
                    for (int i = 0; i &lt; stackTrace.length; i++) {
                        Log.e("Xposed", "" + stackTrace[i]);
                    }
                }

                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                }
            });

        //获取IMSI
        Class&lt;?&gt; Imsi = XposedHelpers.findClass("android.telephony.TelephonyManager", loadPackageParam.classLoader);
        XposedHelpers.findAndHookMethod(Imsi, "getSubscriberId",int.class, new XC_MethodHook() {

            protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Throwable {
                super.beforeHookedMethod(param);
                Log.w("Xposed2", "=============================================================");
                XposedBridge.log("调用getSubscriberId");
                StackTraceElement[] stackTrace = new Exception().getStackTrace();
                for (int i = 0; i &lt; stackTrace.length; i++) {
                    Log.e("Xposed", "" + stackTrace[i]);
                }
            }

            protected void afterHookedMethod(MethodHookParam param) throws Throwable {
            }

        });
            //检测androidId的获取
            Class&lt;?&gt; SystemCls = XposedHelpers.findClass("android.provider.Settings$Secure", loadPackageParam.classLoader);
            XposedHelpers.findAndHookMethod(SystemCls, "getStringForUser", ContentResolver.class, String.class, int.class, new XC_MethodHook() {

                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    Log.w("Xposedadam", "=============================================================");
                    XposedBridge.log("调用getStringForUser");
                    StackTraceElement[] stackTrace = new Exception().getStackTrace();
                    for (int i = 0; i &lt; stackTrace.length; i++) {
                        Log.e("Xposed", "" + stackTrace[i]);
                    }
                }
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                }
            });

        }
    }
}


</code></pre> 
<p>6、根据需要hook的方法参数决定</p> 
<p><img alt="" height="370" src="https://images2.imgbox.com/56/b7/SivhCZST_o.png" width="1200"></p> 
<p>7、在assets目录下新建文件名为：xposed_init 的文本文件，并将刚才新建的那个类的完整类名填写到第一行，比如：</p> 
<p><strong>com.sswl.xposed.PrivacyHook</strong></p> 
<p><img alt="" height="998" src="https://images2.imgbox.com/08/0e/UCZVMMOM_o.png" width="1200"></p> 
<p>8、将应用打包出来安装到模拟器上，然后点模块进行安装，然后重启生效</p> 
<p><img alt="" height="263" src="https://images2.imgbox.com/2b/0d/EdhJ4EaQ_o.png" width="560"></p> 
<p>9、运行需要检测的应用，就可以在Android Studio查看日志打印</p> 
<p><img alt="" height="734" src="https://images2.imgbox.com/d5/49/sBRWMiaz_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4dba0e0a71acf63d4b83b07c7197e90d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IOC概述及其实现原理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d4c759ad228420eee2741c3622a7dee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c&#43;&#43;11计时chrono库使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>