<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#下操作USB设备的方法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#下操作USB设备的方法" />
<meta property="og:description" content="想必大家对LibUSB不陌生，没错，它就是很有名的开源usb驱动，其提供的API可以很方便的操作linux或者WIN下的USB设备，非常的方便！但是libusb是基于c语言的，那么在C#下是不是就不能使用libusb呢？当然不是了，你完全可以把libusb提供的dll封装成自己的C#库，但是这个工作量是非常大的而且调试的过程中肯定会有些意想不到的事情发生，那么在C#下该如何使用libusb呢，下面介绍C#下的强大的开源USB类库就登场了：LibUSBDotNet，没错就是.NET下的libusb，这也是个开源项目，已经把libusb封装成了一个完整的类库，可以去下面链接下载：
http://download.csdn.net/detail/cumtwys/7713473（CSDN不要分）
或者
http://sourceforge.net/projects/libusbdotnet/（官方）
它是sourceforge上的一个开源项目，下载WIN下的EXE安装即可，里面包含了很多的范例，还有说明文档（CHM格式的，超级方便的）。
下面简单介绍一下该如何使用LibUSBDotNet。
1、首先你需要创建一个C#的应用程序（控制台、窗体都可以）
2、将LibUsbDotNet安装目录下Src目录下LibWinUsb拷贝一份到你的工程根目录下
3、不需要多说了吧，在你的解决方案上右击，添加现有项目，将LibWinUsb目录下的项目包含进来
4、在你的项目上右击，添加引用，选择LibUSBDotNet项目，如下图：
5、在你的CS文件开头，添加引用：
using LibUsbDotNet; using LibUsbDotNet.Main; using LibUsbDotNet.Info; using LibUsbDotNet.Descriptors; using LibUsbDotNet.LibUsb; using LibUsbDotNet.WinUsb; 6、下面提供一个读取数据的范例（摘自CHM说明文档） using System; using System.Text; using LibUsbDotNet; using LibUsbDotNet.Main; namespace Examples { internal class ReadPolling { public static UsbDevice MyUsbDevice; #region SET YOUR USB Vendor and Product ID! public static UsbDeviceFinder MyUsbFinder = new UsbDeviceFinder(1234, 1); #endregion public static void Main(string[] args) { ErrorCode ec = ErrorCode." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/03d2aa45771ee97c7f547e77599dce9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-08-04T16:45:58+08:00" />
<meta property="article:modified_time" content="2014-08-04T16:45:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#下操作USB设备的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="white-space:pre"></span>想必大家对LibUSB不陌生，没错，它就是很有名的开源usb驱动，其提供的API可以很方便的操作linux或者WIN下的USB设备，非常的方便！但是libusb是基于c语言的，那么在C#下是不是就不能使用libusb呢？当然不是了，你完全可以把libusb提供的dll封装成自己的C#库，但是这个工作量是非常大的而且调试的过程中肯定会有些意想不到的事情发生，那么在C#下该如何使用libusb呢，下面介绍C#下的强大的开源USB类库就登场了：LibUSBDotNet，没错就是.NET下的libusb，这也是个开源项目，已经把libusb封装成了一个完整的类库，可以去下面链接下载：</p> 
<p><a target="_blank" href="http://download.csdn.net/detail/cumtwys/7713473" rel="noopener noreferrer">http://download.csdn.net/detail/cumtwys/7713473</a>（CSDN不要分）<br> </p> 
<p>或者</p> 
<p><a target="_blank" href="http://sourceforge.net/projects/libusbdotnet/" rel="nofollow noopener noreferrer"><span style="white-space:pre"></span>http://sourceforge.net/projects/libusbdotnet/</a>（官方）</p> 
<p><span style="white-space:pre"></span>它是sourceforge上的一个开源项目，下载WIN下的EXE安装即可，里面包含了很多的范例，还有说明文档（CHM格式的，超级方便的）。</p> 
<p><span style="white-space:pre"></span>下面简单介绍一下该如何使用LibUSBDotNet。</p> 
<p><span style="white-space:pre"></span>1、首先你需要创建一个C#的应用程序（控制台、窗体都可以）</p> 
<p><span style="white-space:pre"></span>2、将LibUsbDotNet安装目录下Src目录下LibWinUsb拷贝一份到你的工程根目录下</p> 
<p><span style="white-space:pre"></span>3、不需要多说了吧，在你的解决方案上右击，添加现有项目，将LibWinUsb目录下的项目包含进来</p> 
<p><span style="white-space:pre"></span>4、在你的项目上右击，添加引用，选择LibUSBDotNet项目，如下图：</p> 
<p><span style="white-space:pre"><img src="https://images2.imgbox.com/c2/75/yj3Dhs3n_o.jpg" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>5</span>、在你的CS文件开头，添加引用：</p> 
<p><span style="white-space:pre"></span></p> 
<pre><code class="language-csharp">using LibUsbDotNet;
using LibUsbDotNet.Main;
using LibUsbDotNet.Info;
using LibUsbDotNet.Descriptors;
using LibUsbDotNet.LibUsb;
using LibUsbDotNet.WinUsb;</code></pre> 
<span style="white-space:pre"></span>6、下面提供一个读取数据的范例（摘自CHM说明文档） 
<p></p> 
<p><span style="white-space:pre"></span></p> 
<pre><code class="language-csharp">using System;
using System.Text;
using LibUsbDotNet;
using LibUsbDotNet.Main;

namespace Examples
{
    internal class ReadPolling
    {
        public static UsbDevice MyUsbDevice;

        #region SET YOUR USB Vendor and Product ID!

        public static UsbDeviceFinder MyUsbFinder = new UsbDeviceFinder(1234, 1);

        #endregion

        public static void Main(string[] args)
        {
            ErrorCode ec = ErrorCode.None;

            try
            {
                // Find and open the usb device.
                MyUsbDevice = UsbDevice.OpenUsbDevice(MyUsbFinder);

                // If the device is open and ready
                if (MyUsbDevice == null) throw new Exception("Device Not Found.");

                // If this is a "whole" usb device (libusb-win32, linux libusb-1.0)
                // it exposes an IUsbDevice interface. If not (WinUSB) the 
                // 'wholeUsbDevice' variable will be null indicating this is 
                // an interface of a device; it does not require or support 
                // configuration and interface selection.
                IUsbDevice wholeUsbDevice = MyUsbDevice as IUsbDevice;
                if (!ReferenceEquals(wholeUsbDevice, null))
                {
                    // This is a "whole" USB device. Before it can be used, 
                    // the desired configuration and interface must be selected.

                    // Select config #1
                    wholeUsbDevice.SetConfiguration(1);

                    // Claim interface #0.
                    wholeUsbDevice.ClaimInterface(0);
                }

                // open read endpoint 1.
                UsbEndpointReader reader = MyUsbDevice.OpenEndpointReader(ReadEndpointID.Ep01);


                byte[] readBuffer = new byte[1024];
                while (ec == ErrorCode.None)
                {
                    int bytesRead;

                    // If the device hasn't sent data in the last 5 seconds,
                    // a timeout error (ec = IoTimedOut) will occur. 
                    ec = reader.Read(readBuffer, 5000, out bytesRead);

                    if (bytesRead == 0) throw new Exception(string.Format("{0}:No more bytes!", ec));
                    Console.WriteLine("{0} bytes read", bytesRead);

                    // Write that output to the console.
                    Console.Write(Encoding.Default.GetString(readBuffer, 0, bytesRead));
                }

                Console.WriteLine("\r\nDone!\r\n");
            }
            catch (Exception ex)
            {
                Console.WriteLine();
                Console.WriteLine((ec != ErrorCode.None ? ec + ":" : String.Empty) + ex.Message);
            }
            finally
            {
                if (MyUsbDevice != null)
                {
                    if (MyUsbDevice.IsOpen)
                    {
                        // If this is a "whole" usb device (libusb-win32, linux libusb-1.0)
                        // it exposes an IUsbDevice interface. If not (WinUSB) the 
                        // 'wholeUsbDevice' variable will be null indicating this is 
                        // an interface of a device; it does not require or support 
                        // configuration and interface selection.
                        IUsbDevice wholeUsbDevice = MyUsbDevice as IUsbDevice;
                        if (!ReferenceEquals(wholeUsbDevice, null))
                        {
                            // Release interface #0.
                            wholeUsbDevice.ReleaseInterface(0);
                        }

                        MyUsbDevice.Close();
                    }
                    MyUsbDevice = null;

                    // Free usb resources
                    UsbDevice.Exit();

                }

                // Wait for user input..
                Console.ReadKey();
            }
        }
    }
}
</code></pre> 
<span style="white-space:pre"></span>7、怎么样简单吧，方便吧，并且安装目录下有个驱动文件自动生成器，非常的好用就是InfWizard.exe，这是个驱动生成向导，对于开发自己的USB设备需要写WIN驱动的时候完全可以考虑使用LIBUSB来做驱动，那么使用这个工具你的工作量会在一分钟之内搞定，太强大了…… 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61175a4203b010745c24985e0ef27270/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">商务通 vs 快商通</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/61243460ba22b06b976f667a3b9468b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阻止文件不被上传到iCloud</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>