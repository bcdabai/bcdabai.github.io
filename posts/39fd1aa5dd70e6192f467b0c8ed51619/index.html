<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp获取用户手机号码，以及流程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp获取用户手机号码，以及流程" />
<meta property="og:description" content="获取用户手机号码需要6个必要条件，
1.必须是企业账号，否则是无权限获取的用户手机号码的，企业账号你需要获取到你微信小程序的appid和小程序密钥（这个后面要用到）
查看appid和小程序密钥的地址：
小程序https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=197451409&amp;lang=zh_CN
2.调用uni.login()获取到用户的code值
3.获取到用户code值之后调用uni.request()请求微信的服务器，拿到用户的session_key值
4.通过微信提供的获取微信手机号的方法getphonenumber拿到encryptedData iv两个字段的内容
5.用户授权完毕之后我们可以拿到encryptedData值和iv值（这两个值用于解密）
6.所有值全部都可以拿到之后，通过微信提供的解密方法：可以拿到最终的手机号
微信提供的方法在：
服务端获取开放数据 | 微信开放文档微信开发者平台文档https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html
找到WXBizDataCrypt.js放入自己的文件夹中，所有条件满足之后就可以正常走通了，此下面代码可以直接拿来使用，样式随便乱写的，自己调整
&lt;template&gt; &lt;view class=&#34;bigBox&#34;&gt; &lt;view class=&#34;box&#34;&gt; &lt;input v-model=&#34;phone&#34; /&gt; &lt;view class=&#34;useWexin&#34;&gt; &lt;button open-type=&#34;getPhoneNumber&#34; @getphonenumber=&#34;getPhoneNumber&#34; plain=&#34;true&#34;&gt;获取手机号&lt;/button&gt; &lt;/view&gt; &lt;/view&gt; &lt;/view&gt; &lt;/template&gt; &lt;script&gt; import WXBizDataCrypt from &#34;../../utils/WXBizDataCrypt.js&#34; export default { data() { return { phone: &#34;&#34;, phone_iv: &#34;&#34;, js_code: &#34;&#34;, session_key: &#34;&#34;, } }, onShow() { this.go() }, methods: { go() { uni.login({ provider: &#39;weixin&#39;, success: res =&gt; { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/39fd1aa5dd70e6192f467b0c8ed51619/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-15T16:02:44+08:00" />
<meta property="article:modified_time" content="2023-09-15T16:02:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp获取用户手机号码，以及流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>获取用户手机号码需要6个必要条件，</p> 
<p>1.必须是企业账号，否则是无权限获取的用户手机号码的，企业账号你需要获取到你微信小程序的<strong>appid和小程序密钥（这个后面要用到）</strong></p> 
<p><strong>查看appid和小程序密钥的地址：</strong></p> 
<p><a class="has-card" href="https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=197451409&amp;lang=zh_CN" rel="nofollow" title="小程序"><span class="link-card-box"><span class="link-title">小程序</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/f8/7f/InwnR31h_o.png" alt="icon-default.png?t=N7T8">https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=197451409&amp;lang=zh_CN</span></span></a><img alt="" height="871" src="https://images2.imgbox.com/aa/ff/9xs1e5gI_o.png" width="1200"></p> 
<p>2.调用<strong>uni.login()</strong>获取到用户的<strong>code</strong>值</p> 
<p>3.获取到用户<strong>code</strong>值之后调用<strong>uni.request()</strong>请求微信的服务器，拿到用户的<strong>session_key</strong>值</p> 
<p>4.通过微信提供的获取微信手机号的方法<strong>getphonenumber</strong>拿到<strong>encryptedData iv</strong>两个字段的内容</p> 
<p>5.用户授权完毕之后我们可以拿到<strong>encryptedData</strong>值和<strong>iv</strong>值（这两个值用于解密）</p> 
<p>6.所有值全部都可以拿到之后，通过微信提供的解密方法：可以拿到最终的手机号</p> 
<p>微信提供的方法在：</p> 
<p><a class="has-card" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html" rel="nofollow" title="服务端获取开放数据 | 微信开放文档"><span class="link-card-box"><span class="link-title">服务端获取开放数据 | 微信开放文档</span><span class="link-desc">微信开发者平台文档</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/2c/69/PMfOiVVs_o.png" alt="icon-default.png?t=N7T8">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html</span></span></a><img alt="" height="743" src="https://images2.imgbox.com/87/09/VVd0iD0n_o.png" width="1200"></p> 
<p>找到WXBizDataCrypt.js放入自己的文件夹中，所有条件满足之后就可以正常走通了，此下面代码可以直接拿来使用，样式随便乱写的，自己调整</p> 
<pre><code class="language-html">&lt;template&gt;
	&lt;view class="bigBox"&gt;
		&lt;view class="box"&gt;
			&lt;input v-model="phone" /&gt;
			&lt;view class="useWexin"&gt;
				&lt;button open-type="getPhoneNumber" @getphonenumber="getPhoneNumber" plain="true"&gt;获取手机号&lt;/button&gt;
			&lt;/view&gt;
		&lt;/view&gt;
	&lt;/view&gt;



&lt;/template&gt;

&lt;script&gt;
	import WXBizDataCrypt from "../../utils/WXBizDataCrypt.js"
	export default {
		data() {
			return {
				phone: "",
				phone_iv: "",
				js_code: "",
				session_key: "",
			}
		},
		onShow() {
			this.go()
		},
		methods: {
			go() {
				uni.login({
					provider: 'weixin',
					success: res =&gt; {
						console.log(res)
						this.js_code = res.code
						uni.request({
							url: 'https://api.weixin.qq.com/sns/jscode2session', // 请求微信服务器
							method: 'GET',
							data: {
								appid: '你的小程序的APPID', //你的小程序的APPID
								secret: '你的小程序秘钥secret, ', //你的小程序秘钥secret,  
								js_code: this.js_code, //uni.login 登录成功后的code
								grant_type: 'authorization_code' //此处为固定值
							},
							success: (res) =&gt; {
								console.log('获取信息', res.data);
								this.session_key = res.data.session_key

							}
						});
					}
				});
			},
			getPhoneNumber(res) { // 获取手机号
				this.phone_encryptedData = res.detail.encryptedData //用于解密
				this.phone_iv = res.detail.iv // 用于解密
				console.log(res, "获取手机号需要的参数");
				let pc = new WXBizDataCrypt('你的小程序的APPID', this.session_key);
				let data = pc.decryptData(this.phone_encryptedData, this.phone_iv);
				console.log(data);
				if (data.phoneNumber != '') {
					this.phone = data.phoneNumber
				}
			}
		}
	}
&lt;/script&gt;

&lt;style lang="less"&gt;
	.bigBox {
		width: 100vw;
		height: 100vh;
		background-color: #F1F2F6;
		display: flex;
		align-items: center;
		justify-content: center;

		.box {
			width: 70vw;
			height: 30vh;

			input {
				border: 2rpx solid black;
			}

			.useWexin {
				width: 50%;
				height: 80rpx;
				display: flex;
				align-items: center;
				justify-content: center;
				margin: 40rpx auto;
			}
		}

	}
&lt;/style&gt;</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c5bc48de6f7c91ea2854bee987a31517/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js 引入lodash.js调用其方法demo 例子</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e0e78bce1797dc89d39449a68f3c23a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里云服务器是什么？云服务器详细介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>