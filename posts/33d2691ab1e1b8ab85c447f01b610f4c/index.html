<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从零学习Linux操作系统 第二十二部分 企业域名解析服务的部署及安全优化 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="从零学习Linux操作系统 第二十二部分 企业域名解析服务的部署及安全优化" />
<meta property="og:description" content="# 一、dns的主要信息 关于dns的名词解释：dns:
domain name service(域名解析服务)
关于客户端:
/etc/resolv.conf dns指向文件
A记录 ##ip地址叫做域名的Address 记录
SOA ##授权起始主机
关于服务端
bind安装包named服务名称/etc/named.conf主配置文件/var/named数据目录端口53 关于报错信息：
1.no servers could be reached服务无法访问（服务开启？火墙？网络？端口？）2.服务启动失败配置文件写错 journalctl -xe查询错误 3.dig查询状态NOERROR表示查询成功REFUSED服务拒绝访问SERVFAIL查询记录失败,（dns服务器无法到达上级，拒绝缓存）NXDOMAIN此域名A记录在dns中不存在 二、dns的安装及启用 安装
dnf install bind.x86_64 -y
启用
systemctl enable --now named
firewall-cmd --permanent --add-service=dns
firewall-cmd --reload
测试
在测试主机上（另一台主机）编辑文件
vim /etc/resolv.conf
客户端主机上运行
dig www.baidu.com
此时测试主机不能运行
客户端主机运行
netstat -antlupe | grep named
发现使用的53端口并没有对外开放
编辑配置文件
vim /etc/named.conf
重启服务
systemctl restart named
此时测试主机上有回应
但并拒绝服务，没有成为服务对象
继续编辑配置文件
重启服务
systemctl restart named" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/33d2691ab1e1b8ab85c447f01b610f4c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-28T21:15:37+08:00" />
<meta property="article:modified_time" content="2024-01-28T21:15:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从零学习Linux操作系统 第二十二部分 企业域名解析服务的部署及安全优化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_dns_0"></a># 一、dns的主要信息</h2> 
<p>关于dns的名词解释：dns:<br> domain name service(域名解析服务)</p> 
<p>关于客户端:<br> /etc/resolv.conf dns指向文件</p> 
<p>A记录 ##ip地址叫做域名的Address 记录<br> SOA ##授权起始主机</p> 
<p>关于服务端</p> 
<table><thead><tr><th>bind</th><th>安装包</th></tr></thead><tbody><tr><td>named</td><td>服务名称</td></tr><tr><td>/etc/named.conf</td><td>主配置文件</td></tr><tr><td>/var/named</td><td>数据目录</td></tr><tr><td>端口</td><td>53</td></tr></tbody></table> 
<p>关于报错信息：</p> 
<table><thead><tr><th>1.no servers could be reached</th><th>服务无法访问（服务开启？火墙？网络？端口？）</th></tr></thead><tbody><tr><td>2.服务启动失败</td><td>配置文件写错 journalctl -xe查询错误</td></tr></tbody></table> 
<table><thead><tr><th>3.dig</th><th>查询状态</th></tr></thead><tbody><tr><td>NOERROR</td><td>表示查询成功</td></tr><tr><td>REFUSED</td><td>服务拒绝访问</td></tr><tr><td>SERVFAIL</td><td>查询记录失败,（dns服务器无法到达上级，拒绝缓存）</td></tr><tr><td>NXDOMAIN</td><td>此域名A记录在dns中不存在</td></tr></tbody></table> 
<h2><a id="dns_31"></a>二、dns的安装及启用</h2> 
<p>安装<br> dnf install bind.x86_64 -y<br> <img src="https://images2.imgbox.com/fe/44/oHvuQzsU_o.png" alt="在这里插入图片描述"><br> 启用<br> systemctl enable --now named<br> firewall-cmd --permanent --add-service=dns<br> firewall-cmd --reload</p> 
<p>测试<br> 在测试主机上（另一台主机）编辑文件<br> vim /etc/resolv.conf<br> <img src="https://images2.imgbox.com/92/88/o9hogyMp_o.png" alt="在这里插入图片描述"><br> 客户端主机上运行<br> dig www.baidu.com<br> <img src="https://images2.imgbox.com/e7/49/LbfjFv25_o.png" alt="在这里插入图片描述"><br> 此时测试主机不能运行<br> <img src="https://images2.imgbox.com/5c/9c/unef5dRW_o.png" alt="在这里插入图片描述"><br> 客户端主机运行<br> netstat -antlupe | grep named<br> <img src="https://images2.imgbox.com/bc/dc/Rp5DgYN1_o.png" alt="在这里插入图片描述"><br> 发现使用的53端口并没有对外开放</p> 
<p>编辑配置文件<br> vim /etc/named.conf<br> <img src="https://images2.imgbox.com/36/ed/iYN6b0GS_o.png" alt="在这里插入图片描述"><br> 重启服务<br> systemctl restart named</p> 
<p>此时测试主机上有回应</p> 
<p><img src="https://images2.imgbox.com/fb/01/MwyMtUM4_o.png" alt="在这里插入图片描述"></p> 
<p>但并拒绝服务，没有成为服务对象</p> 
<p>继续编辑配置文件</p> 
<p><img src="https://images2.imgbox.com/08/bb/btQDvfWi_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/ff/Zd8z9108_o.png" alt="在这里插入图片描述"></p> 
<p>重启服务<br> systemctl restart named</p> 
<p>此时测试主机便可进行解析<br> <img src="https://images2.imgbox.com/1c/79/7fnjgEvd_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dns_80"></a>三、高速缓存dns</h2> 
<p>服务器和外部服务器进行沟通的时候，是要用到解析的。</p> 
<p>比如说企业中有很多台服务器需要用地址解析来获得真正要访问或者要接收数据的地址。<br> 理论上这些主机要获取外网的信息，肯定是要使用外网的dns，所有的主机都要询问外网的dns，一台主机和外网dns的通讯是需要时间的，而此时有很多台主机，如果可以节省下来时间则可以提高很多效率。具体操作就是，内网的一台主机作为服务器构建一个dns，所有的主机都连接这台服务器主机的dns，服务器主机访问外网的dns将数据缓存下来，服务器主机从外网获取信息可能花一些时间，其余主机直接访问内网的服务器主机即可。<strong>这台主机则是高速缓存dns。</strong></p> 
<p>服务器主机上<br> 编辑配置文件<br> vim /etc/named.conf</p> 
<p><img src="https://images2.imgbox.com/2c/93/wcJKmz4m_o.png" alt="在这里插入图片描述"><br> 重启服务<br> systemctl restart named</p> 
<p>再编辑配置文件<br> vim /etc/resolv.conf<br> <img src="https://images2.imgbox.com/b7/f3/RLD4osai_o.png" alt="在这里插入图片描述"></p> 
<p>第二胎主机也要设置成一样的ip<br> <img src="https://images2.imgbox.com/b0/d2/nt6VezlF_o.png" alt="在这里插入图片描述"><br> 此时 高速缓存dns就搭建完成<br> 同时访问一个网址时<br> <img src="https://images2.imgbox.com/0a/f9/V1En5wff_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/e9/hyZtAHOZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dns_107"></a>四、dns的正向解析</h2> 
<p>自己搭建一个dns服务器<br> 自己给自己做解析</p> 
<p>编辑配置文件<br> vim /etc/named.conf<br> <img src="https://images2.imgbox.com/f2/ad/j7vgiNZ2_o.png" alt="在这里插入图片描述"></p> 
<p>手动建立一个文件<br> cp -p /var/named/named.localhost /var/named/westos.org.zone</p> 
<p><img src="https://images2.imgbox.com/2e/d2/zJ5RSEn1_o.png" alt="在这里插入图片描述"><br> 编写这个文件（A记录文件）<br> vim westos.org.zone<br> <img src="https://images2.imgbox.com/f2/52/xuaEfK0C_o.png" alt="在这里插入图片描述"></p> 
<p>重启服务<br> systemctl restart named</p> 
<p>dig www.westos.org<br> <img src="https://images2.imgbox.com/b5/57/GnKjJWTo_o.png" alt="在这里插入图片描述"></p> 
<p>A写的什么 dns解析的就能看到什么</p> 
<p>但不建议将域名信息写道主配置文件里面<br> 而是</p> 
<p><img src="https://images2.imgbox.com/cc/95/v5sF8F44_o.png" alt="在这里插入图片描述"><br> 编辑<br> vim /etc/named.rfc1912.zones</p> 
<p><img src="https://images2.imgbox.com/60/f9/WGek2lR7_o.png" alt="在这里插入图片描述"><br> A记录文件名称是自定义的</p> 
<p>重新书写A记录文件<br> cp -p named.loopback westos.org.zone<br> vim westos.org.zone<br> <img src="https://images2.imgbox.com/81/e8/JEU8qyZ7_o.png" alt="在这里插入图片描述"><br> 测试<br> <img src="https://images2.imgbox.com/be/b6/uczy4BAv_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dns_147"></a>五、dns的数据类型分析</h2> 
<h3><a id="1A_149"></a>1、A记录</h3> 
<h3><a id="2CNAMEcanonical_name_150"></a>2、CNAME（canonical name）</h3> 
<p>一家企业对外开放的域名只有一个，但企业内部主机的域名不可能只用同一个名字，所以需要将内部域名转换成公网域名给别人用，别人在解析的时候需要将公网域名转换成内部域名做解析。</p> 
<p>编辑记录文件<br> vim westos.org.zone</p> 
<p><img src="https://images2.imgbox.com/31/42/2VH4WKMm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/71/nZ0u1bJB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3MX_161"></a>3、MX记录</h3> 
<p>邮件解析记录</p> 
<p>编辑记录文件<br> vim westos.org.zone<br> <img src="https://images2.imgbox.com/fb/1c/WTDzEELK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/69/UBHEXnSa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_170"></a>4、反向解析记录</h3> 
<p>反向解析记录与正向解析记录是独立的</p> 
<p>编辑配置文件<br> vim /etc/named.rfc1912.zones<br> <img src="https://images2.imgbox.com/91/30/zVIFVdgc_o.png" alt="在这里插入图片描述"><br> 再编辑记录文件<br> cp -p named.localhost 192.168.0.ptr<br> vim 192.168.0.ptr<br> <img src="https://images2.imgbox.com/47/09/Eqrgqrpp_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dns_182"></a>六、dns的双向解析</h2> 
<p>需要两个不同的网段<br> <img src="https://images2.imgbox.com/45/7a/bLcEmbmX_o.png" alt="在这里插入图片描述"><br> 设置另一台主机可以与之互通<br> <img src="https://images2.imgbox.com/31/16/uDe7ays6_o.png" alt="在这里插入图片描述"><br> 将测试主机<br> <img src="https://images2.imgbox.com/fc/c7/WokiXmDO_o.png" alt="在这里插入图片描述"><br> 客户端主机上<br> cp -p westos.org.zone westos.org.inter<br> 编辑westos.org.inter<br> vim westos.org.inter</p> 
<p><img src="https://images2.imgbox.com/b9/4f/4Ui2OYzx_o.png" alt="在这里插入图片描述"><br> cp /etc/named.rfc1912.zones /etc/named.rfc1912.inters -p</p> 
<p>更改/etc/named.rfc1912.inters信息<br> vim /etc/named.rfc1912.inters<br> <img src="https://images2.imgbox.com/31/c1/ojOcDzC3_o.png" alt="在这里插入图片描述"></p> 
<p>最后设定主配置文件<br> <img src="https://images2.imgbox.com/e2/47/LVaTSeUO_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dnsdns_205"></a>七、辅助dns的设定及优化（dns集群）</h2> 
<p><strong>如果一台主机作为dns服务器，就有很多用户去访问，这台主机就有更大的几率顶不知很多用户的压力而崩溃，所以就要用另一台主机对dns服务器的压力进行均摊</strong></p> 
<p>主dns：<br> zone “westos.com” IN {<!-- --><br> type master;<br> file “westos.com.zone”;<br> allow-update { none; };<br> also-notify { 192.168.0.30; }; ##主动通知的辅助dns主机<br> };</p> 
<p>在林一台主机上安装<br> dnf install bind -y</p> 
<p><img src="https://images2.imgbox.com/5e/65/Jd5GPxck_o.png" alt="在这里插入图片描述"><br> 设定火墙<br> firewall-cmd --permanent --add-service=dns<br> firewall-cmd --reload<br> <img src="https://images2.imgbox.com/4c/1b/TGfZcijB_o.png" alt="在这里插入图片描述"></p> 
<p>编辑主配置文件<br> vim /etc/named.conf<br> <img src="https://images2.imgbox.com/0e/09/PA6TnnNF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f7/aa/7qfvuzGa_o.png" alt="在这里插入图片描述"><br> 编辑<br> vim /etc/named.rfc1912.zones</p> 
<p><img src="https://images2.imgbox.com/58/08/so46pe2a_o.png" alt="在这里插入图片描述"><br> 设定 /etc/resolv.conf</p> 
<p><img src="https://images2.imgbox.com/bc/a9/YdEnRvl0_o.png" alt="在这里插入图片描述"></p> 
<p>在主机dns服务器里面<br> vim /etc/named.rfc1912.zones</p> 
<p><img src="https://images2.imgbox.com/2f/4e/aHzK8I1g_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="dnskey_245"></a>八、dns的key更新实施</h2> 
<p>要更新需要生成一个key（生成加密文件）</p> 
<p>dnssec-keygen -a HMAC-SHA256 -b 128 -n HOST westos</p> 
<p><img src="https://images2.imgbox.com/39/4d/2XRUWGWQ_o.png" alt="在这里插入图片描述"></p> 
<p>此时生成的密码dns不知道，这时就要将钥匙指定给dns</p> 
<p>cp /etc/rndc.key /etc/westos.key<br> 编辑key文件<br> vim /etc/westos.key<br> <img src="https://images2.imgbox.com/92/60/87EanYBf_o.png" alt="在这里插入图片描述"></p> 
<p>编辑主配置文件<br> <img src="https://images2.imgbox.com/6b/39/f2INYGpN_o.png" alt="在这里插入图片描述"><br> 编辑配置文件 指定谁可以更新<br> vim /etc/named.rfc1912.zones<br> <img src="https://images2.imgbox.com/cc/90/pEJDoIW3_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_267"></a>九、动态域名解析</h2> 
<p>装在服务<br> dnf instsall dhcp-server -y<br> <img src="https://images2.imgbox.com/6b/ab/0qbGlsvo_o.png" alt="在这里插入图片描述"></p> 
<p>dhcp意味用户主机获得ip的时候时不固定的</p> 
<p>这时需要操作<br> 编辑配置文件<br> cp /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf</p> 
<p>vim /etc/dhcp/dhcpd.conf<br> <img src="https://images2.imgbox.com/ef/ea/2GMVZiXb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c6/a1/d4zMGDfI_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a5/e0/QtNaxM6E_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e8/d5/xmXvwlPi_o.png" alt="在这里插入图片描述"><br> 重启服务<br> systemctl restart dhcpd</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/756e682a06f5e361a799bb454dd4c3a8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Javascript（五）：内置对象、简单数据类型和复杂数据类型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/47cf2ea879ddc95344adaab76d2d4d1f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">球形空间产生器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>