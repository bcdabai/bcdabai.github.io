<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shell编程-6 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shell编程-6" />
<meta property="og:description" content="akw深入学习 shell学习第6天继续学习awkif多分支小题目利用awk的system命令求和awk数组小练习练习2split切割函数substr函数---&gt;切片 难题 shell学习第6天 继续学习awk systime()是awk内部得到当前时间的函数
strftime()是awk日期格式化输出的函数，按照指定的格式输出日期
编写一个脚本，发现新增了或者删除了用户，需要知道，还有修改了密码也要知道，密码为空的用户也要知道、如果有上面的行为就记录到日志里/var/log/user_pwd.log
#!/bin/bash #定义日志文件 log_file=&#34;/var/log/user_pwd.log&#34; #备份 /etc/passwd 和 /etc/shadow mkdir -p /backup_user cd /backup_user #手动去备份 #cp /etc/passwd passwd-$(date &#43;%F) #cp /etc/shadow shadow-$(date &#43;%F) #计算备份文件的md5sum passwd_md5=$(md5sum /backup_user/passwd-$(date &#43;%F) | awk &#39;{print $1}&#39;) shadow_md5=$(md5sum /backup_user/shadow-$(date &#43;%F) | awk &#39;{print $1}&#39;) #计算最近的 /etc/passwd /etc/shadow 的md5值 c_passwd_md5=$(md5sum /etc/passwd | awk &#39;{print $1}&#39;) c_shadow_md5=$(md5sum /etc/shadow | awk &#39;{print $1}&#39;) #判断 passwd 文件的 md5 值是否有变化 if [[ $passwd_md5 != $c_passwd_md5 ]]; then echo &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/895b70107cfb168503168506fea55cc9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-22T11:53:29+08:00" />
<meta property="article:modified_time" content="2024-01-22T11:53:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shell编程-6</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>akw深入学习</h4> 
 <ul><li><a href="#shell6_1" rel="nofollow">shell学习第6天</a></li><li><ul><li><a href="#awk_3" rel="nofollow">继续学习awk</a></li><li><a href="#if_88" rel="nofollow">if多分支</a></li><li><a href="#_102" rel="nofollow">小题目</a></li><li><a href="#awksystem_126" rel="nofollow">利用awk的system命令</a></li><li><a href="#_193" rel="nofollow">求和</a></li><li><a href="#awk_213" rel="nofollow">awk数组</a></li><li><ul><li><a href="#_264" rel="nofollow">小练习</a></li><li><a href="#2_289" rel="nofollow">练习2</a></li><li><a href="#split_309" rel="nofollow">split切割函数</a></li><li><a href="#substr_322" rel="nofollow">substr函数---&gt;切片</a></li></ul> 
   </li><li><a href="#_343" rel="nofollow">难题</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="shell6_1"></a>shell学习第6天</h2> 
<h3><a id="awk_3"></a>继续学习awk</h3> 
<p>systime()是awk内部得到当前时间的函数</p> 
<p>strftime()是awk日期格式化输出的函数，按照指定的格式输出日期</p> 
<blockquote> 
 <p>编写一个脚本，发现新增了或者删除了用户，需要知道，还有修改了密码也要知道，密码为空的用户也要知道、如果有上面的行为就记录到日志里/var/log/user_pwd.log</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">#定义日志文件</span>
<span class="token assign-left variable">log_file</span><span class="token operator">=</span><span class="token string">"/var/log/user_pwd.log"</span>

<span class="token comment">#备份 /etc/passwd 和 /etc/shadow</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /backup_user
<span class="token builtin class-name">cd</span> /backup_user
<span class="token comment">#手动去备份</span>
<span class="token comment">#cp /etc/passwd passwd-$(date +%F)</span>
<span class="token comment">#cp /etc/shadow shadow-$(date +%F)</span>

<span class="token comment">#计算备份文件的md5sum</span>
<span class="token assign-left variable">passwd_md5</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum /backup_user/passwd-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">shadow_md5</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum /backup_user/shadow-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>

<span class="token comment">#计算最近的 /etc/passwd /etc/shadow 的md5值</span>
<span class="token assign-left variable">c_passwd_md5</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum /etc/passwd <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>
<span class="token assign-left variable">c_shadow_md5</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>md5sum /etc/shadow <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>

<span class="token comment">#判断 passwd 文件的 md5 值是否有变化</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$passwd_md5</span> <span class="token operator">!=</span> <span class="token variable">$c_passwd_md5</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"用户信息被修改"</span>
    <span class="token comment">#使用 diff 去比较发现是增加或者减少了哪些用户</span>
    <span class="token keyword">if</span> <span class="token function">diff</span> <span class="token parameter variable">-q</span> /etc/passwd /backup_user/passwd-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"用户信息没有详细变化"</span>
    <span class="token keyword">else</span>
        <span class="token function">diff</span> /etc/passwd /backup_user/passwd-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&lt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户新增了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&lt; "</span> <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
        <span class="token assign-left variable">i_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">diff</span> /etc/passwd /backup_user/passwd-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&lt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户新增了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&lt; "</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"用户新增了:<span class="token variable">$i_name</span>"</span>
        <span class="token keyword">fi</span>

        <span class="token function">diff</span> /etc/passwd /backup_user/passwd-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&gt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户删除了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&gt; "</span> <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
        <span class="token assign-left variable">d_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">diff</span> /etc/passwd /backup_user/passwd-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&gt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户删除了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&gt; "</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"用户删除了:<span class="token variable">$d_name</span>"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"用户信息没有被修改"</span>
<span class="token keyword">fi</span>

<span class="token comment">#判断 shadow 文件的 md5 值是否有变化</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$shadow_md5</span> <span class="token operator">!=</span> <span class="token variable">$c_shadow_md5</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"用户密码文件被修改"</span>
    <span class="token comment">#使用 diff 去比较发现是 shadow 文件里的哪些行发生变化了</span>
    <span class="token keyword">if</span> <span class="token function">diff</span> <span class="token parameter variable">-q</span> /etc/shadow /backup_user/shadow-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"用户密码文件没有详细变化"</span>
    <span class="token keyword">else</span>
        <span class="token function">diff</span> /etc/shadow /backup_user/shadow-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&lt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户新增了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&lt; "</span> <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
        <span class="token assign-left variable">i_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">diff</span> /etc/shadow /backup_user/shadow-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&lt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户新增了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&lt; "</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"用户新增了:<span class="token variable">$i_name</span>"</span>
        <span class="token keyword">fi</span>

        <span class="token function">diff</span> /etc/shadow /backup_user/shadow-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&gt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户删除了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&gt; "</span> <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
        <span class="token assign-left variable">d_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">diff</span> /etc/shadow /backup_user/shadow-<span class="token punctuation">$(</span>date +%F<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"^&gt;"</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">'{print "用户删除了:"$1}'</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">"&gt; "</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"用户删除了:<span class="token variable">$d_name</span>"</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">.</span>

    <span class="token builtin class-name">echo</span> <span class="token string">"用户密码文件没有修改"</span>
<span class="token keyword">fi</span>

<span class="token comment">#判断没有设置密码或者密码为空的用户,记录到日志文件里</span>
<span class="token function">awk</span> -F: <span class="token string">'length($2) == 1 || length($2) == 2 {print $1,"没有设置密码",strftime("%D",systime())}'</span> /etc/shadow <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
<span class="token function">awk</span> -F: <span class="token string">'length($2) == 0 {print $1,"密码为空",strftime("%D",systime())}'</span> /etc/shadow <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>

</code></pre> 
<h3><a id="if_88"></a>if多分支</h3> 
<p><img src="https://images2.imgbox.com/4d/78/oA9sGnO6_o.png" alt="image-20240121163433422"></p> 
<pre><code class="prism language-shell"><span class="token function">awk</span> -F: <span class="token string">'length($2) == 1 || length($2) == 2 {print $1,"没有设置密码",strftime("%D",systime())}'</span> /etc/shadow <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
<span class="token function">awk</span> -F: <span class="token string">'length($2) == 0 {print $1,"密码为空",strftime("%D",systime())}'</span> /etc/shadow <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>

<span class="token string">'这两条可以整合起来:'</span>
<span class="token function">awk</span> -F: <span class="token string">'{if (length($2) == 1 || length($2) == 2) print $1,"没有设置密码",strftime("%D",systime())else if (length($2) ==0 ) print $1,"密码为空",strftime("%D",systime())}'</span> /etc/shadow <span class="token operator">&gt;&gt;</span><span class="token variable">$log_file</span>
</code></pre> 
<h3><a id="_102"></a>小题目</h3> 
<pre><code class="prism language-shell">在centos7的配置文件/etc/vimrc中有if v:lang s~ <span class="token string">"utf8$'
这里的v:lang和=~分别是什么意思?
"</span>utf8$<span class="token string">"中的"</span>$"的作用?
</code></pre> 
<blockquote> 
 <p>在 <code>/etc/vimrc</code> 配置文件中的语句：</p> 
 <pre><code class="prism language-bash"><span class="token keyword">if</span> v:lang <span class="token operator">=~</span> <span class="token string">"utf8$"</span>
</code></pre> 
 <p>这里的 <code>v:lang</code> 是 Vim 中的一个特殊变量，表示当前的语言。而 <code>=~</code> 是 Vim 中的正则表达式匹配运算符。</p> 
 <p>解释一下：</p> 
 <ul><li><code>v:lang</code>: 表示当前的语言。</li><li><code>=~</code>: 是 Vim 中的正则表达式匹配运算符，用于判断左侧的字符串是否匹配右侧的正则表达式。</li><li><code>"utf8$"</code>: 是一个正则表达式，其中 <code>"utf8"</code> 表示匹配包含 “utf8” 的字符串，而 <code>$</code> 表示匹配字符串结尾。因此，整个正则表达式 <code>"utf8$"</code> 表示匹配以 “utf8” 结尾的字符串。</li></ul> 
 <p>因此，整个条件语句的意思是：如果当前语言是以 “utf8” 结尾的，那么就执行条件块中的内容。这可能用于在不同的语言环境下设置相关的 Vim 配置。</p> 
</blockquote> 
<h3><a id="awksystem_126"></a>利用awk的system命令</h3> 
<p><img src="https://images2.imgbox.com/70/ae/60Pp3aqu_o.png" alt="image-20240121171710455"></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">awk</span> -F: <span class="token string">'{system("mkdir -p /gao/hui/sc/"$1)}'</span> /etc/passwd
<span class="token number">0</span> directories, <span class="token number">0</span> files
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> tree /gao
/gao
└── hui
    └── sc
        ├── adm
        ├── bin
        ├── chrony
        ├── daemon
        ├── dbus
        ├── <span class="token function">ftp</span>
        ├── games
        ├── gaodingjiang
        ├── gaodingjiang1
        ├── gaodingjiang12
        ├── gaodingjiang123
        ├── gaofei12
        ├── gaofei123
        ├── gh123
        ├── <span class="token function">halt</span>
        ├── liu
        ├── liu1
        ├── liu2
        ├── liu3
        ├── lp
        ├── mail
        ├── nobody
        ├── operator
        ├── polkitd
        ├── postfix
        ├── root
        ├── root1
        ├── root2
        ├── sc1
        ├── sc10
        ├── sc11
        ├── sc12
        ├── sc13
        ├── sc14
        ├── sc15
        ├── sc16
        ├── sc17
        ├── sc18
        ├── sc19
        ├── sc20
        ├── sc5
        ├── sc6
        ├── sc7
        ├── sc8
        ├── sc9
        ├── <span class="token function">shutdown</span>
        ├── sshd
        ├── <span class="token function">sync</span>
        ├── systemd-network
        └── tss
<span class="token number">52</span> directories, <span class="token number">0</span> files
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h3><a id="_193"></a>求和</h3> 
<p><img src="https://images2.imgbox.com/98/5c/pxM6iwbM_o.png" alt="image-20240121172658725"></p> 
<pre><code class="prism language-shell"><span class="token string">'简单的求和'</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> grade.txt <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR&gt;1{sum += $4}END{print sum}'</span>
<span class="token number">355</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> grade.txt 
name	chinese	math	english
cali	<span class="token number">80</span>	<span class="token number">91</span>	<span class="token number">82</span>
tom		<span class="token number">90</span>	<span class="token number">80</span>	<span class="token number">99</span>
lucy	<span class="token number">99</span>	<span class="token number">70</span>	<span class="token number">75</span>
jack	<span class="token number">60</span>	<span class="token number">89</span>	<span class="token number">99</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> 
<h3><a id="awk_213"></a>awk数组</h3> 
<p>array 数组 ：一组数据</p> 
<p><img src="https://images2.imgbox.com/73/56/9HeHB5Gt_o.png" alt="image-20240121174910126"></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> a.txt 
山东 aa <span class="token number">20</span>
河南 bb <span class="token number">30</span>
江西 cc <span class="token number">30</span>
湖南 aa <span class="token number">40</span>
山东 bb <span class="token number">10</span>
江西 <span class="token function">dd</span> <span class="token number">60</span>
河南 cc <span class="token number">30</span>
湖南 cc <span class="token number">30</span>

<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> a.txt<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{a[$1] += $3}END{for (i in a) print i,a[i]}'</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k</span> <span class="token number">2</span> <span class="token parameter variable">-n</span>
山东 <span class="token number">30</span>
河南 <span class="token number">60</span>
湖南 <span class="token number">70</span>
江西 <span class="token number">90</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> 
<p><code>这个数组很像python中的字典</code></p> 
<p><mark>key和value</mark></p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@gh<span class="token operator">-</span>shell <span class="token number">1</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">/</span>scdict<span class="token punctuation">.</span>py
name gaohui
age <span class="token number">18</span>
hobby read_book
skills Linux python
<span class="token punctuation">[</span>root@gh<span class="token operator">-</span>shell <span class="token number">1</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token comment"># cat scdict.py </span>
<span class="token comment">#!/usr/bin/python3</span>

<span class="token comment">#定义一个字典</span>
stu_info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"gaohui"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">"hobby"</span><span class="token punctuation">:</span><span class="token string">"read_book"</span><span class="token punctuation">,</span><span class="token string">"skills"</span><span class="token punctuation">:</span><span class="token string">"Linux python"</span><span class="token punctuation">}</span>

<span class="token comment">#打印所有的key和value</span>
<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> stu_info<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@gh<span class="token operator">-</span>shell <span class="token number">1</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> 
<h4><a id="_264"></a>小练习</h4> 
<p><img src="https://images2.imgbox.com/a0/ad/OcQJKMlH_o.png" alt="image-20240121181730676"></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> top_up.txt<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR&gt;1{top_name[$1]+=$2}END{for (i in top_name) print i,top_name[i]}'</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k</span> <span class="token number">2</span> <span class="token parameter variable">-nr</span>
fei <span class="token number">1329</span>
gao <span class="token number">650</span>
jiang <span class="token number">450</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> top_up.txt 
username	money
gao			<span class="token number">100</span>
gao			<span class="token number">200</span>
gao			<span class="token number">350</span>
fei			<span class="token number">200</span>
fei			<span class="token number">239</span>
fei			<span class="token number">890</span>
jiang		<span class="token number">100</span>
jiang		<span class="token number">350</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h4><a id="2_289"></a>练习2</h4> 
<blockquote> 
 <p>已知一台服务器 nestat –an 输出，用IP简单的正则匹配上面出现的所有的IP</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">netstat</span> -antplu<span class="token operator">|</span><span class="token function">egrep</span> <span class="token parameter variable">-o</span> <span class="token string">"([0-9]{1,3}\.){3}[0-9]{1,3}"</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span>
<span class="token number">0.0</span>.0.0
<span class="token number">127.0</span>.0.1
<span class="token number">192.168</span>.153.1
<span class="token number">192.168</span>.153.165
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">netstat</span> -antplu<span class="token operator">|</span><span class="token function">egrep</span> <span class="token string">"([0-9]{1,3}\.){3}[0-9]{1,3}"</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1109</span>/sshd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:25            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1333</span>/master         
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">192.168</span>.153.165:22      <span class="token number">192.168</span>.153.1:49935     ESTABLISHED <span class="token number">2133</span>/sshd: root@pts 
tcp        <span class="token number">0</span>     <span class="token number">36</span> <span class="token number">192.168</span>.153.165:22      <span class="token number">192.168</span>.153.1:49930     ESTABLISHED <span class="token number">2109</span>/sshd: root@pts 
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:323           <span class="token number">0.0</span>.0.0:*                           <span class="token number">745</span>/chronyd         
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> 
<h4><a id="split_309"></a>split切割函数</h4> 
<p><img src="https://images2.imgbox.com/46/77/kpoMoBRO_o.png" alt="image-20240122102506772"></p> 
<p><img src="https://images2.imgbox.com/ae/d1/RSgTtGts_o.png" alt="image-20240122104256854"></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">netstat</span> -antplu<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR&gt;2 &amp;&amp; /tcp/{s[$6] += 1}END{for (i in s) print i,s[i]}'</span>
LISTEN <span class="token number">4</span>
ESTABLISHED <span class="token number">2</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<h4><a id="substr_322"></a>substr函数—&gt;切片</h4> 
<p><mark>从一段字符串里截取</mark></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token builtin class-name">echo</span> <span class="token string">"fengdeyong|sanchaung|changsha"</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">"|"</span> <span class="token string">'{print substr($1,1,6)}'</span>
fengde
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token builtin class-name">echo</span> <span class="token string">"fengdeyong|sanchaung|changsha"</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">"|"</span> <span class="token string">'{print substr($1,5,10)}'</span>
deyong
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<p><code>substr($1,1,6)</code></p> 
<blockquote> 
 <p>1表示从第一个字符开始</p> 
 <p>6表示取6个字符</p> 
</blockquote> 
<h3><a id="_343"></a>难题</h3> 
<pre><code class="prism language-shell">以下是nginx日志的字段含义
<span class="token variable">$time_iso8601</span><span class="token operator">|</span><span class="token variable">$host</span><span class="token operator">|</span><span class="token variable">$http_cf_connecting_ip</span><span class="token operator">|</span><span class="token variable">$request</span><span class="token operator">|</span><span class="token variable">$status</span><span class="token operator">|</span><span class="token variable">$body_bytes_sent</span><span class="token operator">|</span><span class="token variable">$http_referer</span><span class="token operator">|</span><span class="token variable">$http_user_agent</span>
-------------------------------------
<span class="token number">2019</span>-04-25T09:51:58+08:00<span class="token operator">|</span>a.google.com<span class="token operator">|</span><span class="token number">47.52</span>.197.27<span class="token operator">|</span>GET /v2/depth?symbol<span class="token operator">=</span>aaa HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">24</span><span class="token operator">|</span>-<span class="token operator">|</span>apple
<span class="token number">2019</span>-04-25T09:52:58+08:00<span class="token operator">|</span>b.google.com<span class="token operator">|</span><span class="token number">47.75</span>.159.123<span class="token operator">|</span>GET /v2/depth?symbol<span class="token operator">=</span>bbb HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">407</span><span class="token operator">|</span>-<span class="token operator">|</span>python-requests/2.20.0
<span class="token number">2019</span>-04-25T09:53:58+08:00<span class="token operator">|</span>c.google.com<span class="token operator">|</span><span class="token number">13.125</span>.219.4<span class="token operator">|</span>GET /v2/ticker?timestamp<span class="token operator">=</span><span class="token number">1556157118</span><span class="token operator">&amp;</span><span class="token assign-left variable">symbol</span><span class="token operator">=</span>ccc HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">162</span><span class="token operator">|</span>-<span class="token operator">|</span>chrome
<span class="token number">2019</span>-04-25T09:54:58+08:00<span class="token operator">|</span>d.shuzibi.co<span class="token operator">|</span>-<span class="token operator">||</span>HEAD /justfor.txt HTTP/1.0<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">0</span><span class="token operator">|</span>-<span class="token operator">|</span>-
<span class="token number">2019</span>-04-25T09:55:58+08:00<span class="token operator">|</span>e.google.com<span class="token operator">|</span><span class="token number">13.251</span>.98.2<span class="token operator">|</span>GET /v2/order_detail?apiKey<span class="token operator">=</span>ddd HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">231</span><span class="token operator">|</span>-<span class="token operator">|</span>python-requests/2.18.4
<span class="token number">2019</span>-04-25T09:56:58+08:00<span class="token operator">|</span>f.google.com<span class="token operator">|</span><span class="token number">210.3</span>.168.106<span class="token operator">|</span>GET /v2/trade_detail?apiKey<span class="token operator">=</span>eee HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">24</span><span class="token operator">|</span>-<span class="token operator">|</span>-
<span class="token number">2019</span>-04-25T09:57:58+08:00<span class="token operator">|</span>g.google.com<span class="token operator">|</span><span class="token number">47.75</span>.115.217<span class="token operator">|</span>GET /v2/depth?symbol<span class="token operator">=</span>fff HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">397</span><span class="token operator">|</span>-<span class="token operator">|</span>python-requests/2.18.4
<span class="token number">2019</span>-04-25T09:58:58+08:00<span class="token operator">|</span>h.google.com<span class="token operator">|</span><span class="token number">47.75</span>.58.56<span class="token operator">|</span>GET /v2/depth?symbol<span class="token operator">=</span>ggg HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">404</span><span class="token operator">|</span>-<span class="token operator">|</span>safari
<span class="token number">2019</span>-04-25T09:59:58+08:00<span class="token operator">|</span>i.google.com<span class="token operator">|</span><span class="token number">188.40</span>.137.175<span class="token operator">|</span>GET /v2/trade_detail?symbol<span class="token operator">=</span>hhh HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">6644</span><span class="token operator">|</span>-<span class="token operator">|</span>-
<span class="token number">2019</span>-04-25T10:01:58+08:00<span class="token operator">|</span>j.google.com<span class="token operator">|</span><span class="token number">2600</span>:3c01:0:0:f03c:91ff:fe60:49b8<span class="token operator">|</span>GET /v2/myposition?apiKey<span class="token operator">=</span>jjj HTTP/1.1<span class="token operator">|</span><span class="token number">200</span><span class="token operator">|</span><span class="token number">110</span><span class="token operator">|</span>-<span class="token operator">|</span>scan
</code></pre> 
<p><strong>1、 计算每分钟的带宽（body_bytes_sent）</strong></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> nginx.txt<span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">"|"</span> <span class="token string">'NR&gt;1 {split($1,time,":|");print time[1]":"time[2],$(NF-2)}'</span>
<span class="token number">2019</span>-04-25T09:51 <span class="token number">24</span>
<span class="token number">2019</span>-04-25T09:52 <span class="token number">407</span>
<span class="token number">2019</span>-04-25T09:53 <span class="token number">162</span>
<span class="token number">2019</span>-04-25T09:54 <span class="token number">0</span>
<span class="token number">2019</span>-04-25T09:55 <span class="token number">231</span>
<span class="token number">2019</span>-04-25T09:56 <span class="token number">24</span>
<span class="token number">2019</span>-04-25T09:57 <span class="token number">397</span>
<span class="token number">2019</span>-04-25T09:58 <span class="token number">404</span>
<span class="token number">2019</span>-04-25T09:59 <span class="token number">6644</span>
<span class="token number">2019</span>-04-25T10:01 <span class="token number">110</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> 
<p><strong>2、 统计每个URI（即不带问号?后面的内容）的每分钟的频率</strong></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> nginx.txt<span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">"[|?]"</span> <span class="token string">'NR&gt;1{t[substr($1,1,16)$4]+=1}END{for (i in t) print i,t[i]}'</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k3</span> <span class="token parameter variable">-nr</span>
<span class="token number">2019</span>-04-25T10:01GET /v2/myposition <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:59GET /v2/trade_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:58GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:57GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:56GET /v2/trade_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:55GET /v2/order_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:53GET /v2/ticker <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:52GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:51GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:54 <span class="token number">1</span>

<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span> <span class="token function">cat</span> nginx.txt <span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">"[|?]"</span>  <span class="token string">'NR&gt;1{t[substr($1,1,16)$4]+=1}END{for (i in t) print i,t[i]}'</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k3</span> <span class="token parameter variable">-nr</span>
<span class="token number">2019</span>-04-25T10:01GET /v2/myposition <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:59GET /v2/trade_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:58GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:57GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:56GET /v2/trade_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:55GET /v2/order_detail <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:53GET /v2/ticker <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:52GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:51GET /v2/depth <span class="token number">1</span>
<span class="token number">2019</span>-04-25T09:54 <span class="token number">1</span>
<span class="token punctuation">[</span>root@gh-shell <span class="token number">1</span>-21<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ae601f5c475590c4b73097603df7ece/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java线程池ThreadPoolExecutor的拒绝策略RejectedExecutionHandler</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fec0588c375ddea416f58af07e3b1b38/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kafka-消费者-KafkaConsumer分析总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>