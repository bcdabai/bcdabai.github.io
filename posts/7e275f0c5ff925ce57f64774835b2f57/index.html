<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C语言使用xml2库解析xml文件 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C语言使用xml2库解析xml文件" />
<meta property="og:description" content="xml2库的下载编译：
源码下载地址：Releases · GNOME / libxml2 · GitLab
编译：
./autogen.sh make 注：编译过程中，可能会依赖一些安装包，根据提示进行安装。
解析完整代码：
#include &lt;stdio.h&gt; #include &lt;assert.h&gt; #include &lt;string.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;fcntl.h&gt; #include &lt;libxml/xmlmemory.h&gt; #include &lt;libxml/parser.h&gt; #define DEFAULT_XML_FILE &#34;test.xml&#34; #define spc(level) PrintSpace(level) struct st_version_info { char name[16]; char version[16]; }; struct st_image_info { char image_name[16]; char image_partion[16]; unsigned int image_crc32; }; struct st_update_info { int image_type; struct st_image_info *imageinfo; }; char project_info[32]; struct st_version_info version_ifno[5]; struct st_update_info soc_update_info; struct st_update_info mcu_update_info; //输出缩进用的空格（4个） void PrintSpace(int level) { for(int counter = 0; counter &lt; level; counter&#43;&#43;) { printf(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/7e275f0c5ff925ce57f64774835b2f57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-31T09:20:28+08:00" />
<meta property="article:modified_time" content="2022-10-31T09:20:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C语言使用xml2库解析xml文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>xml2库的下载编译：</p> 
<p>源码下载地址：<a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases" rel="nofollow" title="Releases · GNOME / libxml2 · GitLab">Releases · GNOME / libxml2 · GitLab</a></p> 
<p>编译：</p> 
<pre><code class="language-cpp">./autogen.sh
make</code></pre> 
<p>注：编译过程中，可能会依赖一些安装包，根据提示进行安装。</p> 
<p>解析完整代码：</p> 
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;assert.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
 
#include &lt;libxml/xmlmemory.h&gt;
#include &lt;libxml/parser.h&gt;

#define DEFAULT_XML_FILE "test.xml"
#define spc(level) PrintSpace(level)

struct st_version_info
{
	char name[16];
	char version[16];
};


struct st_image_info
{
	char image_name[16];
	char image_partion[16];
	unsigned int image_crc32;
};

struct st_update_info
{
	int image_type;
	struct st_image_info *imageinfo;
};

char project_info[32];
struct st_version_info version_ifno[5];
struct st_update_info soc_update_info;
struct st_update_info mcu_update_info;



//输出缩进用的空格（4个）
void PrintSpace(int level)
{
    for(int counter = 0; counter &lt; level; counter++)
    {
        printf("    ");
    }
}

static int parse_project(xmlNodePtr cur_p, char *project_info)
{
    xmlNodePtr cur;  //xml节点//获取树形结构
    xmlChar *project;
	
    cur = cur_p-&gt;xmlChildrenNode;
    while(cur)
    {
    	if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"project"))
    	{
    		project = xmlGetProp(cur, "name");
    		printf("project name:%s\n", project);
    	}
    	cur = cur-&gt;next;
    }
	return 0;
}

static int parse_version_list(xmlNodePtr cur_p)
{
    xmlNodePtr cur;  //xml节点//获取树形结构
    xmlChar *name;
    xmlChar *version;
	
    cur = cur_p-&gt;xmlChildrenNode;
    while(cur)
    {
    	if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"version"))
    	{
    		name = xmlGetProp(cur, "name");
    		printf("name:%s	", name);
    		version = xmlGetProp(cur, "version");
    		printf("version:%s	\n", version);
    	}
    	cur = cur-&gt;next;
    }
	return 0;
}

static int parse_soc(xmlNodePtr cur_p)
{
    xmlNodePtr cur;  //xml节点//获取树形结构
    xmlNodePtr cur_child;  //xml节点//获取树形结构
    xmlChar *type;
    xmlChar *crc32;
    xmlChar *filename;
    xmlChar *partition;
    xmlChar *sha256;
	
    cur = cur_p-&gt;xmlChildrenNode;
    
    while(cur)
    {
    	if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"install"))
    	{
    		type = xmlGetProp(cur, "type");
    		printf("type:%s	\n", type);
    	}
    	else if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"FILE_LIST"))
    	{
    		cur_child = cur-&gt;xmlChildrenNode;
    		while(cur_child)
    		{
    			if(!xmlStrcmp(cur_child-&gt;name, (const xmlChar *)"fileinfo"))
    			{
    				crc32 = xmlGetProp(cur_child, "crc32");
    				printf("crc32:%s  ", crc32);
    				filename = xmlGetProp(cur_child, "filename");
    				printf("filename:%s  ", filename);
    				partition = xmlGetProp(cur_child, "partition");
    				printf("partition:%s  ", partition);
    				sha256 = xmlGetProp(cur_child, "sha256");
    				printf("sha256:%s  \n", sha256);
    			}
    			cur_child = cur_child-&gt;next;
    		}
    	}
    	cur = cur-&gt;next;
    }
	return 0;
}

static int parse_mcu(xmlNodePtr cur_p)
{
    xmlNodePtr cur;  //xml节点//获取树形结构
    xmlNodePtr cur_child;  //xml节点//获取树形结构
    xmlChar *type;
    xmlChar *crc32;
    xmlChar *filename;
    xmlChar *partition;
    xmlChar *sha256;
	
    cur = cur_p-&gt;xmlChildrenNode;
    
    while(cur)
    {
    	if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"install"))
    	{
    		type = xmlGetProp(cur, "type");
    		printf("type:%s	\n", type);
    	}
    	else if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"FILE_LIST"))
    	{
    		cur_child = cur-&gt;xmlChildrenNode;
    		while(cur_child)
    		{
    			if(!xmlStrcmp(cur_child-&gt;name, (const xmlChar *)"fileinfo"))
    			{
    				crc32 = xmlGetProp(cur_child, "crc32");
    				printf("crc32:%s  ", crc32);
    				filename = xmlGetProp(cur_child, "filename");
    				printf("filename:%s  ", filename);
    				partition = xmlGetProp(cur_child, "partition");
    				printf("partition:%s  ", partition);
    				sha256 = xmlGetProp(cur_child, "sha256");
    				printf("sha256:%s  \n", sha256);
    			}
    			cur_child = cur_child-&gt;next;
    		}
    	}
    	cur = cur-&gt;next;
    }
	return 0;
}

static int parse_xml(const char *file_name)
{	
    assert(file_name);
    
    xmlDocPtr doc;   //xml整个文档的树形结构
    xmlNodePtr cur;  //xml节点//获取树形结构
    
    doc = xmlParseFile(file_name);
    if (doc == NULL) 
    {
		fprintf(stderr, "Failed to parse xml file:%s\n", file_name);
		return -1;
    }
    
    //获取根节点
    cur = xmlDocGetRootElement(doc);
    if (cur == NULL) 
    {
		fprintf(stderr, "Root is empty.\n");
		return -1;
    }
    
    if ((xmlStrcmp(cur-&gt;name, (const xmlChar *)"update"))) 
    {
		fprintf(stderr, "The root is not update.\n");
		return -1;
    }
    
    printf("cur-&gt;name:%s \n", cur-&gt;name);
    
    //遍历处理根节点的每一个子节点
    cur = cur-&gt;xmlChildrenNode;
    

    while(cur)
    {
    	if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"project"))
    	{
    		parse_project(cur, project_info);
    	}
    	else if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"version_list"))
    	{
    		parse_version_list(cur);
    	}
    	else if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"v9156_ms_emmc"))
    	{
    		parse_soc(cur);
    	}
    	else if(!xmlStrcmp(cur-&gt;name, (const xmlChar *)"v9156_ms_ospi"))
    	{
    		parse_mcu(cur);
    	}
    
    	cur = cur-&gt;next;
    }
    
	
	return 0;
}

int main(int argc, char*argv[])
{
	int fd = 0;
	char *buff = "04df9308";
	struct stat filestat;
	unsigned int value = 0;
	sscanf(buff, "%x", &amp;value);
	printf("value=%.8x\n", value);
    char *xml_file = DEFAULT_XML_FILE;
 
    if (argc == 2) 
	{
    	xml_file = argv[1];
    }
    
    if(stat(xml_file, &amp;filestat) &lt; 0)
    {
    	printf("stat %s fail.\n", xml_file);
    	return -1;    
    }
#if 0    
    fd = open(xml_file, O_RDWR);
    if(fd &lt; 0)
    {
    	printf("open %s fail.\n", xml_file);
    	return -1;
    }
    
    ftruncate(xml_file, filestat.st_size-1024);
    close(fd);
    sync();
#else
//	truncate(xml_file, filestat.st_size-1024);
//    sync();
#endif 
    if (parse_xml(xml_file) != 0) 
    {
		fprintf(stderr, "Failed to parse phone book.\n");
		return -1;
    }
 
    return 0;
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a22d1195b520b08f7dc1edb8ee79839c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows子系统for Linux Ubuntu安装位置转移</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0449b1d34d949ea46118e46757469c0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CE-RTI开源软件代码学习笔记（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>