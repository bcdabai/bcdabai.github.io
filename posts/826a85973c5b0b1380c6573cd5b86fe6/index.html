<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Prometheus 采集snmp监控数据 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Prometheus 采集snmp监控数据" />
<meta property="og:description" content="前言snmp_exporter snmp_exporter是一个用于收集SNMP（Simple Network Management Protocol）设备指标的开源软件，它是Prometheus生态系统中的一个组件。SNMP是一种用于网络设备监控和管理的协议，通过查询和获取设备的各种信息来提供实时的状态和性能数据。
snmp_exporter充当一个代理，运行在需要被监控的SNMP设备（如路由器、交换机、防火墙等）的旁边。它会定期向这些设备发送SNMP请求，获取特定的OID（Object Identifier）值，并将其转换为Prometheus可读的指标数据。
snmp_exporter可以提供各种与SNMP设备相关的指标，如接口流量、CPU利用率、内存使用情况、链路状态、错误计数等。这些指标可以帮助管理员了解设备的运行状况、网络流量情况和性能指标，并及时做出反应。
通过将snmp_exporter与Prometheus结合使用，管理员可以定期从snmp_exporter暴露的HTTP或HTTPS端点获取SNMP设备的指标数据，并将其存储、分析和可视化。使用Prometheus的查询语言，用户可以构建自定义的监控规则和警报条件，以便快速检测和响应设备问题。
download snmp_exporter snmp_exporter采集数据 snmp_exporter 一键监控安装脚本 /opt/snmp_exporter 目录位置 端口9116配置文件/opt/snmp_exporter/snmp.yml vim /snmp_exporter.sh #!/bin/bash # -*- coding: utf-8 -*- # Author: make.han # Email: CIASM@CIASM # Date: 2024/01/17 OPT_CATALOGUE=/opt SNMP_EXPORTER_PREFIX=/opt/snmp_exporter SNMP_EXPORTER_URL=https://github.com/prometheus/snmp_exporter/releases/download/v0.25.0/snmp_exporter-0.25.0.linux-amd64.tar.gz SNMP_EXPORTER_GZ=snmp_exporter-0.25.0.linux-amd64.tar.gz SNMP_EXPORTER_DIRECTORY=snmp_exporter-0.25.0.linux-amd64 SNMP_EXPORTER_NEW=snmp_exporter SNMP_EXPORTER_PORT=9116 install_snmp_exporter (){ if [ ! -d ${SNMP_EXPORTER_PREFIX} ];then # selinux stop setenforce 0 sed -i &#39;s/SELINUX=enforcing/SELINUX=disabled/&#39; /etc/selinux/config if [ $? -eq 0 ];then echo &#34;download snmp_exporter&#34; curl -o $OPT_CATALOGUE/$SNMP_EXPORTER_GZ $SNMP_EXPORTER_URL echo &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/826a85973c5b0b1380c6573cd5b86fe6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-25T17:45:35+08:00" />
<meta property="article:modified_time" content="2024-01-25T17:45:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Prometheus 采集snmp监控数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> <img alt="" height="89" src="https://images2.imgbox.com/8e/d5/hvmypJl2_o.png" width="236"><img alt="" class="left" height="187" src="https://images2.imgbox.com/5e/71/HndUSk5Z_o.png" width="186"></p> 
<p></p> 
<h2>前言snmp_exporter</h2> 
<p>snmp_exporter是一个用于收集SNMP（Simple Network Management Protocol）设备指标的开源软件，它是Prometheus生态系统中的一个组件。SNMP是一种用于网络设备监控和管理的协议，通过查询和获取设备的各种信息来提供实时的状态和性能数据。</p> 
<p>snmp_exporter充当一个代理，运行在需要被监控的SNMP设备（如路由器、交换机、防火墙等）的旁边。它会定期向这些设备发送SNMP请求，获取特定的OID（Object Identifier）值，并将其转换为Prometheus可读的指标数据。</p> 
<p>snmp_exporter可以提供各种与SNMP设备相关的指标，如接口流量、CPU利用率、内存使用情况、链路状态、错误计数等。这些指标可以帮助管理员了解设备的运行状况、网络流量情况和性能指标，并及时做出反应。</p> 
<p>通过将snmp_exporter与Prometheus结合使用，管理员可以定期从snmp_exporter暴露的HTTP或HTTPS端点获取SNMP设备的指标数据，并将其存储、分析和可视化。使用Prometheus的查询语言，用户可以构建自定义的监控规则和警报条件，以便快速检测和响应设备问题。</p> 
<h3>download  snmp_exporter</h3> 
<ul><li> <a class="link-info" href="https://github.com/prometheus/snmp_exporter/releases/tag/v0.20.0" title="snmp_exporter">snmp_exporter</a>采集数据</li></ul> 
<h3>snmp_exporter 一键监控安装脚本</h3> 
<ul><li>/opt/snmp_exporter 目录位置 </li><li>端口9116</li><li>配置文件/opt/snmp_exporter/snmp.yml</li></ul> 
<pre><code>vim /snmp_exporter.sh</code></pre> 
<pre><code>#!/bin/bash
# -*- coding: utf-8 -*-
# Author: make.han 
# Email: CIASM@CIASM
# Date: 2024/01/17

OPT_CATALOGUE=/opt
SNMP_EXPORTER_PREFIX=/opt/snmp_exporter
SNMP_EXPORTER_URL=https://github.com/prometheus/snmp_exporter/releases/download/v0.25.0/snmp_exporter-0.25.0.linux-amd64.tar.gz
SNMP_EXPORTER_GZ=snmp_exporter-0.25.0.linux-amd64.tar.gz
SNMP_EXPORTER_DIRECTORY=snmp_exporter-0.25.0.linux-amd64
SNMP_EXPORTER_NEW=snmp_exporter
SNMP_EXPORTER_PORT=9116

install_snmp_exporter (){
if [ ! -d ${SNMP_EXPORTER_PREFIX} ];then

# selinux stop
setenforce 0
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

 if [ $? -eq 0 ];then

echo "download snmp_exporter"
curl -o $OPT_CATALOGUE/$SNMP_EXPORTER_GZ $SNMP_EXPORTER_URL

echo "decompression snmp_exporter"
tar -zxf $OPT_CATALOGUE/$SNMP_EXPORTER_GZ -C $OPT_CATALOGUE

echo "rechristen snmp_exporter"
mv $OPT_CATALOGUE/$SNMP_EXPORTER_DIRECTORY $SNMP_EXPORTER_PREFIX

echo "firewall snmp_exporter port"
firewall-cmd --zone=public --add-port=$SNMP_EXPORTER_PORT/tcp --permanent &amp;&amp; firewall-cmd --reload 

echo "services scenarios snmp_exporter"
cat &lt;&lt;'EOF'&gt;&gt;/usr/lib/systemd/system/snmp_exporter.service
[Unit]
Description=snmp_exporter
Documentation=https://github.com/prometheus/snmp_exporter
After=network.target
 
[Service]
ExecStart=/opt/snmp_exporter/snmp_exporter \
  --config.file=/opt/snmp_exporter/snmp.yml \
  --web.listen-address=:9116
Restart=on-failure
 
[Install]
WantedBy=multi-user.target
EOF

echo "start snmp_exporter"
systemctl daemon-reload
systemctl enable --now snmp_exporter

echo "delete snmp_exporter"
rm -rf $OPT_CATALOGUE/$SNMP_EXPORTER_GZ

    echo -e "\033[32mThe snmp_exporter Install Sussess...\033[0m" 
   else
    echo -e "\033[33mThe snmp_exporter Install Failed...\033[0m" 
    exit 1
   fi
   else
    echo -e "\033[31mThe snmp_exporter Install already...\033[0m"
fi
}

main (){
	install_snmp_exporter
}
 
main</code></pre> 
<h4>执行安装</h4> 
<pre><code>bash /snmp_exporter.sh</code></pre> 
<h3>替换snmp.yml内容信息</h3> 
<ul><li>/opt/snmp_exporter 目录位置</li><li>内容信息第一行就是，替换或者更改即可</li><li>public_v1 认证模式</li><li>community：snmp的认证密码</li></ul> 
<pre><code>auths:
  public_v1:
    community: 1234.com
    version: 1
  public_v2:
    community: 1234.com
    version: 2</code></pre> 
<h4> 重启服务</h4> 
<pre><code>systemctl restart snmp_exporter</code></pre> 
<h3><strong>查看采集情况</strong> </h3> 
<pre><code>curl 'http://YOU_snmp_exporter_IP:9116/snmp?module=if_mib&amp;target=YOU_SW_IP'</code></pre> 
<h3>查看是否可以看到数据 </h3> 
<ul><li>http://YOU_snmp_exporter_ip:9116</li><li>Target #是交换机IP</li><li>Module #是你的snmp.yml 配置文件内部定义的名称</li><li>Auth # 认证版本</li><li><a href="http://192.168.11.98:9116/snmp?target=192.168.14.2&amp;auth=public_v2&amp;module=if_mib" rel="nofollow" title="http://192.168.11.98:9116/snmp?target=192.168.14.2&amp;auth=public_v2&amp;module=if_mib">http://192.168.11.98:9116/snmp?target=192.168.14.2&amp;auth=public_v2&amp;module=if_mib</a></li></ul> 
<p><img alt="" height="432" src="https://images2.imgbox.com/6a/5e/QtctzRdZ_o.png" width="1200"></p> 
<p><img alt="" height="490" src="https://images2.imgbox.com/93/f8/qc50k1gM_o.png" width="1200"></p> 
<h3>Prometheus 配置文件配置</h3> 
<ul><li>prometheus.yml</li><li>replacement 是snmp_exporter地址和端口</li></ul> 
<pre><code>  - job_name: 'snmp_exporter'
    scrape_interval: 30s
    scrape_timeout: 30s
    static_configs:
      - targets: 
        - 192.168.14.2
        - 192.168.14.1
    metrics_path: /snmp
    params:
      module: [if_mib] 
    relabel_configs:
    - source_labels: [__address__]
      target_label: __param_target
    - source_labels: [__param_target]
      target_label: instance
    - target_label: __address__
      replacement: 192.168.11.98:9116</code></pre> 
<p><img alt="" height="117" src="https://images2.imgbox.com/4a/97/5sfFOaIY_o.png" width="1200"></p> 
<h3><strong>Grafana 图像展示</strong></h3> 
<h4>Import&gt;11169&gt;Prometheus</h4> 
<ul><li>模板<a class="link-info" href="https://grafana.com/grafana/dashboards/11169-snmp-stats/" rel="nofollow" title="下载">下载</a></li></ul> 
<p><img alt="" height="963" src="https://images2.imgbox.com/9f/c0/OoXttFg3_o.png" width="1200"></p> 
<h4>Import&gt;11169&gt;Prometheus  新版本图形显示比较完整，建议使用新版本</h4> 
<ul><li> 模板<a class="link-info" href="https://grafana.com/grafana/dashboards/11169-snmp-stats/" rel="nofollow" title="下载">下载</a></li><li>grafana 版本最大要求7.3.4</li></ul> 
<p><img alt="" height="963" src="https://images2.imgbox.com/0e/ae/PquP93pu_o.png" width="1200"></p> 
<p>Import&gt;20347&gt;Prometheus  新版本图形显示比较完整，建议使用新版本</p> 
<ul><li>Grafana 10.2.3 要求</li><li>模板<a class="link-info" href="https://grafana.com/grafana/dashboards/20347-snmp-device/" rel="nofollow" title="地址">地址</a></li></ul> 
<p><img alt="" height="920" src="https://images2.imgbox.com/a9/f8/gUhzfJPY_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0da9b756131e50e5ca1fe67a16bb4584/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言常见面试题：什么是函数指针，函数指针的作用是什么？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3279768feeac49b924a54853789ba47f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大创项目推荐 题目：垃圾邮件(短信)分类 算法实现 机器学习 深度学习 开题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>