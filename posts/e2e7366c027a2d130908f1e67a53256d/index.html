<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MTK开发之—开机永不灭屏 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MTK开发之—开机永不灭屏" />
<meta property="og:description" content="步骤一：修改配置文件 文件路径：/frameworks/base/packages/SettingsProvider/res/values/defaults.xml
说明一下：def_screen_off_timeout这个参数是默认上电后关闭屏幕时间，单位是ms，600000就是10分钟，对应的就是10 minutes， 改为0就是不休眠，在packages/apps/Settings/res/values/arrays.xml文件中有一一对应的关系
&lt;integer name=&#34;def_screen_off_timeout&#34;&gt;600000&lt;/integer&gt;修改为： &lt;integer name=&#34;def_screen_off_timeout&#34;&gt;0&lt;/integer&gt; 步骤二：检查配置选项 文件路径：/packages/apps/Settings/res/values/arrays.xml
如下所示，当我们将步骤一中的def_screen_off_timeout设置为0时，对应的是screen_timeout_values下的值，最后对应的就是screen_timeout_entries下的never，意思就是永不休眠
&lt;!-- Display settings. The delay in inactivity before the screen is turned off. These are shown in a list dialog. --&gt; &lt;string-array name=&#34;screen_timeout_entries&#34;&gt; &lt;item&gt;15 seconds&lt;/item&gt; &lt;item&gt;30 seconds&lt;/item&gt; &lt;item&gt;1 minute&lt;/item&gt; &lt;item&gt;2 minutes&lt;/item&gt; &lt;item&gt;5 minutes&lt;/item&gt; &lt;item&gt;10 minutes&lt;/item&gt; &lt;item&gt;30 minutes&lt;/item&gt; &lt;item&gt;never&lt;/item&gt; &lt;/string-array&gt; &lt;!-- Do not translate. --&gt; &lt;string-array name=&#34;screen_timeout_values&#34; translatable=&#34;false&#34;&gt; &lt;!-- Do not translate. --&gt; &lt;item&gt;15000&lt;/item&gt; &lt;!-- Do not translate. --&gt; &lt;item&gt;30000&lt;/item&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e2e7366c027a2d130908f1e67a53256d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-20T13:52:58+08:00" />
<meta property="article:modified_time" content="2021-04-20T13:52:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MTK开发之—开机永不灭屏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>步骤一：修改配置文件</h2> 
<p>文件路径：/frameworks/base/packages/SettingsProvider/res/values/defaults.xml</p> 
<p>说明一下：def_screen_off_timeout这个参数是默认上电后关闭屏幕时间，单位是ms，600000就是10分钟，对应的就是10 minutes， 改为0就是不休眠，在packages/apps/Settings/res/values/arrays.xml文件中有一一对应的关系</p> 
<pre><code class="prism language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>def_screen_off_timeout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>600000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>integer</span><span class="token punctuation">&gt;</span></span>修改为：
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>def_screen_off_timeout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>integer</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_9"></a>步骤二：检查配置选项</h2> 
<p>文件路径：/packages/apps/Settings/res/values/arrays.xml</p> 
<p>如下所示，当我们将步骤一中的def_screen_off_timeout设置为0时，对应的是screen_timeout_values下的值，最后对应的就是screen_timeout_entries下的never，意思就是永不休眠</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- Display settings.  The delay in inactivity before the screen is turned off. These are shown in a list dialog. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen_timeout_entries<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>15 seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>30 seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>1 minute<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>2 minutes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>5 minutes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>10 minutes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>30 minutes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>never<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>screen_timeout_values<span class="token punctuation">"</span></span> <span class="token attr-name">translatable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>15000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>30000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>60000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>120000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>300000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>600000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>1800000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Do not translate. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_48"></a>步骤三：代码修改</h2> 
<p>文件路径：/frameworks/base/services/core/java/com/android/server/power/PowerManagerService.java</p> 
<p>修改getScreenOffTimeoutLocked()函数为:</p> 
<pre><code class="prism language-c">private <span class="token keyword">int</span> <span class="token function">getScreenOffTimeoutLocked</span><span class="token punctuation">(</span>intsleepTimeout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> nosleep<span class="token punctuation">;</span>
		<span class="token keyword">int</span> timeout <span class="token operator">=</span> mScreenOffTimeoutSetting<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isMaximumScreenOffTimeoutFromDeviceAdminEnforcedLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            timeout <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span>mMaximumScreenOffTimeoutFromDeviceAdmin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mUserActivityTimeoutOverrideFromWindowManager <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            timeout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span>mUserActivityTimeoutOverrideFromWindowManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sleepTimeout <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            timeout <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span>sleepTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
       nosleep <span class="token operator">=</span> mScreenOffTimeoutSetting<span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>nosleep <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
       <span class="token punctuation">{<!-- --></span>
           nosleep <span class="token operator">=</span> mMaximumScreenOffTimeoutFromDeviceAdmin<span class="token punctuation">;</span>
           <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nosleep<span class="token punctuation">,</span>mMaximumScreenOffTimeoutFromDeviceAdmin<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span>mMinimumScreenOffTimeoutConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>参考:https://www.cnblogs.com/zxouxuewei/p/8127858.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c14d5ee060f1af83f2c1591a3b2d7499/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 查看mysql安装运行路径 my.cnf位置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91bd732a02536b60d89c40966880fdc2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【前端学习】网络知识基础（持更中）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>