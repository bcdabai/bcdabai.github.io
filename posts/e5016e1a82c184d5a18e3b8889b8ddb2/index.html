<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络编程(socket通信基础) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网络编程(socket通信基础)" />
<meta property="og:description" content="文章目录 一、socket 简介二、主机字节序与网络字节序三、网络编程中的结构体四、库函数1. socket()函数2. bind()函数3. listen()函数4. connect()函数5. accept()函数补：TCP三次握手与连接队列6. gethostbyname()函数7. send()函数8. recv()函数 五、TCP报文分包和粘包六、客户端和服务端程序客户端服务端 一、socket 简介 套接字，运行在计算机中的两个程序通过socket建立通道，数据在通道中传输。
1) 流socket：基于TCP协议，建立通道（主要）
2) 数据报socket：基于UDP协议，无需建立和维持连接，无通道(比较少)
流socket通信流程：
二、主机字节序与网络字节序 网络字节序： 采用大端字节排序(将高序字节存于起始位置)，网络间通信统一采用网络字节序。
主机字节序： 可能为小端字节排序(将低序字节存于起始位置)，需转化成网络字节序然后进行通信。
两者之间转换函数： htons() //host to network short s-&gt;短(16位)，同理其它函数htonl(),ntohs(),ntohl()。l-&gt;长(32位)
如图为小端转大端(32位)：
三、网络编程中的结构体 struct sockaddr{ //不常用结构体 unsigned short sa_family; //地址类型，AF_xxx IPv4 char sa_data[14]; //14字节供端口和地址使用 }; struct sockaddr_in{ //常用结构体 short int sin_family;	//地址类型 unsigned short int sin_port; //端口号(两字节) struct in_addr sin_addr; //地址(结构体) unsigned char sin_zero[8] //八字节，为了和struct sockaddr一样 2&#43;4&#43;8=14(方便两结构体强制类型转换) }; struct in_addr{ unsigned long s_addr; //地址(linux32位四字节,linux64位八字节，一般是四字节) }; 四、库函数 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/e5016e1a82c184d5a18e3b8889b8ddb2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-01T18:14:37+08:00" />
<meta property="article:modified_time" content="2023-02-01T18:14:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络编程(socket通信基础)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#socket__1" rel="nofollow">一、socket 简介</a></li><li><a href="#_10" rel="nofollow">二、主机字节序与网络字节序</a></li><li><a href="#_17" rel="nofollow">三、网络编程中的结构体</a></li><li><a href="#_38" rel="nofollow">四、库函数</a></li><li><ul><li><a href="#1_socket_39" rel="nofollow">1. socket()函数</a></li><li><a href="#2_bind_52" rel="nofollow">2. bind()函数</a></li><li><a href="#3_listen_66" rel="nofollow">3. listen()函数</a></li><li><a href="#4_connect_77" rel="nofollow">4. connect()函数</a></li><li><a href="#5_accept_91" rel="nofollow">5. accept()函数</a></li><li><a href="#TCP_107" rel="nofollow">补：TCP三次握手与连接队列</a></li><li><a href="#6_gethostbyname_113" rel="nofollow">6. gethostbyname()函数</a></li><li><a href="#7_send_124" rel="nofollow">7. send()函数</a></li><li><a href="#8_recv_146" rel="nofollow">8. recv()函数</a></li></ul> 
  </li><li><a href="#TCP_168" rel="nofollow">五、TCP报文分包和粘包</a></li><li><a href="#_187" rel="nofollow">六、客户端和服务端程序</a></li><li><ul><li><a href="#_188" rel="nofollow">客户端</a></li><li><a href="#_252" rel="nofollow">服务端</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="socket__1"></a>一、socket 简介</h2> 
<p>套接字，运行在计算机中的两个程序通过socket建立通道，数据在通道中传输。</p> 
<p> 1) 流socket：基于TCP协议，建立通道（主要）<br>  2) 数据报socket：基于UDP协议，无需建立和维持连接，无通道(比较少)</p> 
<p><strong>流socket通信流程：</strong></p> 
<p><img src="https://images2.imgbox.com/cf/15/LglOgV3G_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_10"></a>二、主机字节序与网络字节序</h2> 
<p><strong>网络字节序：</strong> 采用大端字节排序(将高序字节存于起始位置)，网络间通信统一采用网络字节序。<br> <strong>主机字节序：</strong> 可能为小端字节排序(将低序字节存于起始位置)，需转化成网络字节序然后进行通信。<br> <strong>两者之间转换函数：</strong> <code>htons() //host to network short</code> s-&gt;短(16位)，同理其它函数<code>htonl(),ntohs(),ntohl()</code>。l-&gt;长(32位)</p> 
<p>如图为小端转大端(32位)：<br> <img src="https://images2.imgbox.com/3b/78/pILfckG6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_17"></a>三、网络编程中的结构体</h2> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//不常用结构体</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> sa_family<span class="token punctuation">;</span>       <span class="token comment">//地址类型，AF_xxx  IPv4</span>
	<span class="token keyword">char</span> sa_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">//14字节供端口和地址使用</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//常用结构体</span>
	<span class="token keyword">short</span> <span class="token keyword">int</span> sin_family<span class="token punctuation">;</span>			<span class="token comment">//地址类型</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> sin_port<span class="token punctuation">;</span>    <span class="token comment">//端口号(两字节)</span>
	<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> sin_addr<span class="token punctuation">;</span>        <span class="token comment">//地址(结构体)</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>       <span class="token comment">//八字节，为了和struct sockaddr一样 2+4+8=14(方便两结构体强制类型转换)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">in_addr</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> s_addr<span class="token punctuation">;</span>          <span class="token comment">//地址(linux32位四字节,linux64位八字节，一般是四字节)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4a/e4/Ek8clWdk_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_38"></a>四、库函数</h2> 
<h3><a id="1_socket_39"></a>1. socket()函数</h3> 
<p>socket函数用于创建一个新的socket，也就是向系统申请一个socket资源。socket函数用户客户端和服务端。</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>domain：协议域，又称协议族(family)。一般IPv4用<code>AF_INET</code>；<br> type：指定socket类型。一般用流式socket：<code>SOCK_STREAM</code>；<br> protocol：指定协议。一般填<code>0</code>。<br> <strong>返回：</strong> 一个socket<br> <img src="https://images2.imgbox.com/09/d4/GjfO4WY1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_bind_52"></a>2. bind()函数</h3> 
<p>服务端把用于通信的地址和端口绑定到socket上。端口一般(1024~65535)</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span>socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数sockfd，需要绑定的socket；<br> 参数addr，存放了服务端用于通信的地址和端口(强制类型转换)；<br> 参数addrlen表示addr结构体的大小；<br> 如果绑定的地址错误，或端口已被占用，bind函数一定会报错，否则一般不会返回错误。<br> <strong>返回：</strong> 0──成功， -1──报错<br> <img src="https://images2.imgbox.com/bf/58/Om8I7ZTg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_listen_66"></a>3. listen()函数</h3> 
<p>listen函数把主动连接套接口变为被连接套接口，使得这个socket可以接受其它socket的连接请求，从而成为一个服务端的socket。</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> backlog<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>将一个主动的套接字(sockfd)变成一个被动的套接字。<em><strong>该套接字只用于监听(后续调用accept()生成新套接字用于信息传输)</strong></em><br> backlog参数：已完成三次握手的队列长度。一般填5、10都行，一般不超过30。<br> <strong>返回：</strong> 0──成功， -1──失败<br> <img src="https://images2.imgbox.com/96/19/KeFJL51k_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_connect_77"></a>4. connect()函数</h3> 
<p>客户端向服务器发起连接请求。<br> <em>connect函数只用于客户端。</em></p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"> <span class="token keyword">int</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span> serv_addr<span class="token punctuation">,</span> <span class="token keyword">int</span> addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>sockfd：客户端socket<br> serv_addr：服务端地址(结构体sockadd_in)，后续进行强制类型转换<br> addrlen：serv_addr结构体大小<br> <strong>返回：</strong> 0──成功， -1──失败<br> <img src="https://images2.imgbox.com/39/25/YSKeydqQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_accept_91"></a>5. accept()函数</h3> 
<p>服务端接受客户端的连接。</p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp">  <span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span>socklen_t <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>sockfd：是已经被listen过的套接字。<br> addr：客户端地址(结构体sockadd_in)，后续进行强制类型转换<br> addrlen：结构体sockadd_in长度的地址</p> 
<p>accept函数从已准备好的连接队列中获取一个请求，如果队列为空，accept函数将阻塞等待。</p> 
<p><strong>返回：</strong> accept等待到客户端的连接后，创建一个新的套接字，<strong>返回值</strong>就是这个新的套接字<br>    <em><strong>服务端使用这个新的套接字和客户端进行报文的收发。(来一个客户生成一个新套接字)</strong></em><br> <img src="https://images2.imgbox.com/fd/d7/NLxzKXwy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="TCP_107"></a>补：TCP三次握手与连接队列</h3> 
<p>在服务端listen后，客户端connect后，TCP底层(不需要代码实现)，客户端和服务端握手后建立起通信通道，若有多个客户端请求，在服务端会形成一个已准备好的<strong>连接队列</strong>。<br> 服务端收到第一次握手，处于<strong>半连接</strong>，生成<strong>半连接队列</strong>；<br> 服务端收到第三次握手，处于<strong>全连接</strong>，生成<strong>全连接队列</strong>。全连接队列大小有listen()函数的第二个参数决定。<br> 服务端调用accept()函数从队列获取连接并返回一个性的socket，用于与客户端通信。<br> <img src="https://images2.imgbox.com/a2/8e/yU1YDstt_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_gethostbyname_113"></a>6. gethostbyname()函数</h3> 
<p>把ip地址或域名转换为hostent 结构体表达的地址。<br> <em>gethostbyname只用于客户端。</em></p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数name：域名或者主机名，例如"192.168.1.3"、"www.google.com"等。<br> <strong>返回：</strong> 如果成功，返回一个hostent结构指针，失败返回NULL。<br> <img src="https://images2.imgbox.com/e3/12/mpw80QUs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_send_124"></a>7. send()函数</h3> 
<p>send函数用于把数据通过socket发送给对端。</p> 
<p><strong>包含头文件：</strong><br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;sys/socket.h&gt;</code></p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp">ssize_t <span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>sockfd：已建立好连接的socket<br> buf：需要发送的数据的内存地址<br> len：需要发送的数据的长度，为buf中有效数据的长度(小于等于buf长度)<br> flags：填0, 其他数值意义不大。<br> <strong>返回：</strong> 已发送的字节数，出错返回-1<br> 注：就算是网络断开，或socket已被对端关闭，send函数不会立即报错，要过几秒才会报错。<br> 如果send函数返回的错误（&lt;=0），表示通信<strong>链路已不可用</strong>。<br> <img src="https://images2.imgbox.com/2c/a0/kDoXeGgY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8_recv_146"></a>8. recv()函数</h3> 
<p>recv函数用于接收对端socket发送过来的数据。</p> 
<p><strong>包含头文件：</strong><br> <code>#include &lt;sys/types.h&gt;</code><br> <code>#include &lt;sys/socket.h&gt;</code></p> 
<p><strong>函数声明：</strong></p> 
<pre><code class="prism language-cpp">ssize_t <span class="token function">recv</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>sockfd：已建立好连接的socket<br> buf：用于接收的数据的内存地址<br> len：需要接收的数据的长度，为buf中有效数据的长度(小于等于buf长度，否则内存溢出)<br> flags：填0, 其他数值意义不大。<br> <strong>返回：</strong> 已接收的字节数，出错返回-1<br> 注：如果socket的对端没有发送数据，recv函数就会等待；如果socket被对端关闭，返回值为0。<br> 如果recv函数返回的错误（&lt;=0），表示通信链路已不可用。<br> <img src="https://images2.imgbox.com/ea/80/2dANG30M_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="TCP_168"></a>五、TCP报文分包和粘包</h2> 
<p>send()和recv()函数的第三个参数(需要发送/接收的数据的长度)设置不当，会导致分包粘包。</p> 
<p><strong>分包：</strong> 发送方发送字符串“helloworld”，接收方收到两个字符串“hello”和“world”。<br> <strong>粘包：</strong> 发送方发送两个字符串“hello”和“world”，接收方一次性接收到了“helloworld”。</p> 
<p><strong>发生 TCP 分包的原因:</strong></p> 
<ol><li>待发送数据大于最大报文长度，TCP 在传输前将进行分包</li><li>发送的数据大于 TCP 发送缓冲区剩余空间大小，将会发生分包。</li></ol> 
<p><strong>发生 TCP 粘包的原因:</strong></p> 
<ol><li>发送的数据小于 TCP 缓冲区大小，TCP 将缓冲区中的数据一次发送出去可能就会发生粘包。</li><li>接收数据端的应用层没有及时读取接收缓冲区中的数据，将发生粘包。</li></ol> 
<p><strong>解决方案:</strong></p> 
<ol><li>发送端给每个数据包添加包首部，首部中包含数据包的长度，这样接收端在接收到数据后，通过该字段就可以知道每个数据包的实际长度了。</li><li>发送端将每个数据包设置固定长度，这样接收端每次从读取固定长度的数据</li><li>把每个数据包拆分开.可以在数据包之间设置边界，如添加特殊符号，接收端可以通过这个特殊符号来拆分包。</li></ol> 
<h2><a id="_187"></a>六、客户端和服务端程序</h2> 
<h3><a id="_188"></a>客户端</h3> 
<pre><code class="prism language-cpp"><span class="token comment">/*
 * 程序名：client.cpp，此程序用于演示socket的客户端
 * 作者：C语言技术网(www.freecplus.net) 日期：20190525
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>argc<span class="token operator">!=</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Using:./client ip port\nExample:./client 127.0.0.1 5005\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 第1步：创建客户端的socket。</span>
  <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
  <span class="token comment">// 第2步：向服务器发起连接请求。</span>
  <span class="token keyword">struct</span> <span class="token class-name">hostent</span><span class="token operator">*</span> h<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>   <span class="token comment">// 指定服务端的ip地址。</span>
  <span class="token punctuation">{<!-- --></span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"gethostbyname failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> servaddr<span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  servaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
  servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指定服务端的通信端口。</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">,</span>h<span class="token operator">-&gt;</span>h_addr<span class="token punctuation">,</span>h<span class="token operator">-&gt;</span>h_length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 向服务端发起连接清求。</span>
  <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"connect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
  <span class="token comment">// 第3步：与服务端通信，发送一个报文后等待回复，然后再发下一个报文。</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> ii<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>ii<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>ii<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> iret<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"这是第%d个超级女生，编号%03d。"</span><span class="token punctuation">,</span>ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 向服务端发送请求报文。</span>
    <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"send"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"发送：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 接收服务端的回应报文。</span>
    <span class="token punctuation">{<!-- --></span>
       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"iret=%d\n"</span><span class="token punctuation">,</span>iret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"接收：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
  <span class="token comment">// 第4步：关闭socket，释放资源。</span>
  <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_252"></a>服务端</h3> 
<pre><code class="prism language-cpp"><span class="token comment">/*
 * 程序名：server.cpp，此程序用于演示socket通信的服务端
 * 作者：C语言技术网(www.freecplus.net) 日期：20190525
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>argc<span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Using:./server port\nExample:./server 5005\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 第1步：创建服务端的socket。</span>
  <span class="token keyword">int</span> listenfd<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>listenfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
  <span class="token comment">// 第2步：把服务端用于通信的地址和端口绑定到socket上。</span>
  <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> servaddr<span class="token punctuation">;</span>    <span class="token comment">// 服务端地址信息的数据结构。</span>
  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  servaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>  <span class="token comment">// 协议族，在socket编程中只能是AF_INET。</span>
  servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 任意ip地址。</span>
  <span class="token comment">//servaddr.sin_addr.s_addr = inet_addr("192.168.190.134"); // 指定ip地址。</span>
  servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 指定通信端口。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
  <span class="token comment">// 第3步：把socket设置为监听模式。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
  <span class="token comment">// 第4步：接受客户端的连接。</span>
  <span class="token keyword">int</span>  clientfd<span class="token punctuation">;</span>                  <span class="token comment">// 客户端的socket。</span>
  <span class="token keyword">int</span>  socklen<span class="token operator">=</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// struct sockaddr_in的大小</span>
  <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> clientaddr<span class="token punctuation">;</span>  <span class="token comment">// 客户端的地址信息。</span>
  clientfd<span class="token operator">=</span><span class="token function">accept</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>clientaddr<span class="token punctuation">,</span><span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"客户端（%s）已连接。\n"</span><span class="token punctuation">,</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span>clientaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token comment">// 第5步：与客户端通信，接收客户端发过来的报文后，回复ok。</span>
  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> iret<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">recv</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 接收客户端的请求报文。</span>
    <span class="token punctuation">{<!-- --></span>
       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"iret=%d\n"</span><span class="token punctuation">,</span>iret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"接收：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">strcpy</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">send</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 向客户端发送响应结果。</span>
    <span class="token punctuation">{<!-- --></span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"send"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"发送：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
  <span class="token comment">// 第6步：关闭socket，释放资源。</span>
  <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p> <br>  <br>  <br> 部分文字参考：<a href="https://blog.csdn.net/wucz122140729/article/details/98584138?spm=1001.2014.3001.5506">socket通信基础知识</a><br> 部分图片来源：<a href="https://www.bilibili.com/video/BV11Z4y157RY/?p=13&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=b80bf1f6fcfa1ebe62011236071197ff" rel="nofollow">码农论坛——C/C++网络编程</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9e0df31f9071ccc6c9c15001f7b5ed37/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">看过的文章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9ebc500fc4628b1bc9b55d0eb6855ce4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">element-ui组件的使用，导航菜单（NavMenu）组件、分页组件的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>