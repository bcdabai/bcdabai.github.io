<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android串口使用方法 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android串口使用方法" />
<meta property="og:description" content="目录
前言
一、环境介绍
二、设备介绍
二、方法一:
1.引入库 2.编写代码
三、方法二:
1.引入库 2.编写代码
四、完整代码:
五、源码:
前言 串口是一种用于android对硬件设备通信的一种协议，可以发送某种指令控制硬件设备,也可以接受传感器发送过来的数据，比如IC/ID卡，雷达，传感器等。下面介绍串口在android开发中的2使用方式
一、环境介绍 Android 系统版本:Android 7.1 Android 12 Android Studio Electric Eel | 2022.1.1
jdk-18.0.2
PC Windows11 串口调试工具sscom(或者其他串口调试工具也可以)
二、设备介绍 二、方法一: 使用ARMT自带的串口api SerialPort.java
1.引入库 在build.gradle 的dependencies中添加jar包
//ARMT SDK
implementation files(&#39;libs/armtsdkapi.jar&#39;)
2.编写代码 2.1初始化串口 initSerialPort(&#34;/dev/ttyS4&#34;); /** * 初始化串口 * * @param path 串口路径 */ private void initSerialPort(String path) { try { uart3 = new SerialPort(path, 9600, 8, &#34;n&#34;, 1); } catch (IOException e) { e." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/09783854f5627acb560c8de922c10423/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-28T17:20:02+08:00" />
<meta property="article:modified_time" content="2023-04-28T17:20:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android串口使用方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><a id="_0"></a></h2> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="1%E3%80%81%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#1%E3%80%81%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D" rel="nofollow"> 一、环境介绍</a></p> 
<p id="%E4%BA%8C%E3%80%81%E8%AE%BE%E5%A4%87%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E8%AE%BE%E5%A4%87%E4%BB%8B%E7%BB%8D" rel="nofollow">二、设备介绍</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%96%B9%E6%B3%95%E4%B8%80%3A-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%96%B9%E6%B3%95%E4%B8%80%3A" rel="nofollow">二、方法一:</a></p> 
<p id="1.%E5%BC%95%E5%85%A5%E5%BA%93%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0-toc" style="margin-left:40px;"><a href="#1.%E5%BC%95%E5%85%A5%E5%BA%93%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0" rel="nofollow">1.引入库       </a></p> 
<p id="2.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#2.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81" rel="nofollow">2.编写代码</a></p> 
<p id="%E4%B8%89%E3%80%81%E6%96%B9%E6%B3%95%E4%BA%8C%3A-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E6%96%B9%E6%B3%95%E4%BA%8C%3A" rel="nofollow">三、方法二:</a></p> 
<p id="1.%E5%BC%95%E5%85%A5%E5%BA%93%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0-toc" style="margin-left:40px;"><a href="#1.%E5%BC%95%E5%85%A5%E5%BA%93%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0" rel="nofollow">1.引入库       </a></p> 
<p id="2.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#2.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81" rel="nofollow">2.编写代码</a></p> 
<p id="%E5%9B%9B%E3%80%81%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%3A-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%3A" rel="nofollow">四、完整代码:</a></p> 
<p id="-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%3A" rel="nofollow">五、源码:</a></p> 
<hr id="hr-toc"> 
<p></p> 
<hr> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_12"></a>前言</h2> 
<p>串口是一种用于android对硬件设备通信的一种协议，可以发送某种指令控制硬件设备,也可以接受传感器发送过来的数据，比如IC/ID卡，雷达，传感器等。下面介绍串口在android开发中的2使用方式</p> 
<hr> 
<h2 id="1%E3%80%81%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D"> 一、环境介绍</h2> 
<ul><li>Android</li></ul> 
<blockquote> 
 <p>系统版本:Android 7.1 Android 12 <br> Android Studio Electric Eel | 2022.1.1</p> 
 <p>jdk-18.0.2</p> 
</blockquote> 
<ul><li>PC</li></ul> 
<blockquote> 
 <p>Windows11 <br> 串口调试工具sscom(或者其他串口调试工具也可以)</p> 
</blockquote> 
<h2 id="%E4%BA%8C%E3%80%81%E8%AE%BE%E5%A4%87%E4%BB%8B%E7%BB%8D"><a id="pandas_22"></a>二、设备介绍</h2> 
<p><img alt="" height="364" src="https://images2.imgbox.com/e6/c5/WdpnKRa0_o.png" width="763"></p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9d/d5/lhhCkJSv_o.jpg"></p> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E6%96%B9%E6%B3%95%E4%B8%80%3A"><a id="_26"></a>二、方法一:</h2> 
<p>使用ARMT自带的串口api   SerialPort.java</p> 
<h3 id="1.%E5%BC%95%E5%85%A5%E5%BA%93%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0"><a id="1_27"></a>1.引入库       </h3> 
<p>在build.gradle 的dependencies中添加jar包</p> 
<blockquote> 
 <p><br> //ARMT SDK<br> implementation files('libs/armtsdkapi.jar')</p> 
</blockquote> 
<p></p> 
<h3 id="2.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><a id="2_41"></a>2.编写代码</h3> 
<blockquote> 
 <pre><strong>2.1初始化串口
</strong>initSerialPort("/dev/ttyS4");</pre> 
</blockquote> 
<pre><code class="language-c">    /**
     * 初始化串口
     *
     * @param path 串口路径
     */
    private void initSerialPort(String path) {
        try {
            uart3 = new SerialPort(path, 9600, 8, "n", 1);
        } catch (IOException e) {
            e.printStackTrace();
        }
        //获取输出流
        mFileOutputStream3 = (FileOutputStream) uart3.getOutputStream();
        //获取输入流
        mFileInputStream3 = (FileInputStream) uart3.getInputStream();
    }
</code></pre> 
<blockquote> 
 <p>2.2编写接受数据</p> 
</blockquote> 
<pre><code>/**
     * 开机线程接收串口数据
     * 收到数据后发送的Handler刷新
     */
    private void readData() {
        new Thread(() -&gt; {
            while (run_flag) {
                int size3 = 0;
                try {
                    size3 = mFileInputStream3.read(mRevBuffer3);
                } catch (IOException e) {
                    e.printStackTrace();
                }
                if (size3 &gt; 0) {
                    String str3 = new String(mRevBuffer3, 0, size3);
                    Log.i("串口", "receiveData() --&gt; " + str3);
                    mHandler.sendMessage(mHandler.obtainMessage(1, str3));
                    Arrays.fill(mRevBuffer3, (byte) 0x0);
                }
            }
        }, "串口接收线程").start();
    }
</code></pre> 
<p>这里开启线程一直读数据,读到数据后通过Handler更新到Textview</p> 
<blockquote> 
 <p>2.3发送数据</p> 
</blockquote> 
<pre><code>/**
     * 发送串口数据
     */
    private void sendData() {
        try {
            if (mFileOutputStream3 != null) {
                mFileOutputStream3.write(mBuffer);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
</code></pre> 
<blockquote> 
 <p>以上就是通过ARMT提供的方法使用串口, 完整代码在最底部</p> 
</blockquote> 
<h2 id="%E4%B8%89%E3%80%81%E6%96%B9%E6%B3%95%E4%BA%8C%3A">三、方法二:</h2> 
<p>使用第三方库SerialPortHelper</p> 
<h3>1.引入库       </h3> 
<p>在build.gradle 的dependencies中添加jar包</p> 
<pre><code>    //串口
    implementation 'com.github.maybesix:Android-XHLibrary:v1.0.0'</code></pre> 
<p>添加maven 仓库</p> 
<pre><code> repositories {

        maven { url 'https://jitpack.io' }
       
    }</code></pre> 
<h3>2.编写代码</h3> 
<blockquote> 
 <pre><strong>2.1初始化串口
</strong>mHelper = initSerialPortHelper("/dev/ttyS4");
</pre> 
</blockquote> 
<p>这里初始化 SerialPortHelper,并且设置监听, 收到数据后通过Handler更新TextView</p> 
<pre><code> private SerialPortHelper initSerialPortHelper(String port) {
        SerialPortHelper serialPort = new SerialPortHelper(port, 9600);
        serialPort.setSerialPortReceivedListener(new SerialPortHelper.OnSerialPortReceivedListener() {
            @SuppressLint("SetTextI18n")
            @Override
            public void onSerialPortDataReceived(ComPortData comPortData) {
                String dataStr = comPortData.getRecTime() + " 收到: " + new String(comPortData.getRecData());
                mHandler.sendMessage(mHandler.obtainMessage(1, dataStr));
            }
        });
        serialPort.open();
        return serialPort;
    }</code></pre> 
<blockquote> 
 <p>2.2发送数据</p> 
</blockquote> 
<pre><code>  private void sendDataHelper() {
        if (mHelper != null &amp;&amp; mHelper.isOpen()) {
            mHelper.sendTxtString("我是SerialPortHelper");
        }
    }
</code></pre> 
<blockquote> 
 <p> 2.3获取所有串口地址(通用方法)</p> 
 <pre>List&lt;File&gt; allSerial = getAllSerial();</pre> 
</blockquote> 
<pre><code> /**
     * 获取所有串口
     *
     * @return
     */
    private List&lt;File&gt; getAllSerial() {
        List&lt;File&gt; serialPorts = new ArrayList&lt;&gt;();
        Pattern pattern = Pattern.compile("^ttyS|^ttyUSB|^ttyACM|^ttyAMA|^rfcomm|^tty[^/]*$");
        File devDirectory = new File("/dev");

        File[] files = devDirectory.listFiles();
        if (files != null) {
            for (File file : files) {
                String name = file.getName();
                if (pattern.matcher(name).find()) {
                    serialPorts.add(file);
                    Log.e("串口", "扫描到的串口" + file);
                }
            }
        }
        return serialPorts;
    }
</code></pre> 
<h2 id="%E5%9B%9B%E3%80%81%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%3A">四、完整代码:</h2> 
<p></p> 
<pre><code>package com.armt.sdktest_armt.serialPort;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.annotation.SuppressLint;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.os.Message;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;

import com.armt.sdktest_armt.R;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.regex.Pattern;

import cn.com.armt.sdk.hardware.SerialPort;
import top.maybesix.xhlibrary.serialport.ComPortData;
import top.maybesix.xhlibrary.serialport.SerialPortHelper;

public class SerialPortActivity extends AppCompatActivity {

    private byte[] mRevBuffer3 = new byte[100];
    private byte[] mBuffer = "12345".getBytes();//{1,2,3,4,5};
    private SerialPort uart3;
    private FileOutputStream mFileOutputStream3;
    private FileInputStream mFileInputStream3;
    private boolean run_flag = true;
    private Button send;
    private TextView content;
    private SerialPortHelper mHelper;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_serial_port);

        send = findViewById(R.id.send);
        content = findViewById(R.id.content);

        //获取全部串口
        List&lt;File&gt; allSerial = getAllSerial();
        Log.e("串口", "所有串口:" + allSerial);

        //初始化串口,串口地址:"/dev/ttyS4"
        initSerialPort("/dev/ttyS4");
        //开启线程接收串口数据
        readData();

        //第二种使用串口的方式
        mHelper = initSerialPortHelper("/dev/ttyS4");

        //点击发送按钮
        send.setOnClickListener(v -&gt; {
            //点击模拟发送数据
                sendData();
//            sendDataHelper();
        });
    }

    /**
     * 获取所有串口
     *
     * @return
     */
    private List&lt;File&gt; getAllSerial() {
        List&lt;File&gt; serialPorts = new ArrayList&lt;&gt;();
        Pattern pattern = Pattern.compile("^ttyS|^ttyUSB|^ttyACM|^ttyAMA|^rfcomm|^tty[^/]*$");
        File devDirectory = new File("/dev");

        File[] files = devDirectory.listFiles();
        if (files != null) {
            for (File file : files) {
                String name = file.getName();
                if (pattern.matcher(name).find()) {
                    serialPorts.add(file);
                    Log.e("串口", "扫描到的串口" + file);
                }
            }
        }
        return serialPorts;
    }

    /**
     * 初始化串口
     *
     * @param path 串口路径
     */
    private void initSerialPort(String path) {
        try {
            uart3 = new SerialPort(path, 9600, 8, "n", 1);
        } catch (IOException e) {
            e.printStackTrace();
        }
        //获取输出流
        mFileOutputStream3 = (FileOutputStream) uart3.getOutputStream();
        //获取输入流
        mFileInputStream3 = (FileInputStream) uart3.getInputStream();
    }

    private Handler mHandler = new Handler(Looper.getMainLooper()) {
        @Override
        public void handleMessage(@NonNull Message msg) {
            if (msg.what == 1) {
                String data = (String) msg.obj;
                content.append(data + "\n");
            }
        }
    };

    /**
     * 发送串口数据
     */
    private void sendData() {
        try {
            if (mFileOutputStream3 != null) {
                mFileOutputStream3.write(mBuffer);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }


    /**
     * 开机线程接收串口数据
     * 收到数据后发送的Handler刷新
     */
    private void readData() {
        new Thread(() -&gt; {
            while (run_flag) {
                int size3 = 0;
                try {
                    size3 = mFileInputStream3.read(mRevBuffer3);
                } catch (IOException e) {
                    e.printStackTrace();
                }
                if (size3 &gt; 0) {
                    String str3 = new String(mRevBuffer3, 0, size3);
                    Log.i("串口", "receiveData() --&gt; " + str3);
                    mHandler.sendMessage(mHandler.obtainMessage(1, str3));
                    Arrays.fill(mRevBuffer3, (byte) 0x0);
                }
            }
        }, "串口接收线程").start();
    }


    /******************************第二种串口使用方式**********************************/


    private SerialPortHelper initSerialPortHelper(String port) {
        SerialPortHelper serialPort = new SerialPortHelper(port, 9600);
        serialPort.setSerialPortReceivedListener(new SerialPortHelper.OnSerialPortReceivedListener() {
            @SuppressLint("SetTextI18n")
            @Override
            public void onSerialPortDataReceived(ComPortData comPortData) {
                String dataStr = comPortData.getRecTime() + " 收到: " + new String(comPortData.getRecData());
                mHandler.sendMessage(mHandler.obtainMessage(1, dataStr));
            }
        });
        serialPort.open();
        return serialPort;
    }

    private void sendDataHelper() {
        if (mHelper != null &amp;&amp; mHelper.isOpen()) {
            mHelper.sendTxtString("我是SerialPortHelper");
        }
    }


    @Override
    protected void onDestroy() {
        super.onDestroy();
        try {
            run_flag = false;
            if (mFileOutputStream3 != null) mFileOutputStream3.close();
            if (mFileInputStream3 != null) mFileInputStream3.close();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }

        if (mHelper != null) {
            mHelper.close();
        }
    }
}</code></pre> 
<p> 五、源码下载地址:</p> 
<p><a class="link-info" href="https://download.csdn.net/download/qaz96801/87727389" title="完整源码">完整源码</a></p> 
<hr> 
<h2><a id="_55"></a></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29ed53c1538a38c2d002d09750e89774/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vscode pont 模板使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b1317c13b9049e895db41c5f2ed3b79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">R语言|数据结构(四) 数据框 ———R语言入门到入土系列(五)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>