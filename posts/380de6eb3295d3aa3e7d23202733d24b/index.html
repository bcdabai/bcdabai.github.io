<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用天地图报错Error in v-on handler: “TypeError: Cannot read property ‘_tdt_events‘ of null - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用天地图报错Error in v-on handler: “TypeError: Cannot read property ‘_tdt_events‘ of null" />
<meta property="og:description" content="地图官网获取服务许可key；国家地理信息公共服务平台 天地图
vue使用天地图报错Error in v-on handler: “TypeError: Cannot read property ‘_tdt_events‘ of null
当我们调用地图时需要使用setTimeout做延迟
mounted() { // 初始化天地图 setTimeout(()=&gt;{ this.initTdtMap(); },100) }, 或者使用
mounted() { // 初始化天地图 this.$nextTick(()=&gt;{ this.initTdtMap(); }) }, vue使用天地图实现步骤：
创建地图容器元素；引入天地图,tk：在官网申请；初始化地图对象；设置显示地图的中心点和级别；创建地图类型控件；将控件添加到地图，一个控件实例只能向地图中添加一次；创建坐标，通常是调取接口获得经纬度；创建覆盖使用的图标；创建在该坐标上的一个图像标注实例；将覆盖物添加到地图中，一个覆盖物实例只能向地图中添加一次； 全局引入地图 js 库 在Vue项目的index.html 文件中，全局引入天地图js库
&lt;body&gt; &lt;script src=&#34;http://api.tianditu.gov.cn/api?v=4.0&amp;tk=申请的key&#34; type=&#34;text/javascript&#34;&gt;&lt;/script&gt; &lt;/body&gt; 这种方法引入的地图 js，会导致项目的每一个组件都会加载该 js，尤其在不需要加载天地图的页面，会造成很大的性能损耗；而在首页不需要天地图时，天地图加载缓慢，会造成很长的白屏时间，因此需要优化一下引入地图 js 的方法； 创建dom元素并插入 在需要引入 js 的页面，创建script元素，设置 src 属性，并插入；这样就会只在该页面中引入天地图 js；
mounted() { let script = document.createElement(&#39;script&#39;) script.type = &#39;text/javascript&#39; script.src = &#39;http://api.tianditu.gov.cn/api?v=4.0&amp;tk=申请的key&#39; document.body.appendChild(script) }, 应用天地图 &lt;template&gt; &lt;div id=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/380de6eb3295d3aa3e7d23202733d24b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-14T10:24:45+08:00" />
<meta property="article:modified_time" content="2023-02-14T10:24:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用天地图报错Error in v-on handler: “TypeError: Cannot read property ‘_tdt_events‘ of null</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>地图官网获取服务许可key；<a href="https://www.tianditu.gov.cn/" rel="nofollow" title="国家地理信息公共服务平台 天地图">国家地理信息公共服务平台 天地图</a></p> 
<p></p> 
<p>vue使用天地图报错Error in v-on handler: “TypeError: Cannot read property ‘_tdt_events‘ of null</p> 
<p>当我们调用地图时需要使用<strong>setTimeout</strong>做延迟</p> 
<pre><code> mounted() {
      // 初始化天地图
      setTimeout(()=&gt;{
          this.initTdtMap();
      },100)
    },</code></pre> 
<p>或者使用</p> 
<pre><code> mounted() {
      // 初始化天地图
      this.$nextTick(()=&gt;{

          this.initTdtMap();
      })
    },</code></pre> 
<p><strong>vue使用天地图实现步骤：</strong></p> 
<blockquote> 
 <ol><li>创建地图容器元素；</li><li>引入天地图,tk：在官网申请；</li><li>初始化地图对象；</li><li>设置显示地图的中心点和级别；</li><li>创建地图类型控件；</li><li>将控件添加到地图，一个控件实例只能向地图中添加一次；</li><li>创建坐标，通常是调取接口获得经纬度；</li><li>创建覆盖使用的图标；</li><li>创建在该坐标上的一个图像标注实例；</li><li>将覆盖物添加到地图中，一个覆盖物实例只能向地图中添加一次；</li></ol> 
</blockquote> 
<h4>全局引入地图 js 库</h4> 
<p>在Vue项目的index.html 文件中，全局引入天地图js库</p> 
<pre><code>&lt;body&gt;
    &lt;script src="http://api.tianditu.gov.cn/api?v=4.0&amp;tk=申请的key" type="text/javascript"&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre> 
<blockquote> 
 <p> 这种方法引入的地图 js，会导致项目的每一个组件都会加载该 js，尤其在不需要加载天地图的页面，会造成很大的性能损耗；而在首页不需要天地图时，天地图加载缓慢，会造成很长的白屏时间，因此需要优化一下引入地图 js 的方法； </p> 
</blockquote> 
<h4>创建dom元素并插入</h4> 
<p>在需要引入 js 的页面，创建script元素，设置 src 属性，并插入；这样就会只在该页面中引入天地图 js；</p> 
<pre><code>mounted() {
    let script = document.createElement('script')
    script.type = 'text/javascript'
    script.src = 'http://api.tianditu.gov.cn/api?v=4.0&amp;tk=申请的key'
    document.body.appendChild(script)
},</code></pre> 
<h3> 应用天地图</h3> 
<pre><code>&lt;template&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    data() {
        return {
            map: {}
        }
    },
    mounted() {
        this.load();
    },
    methods: {
        load() {
            const init = new Promise((resolve, reject) =&gt; {
                if(window.T) {
                    console.log('地图初始化成功')
                    resolve(window.T)
                    reject('error')
                }
            })
            init.then(T =&gt; {
                this.map = new T.Map('map');
                this.map.centerAndZoom(new T.LngLat(116.40769, 39.89945), 12);
            })
            
        },
    }
}
&lt;/script&gt;
&lt;style scoped&gt;
#map {
    width: 1000px;
    height: 300px;
}
&lt;/style&gt;</code></pre> 
<h3>添加标注点，点击标注点出现信息窗口</h3> 
<p>在上述代码基础上添加一个按钮</p> 
<pre><code>&lt;el-button type="primary" @click="handleAddPoint"&gt;添加标注点&lt;/el-button&gt;

data() {
    return {
        map: {},
        longitude: 116.403963,
        latitude: 39.915119
    }
},

methods: {
    handleAddPoint() {
        this.map.clearOverLays(); //清空原来的标注点
        let point = new T.LngLat(this.longitude -= 0.01,this.latitude -= 0.01)
        let marker = new T.Marker(point)
        this.map.addOverLay(marker) //添加标注点
        //点击标注点事件，添加信息窗口
        let markerInfoWin = new T.InfoWindow("信息窗口");
        marker.addEventListener('click', function() {
             marker.openInfoWindow(markerInfoWin);
        })
    },
}</code></pre> 
<h3>地理编码： 根据地址名称进行坐标解析并标注到地图上</h3> 
<p>在以上代码基础上添加下面内容</p> 
<pre><code>&lt;div style="display: flex"&gt;
    &lt;el-input style="width: 300px; margin-right: 10px" v-model="inputLocation" @keyup.enter.native="handleFindLocation"&gt;&lt;/el-input&gt;
    &lt;el-button type="primary" @click="handleFindLocation"&gt;搜索&lt;/el-button&gt;
&lt;/div&gt;

data() {
    return {
        map: {},
        inputLocation: ''
    }
},

handleFindLocation() {
    let geocoder = new T.Geocoder()
    let that = this
    function searchResult(result){
        if(result.getStatus() == 0){
            //将地图的中心点变换到输入的地理位置，同时缩放到指定等级
            that.map.panTo(result.getLocationPoint(), 16);
            //创建标注对象
            let marker = new T.Marker(result.getLocationPoint());
            //向地图上添加标注
            that.map.addOverLay(marker);
        }else{
            alert(result.getMsg());
        }        
    }
    geocoder.getPoint(this.inputLocation, searchResult);
},</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c9c2f1e2f40e7e6f471adc343ce76a65/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">绘制echarts地图（小圆点，发射线）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d37eb25bf00fe4ceafe7c63d8ab2e5d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">https双向认证</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>