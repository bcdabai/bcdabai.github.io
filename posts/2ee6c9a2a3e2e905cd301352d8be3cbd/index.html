<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于ros Melodic与opencv 4.5.5版本冲突cv_bridge报错 的解决办法： - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于ros Melodic与opencv 4.5.5版本冲突cv_bridge报错 的解决办法：" />
<meta property="og:description" content="关于ros与opencv版本冲突cv_bridge报错
的解决办法：
1.我的环境：ubuntu18.04&#43;ros melodic &#43;opencv4.5.5
2.问题：最近在跑课程项目，因为我的linux放在移动硬盘里面嘛，所以运行速度不是很快，我一般会在windows里写好再去linux，如果大家的linux不卡顿，建议大家开始写代码的时候就在linux的环境。我的windows中opencv版本是4.5.5,就是目前的最新版。写好后我就移动到linux下面嘛。编译报错，百度一下是因为linux的opencv版本太低了，需要升级，我想了一下反正早晚都得用新的，升级呗。于是卸载了老版本的opencv，安装了新的，我觉得不少小伙伴也和我一样。哎，这就是入坑的第一步啊……
问题的样子：我的ros程序需要用到cv_bridge,这才是真正的问题，如果大家不需要cv_bridge的话一般不会出现错误……书回正传；在以前版本的使用的cv_bridge程序现在用不了了，并且程序会报错如下：
OpenCV Error: Assertion failed (tlsSlots.size() &gt; slotIdx) in releaseSlot, file /build/opencv-L2vuMj/opencv-3.2.0&#43;dfsg/modules/core/src/system.cpp, line 1092 terminate called after throwing an instance of ‘cv::Exception’ what(): /build/opencv-L2vuMj/opencv-3.2.0&#43;dfsg/modules/core/src/system.cpp:1092: error: (-215) tlsSlots.size() &gt; slotIdx in function releaseSlot 咋办呢，百度呗，百度得到了结果还是挺令人满意的，下面这几个博主讲述的解决办法都非常详细，但是……不知道为啥我是没有解决这个问题的……
方案一：修改ros目录下关于cv_bridge的文件：
https://blog.csdn.net/Shushan1/article/details/116588614?spm=1001.2014.3001.5506
https://blog.csdn.net/bigdog_1027/article/details/79092263
这二位前辈写的非常非常非常详尽！大家可以先去试一下！
方案二：我成功的方案，安装最新版的cv_bridge,使用时需要在工作空间的Cmakelists文件里写明新的cv_bridge路径。
这里还是看到了这位博主的文章：
https://blog.csdn.net/qq_36814762/article/details/110230127?spm=1001.2014.3001.5506
方法可行，但这篇文章过去两年，而且我用的时opencv4，不知道会出什么幺蛾子，百度了一下选择安装最新版适应opencv4的cv_bridge，这里不要安装这个官方网址下面的包包https://github.com/ros-perception/vision_opencv，因为opencv4.5.5最近才出，所以官网文件里还有很多不兼容的地方。我刚开始并不知道这样的情况，甚至想要放弃了，后来我在github上找到了解决办法。这里插一句：小伙伴们需要什么包的时候多去github上翻翻，出了问题可以在该包对应的issues那里搜索自己的问题，一般都有人遇到过，没有的话可以提问，记得把自己的环境讲清，比如我：ubuntu18&#43;opencv4.5.5……会有大佬帮助的！github上对于cv_bridge不兼容opencv高版本是这样解释的：
Since OpenCV4 is released a month ago, this package doesn’t compile. This PR adds compatibility for OpenCV4.
Regarding the module_opencv4.cpp, it’s probably not the most future proof way to do this, but the package already seems to handle opencv2/3 this way so I just amended it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/2ee6c9a2a3e2e905cd301352d8be3cbd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-19T21:52:43+08:00" />
<meta property="article:modified_time" content="2022-05-19T21:52:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于ros Melodic与opencv 4.5.5版本冲突cv_bridge报错 的解决办法：</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>关于ros与opencv版本冲突cv_bridge报错<br> 的解决办法：</p> 
<p>1.我的环境：ubuntu18.04+ros melodic +opencv4.5.5</p> 
<p>2.问题：最近在跑课程项目，因为我的linux放在移动硬盘里面嘛，所以运行速度不是很快，我一般会在windows里写好再去linux，如果大家的linux不卡顿，建议大家开始写代码的时候就在linux的环境。我的windows中opencv版本是4.5.5,就是目前的最新版。写好后我就移动到linux下面嘛。编译报错，百度一下是因为linux的opencv版本太低了，需要升级，我想了一下反正早晚都得用新的，升级呗。于是卸载了老版本的opencv，安装了新的，我觉得不少小伙伴也和我一样。哎，这就是入坑的第一步啊……</p> 
<p>问题的样子：我的ros程序需要用到cv_bridge,这才是真正的问题，如果大家不需要cv_bridge的话一般不会出现错误……书回正传；在以前版本的使用的cv_bridge程序现在用不了了，并且程序会报错如下：</p> 
<pre><code class="prism language-bash">OpenCV Error: Assertion failed <span class="token punctuation">(</span>tlsSlots.size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> slotIdx<span class="token punctuation">)</span> <span class="token keyword">in</span> releaseSlot, <span class="token function">file</span> /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/system.cpp, line <span class="token number">1092</span> terminate called after throwing an instance of ‘cv::Exception’ what<span class="token punctuation">(</span><span class="token punctuation">)</span>: /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/system.cpp:1092: error: <span class="token punctuation">(</span>-215<span class="token punctuation">)</span> tlsSlots.size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> slotIdx <span class="token keyword">in</span> <span class="token keyword">function</span> releaseSlot
</code></pre> 
<p>咋办呢，百度呗，百度得到了结果还是挺令人满意的，下面这几个博主讲述的解决办法都非常详细，但是……不知道为啥我是没有解决这个问题的……</p> 
<p>方案一：修改ros目录下关于cv_bridge的文件：<br> https://blog.csdn.net/Shushan1/article/details/116588614?spm=1001.2014.3001.5506<br> https://blog.csdn.net/bigdog_1027/article/details/79092263</p> 
<p>这二位前辈写的非常非常非常详尽！大家可以先去试一下！</p> 
<p>方案二：我成功的方案，安装最新版的cv_bridge,使用时需要在工作空间的Cmakelists文件里写明新的cv_bridge路径。</p> 
<p>这里还是看到了这位博主的文章：</p> 
<p>https://blog.csdn.net/qq_36814762/article/details/110230127?spm=1001.2014.3001.5506</p> 
<p>方法可行，但这篇文章过去两年，而且我用的时opencv4，不知道会出什么幺蛾子，百度了一下选择安装最新版适应opencv4的cv_bridge，这里不要安装这个官方网址下面的包包https://github.com/ros-perception/vision_opencv，因为opencv4.5.5最近才出，所以官网文件里还有很多不兼容的地方。我刚开始并不知道这样的情况，甚至想要放弃了，后来我在github上找到了解决办法。这里插一句：小伙伴们需要什么包的时候多去github上翻翻，出了问题可以在该包对应的issues那里搜索自己的问题，一般都有人遇到过，没有的话可以提问，记得把自己的环境讲清，比如我：ubuntu18+opencv4.5.5……会有大佬帮助的！github上对于cv_bridge不兼容opencv高版本是这样解释的：</p> 
<blockquote> 
 <p>Since OpenCV4 is released a month ago, this package doesn’t compile. This PR adds compatibility for OpenCV4.</p> 
 <p>Regarding the <code>module_opencv4.cpp</code>, it’s probably not the most future proof way to do this, but the package already seems to handle opencv2/3 this way so I just amended it.</p> 
</blockquote> 
<p>这位大佬给出了适合opencv4版本的cv_bridge！</p> 
<p>大家跟我一起做：</p> 
<p>首先 随便找个地方建立工作空间，比如：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> ~
$ <span class="token function">mkdir</span> -p catkin_ws/src
</code></pre> 
<p>随后一起来吧！：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> catkin_ws/src
$ catkin_init_workspace 
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
$ cdtkin_make
$ <span class="token builtin class-name">cd</span> src
之后大家得去网址：https://github.com/fizyr-forks/vision_opencv/tree/opencv4下载压缩包，百步网盘也OK，我发现用git下载的东西和压缩包下载不一样而且会编译失败，下载后把压缩包里的cv_bridge工程文件放在src目录下即可
</code></pre> 
<p>网盘链接：</p> 
<p>链接：https://pan.baidu.com/s/1VB1JoMuIrz27SsAgjV5irw?pwd=0000</p> 
<p>接下来需要改一下cv_bridge包下的cmakelists.txt文件：</p> 
<pre><code class="prism language-bash">$ gedit cv_bridge/CMakeLists.txt 
这一部分：
cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">2.8</span><span class="token punctuation">)</span>
project<span class="token punctuation">(</span>cv_bridge<span class="token punctuation">)</span>
																							//在这加个东西
find_package<span class="token punctuation">(</span>catkin REQUIRED COMPONENTS rosconsole sensor_msgs<span class="token punctuation">)</span>

if<span class="token punctuation">(</span>NOT ANDROID<span class="token punctuation">)</span>
  find_package<span class="token punctuation">(</span>PythonLibs<span class="token punctuation">)</span>
  if<span class="token punctuation">(</span>PYTHONLIBS_VERSION_STRING VERSION_LESS <span class="token number">3</span><span class="token punctuation">)</span>
    find_package<span class="token punctuation">(</span>Boost REQUIRED python<span class="token punctuation">)</span>
  else<span class="token punctuation">(</span><span class="token punctuation">)</span>
    find_package<span class="token punctuation">(</span>Boost REQUIRED python3<span class="token punctuation">)</span>
  endif<span class="token punctuation">(</span><span class="token punctuation">)</span>
else<span class="token punctuation">(</span><span class="token punctuation">)</span>
find_package<span class="token punctuation">(</span>Boost REQUIRED<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>
find_package<span class="token punctuation">(</span>OpenCV <span class="token number">3</span> REQUIRED							//这里需要改
  COMPONENTS
    opencv_core
    opencv_imgproc
    opencv_imgcodecs
  CONFIG
<span class="token punctuation">)</span>
修改如下：
cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">2.8</span><span class="token punctuation">)</span>
project<span class="token punctuation">(</span>cv_bridge<span class="token punctuation">)</span>
set<span class="token punctuation">(</span>OpenCV_DIR <span class="token string">"/usr/local/include/opencv4/opencv2"</span><span class="token punctuation">)</span>					<span class="token comment">#opencv库的路径，大家应该都一样，加上的，自己加的时候给我这句话删掉，看着多难受,</span>
find_package<span class="token punctuation">(</span>catkin REQUIRED COMPONENTS rosconsole sensor_msgs<span class="token punctuation">)</span>

if<span class="token punctuation">(</span>NOT ANDROID<span class="token punctuation">)</span>
  find_package<span class="token punctuation">(</span>PythonLibs<span class="token punctuation">)</span>
  if<span class="token punctuation">(</span>PYTHONLIBS_VERSION_STRING VERSION_LESS <span class="token number">3</span><span class="token punctuation">)</span>
    find_package<span class="token punctuation">(</span>Boost REQUIRED python<span class="token punctuation">)</span>
  else<span class="token punctuation">(</span><span class="token punctuation">)</span>
    find_package<span class="token punctuation">(</span>Boost REQUIRED python3<span class="token punctuation">)</span>
  endif<span class="token punctuation">(</span><span class="token punctuation">)</span>
else<span class="token punctuation">(</span><span class="token punctuation">)</span>
find_package<span class="token punctuation">(</span>Boost REQUIRED<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>

find_package<span class="token punctuation">(</span>OpenCV <span class="token number">4.5</span> REQUIRED						<span class="token comment">#改成4.5</span>
  COMPONENTS
    opencv_core
    opencv_imgproc
    opencv_imgcodecs
  CONFIG
<span class="token punctuation">)</span>
</code></pre> 
<p>接下来进行编译：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> ~/catkin_ws/
$ catkin_make
</code></pre> 
<p>成功啦！，但是还没结束哈，使用的时候在自己的工作空间中CmakeLists.txt需要添加：</p> 
<pre><code class="prism language-bash">set<span class="token punctuation">(</span>cv_bridge_DIR ~/catkin_ws/devel/share/cv_bridge/cmake<span class="token punctuation">)</span><span class="token comment">#大家根据自己的情况修改就好！</span>
set<span class="token punctuation">(</span>OpenCV_DIR <span class="token string">"/usr/local/include/opencv4/opencv2"</span><span class="token punctuation">)</span>
</code></pre> 
<p>编译你报错的ros文件，呜呜呜成功啦！！！！</p> 
<p>感谢csdn前辈，github上的前辈们（特别是这位提出来方案https://github.com/hgaiser）！感激涕零！！！！</p> 
<p>另外，最近准备考研，大家如果有问题不能及时回复的~大家就看看有没有更好的解决方案哈……</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/59a7798cc8986330be284897029eebdf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">报错:ImproperlyConfigured: Requested setting INSTALLED_APPS, but settings are not configured.</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/058584f36475fae18dd12a54a3ba5c5f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">15.登录模块增加验证码部分</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>