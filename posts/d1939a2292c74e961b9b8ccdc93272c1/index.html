<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vcenter证书过期--Vcenter无法登录,密码错误,签名无效,503 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vcenter证书过期--Vcenter无法登录,密码错误,签名无效,503" />
<meta property="og:description" content="1. 故障现象 登录时一直提示用户名密码错误,但确认密码和用户名没有问题.之前1个月其实已经通过控制台重置过证书日期,并看到证书日期是2年后的了.于是怀疑是不是证书过期了.
当时急着排除故障就没有截图了.引用官网的2张图
2. 排除过程 2.1 确认故障原因 2.2.1 登录vcenter命令行 2.2.2 查看证书日期 果然,证书日期是今天凌晨过期的
root@pana-vc [ ~ ]# for i in $(/usr/lib/vmware-vmafd/bin/vecs-cli store list);do echo STORE $i;sudo /usr/lib/vmware-vmafd/bin/vecs-cli entry list --store $i --text|egrep &#34;Alias|Not After&#34;; done STORE MACHINE_SSL_CERT Alias :	__MACHINE_CERT Not After : Sep 16 05:18:40 2024 GMT STORE TRUSTED_ROOTS Alias :	79f3d5a2a7ee50b15c6698c7c796b104ff2dc855 Not After : Oct 4 08:49:45 2028 GMT Alias :	f7083e9abad114d69d3bb1eb0657bb0f904c4a59 Not After : Oct 15 04:35:10 2030 GMT STORE TRUSTED_ROOT_CRLS Alias :	8900883067e989a792fdd6aad2182d8ab965e7bc Alias :	be6990d6d91b1ec33f0b1a1d16acc1e4bcb71a14 STORE machine Alias :	machine Not After : Oct 15 04:35:10 2030 GMT STORE vsphere-webclient Alias :	vsphere-webclient Not After : Oct 15 04:35:10 2030 GMT STORE vpxd Alias :	vpxd Not After : Sep 16 05:19:07 2024 GMT STORE vpxd-extension Alias :	vpxd-extension Not After : Oct 15 04:35:10 2030 GMT STORE SMS Alias :	sms_self_signed Not After : Oct 10 08:54:35 2028 GMT STORE BACKUP_STORE Alias :	bkp___MACHINE_CERT Not After : Oct 9 20:49:45 2020 GMT Alias :	bkp_machine Not After : Oct 9 08:40:35 2020 GMT Alias :	bkp_vsphere-webclient Not After : Oct 9 08:40:35 2020 GMT Alias :	bkp_vpxd Not After : Oct 9 08:40:35 2020 GMT Alias :	bkp_vpxd-extension Not After : Oct 9 08:40:36 2020 GMT Alias :	bkp__MACHINE_CERT Not After : Oct 20 04:25:11 2022 GMT STORE BACKUP_STORE_H5C Alias :	bkpmachine Not After : Oct 20 04:26:33 2022 GMT Alias :	bkpvsphere-webclient Not After : Oct 20 04:26:33 2022 GMT Alias :	bkpvpxd-extension Not After : Oct 20 04:26:34 2022 GMT Alias :	bkpvpxd Not After : Oct 20 04:26:34 2022 GMT 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d1939a2292c74e961b9b8ccdc93272c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-21T12:17:13+08:00" />
<meta property="article:modified_time" content="2022-10-21T12:17:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vcenter证书过期--Vcenter无法登录,密码错误,签名无效,503</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__0"></a>1. 故障现象</h2> 
<p>登录时一直提示用户名密码错误,但确认密码和用户名没有问题.之前1个月其实已经通过控制台重置过证书日期,并看到证书日期是2年后的了.于是怀疑是不是证书过期了.<br> 当时急着排除故障就没有截图了.引用官网的2张图<br> <img src="https://images2.imgbox.com/05/cd/xkUdH8c0_o.jpg" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/b0/46/MEmNegRf_o.jpg" alt="请添加图片描述"></p> 
<h2><a id="2__6"></a>2. 排除过程</h2> 
<h3><a id="21__7"></a>2.1 确认故障原因</h3> 
<h4><a id="221_vcenter_8"></a>2.2.1 登录vcenter命令行</h4> 
<p><img src="https://images2.imgbox.com/27/86/hxG75Ejc_o.png" alt="请添加图片描述"></p> 
<h4><a id="222__10"></a>2.2.2 查看证书日期</h4> 
<p>果然,证书日期是今天凌晨过期的</p> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># for i in $(/usr/lib/vmware-vmafd/bin/vecs-cli store list);do echo STORE $i;sudo /usr/lib/vmware-vmafd/bin/vecs-cli entry list --store $i --text|egrep "Alias|Not After"; done</span>
STORE MACHINE_SSL_CERT
Alias <span class="token builtin class-name">:</span>	__MACHINE_CERT
            Not After <span class="token builtin class-name">:</span> Sep <span class="token number">16</span> 05:18:40 <span class="token number">2024</span> GMT
STORE TRUSTED_ROOTS
Alias <span class="token builtin class-name">:</span>	79f3d5a2a7ee50b15c6698c7c796b104ff2dc855
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">4</span> 08:49:45 <span class="token number">2028</span> GMT
Alias <span class="token builtin class-name">:</span>	f7083e9abad114d69d3bb1eb0657bb0f904c4a59
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">15</span> 04:35:10 <span class="token number">2030</span> GMT
STORE TRUSTED_ROOT_CRLS
Alias <span class="token builtin class-name">:</span>	8900883067e989a792fdd6aad2182d8ab965e7bc
Alias <span class="token builtin class-name">:</span>	be6990d6d91b1ec33f0b1a1d16acc1e4bcb71a14
STORE machine
Alias <span class="token builtin class-name">:</span>	machine
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">15</span> 04:35:10 <span class="token number">2030</span> GMT
STORE vsphere-webclient
Alias <span class="token builtin class-name">:</span>	vsphere-webclient
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">15</span> 04:35:10 <span class="token number">2030</span> GMT
STORE vpxd
Alias <span class="token builtin class-name">:</span>	vpxd
            Not After <span class="token builtin class-name">:</span> Sep <span class="token number">16</span> 05:19:07 <span class="token number">2024</span> GMT
STORE vpxd-extension
Alias <span class="token builtin class-name">:</span>	vpxd-extension
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">15</span> 04:35:10 <span class="token number">2030</span> GMT
STORE SMS
Alias <span class="token builtin class-name">:</span>	sms_self_signed
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">10</span> 08:54:35 <span class="token number">2028</span> GMT
STORE BACKUP_STORE
Alias <span class="token builtin class-name">:</span>	bkp___MACHINE_CERT
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">9</span> <span class="token number">20</span>:49:45 <span class="token number">2020</span> GMT
Alias <span class="token builtin class-name">:</span>	bkp_machine
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">9</span> 08:40:35 <span class="token number">2020</span> GMT
Alias <span class="token builtin class-name">:</span>	bkp_vsphere-webclient
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">9</span> 08:40:35 <span class="token number">2020</span> GMT
Alias <span class="token builtin class-name">:</span>	bkp_vpxd
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">9</span> 08:40:35 <span class="token number">2020</span> GMT
Alias <span class="token builtin class-name">:</span>	bkp_vpxd-extension
            Not After <span class="token builtin class-name">:</span> Oct  <span class="token number">9</span> 08:40:36 <span class="token number">2020</span> GMT
Alias <span class="token builtin class-name">:</span>	bkp__MACHINE_CERT
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">20</span> 04:25:11 <span class="token number">2022</span> GMT
STORE BACKUP_STORE_H5C
Alias <span class="token builtin class-name">:</span>	bkpmachine
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">20</span> 04:26:33 <span class="token number">2022</span> GMT
Alias <span class="token builtin class-name">:</span>	bkpvsphere-webclient
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">20</span> 04:26:33 <span class="token number">2022</span> GMT
Alias <span class="token builtin class-name">:</span>	bkpvpxd-extension
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">20</span> 04:26:34 <span class="token number">2022</span> GMT
Alias <span class="token builtin class-name">:</span>	bkpvpxd
            Not After <span class="token builtin class-name">:</span> Oct <span class="token number">20</span> 04:26:34 <span class="token number">2022</span> GMT
</code></pre> 
<h3><a id="22__63"></a>2.2 故障排除</h3> 
<h4><a id="221__64"></a>2.2.1 工具准备</h4> 
<p>我们需要准备2个软件,当时一直在正文里找这2个文件的下载链接.浪费了很多时间,其实在右测有下载地址.<br> 实在找不到的朋友可以访问我的百度网盘<br> 链接：https://pan.baidu.com/s/1PCOP_PQ6HXe-5hdRWG4LlA?pwd=MQiu<br> 提取码：MQiu</p> 
<h5><a id="2211_checkstspy_70"></a>2.2.1.1 checksts.py</h5> 
<p>https://kb.vmware.com/s/article/79248<br> <img src="https://images2.imgbox.com/f8/86/iALGbfvq_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2212_fixstssh_73"></a>2.2.1.2 fixsts.sh</h5> 
<p>https://kb.vmware.com/s/article/76719<br> <img src="https://images2.imgbox.com/6b/64/6ORIJExk_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2213__76"></a>2.2.1.3 工具上传</h5> 
<p>用winscp一直报错,官方好像也有KB说怎么解决.我看到winscp有报错就直接放弃使用其他服务进行上传</p> 
<pre><code class="prism language-bash"><span class="token comment"># scp checksts.py fixsts.sh 192.168.101.200:/root</span>
</code></pre> 
<h4><a id="222__81"></a>2.2.2 检查证书日期</h4> 
<pre><code class="prism language-bash"><span class="token comment"># cd /root</span>
<span class="token comment"># python checksts.py</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/30/ac/6s3bf7lJ_o.png" alt="请添加图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># for i in $(/usr/lib/vmware-vmafd/bin/vecs-cli store list);do echo STORE $i;sudo /usr/lib/vmware-vmafd/bin/vecs-cli entry list --store $i --text|egrep "Alias|Not After"; done</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ae/1d/xSvDiuif_o.png" alt="请添加图片描述"><br> 至此确诊了证书过期</p> 
<h4><a id="223__92"></a>2.2.3 证书续订</h4> 
<pre><code class="prism language-bash"><span class="token comment"># chmod +x fixsts.sh</span>
<span class="token comment"># ./fixsts.sh</span>
</code></pre> 
<p><strong>注意!!!</strong><br> 这里需要输入一次<strong>Vcenter控制台登录密码</strong>,我第一次搞错了输入了vcenter的root密码,导致服务启动失败.</p> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># ./fixsts.sh </span>
NOTE: This works on external and embedded PSCs
This script will <span class="token keyword">do</span> the following
<span class="token number">1</span>: Regenerate STS certificate
What is needed?
<span class="token number">1</span>: Offline snapshots of VCs/PSCs
<span class="token number">2</span>: SSO Admin Password
IMPORTANT: This script should only be run on a single PSC per SSO domain
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Resetting STS certificate <span class="token keyword">for</span> pana-vc.pana.dc started on Fri Oct <span class="token number">21</span> 01:08:07 UTC <span class="token number">2022</span>


Detected DN: <span class="token assign-left variable">cn</span><span class="token operator">=</span><span class="token number">192.168</span>.101.200,ou<span class="token operator">=</span>Domain Controllers,dc<span class="token operator">=</span>vsphere,dc<span class="token operator">=</span>local
Detected PNID: <span class="token number">192.168</span>.101.200
Detected PSC: <span class="token number">192.168</span>.101.200
Detected SSO domain name: vsphere.local
Detected Machine ID: c3d30267-b3c9-4108-8580-54a6890b4133
Detected IP Address: <span class="token number">192.168</span>.101.200
Domain CN: <span class="token assign-left variable">dc</span><span class="token operator">=</span>vsphere,dc<span class="token operator">=</span>local
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

Detected Root<span class="token string">'s certificate expiration date: 2030 Oct 15
Detected today'</span>s date: <span class="token number">2022</span> Oct <span class="token number">21</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

Exporting and generating STS certificate

Status <span class="token builtin class-name">:</span> Success
Using config <span class="token function">file</span> <span class="token builtin class-name">:</span> /tmp/vmware-fixsts/certool.cfg
Status <span class="token builtin class-name">:</span> Success


Enter password <span class="token keyword">for</span> administrator@vsphere.local: 
Highest tenant credentials index <span class="token builtin class-name">:</span> <span class="token number">1</span>
Exporting tenant <span class="token number">1</span> to /tmp/vmware-fixsts

Deleting tenant <span class="token number">1</span>

Highest trusted cert chains index: <span class="token number">1</span>
Exporting trustedcertchain <span class="token number">1</span> to /tmp/vmware-fixsts

Deleting trustedcertchain <span class="token number">1</span>



Applying newly generated STS certificate to SSO domain
adding new entry <span class="token string">"cn=TenantCredential-1,cn=vsphere.local,cn=Tenants,cn=IdentityManager,cn=Services,dc=vsphere,dc=local"</span>

adding new entry <span class="token string">"cn=TrustedCertChain-1,cn=TrustedCertificateChains,cn=vsphere.local,cn=Tenants,cn=IdentityManager,cn=Services,dc=vsphere,dc=local"</span>


Replacement finished - Please restart services on all vCenters and PSCs <span class="token keyword">in</span> your SSO domain
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
IMPORTANT: In <span class="token keyword">case</span> you're using HLM <span class="token punctuation">(</span>Hybrid Linked Mode<span class="token punctuation">)</span> without a gateway, you would need to re-sync the certs from Cloud to On-Prem after following this procedure
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre> 
<h4><a id="224__159"></a>2.2.4 重启服务</h4> 
<h5><a id="2241__160"></a>2.2.4.1 停止所有服务</h5> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># service-control --stop --all</span>
Perform stop operation. <span class="token assign-left variable">vmon_profile</span><span class="token operator">=</span>ALL, <span class="token assign-left variable">svc_names</span><span class="token operator">=</span>None, <span class="token assign-left variable">include_coreossvcs</span><span class="token operator">=</span>True, <span class="token assign-left variable">include_leafossvcs</span><span class="token operator">=</span>True
<span class="token number">2022</span>-10-21T00:51:44.164Z   Service vmware-vmon does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T00:53:46.043Z   Done running commandsbin/service<span class="token string">', u'</span>vmware-vmon<span class="token string">', '</span>stop<span class="token string">']
2022-10-21T00:53:46.043Z   Successfully stopped service vmware-vmon
Successfully stopped vmon services. Profile ALL.
2022-10-21T00:53:46.054Z   Service vmware-psc-client does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:46.054Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmware-psc-client<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:46.700Z   Done running command
Successfully stopped service vmware-psc-client
2022-10-21T00:53:48.889Z   Service vmdnsd does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:48.889Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmdnsd<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:49.349Z   Done running command
Successfully stopped service vmdnsd
2022-10-21T00:53:49.506Z   Service vmware-stsd does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:49.507Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmware-stsd<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:49.959Z   Done running command
Successfully stopped service vmware-stsd
2022-10-21T00:53:54.357Z   Service vmware-sts-idmd does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:54.357Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmware-sts-idmd<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:54.636Z   Done running command
Successfully stopped service vmware-sts-idmd
2022-10-21T00:53:55.722Z   Service vmcad does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:55.722Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmcad<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:56.223Z   Done running command
Successfully stopped service vmcad
2022-10-21T00:53:56.333Z   Service vmdird does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:56.333Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmdird<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:56.696Z   Done running command
Successfully stopped service vmdird
2022-10-21T00:53:56.808Z   Service vmafdd does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:56.808Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>vmafdd<span class="token string">', '</span>status<span class="token string">']
2022-10-21T00:53:57.406Z   Done running command
Successfully stopped service vmafdd
2022-10-21T00:53:57.603Z   Service lwsmd does not seem to be registered with vMon. If this is unexpected please make sure your service config is a valid json. Also check vmon logs for warnings.
2022-10-21T00:53:57.603Z   Running command: ['</span>/sbin/service<span class="token string">', u'</span>lwsmd<span class="token string">', '</span>status'<span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T00:53:58.235Z   Done running <span class="token builtin class-name">command</span>
Successfully stopped <span class="token function">service</span> lwsmd

</code></pre> 
<h5><a id="2242__202"></a>2.2.4.2 启动所有服务</h5> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># service-control --start --all</span>
Perform start operation. <span class="token assign-left variable">vmon_profile</span><span class="token operator">=</span>ALL, <span class="token assign-left variable">svc_names</span><span class="token operator">=</span>None, <span class="token assign-left variable">include_coreossvcs</span><span class="token operator">=</span>True, <span class="token assign-left variable">include_leafossvcs</span><span class="token operator">=</span>True
<span class="token number">2022</span>-10-21T01:08:47.990Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'lwsmd'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:47.995Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:47.999Z   Service lwsmd does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:47.999Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'lwsmd'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.041Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> lwsmd
<span class="token number">2022</span>-10-21T01:08:48.050Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmafdd'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.062Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.067Z   Service vmafdd does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.067Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmafdd'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.104Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmafdd
<span class="token number">2022</span>-10-21T01:08:48.108Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmdird'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.119Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.123Z   Service vmdird does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.123Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmdird'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.162Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmdird
<span class="token number">2022</span>-10-21T01:08:48.168Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmcad'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.180Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.188Z   Service vmcad does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.188Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmcad'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.229Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmcad
<span class="token number">2022</span>-10-21T01:08:48.236Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmware-sts-idmd'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.247Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.251Z   Service vmware-sts-idmd does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.251Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmware-sts-idmd'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.287Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmware-sts-idmd
<span class="token number">2022</span>-10-21T01:08:48.291Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmware-stsd'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.304Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.308Z   Service vmware-stsd does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.308Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmware-stsd'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.344Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmware-stsd
<span class="token number">2022</span>-10-21T01:08:48.348Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmdnsd'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.354Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.357Z   Service vmdnsd does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.357Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmdnsd'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.390Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmdnsd
<span class="token number">2022</span>-10-21T01:08:48.398Z   Running command: <span class="token punctuation">[</span><span class="token string">'/usr/bin/systemctl'</span>, <span class="token string">'is-enabled'</span>, u<span class="token string">'vmware-psc-client'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.409Z   Done running <span class="token builtin class-name">command</span>
<span class="token number">2022</span>-10-21T01:08:48.412Z   Service vmware-psc-client does not seem to be registered with vMon. If this is unexpected please <span class="token function">make</span> sure your <span class="token function">service</span> config is a valid json. Also check vmon logs <span class="token keyword">for</span> warnings.
<span class="token number">2022</span>-10-21T01:08:48.412Z   Running command: <span class="token punctuation">[</span><span class="token string">'/sbin/service'</span>, u<span class="token string">'vmware-psc-client'</span>, <span class="token string">'status'</span><span class="token punctuation">]</span>
<span class="token number">2022</span>-10-21T01:08:48.453Z   Done running <span class="token builtin class-name">command</span>
Successfully started <span class="token function">service</span> vmware-psc-client
Successfully started vmon services. Profile ALL.
</code></pre> 
<p>之前由于密码错误启动时有这样的报错,看到这个报错,一般都是前面fixsts的时候密码搞错了,再次确认下是控制台的密码,不是ssh的root密码</p> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># service-control --start --all</span>
略
Service-control failed. Error Failed to start vmon services.vmon-cli <span class="token assign-left variable">RC</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">stderr</span><span class="token operator">=</span>Failed to start vapi-endpoint, vpxd-svcs, cm services. Error: Operation timed out
</code></pre> 
<h2><a id="3__262"></a>3. 故障解决</h2> 
<p>此时EXPIRED的证书已经没有了.可以看到</p> 
<pre><code class="prism language-bash">root@pana-vc <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># python checksts.py </span>

<span class="token number">2</span> VALID CERTS
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

	LEAF CERTS:

	<span class="token punctuation">[</span><span class="token punctuation">]</span> Certificate <span class="token number">33</span>:87:6B:66:90:ED:24:90:23:66:54:B3:65:EF:8F:68:C5:6F:5C:64 will expire <span class="token keyword">in</span> <span class="token number">730</span> days <span class="token punctuation">(</span><span class="token number">2.0</span> years<span class="token punctuation">)</span>.

	ROOT CERTS:

	<span class="token punctuation">[</span><span class="token punctuation">]</span> Certificate F7:08:3E:9A:BA:D1:14:D6:9D:3B:B1:EB:06:57:BB:0F:90:4C:4A:59 will expire <span class="token keyword">in</span> <span class="token number">2916</span> days <span class="token punctuation">(</span><span class="token number">7.0</span> years<span class="token punctuation">)</span>.

<span class="token number">0</span> EXPIRED CERTS
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

	LEAF CERTS:

	None

	ROOT CERTS:

	None
</code></pre> 
<p>此时Vcenter已经可以正常登陆.到Vcenter配置中可以看到STS证书日期已经变成2年后.<br> <img src="https://images2.imgbox.com/64/27/7RIecJ5T_o.png" alt="请添加图片描述"><br> 至此Vcenter证书更新全部完成.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/499040b46dd0df6fd8d8b624bcac2e35/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ucharts 图表接口数据处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f7e5c5e3df9b53f4682d2e4228d7fdbd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python学习记录：浅谈python变量与C语言变量的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>