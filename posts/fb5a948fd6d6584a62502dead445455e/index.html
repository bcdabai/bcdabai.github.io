<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LVM/RAID - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LVM/RAID" />
<meta property="og:description" content="LVM Logical Volume Manager 逻辑卷管理
屏蔽了底层磁盘布局，便于调整磁盘容量
相对传统分区方式的优点
1.空间利用率高
2. 可以在线扩张容量
3. 数据备份方便
4. 可随意定义逻辑卷卷标
缺点：一个磁盘坏了，整个逻辑卷全部崩溃
注：/boot分区用于存放引导文件，不能应用LVM机制
对比
传统分区：磁盘——&gt;建立分区——&gt;格式化分区（建立文件系统）
LVM：磁盘——&gt;(分区）——&gt;PV——&gt;VG——&gt;LV——格式化
基本概念
PV （physical volume ，物理卷）
整个磁盘，或普通分区
包括许多默认4MB大小的PE (physical extents ，基本单元）
VG (Volume Group , 卷组）：一个或多个物理卷组合而成的整体
LV （Logical volume , 逻辑卷）：从卷组中分割出的一块空间，用于建立文件系统
LE（logical extents) 与PE大小相同并一一对应
管理命令
pvmove
#pvmove [物理卷] 移动物理卷组进行数据迁移
#pvcreate [设备]/[分区] #vgcreate [卷组] [物理卷1] [物理卷2]
#vgextend [卷组] [物理卷1] [物理卷2]
#vgreduce [卷组] [物理卷1] [物理卷2]
#lvcreate -L 大小 -n 逻辑卷名 卷组名
:#pvceate/dev/sd{b,c,d}1 = #pvceate /dev/sdb1 /dev/sdc1 /dev/sdd1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/fb5a948fd6d6584a62502dead445455e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-04-21T16:53:18+08:00" />
<meta property="article:modified_time" content="2014-04-21T16:53:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LVM/RAID</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><strong><span style="color:#ff0000">LVM </span></strong><span style="color:#ff0000">Logical Volume Manager</span> 逻辑卷管理<br> 屏蔽了底层磁盘布局，便于调整磁盘容量<br> 相对传统分区方式的优点<br> 1.空间利用率高<br> 2. 可以在线扩张容量<br> 3. 数据备份方便<br> 4. 可随意定义逻辑卷卷标<br> 缺点：一个磁盘坏了，整个逻辑卷全部崩溃<br> 注：/boot分区用于存放引导文件，不能应用LVM机制<br> <br> 对比<br> 传统分区：磁盘——&gt;建立分区——&gt;格式化分区（建立文件系统）<br> LVM：磁盘——&gt;(分区）——&gt;PV——&gt;VG——&gt;LV——格式化<br> <br> 基本概念<br> PV （physical volume ，物理卷）<br> 整个磁盘，或普通分区<br> 包括许多默认4MB大小的PE (physical extents ，基本单元）<br> VG (Volume Group , 卷组）：一个或多个物理卷组合而成的整体<br> LV （Logical volume , 逻辑卷）：从卷组中分割出的一块空间，用于建立文件系统<br> </span></span> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">LE（logical extents) 与PE大小相同并一一对应</span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/88/f3/lK39cR5P_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> </span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">管理命令<br> </span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/ea/98/46DBjpsU_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><span style="color:#ff0000">                                     pvmove</span><br> <span style="color:#ff0000">#pvmove</span> [物理卷] 移动物理卷组进行数据迁移<br> #pvcreate [设备]/[分区] <br> #vgcreate [卷组] [物理卷1] [物理卷2]<br> #vgextend [卷组] [物理卷1] [物理卷2]<br> #vgreduce [卷组] [物理卷1] [物理卷2]<br> #lvcreate -L 大小 -n 逻辑卷名 卷组名<br> :#pvceate/dev/sd{b,c,d}1 = #pvceate /dev/sdb1 /dev/sdc1 /dev/sdd1<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> 调整逻辑卷大小<br> #lvextend -L +大小 /dev/逻辑卷名/卷组名<br> #lvresize -L +/-大小 /dev/逻辑卷名/卷组名<br> 无“+”表示增加到多少<br> <br> 增大：先增大逻辑卷——&gt;再用resize2fs 增大文件系统 （可以在线增大逻辑卷，即不用卸载文件系统）<br> 减小：先用resize2fs缩小文件系统——&gt;在缩小逻辑卷 （注：必须先卸载文件系统）<br> #resize2fs ：更新系统识别的文件系统大小<br> :#resize2fs /dev/vg0/lv0 //增大逻辑卷后更新文件系统大小<br> :#resize2fs /dev/vg0/lv0 <strong>100M</strong> //缩小文件系统<br> #fsck.ext4 -f /dev/vg0/lv0 从新扫描文件系统<br> <br> 注意：增大逻辑卷时，若卷组大小不够，要扩展卷组才能扩展逻辑卷 <br> <br> <strong><span style="color:#ff0000">千万不要在没有关闭LVM的情况下删除分区</span></strong><br> 正确关闭LVM的步骤<br> 1.umount卸载lvm文件系统<br> 2. lvremove 删除逻辑卷<br> 3. vgremove 删除卷组<br> 4. pvremove 删除物理卷<br> 5. 清除/etc/fstab中LVM的挂载记录<br> 6. fdisk修改分析ID<br> <br> #chkconfig --list | grep <strong>smart</strong> smart??<br> ——————————————————————————————————————<br> <strong><span style="color:#ff0000">RAID </span></strong>廉价冗余磁盘阵列<br> <br> 硬件RAID：速度快，性能好，支持热插拔<br> 需专门的RAID磁盘阵列卡，价格按贵，还需配合相应的驱动<br> 软件RAID：使用mdadm软件仿真磁盘阵列功能<br> 无须专门硬件，性价比较好<br> 设备文件标识是/dev/md0<br> <br> RAID0 RAID1 RAID5 RAID6 RAID10 RAID01<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> <strong>RAID0 </strong>: 条带（striping)                                                                        <strong>RAID1</strong>： 读写速度变慢，备份，只认识两个有效成员<br> 读写速度很快，统一大小</span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/bf/30/F0YZaEi2_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><strong>RAID5</strong>：条带+分布校验                                                                   <strong>RAID6</strong>：条带+分布校验+分布校验 &gt;=4</span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/3b/8f/OaxOvoX2_o.png" alt="">  <img src="https://images2.imgbox.com/5a/c0/WNzBMc2I_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">RAID5备用磁盘和热修复</span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/1f/71/JZcvK9jR_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">RAID10：镜像+条带                                                                            RAID01：条带+镜像<br> </span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/2b/75/OLgCnUXl_o.png" alt=""> <img src="https://images2.imgbox.com/57/10/tYbPYNxF_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">RAID配置总结</span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><img src="https://images2.imgbox.com/ed/d1/Wox8BhrB_o.png" alt=""></span></span></p> 
<p><span style="font-size:14px"><span style="background-color:rgb(192,192,192)">注意：/boot分区用于存放引导文件，不能应用RAID机制<br> <br> <span style="color:#ff0000">#mdadm</span> multiple devices admin 创建、修改监控RAID阵列<br> #mdadm [模式] [设备名/dev/md0] [选项] [成员设备名]<br> -C create 新建RAID设备<br> -l --level 设定RAID级别<br> -n number [磁盘数目] ：设定RAID成员设备数目<br> -x --spare-devices [磁盘数目] : 设定备用磁盘数目<br> -s --scan 扫描配置文件。/etc/mdadm.conf<br> -D --detail 查看RAID设备信息<br> -S --stop 停用RAID<br> -A --assemble 激活RAID<br> 大写：模式<br> 小写：选项 <br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> <strong>自动挂载RAID阵列</strong><br> vim /etc/fstab<br> /dev/md0 /raid5 ext4 defaults 0 0<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> <strong>RAID5模拟故障</strong><br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> 1.将/dev/sdb1失效<br> mdadm /dev/md0 <strong>-f</strong> /dev/sdb1<br> -f<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> 2. 将失效的/dev/sdb1替换为/dev/sdg1<br> mdadm /dev/md0 <strong>-a</strong> /dev/sdg1 <strong>-r</strong> /dev/sdb1<br> -a<br> -r<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> 查看RAID信息 cat/proc/mdstat<br> 创建RAID配置文件 mdadm -Ds &gt; /etc/mdadm.conf<br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> # mdadm -S /dev/mdadm<br> # mdadm -A /dev/md0<br> mdadm: /dev/md0 not identified in config file.<br> # mdadm -A /dev/md0 /dev/sd{b,c,d,e,f,g}1<br> mdadm: /dev/md0 has been started with 3 drives (out of 4).<br> # mdadm -Ds &gt; /etc/madadm.conf (如果需要第二次激活建议创建配置文件）<br> # cat /etc/mdadm.conf <br> ARRAY /dev/md0 metadata=1.2 name=host1.zwb.com:0 UUID=68962510:ab70ee28:c3d6beac:7d8f8e1d<br> # mdadm -S /dev/mdadm<br> # mdadm -A /dev/md0<br> <br> </span></span><span style="font-size:14px"><span style="background-color:rgb(192,192,192)"><br> #resize2fs /dev/md0 与LVM同理<br> </span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a28f39daf05949fa1b73c1b3395b5dc3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VS MONO Android开发控件悬浮显示提醒 自定义背景颜色、字体、数字颜色、摆放位置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bfdc9460d333c0b4cdf79670a1ebe66e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#中keybd_event 用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>