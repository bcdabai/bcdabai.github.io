<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SCSA第三天总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SCSA第三天总结" />
<meta property="og:description" content="1.设备登陆管理
首次拿到AC/SG设备时，可以通过以下方法登录设备控制台
SANGFOR AC/SG设备，各网口默认的出厂IP为： eth0(LAN)：10.251.251.251/24 , eth1(DMZ)10.252.252.252/24 【1】、使用一根交叉线连接设备和电脑 (1) 如果电脑连接的是设备的eth0口，需先在电脑上配置一个10.251.251.0/24网段的地 址（10.251.251.251除外），打开浏览器输入https://10.251.251.251 登录设备网关控制台。 (2) 如果电脑连接的是设备的eth1口，需先在电脑上配置一个10.252.252.0/24网段的地址（10.252.252.252除外），打开浏览器输入https://10.252.252.252 登录设备网关控制台。 【2】输入控制台admin帐号登录设备。默认的管理员用户名和密码为admin/admin。 如果设备接口地址被修改，在不知道更改后接口地址的情况下，提供以下2种方法登录设备
【1】、SANGFOR AC/SG设备的lan口(默认eth0定义为lan)有保留IP地址为128.127.125.252/29, 请配置电脑IP地址为128.127.125.253/29, 用交叉线连接电脑和设备eth0口，通过https://128.127.125.252登录设备网关控制台。 同时，AC/SG设备dmz口(默认eth1定义为dmz)也有保留IP地址128.128.125.252/29，也可以通过交叉线电脑接到设备eth1口，且电脑配置IP为128.128.125.253/29，通过https://128.128.125.252登录设备控制台。 【2】、通过SANGFOR 升级系统工具查找设备地址后，通过查找得到的地址进设备控制台 （1）安装SANGFOR 升级系统工具的PC和设备使用交叉线直连 （2）关闭PC上安装的防火墙及windows自带防火墙 （3）通过SANGFOR 升级系统工具查找设备地址 （4）通过SANGFOR 升级系统工具查到的地址登录设备 2.恢复出厂设置
恢复出厂配置会使设备重启。
对于能够正常登录设备的情况，可以通过以下四种方法恢复出厂配置
【1】、通过控制台界面恢复出厂配置：恢复出厂配置会重启设备，通过此方法恢复出厂配置后，再次登录控制台，右下角会有“恢复成功”的提示 【2】、通过SANGFOR 升级系统工具恢复出厂配置 【3】、交叉线短接设备两个电口恢复 【4】、U盘恢复出厂设置 3.恢复控制台密码
如果忘记了admin的密码，导致无法登录设备，又需要保留设备配置（即不能恢复出厂配置），可以通过下面两种方法单独恢复admin的密码。
（1）交叉线恢复控制台密码 【1】.确保电脑和设备可以通信，访问设备地址，https://acip/php/rp.php，如下图，提示“创建文件成功，请连接交叉线并重启设备”。 【2】.准备交叉线短接设备任意两个非一组bypass电口（例如eth0和eth2是bypass口，就不能短接这两个口恢复密码） 【3】.手动重启设备，重启过程中，注意观察交叉线短接的两个电口ACT灯状态，两个电口ACT灯同时闪烁10次后，说明密码恢复完成，此时可以拔掉短接的交叉线，通过默认的控制台帐号密码admin/admin登录设备即可。设备重启到密码恢复成功大约3到5分钟左右。 【4】.如果第3步无法根据网口灯状态判断密码恢复是否成功，你可以一直等待，等待5到10分钟左右，尝试通过默认帐号admin/admin帐号登录设备。 （2）U盘恢复密码 【1】.新建一个txt文档，将其重命名为reset-cfg.txt，将txt文档拷贝到U盘根目录，U盘格式为FAT 32的。 【2】.确保电脑和设备可以通信，访问设备地址 https://ACIP/php/rp.php 【3】.AC上插入U盘，重启设备 【4】.当设备的LED红灯熄灭之后，alram灯闪烁即恢复密码成功，拔出U盘 注意事项：U盘恢复密码,需要设备重启 4.部署模式
路由模式
简介： 设备以路由模式部署时，AC的工作方式与路由器相当，具备基本的路由转发及NAT功能。一般在客户还没有相应的网关设备或者用户的网络环境规模比较小，需要将AC做网关使用时，建议以路由模式部署。 路由模式下支持AC所有的功能。 如果需要使用NAT、VPN、DHCP等功能时，AC必须以路由模式部署，其它工作模式没有这些功能。 配置思路： 【1】、网口配置：配置各网口地址。如果是固定IP，则填写运营商给的IP地址及网关；如果是ADSL拨号上网，则填写运营商给的拨号帐号和密码；确定内网口的IP； 【2】、确定内网是否为多网段网络环境，如果是的话需要添加相应的回包路由，将到内网各网段的数据回指给设备下接的三层设备。 【3】、用户是否需要通过AC设备上网，如果是的话，需要设置NAT规则。 【4】、检查并放通防火墙规则 排错思路： （1）检查PC本身的网口IP，子网掩码 （2）检查PC本身的默认网关，首选的DNS服务器 （3）检查AC上给PC做的SNAT （4）检查AC上给PC做的回包路由 （5）被PC访问的设备本身能否上网 PING /TELNET /WGET （6）网口兼容性 换网线 换网口 中间加交换机 （7）arp防护和免费arp可能存在冲突 （8）通过ifconfig检查网口错误包或者丢包，ethtool -S 查看丢包类型 网桥模式：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/d64dffeb2a6e12928bc371a59b19c569/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-23T20:07:05+08:00" />
<meta property="article:modified_time" content="2020-07-23T20:07:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SCSA第三天总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1.设备登陆管理<br> 首次拿到AC/SG设备时，可以通过以下方法登录设备控制台</p> 
<pre><code>	SANGFOR AC/SG设备，各网口默认的出厂IP为：
 	 eth0(LAN)：10.251.251.251/24 ,  eth1(DMZ)10.252.252.252/24
	  【1】、使用一根交叉线连接设备和电脑
     	  (1) 如果电脑连接的是设备的eth0口，需先在电脑上配置一个10.251.251.0/24网段的地 址（10.251.251.251除外），打开浏览器输入https://10.251.251.251 登录设备网关控制台。
      	 (2) 如果电脑连接的是设备的eth1口，需先在电脑上配置一个10.252.252.0/24网段的地址（10.252.252.252除外），打开浏览器输入https://10.252.252.252 登录设备网关控制台。
		【2】输入控制台admin帐号登录设备。默认的管理员用户名和密码为admin/admin。
</code></pre> 
<p>如果设备接口地址被修改，在不知道更改后接口地址的情况下，提供以下2种方法登录设备</p> 
<pre><code>【1】、SANGFOR AC/SG设备的lan口(默认eth0定义为lan)有保留IP地址为128.127.125.252/29, 请配置电脑IP地址为128.127.125.253/29, 用交叉线连接电脑和设备eth0口，通过https://128.127.125.252登录设备网关控制台。
 同时，AC/SG设备dmz口(默认eth1定义为dmz)也有保留IP地址128.128.125.252/29，也可以通过交叉线电脑接到设备eth1口，且电脑配置IP为128.128.125.253/29，通过https://128.128.125.252登录设备控制台。
 【2】、通过SANGFOR 升级系统工具查找设备地址后，通过查找得到的地址进设备控制台
			（1）安装SANGFOR 升级系统工具的PC和设备使用交叉线直连
			（2）关闭PC上安装的防火墙及windows自带防火墙
			（3）通过SANGFOR 升级系统工具查找设备地址
			（4）通过SANGFOR 升级系统工具查到的地址登录设备
</code></pre> 
<p>2.恢复出厂设置<br> 恢复出厂配置会使设备重启。<br> 对于能够正常登录设备的情况，可以通过以下四种方法恢复出厂配置</p> 
<pre><code>【1】、通过控制台界面恢复出厂配置：恢复出厂配置会重启设备，通过此方法恢复出厂配置后，再次登录控制台，右下角会有“恢复成功”的提示
【2】、通过SANGFOR 升级系统工具恢复出厂配置
【3】、交叉线短接设备两个电口恢复
【4】、U盘恢复出厂设置
</code></pre> 
<p>3.恢复控制台密码<br> 如果忘记了admin的密码，导致无法登录设备，又需要保留设备配置（即不能恢复出厂配置），可以通过下面两种方法单独恢复admin的密码。</p> 
<pre><code>（1）交叉线恢复控制台密码
	【1】.确保电脑和设备可以通信，访问设备地址，https://acip/php/rp.php，如下图，提示“创建文件成功，请连接交叉线并重启设备”。
	【2】.准备交叉线短接设备任意两个非一组bypass电口（例如eth0和eth2是bypass口，就不能短接这两个口恢复密码）
	【3】.手动重启设备，重启过程中，注意观察交叉线短接的两个电口ACT灯状态，两个电口ACT灯同时闪烁10次后，说明密码恢复完成，此时可以拔掉短接的交叉线，通过默认的控制台帐号密码admin/admin登录设备即可。设备重启到密码恢复成功大约3到5分钟左右。
	【4】.如果第3步无法根据网口灯状态判断密码恢复是否成功，你可以一直等待，等待5到10分钟左右，尝试通过默认帐号admin/admin帐号登录设备。
（2）U盘恢复密码
	【1】.新建一个txt文档，将其重命名为reset-cfg.txt，将txt文档拷贝到U盘根目录，U盘格式为FAT 32的。
	【2】.确保电脑和设备可以通信，访问设备地址 https://ACIP/php/rp.php
	【3】.AC上插入U盘，重启设备 
	【4】.当设备的LED红灯熄灭之后，alram灯闪烁即恢复密码成功，拔出U盘
	注意事项：U盘恢复密码,需要设备重启 
</code></pre> 
<p>4.部署模式<br> 路由模式</p> 
<pre><code>	简介：
		设备以路由模式部署时，AC的工作方式与路由器相当，具备基本的路由转发及NAT功能。一般在客户还没有相应的网关设备或者用户的网络环境规模比较小，需要将AC做网关使用时，建议以路由模式部署。
		 路由模式下支持AC所有的功能。
		如果需要使用NAT、VPN、DHCP等功能时，AC必须以路由模式部署，其它工作模式没有这些功能。
	配置思路：
		【1】、网口配置：配置各网口地址。如果是固定IP，则填写运营商给的IP地址及网关；如果是ADSL拨号上网，则填写运营商给的拨号帐号和密码；确定内网口的IP；
		【2】、确定内网是否为多网段网络环境，如果是的话需要添加相应的回包路由，将到内网各网段的数据回指给设备下接的三层设备。
		【3】、用户是否需要通过AC设备上网，如果是的话，需要设置NAT规则。
		【4】、检查并放通防火墙规则
	排错思路：
		（1）检查PC本身的网口IP，子网掩码
		（2）检查PC本身的默认网关，首选的DNS服务器
		（3）检查AC上给PC做的SNAT
		（4）检查AC上给PC做的回包路由
		（5）被PC访问的设备本身能否上网 PING /TELNET /WGET
		（6）网口兼容性  换网线 换网口 中间加交换机
		（7）arp防护和免费arp可能存在冲突
		（8）通过ifconfig检查网口错误包或者丢包，ethtool -S  查看丢包类型
</code></pre> 
<p>网桥模式：</p> 
<pre><code>简介：
	设备以网桥模式部署时对客户原有的网络基本没有改动。网桥模式部署AC时，对客户来说AC就是个透明的设备，如果因为AC自身的原因而导致网络中断时可以开启硬件bypass功能，即可恢复网络通信。
	网桥模式部署时AC不支持NAT（代理上网和端口映射）、VPN、DHCP等功能。
配置思路：
	【1】、配置设备网桥地址，网关地址，DNS地址。
	【2】、确定内网是否为多网段网络环境，本案例就是三层环境，所以需要添加相应的回包路由，将到内网各网段的数据回指给设备下接的三层设备。
	【3】、检查并放通防火墙规则。
排错思路：
	【1】、AC网线是否反接（在线用户列表出现大量公网IP）
	【2】、网桥地址是否可用，是否和内网冲突
	【3】、网关是否指向靠近出口方向的设备
	【4】、设备上的DNS是否填写正确
	【5】、确认前面设备是否有拦截（可能做ACL拦截了AC），或者是否对AC做源地址转换代理上网
</code></pre> 
<p>旁路模式：</p> 
<pre><code>简介：
	旁路模式主要用于实现审计功能，完全不需要改变用户的网络环境，通过把设备的监听口接在交换机的镜像口，实现对上网数据的监控。这种模式对用户的网络环境完全没有影响，即使宕机也不会对用户的网络造成中断。
	旁路模式部署主要用于做上网行为的审计，且只能对TCP应用做控制，对基于UDP的应用无法控制。不支持流量管理、NAT、 VPN、 DHCP等功能。
	更多场景：全网行为管理推荐的旁路准入+审计场景
配置思路：
	【1】、交换机设置镜像口，并接到AC监听口。
	【2】、配置需要审计的内网网段和服务器网段。
	【3】、配置管理口地址，用于管理AC设备
注意事项：
	【1】、路由模式可以实现设备所有功能，网桥模式其次，旁路模式多用于审计，只能对TCP应用控制，控制功能最弱。
	【2】、路由模式对客户原有网络改造影响最大，网桥模式其次，旁路模式对客户原有网络改造无影响，即使设备宕机也不会影响客户断网。
	【3】、设备路由模式最多支持8条外网线路。网桥模式最多支持8对网桥，旁路模式除了管理口外，其它网口均可作为监听口，可以同时选择多个网口作为监听口。
</code></pre> 
<p>5.用户认证</p> 
<pre><code>	【1】用户注销
		（1）在【在线用户管理】中强制注销在线用户（临时用户、Dkey用户、不需要认证的用户无法被强制注销）
		（2）在【认证高级选项】-【认证选项】中选择【自动注销无流量的用户】（对所有用户生效）
		（3）在【认证高级选项】-【认证选项】中设置【每天强制注销所有在线用户】，并设置注销时间（对所有用户生效）
		（4）设置认证页面关闭时自动注销
		（5）设置MAC变动时自动注销
	【2】IP/MAC绑定认证
		（1）、 首先为办公区的用户建一个用户组，在【用户认证与管理】－【用户管理】－【组/用户】中，点新增，选择【组】，定义组名：办公区
		（2）、新增【认证策略】，选择认证方式为：不需要认证
		（3）、【认证后处理】-【非本地/域用户使用该组上线】选择：办公区
		（4）、勾选【自动录入绑定关系】-【自动录入IP和MAC的绑定关系】
	三层网络环境下特别注意，需要开启以下功能：
		（5）配置【认证高级选项】-【跨三层取MAC】
				（注意：要在三层设备上设置允许AC访问其SNMP服务器）
		【3】外部认证
			（1）PC向AC/SG提交用户名密码信息
			（2）AC/SG判断为外部认证，并把用户名密码信息发给外部认证服务器校验
			（3）外部认证服务器校验后，向AC/SG发送认证失败或成功的消息
			（4）AC/SG根据外部认证服务器返回的消息，确定是否让该PC通过认证
			（5）PC通过认证后，就可直接访问公网了
</code></pre> 
<p>6.应用控制技术</p> 
<pre><code>【1】应用特征识别技术
	配置思路：
	（1）新增【上网策略】-【上网权限策略】-【策略设置】-【应用控制】在应用里面勾选IM，生效时间全天，移动终端设备里面勾选通讯聊天，动作拒绝，在【适用对象】选择办公区，即对办工区的所有用户关联上这条控制策略。
	（2）、新增【上网策略】-【上网审计策略】-【应用审计】添加，勾选所有选项，在【适用对象】选择办公区，即对办工区的所有用户关联上这条识别策略。
	（3）、登录在白名单内的QQ号，可以正常登录；登录在白名单之外的QQ号，登录失败
【2】HTTP识别控制技术
	配置思路：
		（1）、新增【上网策略】-【上网权限策略】-【策略设置】-【应用控制】在应用里面访问网站-娱乐在线影音及下载勾选，生效时间上班时间，动作拒绝。
		（2）、在【适用对象】选择IT部，即对IT部的所有用户关联上这条控制策略。
【3】HTTPS识别控制技术
	配置思路：
		（1）、 新增【上网策略】-【上网权限策略】-【策略设置】-【应用控制】在应用里面勾选访问网站-web应用-搜索引擎，生效全天，动作拒绝。
		（2）、在【适用对象】选择公共上网区，即对公共上网区的所有用户关联上这条控制策略。
	排查思路：
		（1）、URL库是否更新到最新版本
		（2）、该https网站是否在应用识别库或URL规则库中
		（3）、策略是否配置正确
		（4）、策略的适用用户是否在线
		（5）、该用户是否在全局排除地址中
		（6）、是否开启了直通
		（7）抓包分析ServerName是否正确，是否对应该HTTPS网站
【4】自定义应用识别技术
		总结：
			（1）、自定义准入规则：可以定义运行了某个进程才允许(或不允许)上网
			（2）、自定义应用（封堵或审计精准的应用）
			（3）、自定义URL（封堵或审计精准的URL）
			（4）、自定义关键字（用作关键字过滤或审计）
		上网权限策略排查思路：
			（1）、检查设备部署,如是旁路模式部署,设备本身只能对一些TCP的应用做控制
			（2）、【实时状态】-【在线用户列表】查看策略对应的用户是否在线
			（3）、检查规则库“应用识别”“URL库”“审计规则库”是否为最新
			（4）、检查上网权限策略是否与用户关联,检查用户是否关联了多条上网权限策略,注意策略的叠加顺序（自上而下优先级递减）
			（5）、检查【系统诊断】-【上网故障排除】是否开启直通；【系统配置】-【全局排除地址】是否有排除内网PC的ip、目标域名、目标IP等
			（6）、检查是否有自定义应用,禁用或删除自定义的应用看策略是否正常
			（7）、给用户关联一条【上网审计策略】,开启所有应用的审计,进入【内置数据中心】,检查数据中心识别到的应用和实际使用的应用是否对应。如不对应那回滚下应用识别规则库再重新更新规则库
			（8）、如数据中心没有识别内网PC任何的应用,此时注意检查客户是否有其它的上网线路,抓包分析用户流量是否经过AC
</code></pre> 
<p>HTTPS网站和HTTP网站的异同</p> 
<table><thead><tr><th>相同点</th><th>不同点</th></tr></thead><tbody><tr><td>封堵对象的获取：都是通过获取服务器的标识进行封堵HTTP和HTTPS网站</td><td>封堵对象的获取：针对HTTP是获取三次握手后的GET请求包中的HOST字段来识别服务器；针对HTTPS是在四次握手的第一阶段，获取客户机发送Client hello包中的Servername字段来识别服务器</td></tr><tr><td>封堵行为：都是发送RST包来断开PC和服务器的TCP连接</td><td>封堵行为：针对HTTP是先发送重定向包，再发送RST；针对HTTPS是直接发送RST结束TCP连接不发重定向包</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6166521de5c8b6f7c2d9cde835b9ea18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">git之.gitignore文件详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/63fc8cea032e447e7db2cafaeb3e08b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java多态 练习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>