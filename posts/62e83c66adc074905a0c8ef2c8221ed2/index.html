<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C/C&#43;&#43;开发之CMakeList(其二) - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C/C&#43;&#43;开发之CMakeList(其二)" />
<meta property="og:description" content="嵌套式CMakeLists写法，文件结构如下：
|--examples | |--add_example.c | |--sub_example.c |--CMakeLists.txt |--add | |--add.c | |--add.h |--sub | |--sub.c | |--sub.h 文件内容详情见C/C&#43;&#43;开发之CMakelist(其一)
将C/C&#43;&#43;开发之CMakeList(其一)的内容推广，我们可以将对应文件相对路径分别记录，再统一编译运行
需要注意添加include_directories，指定include目录，否则在add.c与sub.c中可能找不到头文件。
#最小cmake版本 cmake_minimum_required(VERSION 2.8) #项目名字，随意起 project(simple_exe) #设置C/c&#43;&#43;版本(如c99,c&#43;&#43;11,c&#43;&#43;17等版本)，下面表示使用c99版本 set(CMAKE_C_STANDARD 99) #指定include路径 #${CMAKE_CURRENT_SOURCE_DIR}表示当前文件目录，是cmake内置变量 include_directories(${CMAKE_CURRENT_SOURCE_DIR}/add/) include_directories(${CMAKE_CURRENT_SOURCE_DIR}/sub/) #set作用为将第一个字符之后的字符命名为第一个字符， #下面的例子表示将add.c与sub.c用SOURCES表示，即SOURCES = [add.c, sub.c] set(SOURCES add/add.c sub/sub.c ) #将可执行文件统一命名为MAIN_FILES set(MAIN_FILES examples/add_example.c examples/sub_example.c ) #将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字 add_library(alg STATIC ${SOURCES}) #循环MAIN_FILES中的每一个元素 foreach(mainfile ${MAIN_FILES}) #获取不带文件后缀的文件名，下面的作用为提取add_example与sub_example get_filename_component(mainname ${mainfile} NAME_WE) #将mainfile编译生成可执行文件mainname add_executable(${mainname} ${mainfile}) #将静态库链接到可执行文件中 target_link_libraries(${mainname} alg) endforeach() 但是头文件过多时，写起来不方便，用户调用也不方便，最好的方式是将所有头文件整合到一起，统一加到alg.h中，文件结构如下：
|--examples | |--add_example.c | |--sub_example." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/62e83c66adc074905a0c8ef2c8221ed2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-18T22:20:03+08:00" />
<meta property="article:modified_time" content="2022-03-18T22:20:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C/C&#43;&#43;开发之CMakeList(其二)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>嵌套式CMakeLists写法，文件结构如下：</strong></p> 
<pre><code class="prism language-bash">   <span class="token operator">|</span>--examples
   <span class="token operator">|</span>   <span class="token operator">|</span>--add_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub_example.c
   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--add
   <span class="token operator">|</span>   <span class="token operator">|</span>--add.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--add.h
   <span class="token operator">|</span>--sub
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub.h
</code></pre> 
<p>文件内容详情见<a href="https://blog.csdn.net/qq_41876213/article/details/123489427?spm=1001.2014.3001.5502">C/C++开发之CMakelist(其一)</a><br> <strong>将C/C++开发之CMakeList(其一)的内容推广，我们可以将对应文件相对路径分别记录，再统一编译运行</strong><br> 需要注意添加include_directories，指定include目录，否则在add.c与sub.c中可能找不到头文件。</p> 
<pre><code class="prism language-powershell"><span class="token comment">#最小cmake版本</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
<span class="token comment">#项目名字，随意起</span>
project<span class="token punctuation">(</span>simple_exe<span class="token punctuation">)</span>
<span class="token comment">#设置C/c++版本(如c99,c++11,c++17等版本)，下面表示使用c99版本</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#指定include路径</span>
<span class="token comment">#${CMAKE_CURRENT_SOURCE_DIR}表示当前文件目录，是cmake内置变量</span>
include_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>add<span class="token operator">/</span><span class="token punctuation">)</span>
include_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>sub<span class="token operator">/</span><span class="token punctuation">)</span>

<span class="token comment">#set作用为将第一个字符之后的字符命名为第一个字符，</span>
<span class="token comment">#下面的例子表示将add.c与sub.c用SOURCES表示，即SOURCES = [add.c, sub.c]</span>
<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
    add<span class="token operator">/</span>add<span class="token punctuation">.</span>c
    sub<span class="token operator">/</span>sub<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token comment">#将可执行文件统一命名为MAIN_FILES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MAIN_FILES
    examples<span class="token operator">/</span>add_example<span class="token punctuation">.</span>c
    examples<span class="token operator">/</span>sub_example<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token comment">#将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字</span>
add_library<span class="token punctuation">(</span>alg STATIC $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#循环MAIN_FILES中的每一个元素</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span>mainfile $<span class="token punctuation">{<!-- --></span>MAIN_FILES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#获取不带文件后缀的文件名，下面的作用为提取add_example与sub_example</span>
  get_filename_component<span class="token punctuation">(</span>mainname $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span> NAME_WE<span class="token punctuation">)</span>
  <span class="token comment">#将mainfile编译生成可执行文件mainname</span>
  add_executable<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#将静态库链接到可执行文件中</span>
  target_link_libraries<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> alg<span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>但是头文件过多时，写起来不方便，用户调用也不方便，最好的方式是将所有头文件整合到一起，统一加到alg.h中，文件结构如下：</p> 
<pre><code class="prism language-powershell">   <span class="token punctuation">|</span><span class="token operator">--</span>examples
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>add_example<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>sub_example<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span><span class="token operator">--</span>CMakeLists<span class="token punctuation">.</span>txt
   <span class="token punctuation">|</span><span class="token operator">--</span>add
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>add<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span><span class="token operator">--</span>sub
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>sub<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span><span class="token operator">--</span>include
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>alg<span class="token punctuation">.</span>h
</code></pre> 
<p>头文件alg.h：</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> __ALG_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> __ALG_H</span>

<span class="token keyword">int</span> <span class="token function">my_sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">my_add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>

</code></pre> 
<p>源文件add.c,sub.c<br> add.c</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"alg.h"</span></span>

<span class="token keyword">int</span> <span class="token function">my_add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>sub.c</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"alg.h"</span></span>

<span class="token keyword">int</span> <span class="token function">my_sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>main文件sub_example.c, add_example.c<br> add_example.c</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"alg.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"add:%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>sub_example.c</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"alg.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sub:%d\n"</span><span class="token punctuation">,</span> <span class="token function">my_sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>对应cmake也需要改写include_directories</strong></p> 
<pre><code class="prism language-powershell"><span class="token comment">#最小cmake版本</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
<span class="token comment">#项目名字，随意起</span>
project<span class="token punctuation">(</span>simple_exe<span class="token punctuation">)</span>
<span class="token comment">#设置C/c++版本(如c99,c++11,c++17等版本)，下面表示使用c99版本</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#指定include目录</span>
include_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>include<span class="token operator">/</span><span class="token punctuation">)</span>

<span class="token comment">#set作用为将第一个字符之后的字符命名为第一个字符，</span>
<span class="token comment">#下面的例子表示将add.c与sub.c用SOURCES表示，即SOURCES = [add.c, sub.c]</span>
<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
    add<span class="token operator">/</span>add<span class="token punctuation">.</span>c
    sub<span class="token operator">/</span>sub<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token comment">#将可执行文件统一命名为MAIN_FILES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MAIN_FILES
    examples<span class="token operator">/</span>add_example<span class="token punctuation">.</span>c
    examples<span class="token operator">/</span>sub_example<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token comment">#将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字</span>
add_library<span class="token punctuation">(</span>alg STATIC $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#循环MAIN_FILES中的每一个元素</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span>mainfile $<span class="token punctuation">{<!-- --></span>MAIN_FILES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#获取不带文件后缀的文件名，下面的作用为提取add_example与sub_example</span>
  get_filename_component<span class="token punctuation">(</span>mainname $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span> NAME_WE<span class="token punctuation">)</span>
  <span class="token comment">#将mainfile编译生成可执行文件mainname</span>
  add_executable<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#将静态库链接到可执行文件中</span>
  target_link_libraries<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> alg<span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果源文件也特别多，文件夹里面也嵌套了很多文件夹，将文件中所有目录全写入最外层CMakeLists显得特别混乱，不利于团队开发。解决方案为在合适的文件嵌套深度写CMakelists.txt文件，然后将内部的CMakelists.txt文件中的变量层层传入外部合适的位置。不慌，看案例：<br> 我们再增加一层目录，如下</p> 
<pre><code class="prism language-powershell">   <span class="token punctuation">|</span><span class="token operator">--</span>examples
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>add_example<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>sub_example<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span><span class="token operator">--</span>CMakeLists<span class="token punctuation">.</span>txt
   <span class="token punctuation">|</span><span class="token operator">--</span>include
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>alg<span class="token punctuation">.</span>h
   <span class="token punctuation">|</span><span class="token operator">--</span>alg
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>add
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>add<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>CMakeLists<span class="token punctuation">.</span>txt
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>sub
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>sub<span class="token punctuation">.</span>c
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>CMakeLists<span class="token punctuation">.</span>txt
   <span class="token punctuation">|</span>   <span class="token punctuation">|</span><span class="token operator">--</span>CMakeLists<span class="token punctuation">.</span>txt
</code></pre> 
<p>alg/add/CMakeLists.txt中重点为set(SRCS ${SRCS} ${SOURCES} PARENT_SCOPE)，表示作用域在父目录</p> 
<pre><code class="prism language-powershell"><span class="token comment">#老三段</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>
<span class="token comment">#注意这里的目录不是相对路径，是从可执行CMakeLists.txt开始的（即存在add_library或add_executable的CMakeLists，如果写错的话会报错找不到改文件，可以考虑修改一下子目录里面的CMakeLists中SOURCES的目录）</span>
<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
  alg<span class="token operator">/</span>add<span class="token operator">/</span>add<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>

<span class="token comment">#等价于SRC = [SRC, SOURCES]，PARENT_SCOPE表示作用域为父目录</span>
<span class="token comment">#注意这里为啥不写成set(SOURCES ${SOURCES} ${SOURCES} PARENT_SCOPE)，注意到第8行的set(SOURCES ...)</span>
<span class="token comment">#如果写成这种形式，如果在其它层也存在SOURCES，那么在第八行SOURCES会被替换成[add/add.c, sub/sub.c]导致找不到部分源文件</span>
<span class="token comment">#所以在该项目里我们约定SRCS为全局变量，提供给外层使用，SOURCES仅在本层使用</span>
<span class="token function">set</span><span class="token punctuation">(</span>SRCS $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span> PARENT_SCOPE<span class="token punctuation">)</span>
</code></pre> 
<p>alg/sub/CMakeLists.txt</p> 
<pre><code class="prism language-powershell">cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
  alg<span class="token operator">/</span>sub<span class="token operator">/</span>sub<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>SRCS $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span> PARENT_SCOPE<span class="token punctuation">)</span>

</code></pre> 
<p>alg/CMakeLists.txt如下，重点为add_subdirectory，表示调用子目录的CMakeLists：</p> 
<pre><code class="prism language-powershell">cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#将文件夹内存在CMakelist的所有文件命名为MODULES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MODULES
  add
  sub
<span class="token punctuation">)</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span>module $<span class="token punctuation">{<!-- --></span>MODULES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#执行每一个文件夹里面的CMakeLists.txt脚本</span>
  add_subdirectory<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>module<span class="token punctuation">}</span><span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#将SRC传入上层，这样可以层层上传子文件夹中CMakeLists里的变量。</span>
<span class="token function">set</span><span class="token punctuation">(</span>SRCS $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span> PARENT_SCOPE<span class="token punctuation">)</span>
</code></pre> 
<p>CMakeLists.txt如下：</p> 
<pre><code class="prism language-powershell"><span class="token comment">#最小cmake版本</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
<span class="token comment">#项目名字，随意起</span>
project<span class="token punctuation">(</span>simple_exe<span class="token punctuation">)</span>
<span class="token comment">#设置C/c++版本(如c99,c++11,c++17等版本)，下面表示使用c99版本</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#指定include目录</span>
include_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>include<span class="token operator">/</span><span class="token punctuation">)</span>

<span class="token comment">#将文件夹内存在CMakelist的所有文件命名为MODULES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MODULES
  alg
<span class="token punctuation">)</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span>module $<span class="token punctuation">{<!-- --></span>MODULES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#执行每一个文件夹里面的CMakeLists.txt脚本</span>
  add_subdirectory<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>module<span class="token punctuation">}</span><span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#将可执行文件统一命名为MAIN_FILES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MAIN_FILES
    examples<span class="token operator">/</span>add_example<span class="token punctuation">.</span>c
    examples<span class="token operator">/</span>sub_example<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>
<span class="token comment">#将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字</span>
add_library<span class="token punctuation">(</span>alg STATIC $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#循环MAIN_FILES中的每一个元素</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span>mainfile $<span class="token punctuation">{<!-- --></span>MAIN_FILES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#获取不带文件后缀的文件名，下面的作用为提取add_example与sub_example</span>
  get_filename_component<span class="token punctuation">(</span>mainname $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span> NAME_WE<span class="token punctuation">)</span>
  <span class="token comment">#将mainfile编译生成可执行文件mainname</span>
  add_executable<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#将静态库链接到可执行文件中</span>
  target_link_libraries<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> alg<span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>但是！！！如果main示例文件过多而且也存在各种文件嵌套，怎么办？</strong><br> 修改文件目录如下：</p> 
<pre><code class="prism language-bash">   <span class="token operator">|</span>--examples
   <span class="token operator">|</span>   <span class="token operator">|</span>--add_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--include
   <span class="token operator">|</span>   <span class="token operator">|</span>--alg.h
   <span class="token operator">|</span>--alg
   <span class="token operator">|</span>   <span class="token operator">|</span>--add
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--add.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--sub.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--build
</code></pre> 
<p>examples/CMakeLists.txt</p> 
<pre><code class="prism language-powershell">cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#将可执行文件统一命名为MAIN_FILES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MAIN_FILES
    add_example<span class="token punctuation">.</span>c
    sub_example<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>

<span class="token comment">#循环MAIN_FILES中的每一个元素</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span>mainfile $<span class="token punctuation">{<!-- --></span>MAIN_FILES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#获取不带文件后缀的文件名，下面的作用为提取add_example与sub_example</span>
  get_filename_component<span class="token punctuation">(</span>mainname $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span> NAME_WE<span class="token punctuation">)</span>
  <span class="token comment">#将mainfile编译生成可执行文件mainname</span>
  add_executable<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>mainfile<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#将静态库链接到可执行文件中</span>
  target_link_libraries<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>mainname<span class="token punctuation">}</span> alg<span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>alg/add/CMakeLists.txt</p> 
<pre><code class="prism language-powershell"><span class="token comment">#老三段</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>
<span class="token comment">#对比一下上一节SOURCES的写法</span>
<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
  add<span class="token operator">/</span>add<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>

<span class="token function">set</span><span class="token punctuation">(</span>SRCS $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span> PARENT_SCOPE<span class="token punctuation">)</span>
</code></pre> 
<p>alg/sub/CMakeLists.txt</p> 
<pre><code class="prism language-powershell"><span class="token comment">#老三段</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token function">set</span><span class="token punctuation">(</span>SOURCES
  sub<span class="token operator">/</span>sub<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>

<span class="token function">set</span><span class="token punctuation">(</span>SRCS $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span> $<span class="token punctuation">{<!-- --></span>SOURCES<span class="token punctuation">}</span> PARENT_SCOPE<span class="token punctuation">)</span>
</code></pre> 
<p>alg/CMakeLists.txt，重点理解一下SET(LIBRARY_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR}/…/lib)</p> 
<pre><code class="prism language-powershell">cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#设置LIBRARY_OUTPUT_PATH为库的输出位置</span>
<span class="token function">SET</span><span class="token punctuation">(</span>LIBRARY_OUTPUT_PATH $<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token punctuation">)</span> 

<span class="token comment">#将文件夹内存在CMakelist的所有文件命名为MODULES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MODULES
  add
  sub
<span class="token punctuation">)</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span>module $<span class="token punctuation">{<!-- --></span>MODULES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#执行每一个文件夹里面的CMakeLists.txt脚本</span>
  add_subdirectory<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>module<span class="token punctuation">}</span><span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字</span>
add_library<span class="token punctuation">(</span>alg STATIC $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>CMakeLists.txt</p> 
<pre><code class="prism language-powershell"><span class="token comment">#最小cmake版本</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
<span class="token comment">#项目名字，随意起</span>
project<span class="token punctuation">(</span>simple_exe<span class="token punctuation">)</span>
<span class="token comment">#设置C/c++版本(如c99,c++11,c++17等版本)，下面表示使用c99版本</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#指定include目录，作用域为全局，包括子目录中的CMakeLists</span>
include_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>include<span class="token operator">/</span><span class="token punctuation">)</span>
<span class="token comment">#指定静态库输出路径，作用域为全局，包括子目录中的CMakeLists</span>
link_directories<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token punctuation">)</span>

<span class="token comment">#将文件夹内存在CMakelist的所有文件命名为MODULES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MODULES
  alg
  examples
<span class="token punctuation">)</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span>module $<span class="token punctuation">{<!-- --></span>MODULES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#执行每一个文件夹里面的CMakeLists.txt脚本</span>
  add_subdirectory<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>module<span class="token punctuation">}</span><span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>查看一下编译之后的文件目录，对比一下编译之前的目录</p> 
<pre><code class="prism language-bash">   <span class="token operator">|</span>--examples
   <span class="token operator">|</span>   <span class="token operator">|</span>--add_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--include
   <span class="token operator">|</span>   <span class="token operator">|</span>--alg.h
   <span class="token operator">|</span>--alg
   <span class="token operator">|</span>   <span class="token operator">|</span>--add
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--add.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--sub.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--lib
   <span class="token operator">|</span>   <span class="token operator">|</span>--libalg.a
</code></pre> 
<p>还差一步就可以打包发布自己的程序啦，回忆一下我们源码安装c/c++程序时，离不开这几个命令，cmake, make , make install。目前我们仅仅在使用cmake, make之后在build/examples里面可以找到自己的源码，所以如何使用make install呢？<br> <strong>make install发布自己的程序</strong><br> 只需要替换上一节中alg/CmkaeLists.txt的内容如下，注意Install命令</p> 
<pre><code class="prism language-powershell"><span class="token comment">#老三段</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION 2<span class="token punctuation">.</span>8<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>simple_alg_exe<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD 99<span class="token punctuation">)</span>

<span class="token comment">#设置LIBRARY_OUTPUT_PATH为库的输出位置</span>
<span class="token function">SET</span><span class="token punctuation">(</span>LIBRARY_OUTPUT_PATH $<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token punctuation">)</span> 

<span class="token comment">#将文件夹内存在CMakelist的所有文件命名为MODULES</span>
<span class="token function">set</span><span class="token punctuation">(</span>MODULES
  add
  sub
<span class="token punctuation">)</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span>module $<span class="token punctuation">{<!-- --></span>MODULES<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">#执行每一个文件夹里面的CMakeLists.txt脚本</span>
  add_subdirectory<span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>module<span class="token punctuation">}</span><span class="token punctuation">)</span>
endforeach<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#将文件打包成alg库，中间的选项STATIC表示静态库，${SOURCES}为源文件，alg为生成的静态库名字</span>
add_library<span class="token punctuation">(</span>alg STATIC $<span class="token punctuation">{<!-- --></span>SRCS<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#将alg.h头文件发布到${CMAKE_CURRENT_SOURCE_DIR}/../output/include目录中，当然可以写一些其它的目录，如/usr/local/lib64/include</span>
install<span class="token punctuation">(</span>FILES <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>include<span class="token operator">/</span>alg<span class="token punctuation">.</span>h DESTINATION $<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>output<span class="token operator">/</span>include<span class="token punctuation">)</span>
<span class="token comment">#将libalg.a静态库文件发布到${CMAKE_CURRENT_SOURCE_DIR}/../output/lib目录中</span>
install<span class="token punctuation">(</span>FILES <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>libalg<span class="token punctuation">.</span>a DESTINATION $<span class="token punctuation">{<!-- --></span>CMAKE_CURRENT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>output<span class="token operator">/</span>lib<span class="token punctuation">)</span>
</code></pre> 
<p>当输入make install时输出如下：</p> 
<pre><code class="prism language-bash"> <span class="token function">make</span> <span class="token function">install</span>
<span class="token punctuation">[</span> 42%<span class="token punctuation">]</span> Built target alg
<span class="token punctuation">[</span> 71%<span class="token punctuation">]</span> Built target sub_example
<span class="token punctuation">[</span>100%<span class="token punctuation">]</span> Built target add_example
Install the project<span class="token punctuation">..</span>.
-- Install configuration: <span class="token string">""</span>
-- Installing: /home/lichangshi/ML2/my_test/test_cmake/alg/<span class="token punctuation">..</span>/output/include/alg.h
-- Installing: /home/lichangshi/ML2/my_test/test_cmake/alg/<span class="token punctuation">..</span>/output/lib/libalg.a
</code></pre> 
<p>安装成功，查看目录结构</p> 
<pre><code class="prism language-bash">   <span class="token operator">|</span>--examples
   <span class="token operator">|</span>   <span class="token operator">|</span>--add_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub_example.c
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--include
   <span class="token operator">|</span>   <span class="token operator">|</span>--alg.h
   <span class="token operator">|</span>--alg
   <span class="token operator">|</span>   <span class="token operator">|</span>--add
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--add.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--sub
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--sub.c
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>   <span class="token operator">|</span>--CMakeLists.txt
   <span class="token operator">|</span>--output
   <span class="token operator">|</span>   <span class="token operator">|</span>--lib
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--libalg.a
   <span class="token operator">|</span>   <span class="token operator">|</span>--include
   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>--alg.h
   <span class="token operator">|</span>--lib
   <span class="token operator">|</span>   <span class="token operator">|</span>--libalg.a
</code></pre> 
<p>安装成功，其它程序只要正确找到对应的头文件与静态库就可以直接调用自己的程序。</p> 
<h3><a id="_484"></a>传送门</h3> 
<p><a href="https://blog.csdn.net/qq_41876213/article/details/123585538">C语言开发之CMakeLists以及gtest测试在C语言中的使用方法（其四）</a><br> <a href="https://blog.csdn.net/qq_41876213/article/details/123584072?spm=1001.2014.3001.5501">C语言开发之CMakeList(其三)</a><br> <a href="https://blog.csdn.net/qq_41876213/article/details/123506370?spm=1001.2014.3001.5501">C/C++开发之CMakeList(其二)</a><br> <a href="https://blog.csdn.net/qq_41876213/article/details/123489427?spm=1001.2014.3001.5502">C/C++开发之CMakeLists(其一)</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dab578cc8ae8499fd63b45acba3e0411/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Navicat Premium出现2003解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f650054f90453cf26a0bd95e0512716/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">选用华为云服务器 宝塔面板中放行了8080端口却无法访问</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>