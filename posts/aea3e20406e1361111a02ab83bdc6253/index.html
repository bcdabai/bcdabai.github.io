<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Trie树实现前缀自动补全 &#43; AC自动机实现敏感词过滤 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Trie树实现前缀自动补全 &#43; AC自动机实现敏感词过滤" />
<meta property="og:description" content="文章目录 背景扩展AC自动机 背景 最近参与了某业务系统的开发， 需要根据城市的名字简称，找到其官方的完整名称。比如云南的大理，其实其完整的名称是大理白族自治州。可以参考官方的行政区划，点这里。
通常来说，城市的简称，都是其完整名称的前缀。所以任务就转化成了：根据前缀，在一堆字符串中，找出满足条件的字符串。
Trie树可以派上用场，只需要对全国所有城市的完整名称，建一颗Trie树即可。这种前缀补全的功能，也有其他的一些经典应用，比如在命令行下，输入一个命令的前缀，或文件名的前缀，敲下 Tab，能够进行自动补全，也是利用了Trie树这种数据结构。
Trie树的原理参考我之前的这篇文章
代码如下
import java.util.*; /** * @Author yogurtzzz * @Date 2022/3/31 15:57 * * 利用 Trie 树实现字符串的存储和快速查找 * * 该类的功能是, 给定一个字符串数组 list , 给定一个字符串 s * 返回在 list 中所有前缀为 s 的字符串 * * 简单地说, 该类的功能是做字符串前缀匹配, 或者自动补全 * * 比如, 输入 &#34;内蒙&#34;, 能够查找到完整的名称为 &#34;内蒙古自治区&#34; **/ public class TrieTree { private Node root = new Node(&#39;0&#39;); /** * 添加一个字符串到 [集合] 中 * **/ public void addString(String s) { Node cur = root; for (int i = 0; i &lt; s." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/aea3e20406e1361111a02ab83bdc6253/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-26T15:00:28+08:00" />
<meta property="article:modified_time" content="2022-04-26T15:00:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Trie树实现前缀自动补全 &#43; AC自动机实现敏感词过滤</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_1" rel="nofollow">背景</a></li><li><a href="#_133" rel="nofollow">扩展</a></li><li><a href="#AC_155" rel="nofollow">AC自动机</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_1"></a>背景</h4> 
<p>最近参与了某业务系统的开发， 需要根据城市的名字简称，找到其官方的完整名称。比如云南的<code>大理</code>，其实其完整的名称是<code>大理白族自治州</code>。可以参考官方的行政区划，点<a href="http://xzqh.mca.gov.cn/defaultQuery?shengji=%D4%C6%C4%CF%CA%A1%A3%A8%B5%E1%A1%A2%D4%C6%A3%A9&amp;diji=-1&amp;xianji=-1" rel="nofollow">这里</a>。</p> 
<p>通常来说，城市的简称，都是其完整名称的前缀。所以任务就转化成了：<strong>根据前缀，在一堆字符串中，找出满足条件的字符串。</strong></p> 
<p>Trie树可以派上用场，只需要对全国所有城市的完整名称，建一颗Trie树即可。这种前缀补全的功能，也有其他的一些经典应用，比如在命令行下，输入一个命令的前缀，或文件名的前缀，敲下 <code>Tab</code>，能够进行<strong>自动补全</strong>，也是利用了Trie树这种数据结构。</p> 
<p><strong>Trie树的原理参考我之前的</strong><a href="https://blog.csdn.net/vcj1009784814/article/details/117811949">这篇文章</a></p> 
<p>代码如下</p> 
<pre><code class="prism language-java">
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author yogurtzzz
 * @Date 2022/3/31 15:57
 *
 * 利用 Trie 树实现字符串的存储和快速查找
 *
 * 该类的功能是, 给定一个字符串数组 list , 给定一个字符串 s
 * 返回在 list 中所有前缀为 s 的字符串
 *
 * 简单地说, 该类的功能是做字符串前缀匹配, 或者自动补全
 *
 * 比如, 输入 "内蒙", 能够查找到完整的名称为 "内蒙古自治区"
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrieTree</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Node</span> root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 添加一个字符串到 [集合] 中
	 * **/</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addString</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Node</span> cur <span class="token operator">=</span> root<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">char</span> c <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">getOrCreateSon</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		cur<span class="token punctuation">.</span>mark <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 在末尾打上标记</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 返回 [集合] 中所有以 @param prefix 为前缀的字符串
	 * **/</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findStringFuzzy</span><span class="token punctuation">(</span><span class="token class-name">String</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> prefix<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">find</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> ans<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 查找
	 * **/</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Node</span> cur<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> prefix<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ans<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> n <span class="token operator">=</span> prefix<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> n <span class="token operator">&amp;&amp;</span> cur <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">dfsAns</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 前缀匹配完成, 开始搜寻答案</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> cur<span class="token punctuation">.</span>son <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>cur<span class="token punctuation">.</span>son<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>prefix<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token function">find</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>son<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>prefix<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


	<span class="token comment">/**
	 * 返回这个节点下所有可能的字符串
	 * **/</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dfsAns</span><span class="token punctuation">(</span><span class="token class-name">Node</span> node<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> prefix<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ans<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>mark<span class="token punctuation">)</span> ans<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>son <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span> s <span class="token operator">:</span> node<span class="token punctuation">.</span>son<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">dfsFinal</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sb<span class="token punctuation">,</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dfsFinal</span><span class="token punctuation">(</span><span class="token class-name">Node</span> cur<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> sb<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ans<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>mark<span class="token punctuation">)</span> ans<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>son <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span> n <span class="token operator">:</span> cur<span class="token punctuation">.</span>son<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">dfsFinal</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> sb<span class="token punctuation">,</span> ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		sb<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 深搜恢复现场</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{<!-- --></span>

		<span class="token keyword">char</span> c<span class="token punctuation">;</span>

		<span class="token keyword">boolean</span> mark<span class="token punctuation">;</span> <span class="token comment">// 标记是否为终点</span>

		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Character</span><span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> son<span class="token punctuation">;</span> <span class="token comment">// 子节点</span>

		<span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span>
			mark <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">void</span> <span class="token function">addSon</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>son <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			son<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">Node</span> <span class="token function">getOrCreateSon</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">boolean</span> isSon <span class="token operator">=</span> son <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> son<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSon<span class="token punctuation">)</span> <span class="token function">addSon</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> son<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


	<span class="token comment">/**
	 * 测试代码
	 * **/</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"海南市"</span><span class="token punctuation">,</span> <span class="token string">"海北市"</span><span class="token punctuation">,</span> <span class="token string">"辽宁哈哈市"</span><span class="token punctuation">,</span> <span class="token string">"辽宁市"</span><span class="token punctuation">,</span> <span class="token string">"辽宁哈嘻嘻市"</span><span class="token punctuation">,</span> <span class="token string">"绵阳市"</span><span class="token punctuation">,</span> <span class="token string">"绵花市"</span><span class="token punctuation">,</span> <span class="token string">"绵阳咩咩市"</span><span class="token punctuation">,</span> <span class="token string">"内蒙古自治区"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">TrieTree</span> trie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrieTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>trie<span class="token operator">::</span><span class="token function">addString</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>line <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"quit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> trie<span class="token punctuation">.</span><span class="token function">findStringFuzzy</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
			result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s,"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_133"></a>扩展</h4> 
<p>上面的功能完成后，我回顾了一下，实现的就是一个前缀模糊查找。（查找有固定前缀的字符串）<br> 在 mysql 中就相当于 <code>like 's%'</code>，但是像后缀 <code>like '%s'</code> 和 中缀 <code>like '%s%'</code> 又要怎么实现呢？</p> 
<p>对于后缀模糊查找，容易想到的一个方法是，对所有字符串，按照字符逆序建一颗 Trie 树即可（可以理解为先把字符串反转一下，再建 Trie）</p> 
<p>但是对于 <code>%s%</code> 好像就无能为力了。</p> 
<p>查了很多的资料，发现一个比较接近的解决方案是：<strong>AC自动机</strong>。但是这个方案还是不太适用于 <code>%s%</code> 这种场景。</p> 
<p>我们知道，在字符串的模式匹配中，一般有两种情形：</p> 
<ul><li><strong>单模式匹配</strong>：给定一个主串<code>s</code>和一个模式串<code>p</code>，查找<code>s</code>中<code>p</code>出现的位置，方法有BF（暴力），KMP</li><li><strong>多模式匹配</strong>：给定一个主串<code>s</code>和多个模式串，查找<code>s</code>中出现的模式串都有哪些，经典的应用场景是敏感词过滤。</li></ul> 
<p>但是我们发现，这两种情形都是在<strong>一个主串</strong>中，根据<strong>一个或多个模式串</strong>，来查找<strong>主串中</strong>是否有匹配的部分，且都是精确匹配。</p> 
<p>这和我们上面说的情形不太一样。上面的情形是：给定一堆字符串（主串），再给一个模式串（带通配符），在这一堆主串中，查找出所有满足模糊匹配条件的串。</p> 
<p>其实是两个不太一样的问题。</p> 
<p>由于对于 <code>%s%</code> 这样中缀模糊查找，仍然没找到解决方案，于是便暂时搁置，先研究一下利用AC自动机实现敏感词过滤，也挺有意思的。（有朋友说去研究一下ElasticSearch中的倒排索引的原理，手写一下，就能解决<code>%s%</code> 这个问题，这个留在之后再去做了）</p> 
<h4><a id="AC_155"></a>AC自动机</h4> 
<p>对于在一个主串中查找多个模式串，一个简单粗暴的做法是，将每个模式串拿出来，单独和主串用KMP做匹配。由于KMP的时间复杂度是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         n 
        
       
         ) 
        
       
      
        O(m+n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span> 。</p> 
<p><strong>关于KMP算法的原理</strong>，参考我之前的<a href="https://blog.csdn.net/vcj1009784814/article/details/116662859">这篇文章</a></p> 
<p><strong>关于KMP的时间复杂度如何计算</strong>，参考思否的<a href="https://segmentfault.com/q/1010000014560162" rel="nofollow">这篇文章</a>。</p> 
<p><strong>关于KMP在回溯指针<code>j</code>时，如何保证不漏掉正确答案？</strong>-&gt; 用反证法证明即可，参考<a href="https://blog.csdn.net/qq_21989927/article/details/109520767">这篇文章</a></p> 
<p>大概是，在KMP的匹配过程中，当匹配到<code>i</code>位置时，若下一个位置不匹配，则<code>j</code>最多回退<code>i-1</code>次。极端的例子是：T=“aaaabaaaab”,P=“aaaaa”。则在对主串进行一次遍历时（假设主串长度为<code>m</code>），则最多会遍历<code>2m</code>次（实际，上界到不了<code>2m</code>），而我们构造<code>next</code>数组时，是对模式串进行了一次同样的遍历匹配操作（假设模式串长度为<code>n</code>），那么构造<code>next</code>数组时最多要<code>2n</code>次，加到一起，就是<code>2m + 2n</code>，所以复杂度是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         n 
        
       
         ) 
        
       
      
        O(m+n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span>。</p> 
<p>那么如果对所有模式串，依次与主串做一次KMP，则开销是非常大的。假设主串长度为<code>m</code>，模式串平均长度为<code>n</code>，模式串个数为<code>N</code>。容易算得，这种方式的时间复杂度是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         ( 
        
       
         N 
        
       
         × 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         n 
        
       
         ) 
        
       
         ) 
        
       
      
        O(N×(m+n)) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span>。</p> 
<p>这样肯定是不行的，那我们来看看用朴素的 Trie 树可以怎么做？我们先对多个模式串，建一颗 Trie 树，然后从主串<code>s</code>的第一个位置开始，在 Trie 树中进行查找，查找完毕后（匹配到或者没匹配到），则把主串中的指针<code>i</code>往后移一位，从第二个位置开始查找，再从第三个位置进行查找。如此以来就能找到<code>s</code>中包含的全部模式串。假设模式串的平均长度为<code>n</code>，主串长度为<code>m</code>，最坏情况下，在主串的每一个位置都要进行<code>n</code>次匹配，则时间复杂度是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         ( 
        
       
         m 
        
       
         × 
        
       
         n 
        
       
         ) 
        
       
      
        O(m × n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></p> 
<p>这种效率也无法达到我们的需求。</p> 
<p>此时轮到AC自动机登场了。</p> 
<p>多模式匹配中，朴素的 Trie 和 AC自动机的关系；就和单模式匹配中，BF法 和 KMP 的关系一样。</p> 
<p>AC自动机仅仅是在 Trie 树上运用了 KMP 的思想，增加了一个类似 <code>next</code> 数组的东西，叫做 <code>fail</code> 指针。</p> 
<p>整个匹配的过程，主串只会被扫描一次，而不会不断回退，当在主串的某个位置匹配失败后，根据 Trie 树上该节点的<strong>父节点</strong>的 <code>fail</code> 指针，找到 Trie 树上下一个要匹配的节点，继续进行匹配即可。</p> 
<p>可以这样简单的理解<code>fail</code>指针，假设Trie树上的一个节点<code>p</code>，其到根节点<code>root</code>，构成的字符串为<code>abc</code>，节点<code>p</code>的<code>fail</code>指针，指向节点<code>q</code>，而节点<code>q</code>到<code>root</code>节点，构成的字符串是<code>bc</code>，这两个节点代表的字符串，存在一个公共的前后缀（这和KMP中next数组的含义一样）。<br> 在AC自动机匹配时，假设主串为<code>abcd</code>，则在匹配第四个位置<code>d</code>时，Trie树上是到节点<code>pc</code>，此时匹配失败，此时查看<code>pc</code>节点的父节点<code>p</code>的<code>fail</code>指针为<code>q</code>，则继续查看<code>q</code>的子节点中有没有字符为<code>d</code>的，发现有，则成功匹配到模式串<code>bcd</code>。<br> <img src="https://images2.imgbox.com/4c/e1/LH3qqcsk_o.png" alt=""><br> （图片来源极客时间）</p> 
<p>由于每个节点的<code>fail</code>指针，都一定依赖于其上层的节点，那么我们构造<code>fail</code>指针的时候，需要从根节点往下，一层一层构造，所以需要使用层序遍历BFS。根节点<code>root</code>的<code>fail</code>指针为<code>null</code>，第一层节点的<code>fail</code>指针为<code>root</code>。因为第一个位置不存在公共前后缀，需要从头开始匹配。（因为公共前后缀的长度一定要小于当前长度，才能构成公共前后缀，至少从第二个位置开始，才可能存在公共前后缀）。<br> 比如<code>a</code>，是没有公共前后缀的，<code>aa</code>的公共前后缀长度为1。</p> 
<p>我们用BFS，每次处理一个节点，并为这个节点的所有子节点，填充<code>fail</code>指针。</p> 
<p>假设当前节点为<code>p</code>，它有一个子节点<code>s</code>，那么填充<code>s</code>的<code>fail</code>指针的过程如下：</p> 
<ul><li>取<code>p.fail</code>，看这个节点的子节点中，有没有和<code>s</code>节点字符相同的，若有，假设为<code>s'</code>，则填充<code>s.fail = s’</code></li><li>若<code>p.fail</code>的子节点中，没有和<code>s</code>字符相同的节点，则更新<code>p = p.fail</code>，继续上面的判断，直到<code>p = null</code>。</li><li>若<code>p = null</code>，说明在<code>root</code>节点的子节点中，都没有发现和<code>s</code>节点字符相同的节点（才会在<code>p = p.fail</code>时将<code>p</code>更新为<code>null</code>），那么在<code>s</code>节点就不存在公共前后缀，需要从头匹配，所以此时<code>s.fail = root</code></li></ul> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author yogurtzzz
 * @Date 2022/4/26 10:30
 *
 * AC 自动机
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcMachine</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">AcNode</span> root<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 用一个敏感词集合构建一个 AC 自动机
	 * **/</span>
	<span class="token keyword">public</span> <span class="token class-name">AcMachine</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> words<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcNode</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">buildTrieTree</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先把 Trie 树建起来</span>
		<span class="token function">fillFailPointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 再填充每个节点的 fail 指针</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 进行敏感词过滤
	 * @param s 原字符串
	 * @return 脱敏后的字符串   
	 * **/</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">filterWithSensitiveWords</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cs <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> begins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> lens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 开始查找</span>
		<span class="token class-name">AcNode</span> cur <span class="token operator">=</span> root<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">char</span> c <span class="token operator">=</span> cs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">hasChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">getOrCreateChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>len <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 该节点为结束节点</span>
					lens<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
					begins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>j <span class="token operator">-</span> cur<span class="token punctuation">.</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>fail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>fail<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">hasChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						cur <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">getOrCreateChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>len <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							lens<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
							begins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>j <span class="token operator">-</span> cur<span class="token punctuation">.</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 查找出所有敏感词出现的起始位置和长度后, 对原字符串进行敏感词屏蔽</span>
		<span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> begins<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> begin <span class="token operator">=</span> begins<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> len <span class="token operator">=</span> lens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> begin<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>cs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> begin <span class="token operator">+</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> cs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>cs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">buildTrieTree</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> words<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		words<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">addWord</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWord</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">AcNode</span> p <span class="token operator">=</span> root<span class="token punctuation">;</span>
		<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cs <span class="token operator">=</span> word<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> c <span class="token operator">:</span> cs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getOrCreateChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		p<span class="token punctuation">.</span>len <span class="token operator">=</span> cs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fillFailPointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// BFS 层序遍历填充 fail 指针</span>
		<span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AcNode</span><span class="token punctuation">&gt;</span></span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		q<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>q<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">AcNode</span> x <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>children <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
			<span class="token comment">// 处理当前节点的子节点的fail指针</span>
			x<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>node <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
				q<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加入队列</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> root<span class="token punctuation">)</span> node<span class="token punctuation">.</span>fail <span class="token operator">=</span> root<span class="token punctuation">;</span>
				<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token class-name">AcNode</span> last <span class="token operator">=</span> x<span class="token punctuation">.</span>fail<span class="token punctuation">;</span>
					<span class="token keyword">while</span> <span class="token punctuation">(</span>last <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>last<span class="token punctuation">.</span><span class="token function">hasChild</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							node<span class="token punctuation">.</span>fail <span class="token operator">=</span> last<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
							last <span class="token operator">=</span> last<span class="token punctuation">.</span>fail<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> node<span class="token punctuation">.</span>fail <span class="token operator">=</span> root<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AcNode</span> <span class="token punctuation">{<!-- --></span>

		<span class="token keyword">private</span> <span class="token keyword">char</span> c<span class="token punctuation">;</span>

		<span class="token keyword">private</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果是结尾节点, 记录长度</span>

		<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Character</span><span class="token punctuation">,</span> <span class="token class-name">AcNode</span><span class="token punctuation">&gt;</span></span> children<span class="token punctuation">;</span>

		<span class="token keyword">private</span> <span class="token class-name">AcNode</span> fail<span class="token punctuation">;</span>

		<span class="token class-name">AcNode</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">AcNode</span> <span class="token function">getOrCreateChild</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>children <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> children<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">AcNode</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcNode</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
			children<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> newNode<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">boolean</span> <span class="token function">hasChild</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> children <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> children<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">testEn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">testZh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testEn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"she"</span><span class="token punctuation">,</span> <span class="token string">"bleed"</span><span class="token punctuation">,</span> <span class="token string">"dog"</span><span class="token punctuation">,</span> <span class="token string">"doggy"</span><span class="token punctuation">,</span> <span class="token string">"hurt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">AcMachine</span> acMachine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcMachine</span><span class="token punctuation">(</span>wordSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"A girl is bitten by a doggy, and she is badly hurt, bleeding along the road"</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sensitive words : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> x <span class="token operator">:</span> wordSet<span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s "</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> filteredString <span class="token operator">=</span> acMachine<span class="token punctuation">.</span><span class="token function">filterWithSensitiveWords</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>filteredString<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testZh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"血"</span><span class="token punctuation">,</span> <span class="token string">"政府"</span><span class="token punctuation">,</span> <span class="token string">"暴力"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">AcMachine</span> acMachine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcMachine</span><span class="token punctuation">(</span>wordSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sensitive words : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> x <span class="token operator">:</span> wordSet<span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s "</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"美国政府呼吁民众不要暴力, 因为暴力会造成流血"</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>acMachine<span class="token punctuation">.</span><span class="token function">filterWithSensitiveWords</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>关于AC自动机的原理，参考<a href="https://time.geekbang.org/column/article/72810" rel="nofollow">极客时间的这篇文章</a>，以及<a href="https://chenhe.me/post/multiple-pattern-matching-ac-auto/" rel="nofollow">这篇文章</a></strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e1185a2e99a8d3b2307fb048ab907ab6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yolov5踩坑记录：标签错位（PIL读取图片方向异常）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44540c00efa9e44578c17a0623aee08f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 基础篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>