<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenFeign详细使用教程 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenFeign详细使用教程" />
<meta property="og:description" content="Feign 是由 Netflix 团队开发的一款基于 Java 实现的 HTTP client，借鉴了 Retrofit、 JAXRS-2.0、WebSocket 等类库。通过 Feign，我们可以像调用方法一样非常简单地访问 HTTP API。 OpenFeign是spring cloud在Feigh的基础上支持了springmvc的注解，如果@RequseMappering等等。OpenFeign的@FeignClient可以解析springmvc的@REquestMappering注解下的接口，并通过动态代理的方式产生实现类实现类中作负载均衡并调用其他服务 OpenFeign内含有ribbon负载均衡
使用 添加注解
&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 主启动类上添加@EnableFeignClients
添加接口加注解
@Component @FeignClient(value = &#34;CLOUD-PAYMENT-SERVICE&#34;)//server的名称 public interface PaymentService { @GetMapping( &#34;/payment/get/{id}&#34;) public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(&#34;id&#34;) Long id); ​ } controller层
@RestController @Slf4j public class OrderController { ​ @Resource private PaymentService paymentService; @GetMapping( &#34;/consumer/payment/get/{id}&#34;) public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(&#34;id&#34;) Long id){ return paymentService.getPaymentById(id); } } 可以像调用方法一样调用服务，不用spring的层层包装
而且自带负载均衡（ribbon）
openfeign超时控制 默认等待一秒超过一秒则报错" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/c889bd754eba32d3286bf8f295d4493f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-03T16:28:32+08:00" />
<meta property="article:modified_time" content="2022-11-03T16:28:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenFeign详细使用教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>  Feign 是由 Netflix 团队开发的一款基于 Java 实现的 HTTP client，借鉴了 Retrofit、 JAXRS-2.0、WebSocket 等类库。通过 Feign，我们可以像调用方法一样非常简单地访问 HTTP API。 </h2> 
<h2>  OpenFeign是spring cloud在Feigh的基础上支持了springmvc的注解，如果@RequseMappering等等。OpenFeign的@FeignClient可以解析springmvc的@REquestMappering注解下的接口，并通过动态代理的方式产生实现类实现类中作负载均衡并调用其他服务</h2> 
<p>OpenFeign内含有ribbon负载均衡</p> 
<h3>使用</h3> 
<p>添加注解</p> 
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;</pre> 
<p>主启动类上添加@EnableFeignClients</p> 
<p>添加接口加注解</p> 
<pre>@Component
@FeignClient(value = "CLOUD-PAYMENT-SERVICE")//server的名称
public interface PaymentService {
    @GetMapping( "/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable("id") Long id);
​
}</pre> 
<p>controller层</p> 
<pre>@RestController
@Slf4j
public class OrderController {
​
    @Resource
    private PaymentService paymentService;
    @GetMapping( "/consumer/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable("id") Long id){
        return paymentService.getPaymentById(id);
    }
}</pre> 
<p>可以像调用方法一样调用服务，不用spring的层层包装</p> 
<p>而且自带负载均衡（ribbon）</p> 
<p></p> 
<h4>openfeign超时控制</h4> 
<p>默认等待一秒超过一秒则报错</p> 
<p>超时演示</p> 
<p>服务模块添加超时服务</p> 
<pre>@GetMapping("/payment/feign/timeout")
public String paymentFeignTimeout(){
    try{
        TimeUnit.SECONDS.sleep(3);
    }catch (InterruptedException e){
        e.printStackTrace();
    }
    return serverPort;
}</pre> 
<p>消费模块接口添加方法</p> 
<pre>@Component
@FeignClient(value = "CLOUD-PAYMENT-SERVICE")
public interface PaymentService {
    @GetMapping( "/payment/get/{id}")
    public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable("id") Long id);
​
    @GetMapping("/payment/feign/timeout")
    public String paymentFeignTimeout();
​
}
​</pre> 
<p>controller层添加方法</p> 
<pre>@GetMapping("/consumer/payment/feign/timeout")
public String paymentFeignTimeout(){
    return paymentService.paymentFeignTimeout();
}</pre> 
<p>自测服务端口方法是否可以调用</p> 
<p><img alt="" height="286" src="https://images2.imgbox.com/55/db/iLOj2eKc_o.png" width="692"></p> 
<p> </p> 
<p></p> 
<p>消费模块调用测试</p> 
<p><img alt="" height="925" src="https://images2.imgbox.com/30/d1/YM4Vd46G_o.png" width="1200"></p> 
<p> </p> 
<p></p> 
<p>修改默认超等待</p> 
<p>修改application.yml文件</p> 
<pre>ribbon:
  ReadTimeout: 5000 #建立链接的所用时间5秒
  ConnectTimeout: 5000 #建立连接后从服务器读取可用资源的时间5秒</pre> 
<p>日志打印增强</p> 
<p>日志级别：</p> 
<p>NONE 默认的不显示任何日志</p> 
<p>BASIC 仅记录请求方法，rul，响应状态码及执行时间</p> 
<p>HEADERS 除了BASIC中定义的信息之外还有请求和响应的头信息</p> 
<p>FULL 除了HEADERS中定义的信息之外，还有请求和响应的正文及元数据</p> 
<p>使用</p> 
<p>配置类下添加bean</p> 
<pre>@Configuration
public class FeignConfig {
    @Bean
    Logger.Level feignLoggerLevel(){
        return Logger.Level.FULL;
    }
}</pre> 
<p>修改yml</p> 
<pre>logging:
  level:
    #添加地址
    com.demo.springcloud.service.PaymentService: debug</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e4732e195de4a4f675f4f2a37d29aefb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在Windows电脑上修改图片内存大小的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f93a0795ab4f717f7d8ea8c9ab3f18ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">高校实验室设备预约管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>