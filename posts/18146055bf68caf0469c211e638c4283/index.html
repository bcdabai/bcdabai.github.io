<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【保姆级】lookup-method标签实践与分析 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【保姆级】lookup-method标签实践与分析" />
<meta property="og:description" content="【Spring源码系列- IOC】
1
【Spring源码】0.安装Gradle环境
2
【Spring源码】1.下载与编译_pom relocation to an other version number is not f
3
【Spring源码】2.试个水先～Debug找到传说中的三级缓存(图解向，堆图预警)
4
【Spring源码】3. xml文件如何转换成BeanDefinition(主要涉及prepareRefresh()&#43; obtainFreshBeanFactory()两个函数，图解向，堆图预警)_spring xml转bean
5
【Spring源码】4. 自己搞个标签?~自定义标签保姆级全过程(图解向，堆图预警)
6
【Spring源码】5.spring的bean工厂准备工作（prepareBeanFactory(beanFactory)
7
【Spring源码】6. Spring扩展自定义属性编辑器保姆级教程
8
【Spring源码】7. 如何添加自定义的BeanFactoryPostProcessor
9
【Spring源码】8. 捋下invokeBeanFactoryPostProcessors()主要处理流程
10
【Spring源码】9. 超级重要的ConfigurationClassPostProcessor
11
【Spring源码】10. 递归调用的processConfigurationClass()方法
12
【Spring源码】11. 我是注解类不？checkConfigurationClassCandidate()注解类判断方法详解
13
【Spring源码】12. 注册bean处理器registerBeanPostProcessors()
14
【Spring源码】13. 国际化处理initMessageSource()源码解析
【补充内容】【保姆级】SpringBoot项目中的i18n国际化
15
【Spring源码】14. 消息多播器（观察者模式）
【补充内容】【保姆级示例向】观察者模式
16
【Spring源码】15. Bean的创建过程（1.概述篇）
17
【Spring源码】16. Bean的创建过程（2）
18
【Spring源码】17.创建Bean这篇认真的@(・●・)@
【补充内容】
【保姆级·创建对象】如何通过Supplier创建对象
【保姆级·创建对象】如何通过factory-method创建对象
【保姆级·创建对象】如何利用resolveBeforeInstantiation()在预处理阶段返回一个Bean的实例对象
19" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/18146055bf68caf0469c211e638c4283/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-16T12:09:32+08:00" />
<meta property="article:modified_time" content="2023-04-16T12:09:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【保姆级】lookup-method标签实践与分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>【Spring源码系列- IOC】</strong></p> 
<table border="1"><tbody><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>1</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/124325005" title="【Spring源码】0.安装Gradle环境">【Spring源码】0.安装Gradle环境</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>2</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/124295132" title="【Spring源码】1.下载与编译_pom relocation to an other version number is not f">【Spring源码】1.下载与编译_pom relocation to an other version number is not f</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>3</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/124494757" title="【Spring源码】2.试个水先～Debug找到传说中的三级缓存(图解向，堆图预警)">【Spring源码】2.试个水先～Debug找到传说中的三级缓存(图解向，堆图预警)</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>4</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/124494175" title="【Spring源码】3. xml文件如何转换成BeanDefinition(主要涉及prepareRefresh()+ obtainFreshBeanFactory()两个函数，图解向，堆图预警)_spring xml转bean">【Spring源码】3. xml文件如何转换成BeanDefinition(主要涉及prepareRefresh()+ obtainFreshBeanFactory()两个函数，图解向，堆图预警)_spring xml转bean</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>5</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/124967341" title="【Spring源码】4. 自己搞个标签?~自定义标签保姆级全过程(图解向，堆图预警)">【Spring源码】4. 自己搞个标签?~自定义标签保姆级全过程(图解向，堆图预警)</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>6</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/125099022" title="【Spring源码】5.spring的bean工厂准备工作（prepareBeanFactory(beanFactory)">【Spring源码】5.spring的bean工厂准备工作（prepareBeanFactory(beanFactory)</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>7</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/125099608" title="【Spring源码】6. Spring扩展自定义属性编辑器保姆级教程">【Spring源码】6. Spring扩展自定义属性编辑器保姆级教程</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>8</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/125189197" title="【Spring源码】7. 如何添加自定义的BeanFactoryPostProcessor">【Spring源码】7. 如何添加自定义的BeanFactoryPostProcessor</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>9</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/125913768" title="【Spring源码】8. 捋下invokeBeanFactoryPostProcessors()主要处理流程">【Spring源码】8. 捋下invokeBeanFactoryPostProcessors()主要处理流程</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>10</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126053792" title="【Spring源码】9. 超级重要的ConfigurationClassPostProcessor">【Spring源码】9. 超级重要的ConfigurationClassPostProcessor</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>11</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126107551" title="【Spring源码】10. 递归调用的processConfigurationClass()方法">【Spring源码】10. 递归调用的processConfigurationClass()方法</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>12</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126107412" title="【Spring源码】11. 我是注解类不？checkConfigurationClassCandidate()注解类判断方法详解">【Spring源码】11. 我是注解类不？checkConfigurationClassCandidate()注解类判断方法详解</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>13</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126136230" title="【Spring源码】12. 注册bean处理器registerBeanPostProcessors()">【Spring源码】12. 注册bean处理器registerBeanPostProcessors()</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>14</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126303691" title="【Spring源码】13. 国际化处理initMessageSource()源码解析">【Spring源码】13. 国际化处理initMessageSource()源码解析</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】<a href="https://blog.csdn.net/aqin1012/article/details/127171568" title="【保姆级】SpringBoot项目中的i18n国际化">【保姆级】SpringBoot项目中的i18n国际化</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>15</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/126644051" title="【Spring源码】14. 消息多播器（观察者模式）">【Spring源码】14. 消息多播器（观察者模式）</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】<a href="https://blog.csdn.net/aqin1012/article/details/126127883" title="【保姆级示例向】观察者模式">【保姆级示例向】观察者模式</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>16</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/127362286" title="【Spring源码】15. Bean的创建过程（1.概述篇）">【Spring源码】15. Bean的创建过程（1.概述篇）</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>17</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/127432109" title="【Spring源码】16. Bean的创建过程（2）">【Spring源码】16. Bean的创建过程（2）</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>18</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/127472470" title="【Spring源码】17.创建Bean这篇认真的@(・●・)@">【Spring源码】17.创建Bean这篇认真的@(・●・)@</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】</p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128188799" title="【保姆级·创建对象】如何通过Supplier创建对象">【保姆级·创建对象】如何通过Supplier创建对象</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128204883" title="【保姆级·创建对象】如何通过factory-method创建对象">【保姆级·创建对象】如何通过factory-method创建对象</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/127865881" title="【保姆级·创建对象】如何利用resolveBeforeInstantiation()在预处理阶段返回一个Bean的实例对象">【保姆级·创建对象】如何利用resolveBeforeInstantiation()在预处理阶段返回一个Bean的实例对象</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>19</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128002786" title="【Spring源码】18. factory-method创建对象关键函数详解：instantiateUsingFactoryMethod()">【Spring源码】18. factory-method创建对象关键函数详解：instantiateUsingFactoryMethod()</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>20</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128632696" title="【Spring源码】19. 没合适的构造器？找determineCandidateConstructors()！">【Spring源码】19. 没合适的构造器？找determineCandidateConstructors()！</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>21</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128633664" title="【Spring源码】20. MergedBeanDefinitionPostProcessor修改/合并bean定义">【Spring源码】20. MergedBeanDefinitionPostProcessor修改/合并bean定义</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】</p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128633923" title="【保姆级】@PostConstruct &amp; @PreDestroy使用示例">【保姆级】@PostConstruct &amp; @PreDestroy使用示例</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128644949" title="【Spring源码】AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition()详解">【Spring源码】AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition()详解</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128644909" title="【Spring源码】CommonAnnotationBeanPostProcessor.postProcessMergedBeanDefinition()详解">【Spring源码】CommonAnnotationBeanPostProcessor.postProcessMergedBeanDefinition()详解</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>22</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128656295" title="【Spring源码】21. 初探循环依赖">【Spring源码】21. 初探循环依赖</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】</p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128702039" title="【保姆级】手把手Debug循环依赖的整体流程">【保姆级】手把手Debug循环依赖的整体流程</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128715562" title="【实践向】当移除了三级缓存……">【实践向】当移除了三级缓存……</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128775251" title="【分析向】没有三级缓存会导致什么？">【分析向】没有三级缓存会导致什么？</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128785050" title="【Spring源码】插播一个创建代理对象的wrapIfNecessary()方法">【Spring源码】插播一个创建代理对象的wrapIfNecessary()方法</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>23</p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128800736" title="【Spring源码】22. 属性填充populateBean()详解">【Spring源码】22. 属性填充populateBean()详解</a></p> </td><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>【补充内容】</p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128812119" title="【Spring源码】自动注入·名称：autowireByName()详解">【Spring源码】自动注入·名称：autowireByName()详解</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128905209" title="【Spring源码】自动注入·类型：autowireByType()详解">【Spring源码】自动注入·类型：autowireByType()详解</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128922136" title="【Spring源码】属性值的解析与赋值：populateBean().applyPropertyValues()">【Spring源码】属性值的解析与赋值：populateBean().applyPropertyValues()</a></p> <p><a href="https://blog.csdn.net/aqin1012/article/details/128938759" title="【保姆级】超超超简单的自定义注解实现@Autowired同款功能">【保姆级】超超超简单的自定义注解实现@Autowired同款功能</a></p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:middle;"> <p>24</p> </td><td colspan="2" rowspan="1" style="vertical-align:middle;"> <p><a href="https://blog.csdn.net/aqin1012/article/details/128949267" title="【Spring源码】23. 执行初始化逻辑：initializeBean()">【Spring源码】23. 执行初始化逻辑：initializeBean()</a></p> </td></tr></tbody></table> 
<p id="main-toc"><strong>本文目录</strong></p> 
<p id="%F0%9F%8C%B0-toc" style="margin-left:0px;"><a href="#%F0%9F%8C%B0" rel="nofollow">🌰</a></p> 
<p id="%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" rel="nofollow">文件结构</a></p> 
<p id="%E2%80%8B%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%E2%80%8B%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB" rel="nofollow">​创建实体类</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">创建配置文件</a></p> 
<p id="%E6%96%B0%E5%BB%BASpring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E6%96%B0%E5%BB%BASpring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">新建Spring配置文件</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%B1%BB" rel="nofollow">创建测试类</a></p> 
<p id="%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C-toc" style="margin-left:80px;"><a href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" rel="nofollow">测试结果</a></p> 
<p id="%E2%80%8B%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90-toc" style="margin-left:80px;"><a href="#%E2%80%8B%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90" rel="nofollow">​测试分析</a></p> 
<p id="%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E4%B8%8D%E5%90%8C%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E4%B8%8D%E5%90%8C%E5%AE%9E%E4%BE%8B" rel="nofollow">获取一个类的不同实例</a></p> 
<p id="xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">xml配置文件</a></p> 
<p id="%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C-toc" style="margin-left:80px;"><a href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" rel="nofollow">测试结果</a></p> 
<p id="%E2%80%8B%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90-toc" style="margin-left:80px;"><a href="#%E2%80%8B%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90" rel="nofollow">​测试分析</a></p> 
<hr id="hr-toc"> 
<p>一句话：<strong>这个注解是在单例中引用原型使用的</strong></p> 
<p>详细点说：Spring中默认的对象都是单例的（而且Spring会在一级缓存中保存该对象以便下次直接获取），如果是原型作用域，每次会创建一个新的对象。如果在单例模式的bean下引用一个原型模式的bean，此时就需要引用lookup-method标签来解决此类问题。 个人理解：由于当调用getBean()方法时，Spring会先在容器中查找有没有这个类，或者这个类的子类，通常情况下，Spring在查找的时候，如果没有匹配或者匹配到多个类都会报错，然而我们又想在一个程序中实现如下两个功能：</p> 
<ul><li> <p>分别获取这个父类的两个不同的子类的实例</p> </li><li> <p>每次获取到的都是同一个类的不同实例</p> </li></ul> 
<p>而lookup-method这个标签就是解决这些问题的</p> 
<p>本文就是这两种情况的栗子🌰，感兴趣的同学可以跟着一步一步操作，绝对保姆级教程（不愧是俺(˶‾᷄ ⁻̫ ‾᷅˵)）</p> 
<h2 id="%F0%9F%8C%B0">🌰</h2> 
<p>获取同一父类的不同子类</p> 
<h3 id="%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">文件结构</h3> 
<p>这个示例一共需要新建6个文件</p> 
<p class="img-center"><img alt="" height="678" src="https://images2.imgbox.com/12/99/0yXyqMpO_o.png" width="367"></p> 
<h4 id="%E2%80%8B%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB">​创建实体类</h4> 
<p>有4个实体类（一个父类+两个子类+一个操作类）</p> 
<p><strong>Animal.java(父类)</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/82/e8/c0DYmi2K_o.png"></p> 
<pre><code class="language-java">package com.aqin.custom.MethodOverride.lookup;

/**
 * @Description
 * @Author aqin1012 AQin.
 * @Date 2022/8/22 9:28 AM
 * @Version 1.0
 */
public class Animal {
   public Animal() {
      System.out.println("吃点啥嘞？");
   }
}</code></pre> 
<p><strong>Cat.java</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/61/48/0zeJRJDr_o.png"></p> 
<pre><code class="language-java">package com.aqin.custom.MethodOverride.lookup;

/**
 * @Description
 * @Author aqin1012 AQin.
 * @Date 2022/8/22 10:01 AM
 * @Version 1.0
 */
public class Cat extends Animal{
   public Cat() {
      System.out.println("吃(_ _).｡oO……猫粮");
   }
}</code></pre> 
<p><strong>Dog.java</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e2/88/IyUBHmGy_o.png"></p> 
<pre><code class="language-java">package com.aqin.custom.MethodOverride.lookup;

/**
 * @Description
 * @Author aqin1012 AQin.
 * @Date 2022/8/22 9:29 AM
 * @Version 1.0
 */
public class Dog extends Animal{
   public Dog() {
      System.out.println("吃(*≧ω≦)……狗粮");
   }
}</code></pre> 
<p><strong>AnimalAction.java</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/42/85/Wp6MDMnJ_o.png"></p> 
<pre><code class="language-java">package com.aqin.custom.MethodOverride.lookup;

/**
 * @Description
 * @Author aqin1012 AQin.
 * @Date 2022/8/22 10:25 AM
 * @Version 1.0
 */
public abstract class AnimalAction {
   /**
    * 获取执行该动作的动物
    *
    * @return
    */
   public abstract Animal getAnimal();
}</code></pre> 
<h4 id="%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">创建配置文件</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c9/76/gRn9jFxE_o.png"></p> 
<h4 id="%E6%96%B0%E5%BB%BASpring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">新建Spring配置文件</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0b/76/eBOQUJEA_o.png"></p> 
<p>​添加如下bean定义：</p> 
<pre><code class="language-java">&lt;bean id="dog" class="com.aqin.custom.MethodOverride.lookup.Dog"&gt;&lt;/bean&gt;
&lt;bean id="cat" class="com.aqin.custom.MethodOverride.lookup.Cat"&gt;&lt;/bean&gt;

&lt;bean id="animalAction_A" class="com.aqin.custom.MethodOverride.lookup.AnimalAction"&gt;
   &lt;lookup-method name="getAnimal" bean="dog"&gt;&lt;/lookup-method&gt;
&lt;/bean&gt;

&lt;bean id="animalAction_B" class="com.aqin.custom.MethodOverride.lookup.AnimalAction"&gt;
   &lt;lookup-method name="getAnimal" bean="cat"&gt;&lt;/lookup-method&gt;
&lt;/bean&gt;</code></pre> 
<h4 id="%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%B1%BB">创建测试类</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f4/60/vXJ8l6Jd_o.png"></p> 
<pre><code class="language-java">package com.aqin.custom.MethodOverride.test;

import com.aqin.custom.MethodOverride.lookup.AnimalAction;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

/**
 * @Description
 * @Author aqin1012 AQin.
 * @Date 2022/8/22 10:29 AM
 * @Version 1.0
 */
public class TestMethodOverride {
   public static void main(String[] args) {
      ApplicationContext applicationContext = new ClassPathXmlApplicationContext("MethodOverride.xml");
      AnimalAction animalActionA = (AnimalAction) applicationContext.getBean("animalAction_A");
      animalActionA.getAnimal();
      AnimalAction animalActionB = (AnimalAction) applicationContext.getBean("animalAction_B");
      animalActionB.getAnimal();
   }
}</code></pre> 
<h4 id="%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">测试结果</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/52/97/ZsBGH8IB_o.png"></p> 
<h4 id="%E2%80%8B%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90">​测试分析</h4> 
<p>先在下图位置打个断点</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/80/af/9RPiAXBc_o.png"></p> 
<p>​选择debug方式执行</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/79/18/0nFmMxFX_o.png"></p> 
<p>不断下一步，直到我们在配置类中配置的4个Bean都能在this对象中的singletonObjects中找到的时候，我们来查看使用了lookup-method标签的那两个Bean，可以看到这两个对象都是cglib的代理对象</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/25/fb/PZnIQXvl_o.png"></p> 
<p>​当调用到getAnimal()方法时，会跳转到CglibSubclassingInstantiationStrategy中的intercept()方法中</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1a/58/JeUiwoQh_o.png"></p> 
<p>这里的lo是animalAction_A，可以看到lo中的beanName跟xml配置文件中animalAction_A的&lt;lookup-method name="getAnimal" bean="dog"&gt;&lt;/lookup-method&gt;标签中的bean="dog"是相对应的（animalAction_B类似）</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/50/6f/w9u3eQiP_o.png"></p> 
<h3 id="%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E4%B8%8D%E5%90%8C%E5%AE%9E%E4%BE%8B">获取一个类的不同实例</h3> 
<p>文件就用上面的结构就可以了，需要修改下测试类和xml配置文件</p> 
<p>测试类做如下修改</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b4/46/P2dg5wRa_o.png"></p> 
<pre><code class="language-java">public class TestMethodOverride {
   public static void main(String[] args) {
      ApplicationContext applicationContext = new ClassPathXmlApplicationContext("MethodOverride.xml");
      AnimalAction animalActionB = (AnimalAction) applicationContext.getBean("animalAction_B");
      animalActionB.getAnimal();
      AnimalAction animalActionB_2 = (AnimalAction) applicationContext.getBean("animalAction_B");
      animalActionB_2.getAnimal();
   }
}</code></pre> 
<h4 id="xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">xml配置文件</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a1/c0/N9d8wq0E_o.png"></p> 
<pre><code class="language-XML">&lt;bean id="dog" class="com.aqin.custom.MethodOverride.lookup.Dog" scope="prototype"&gt;&lt;/bean&gt;
&lt;bean id="cat" class="com.aqin.custom.MethodOverride.lookup.Cat" scope="prototype"&gt;&lt;/bean&gt;</code></pre> 
<h4>测试结果</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/91/72/k3CPp9ig_o.png"></p> 
<h4>​测试分析</h4> 
<p>此时this对象中的singletonObjects中就只有animalAction_A和animalAction_B两个了（因为Cat和Dog都的scope设置成了prototype（原型））</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ad/fc/QHHhI9MX_o.png"></p> 
<p>​可以看到，两次获取的Cat一个是Cat@1730，一个是Cat@1790，并不是同一个对象，实现了在单例中引用原型（单例的bean会被Spring放在一级缓存中保存，以便下次直接获取，所以每次获取到的都是同一个实例）</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/07/a9/fhtkdwF7_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b9/6a/js19rpHN_o.png"></p> 
<p>返回的实际上是一个动态代理生成的对象</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4a/89/mZeMOU0b_o.png"></p> 
<p>撒花(｡･ω･｡)ﾉ🎉🎉🎉</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/49b13fc01c9dffed711708ee0388170d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年超实用的27个VSCode插件推荐</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/580cf495dabcd67f13a4921aac4b95e8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java8 获取list对象属性到新的list</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>