<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker网络 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker网络" />
<meta property="og:description" content="Docker网络 一.Docker网络原理1.linux veth pair2.理解docker0 二.网络模式讲解1.bridge模式2.host模式3.none模式4.container模式5.自定义网络1.网络互通 一.Docker网络原理 1.linux veth pair 容器是相对独立的环境，相当于一个小型的 Linux 系统，外界无法直接访问，那他是怎么做的呢，这里我们先了解下 Linux veth pair
veth虚拟网络设备的特点就是它会成对出现，pair英文就是成对的意思，也就是说你创建veth的时候，他会创建一个对veth设备，veth设备一段连着linux网络协议栈，另一端连接的另外的veth设备，成对的veth发送数据后会直接到另一个veth设备上去。
veth pair将两个网络eth0和eth1连通
2.理解docker0 2.1查看本地ip
三个网络 1. lo 127.0.0.1 #本地回环地址 2. eth0 172.21.221.194 # 阿里云的私有IP 3. docker0 172.17.0.1 # docker网桥 lo和eth0在我们创建虚拟机的时候就会创建，但是docker0在我们安装了docker的时候就会创建，docker0用来和虚拟机之间通信
2.2启动一个容器，查看网络
[root@docker ~]# docker run -d -p 8080:8080 --name tomcat01 tomcat [root@docker ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ba0a3198a482 tomcat &#34;catalina.sh run&#34; 2 minutes ago Up 2 minutes 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/325383468ac9fa668a6457068c294ae4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-02T15:28:02+08:00" />
<meta property="article:modified_time" content="2023-11-02T15:28:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker网络</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Docker网络</h4> 
 <ul><li><a href="#Docker_1" rel="nofollow">一.Docker网络原理</a></li><li><ul><li><a href="#1linux_veth_pair_2" rel="nofollow">1.linux veth pair</a></li><li><a href="#2docker0_9" rel="nofollow">2.理解docker0</a></li></ul> 
  </li><li><a href="#_56" rel="nofollow">二.网络模式讲解</a></li><li><ul><li><a href="#1bridge_64" rel="nofollow">1.bridge模式</a></li><li><a href="#2host_74" rel="nofollow">2.host模式</a></li><li><a href="#3none_90" rel="nofollow">3.none模式</a></li><li><a href="#4container_99" rel="nofollow">4.container模式</a></li><li><a href="#5_113" rel="nofollow">5.自定义网络</a></li><li><ul><li><a href="#1_151" rel="nofollow">1.网络互通</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Docker_1"></a>一.Docker网络原理</h2> 
<h3><a id="1linux_veth_pair_2"></a>1.linux veth pair</h3> 
<p>容器是相对独立的环境，相当于一个小型的 Linux 系统，外界无法直接访问，那他是怎么做的呢，这里我们先了解下 Linux veth pair</p> 
<p>veth虚拟网络设备的特点就是它会<strong>成对出现</strong>，pair英文就是成对的意思，也就是说你创建veth的时候，他会创建一个对veth设备，veth设备一段连着linux网络协议栈，另一端连接的另外的veth设备，成对的veth发送数据后会直接到另一个veth设备上去。<br> <img src="https://images2.imgbox.com/f5/48/4AdjfvGu_o.png" alt=""></p> 
<blockquote> 
 <p>veth pair将两个网络eth0和eth1连通</p> 
</blockquote> 
<h3><a id="2docker0_9"></a>2.理解docker0</h3> 
<p><strong>2.1查看本地ip</strong><br> <img src="https://images2.imgbox.com/ba/e2/Yq82jAEL_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">三个网络
<span class="token number">1</span>. lo       <span class="token number">127.0</span>.0.1         <span class="token comment">#本地回环地址</span>
<span class="token number">2</span>. eth0     <span class="token number">172.21</span>.221.194    <span class="token comment"># 阿里云的私有IP</span>
<span class="token number">3</span>. docker0  <span class="token number">172.17</span>.0.1        <span class="token comment"># docker网桥</span>
</code></pre> 
<blockquote> 
 <p>lo和eth0在我们创建虚拟机的时候就会创建，但是docker0在我们安装了docker的时候就会创建，docker0用来和虚拟机之间通信</p> 
</blockquote> 
<p><strong>2.2启动一个容器，查看网络</strong></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker  run  -d -p 8080:8080  --name tomcat01  tomcat</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker  ps</span>
CONTAINER ID   IMAGE     COMMAND             CREATED         STATUS         PORTS                                       NAMES
ba0a3198a482   tomcat    <span class="token string">"catalina.sh run"</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes   <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat01
</code></pre> 
<p><img src="https://images2.imgbox.com/be/25/DMfy31T0_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>发现启动容器之后，多了一组网卡，而且是成对的。</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># 进入容器，查看容器内的ip</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker  exec -it  tomcat01  /bin/bash</span>
root@ba0a3198a482:/usr/local/tomcat<span class="token comment"># cat  /etc/hosts</span>
<span class="token number">127.0</span>.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
<span class="token number">172.17</span>.0.2      ba0a3198a482   <span class="token comment"># 容器内的ip地址</span>
</code></pre> 
<blockquote> 
 <p>结论：我们每启动一个容器，就会多出一对网卡，同时他们被连接到docker0上，而docker0又和虚拟机之间连通</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># 通过network ls查看列表</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
b8a696ab513c   bridge    bridge    <span class="token builtin class-name">local</span>    <span class="token comment"># docker0</span>
e789f4efb1cd   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
014233f751ef   none      null      <span class="token builtin class-name">local</span>
</code></pre> 
<p>通过inspect查看网络情况<br> <img src="https://images2.imgbox.com/19/1d/6GLnNHEo_o.png" alt="在这里插入图片描述"><br> <code>把docker0当作一个路由器的功能，任何一个容器启动都是docker0网络</code><br> <code>docker默认会给容器分配一个可用ip，并把它同docker项链，使用的就是veth-pair技术</code><br> <img src="https://images2.imgbox.com/5a/51/yNV29gij_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_56"></a>二.网络模式讲解</h2> 
<table><thead><tr><th>网络模式</th><th>配置</th><th>说明</th></tr></thead><tbody><tr><td>bridge模式</td><td>–net=bridge</td><td>默认值，在docker0上为容器创建新的网络栈</td></tr><tr><td>host模式</td><td>–net=host</td><td>容器和宿主机共享network namespace</td></tr><tr><td>none模式</td><td>–net=none</td><td>不配置网络，用户进入容器，自行配置</td></tr><tr><td>container模式</td><td>–net=container:name/id</td><td>容器和另一个容器共享network namespace</td></tr><tr><td>用户自定义</td><td>–net=自定义模式</td><td>用户自己使用network相关命令定义网络，创建容器的时候可以指定自己定义的网络</td></tr></tbody></table> 
<h3><a id="1bridge_64"></a>1.bridge模式</h3> 
<p>原理：docker服务默认创建一个docker0网桥，该桥接的网络名称为docker0，它在内核层联通了其他的物理或虚拟网卡，这就将所容器和本地主机都放在了一个物理网络，docker默认指定了docker0</p> 
<ol><li>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。</li><li>网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。</li></ol> 
<p><strong>运行并验证</strong><br> 宿主机中网卡和容器中网卡成对存在。<br> <img src="https://images2.imgbox.com/8d/a5/Yn3fD9wW_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1a/51/klYdNrM8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2host_74"></a>2.host模式</h3> 
<p>原理：直接使用宿主机得到的ip和端口于外界进行通信，不再需要额外进行nat转换。<br> 容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡而是使用宿主机的ip和端口<br> <img src="https://images2.imgbox.com/49/64/ke6FR4qY_o.png" alt="在这里插入图片描述"></p> 
<p>通过配置文件我们也可以看出，容器内没有进行网络配置<br> <img src="https://images2.imgbox.com/82/89/beluKkDX_o.png" alt="在这里插入图片描述"><br> <strong>运行并验证</strong><br> <code>注意：由于容器使用宿主机的ip和端口，在使用-p映射端口时，会报错</code></p> 
<p>docker启动时指定–network=host或-net=host，如果还指定了-p映射端口，那这个时候就会有此警告，并且通过-p设置的参数将不会起到任何作用，端口号会以主机端口号为主，重复时则递增。<br> <img src="https://images2.imgbox.com/06/c2/hvie7cgK_o.png" alt="在这里插入图片描述"><br> 查看容器的网络配置<br> docker inspect tomcat01<br> <img src="https://images2.imgbox.com/d2/66/4uicIjUX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3none_90"></a>3.none模式</h3> 
<p>原理：在none模式下，没有对docker容器进行任何网络配置。等于这个docker容器没有网卡，ip，路由信息，只有一个lo，这个时候需要我们自己为docker容器添加网卡，配置ip等。<br> 查看none模式的网络配置信息<br> <img src="https://images2.imgbox.com/be/7f/TvzMR2bR_o.png" alt="在这里插入图片描述"><br> <strong>运行并验证</strong><br> 没有ip等信息</p> 
<p><img src="https://images2.imgbox.com/15/ee/3VQBMToo_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4container_99"></a>4.container模式</h3> 
<p>原理：新建的容器和已经存在的一个容器共享一个网络ip配置而不是和宿主机共享。新创建的容器不会创建自己的网卡，培植自己的ip，而是和一个指定的容器共享ip，端口范围等。同样，两个容器除了网络方面，其他的如文件系统，进程列表等还是隔离的。<br> <img src="https://images2.imgbox.com/ec/60/0n1RJTuO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>运行并验证</strong><br> 新建一个容器centos01，查看网络信息<br> <img src="https://images2.imgbox.com/ff/b1/IIkzA5Jw_o.png" alt="在这里插入图片描述"></p> 
<p>在新建一个容器centos02，网络模式采用container模式，查看网络信息<br> <img src="https://images2.imgbox.com/1c/3e/hTyALa3F_o.png" alt="在这里插入图片描述"><br> 两个容器网络信息一样，如果centos01关机后，centos02网络是否发生变化？<br> 网络只剩下一个回环地址<br> <img src="https://images2.imgbox.com/42/b8/X7uP8RSu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_113"></a>5.自定义网络</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 创建两个容器</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">#docker  run  -it  --name centos01    centos   # ctrl+Q+P   不停止退出容器</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">#docker  run  -it  --name centos02    centos   # ctrl+Q+P   不停止退出容器</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker   ps</span>
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
590ef03a6ece   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">11</span> seconds ago   Up <span class="token number">10</span> seconds             centos02
7a681b1b7a87   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">41</span> seconds ago   Up <span class="token number">41</span> seconds             centos01
</code></pre> 
<p>两个容器之间互ping，ip可以通，服务名不通<br> <img src="https://images2.imgbox.com/0b/84/LY2ulROK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d1/2b/weRsRk8d_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2e/d3/S1Hw3ntg_o.png" alt="在这里插入图片描述"><br> <strong>自定义网络</strong></p> 
<blockquote> 
 <p>docker network create --help</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4c/4b/j1Q5QesU_o.png" alt="在这里插入图片描述"><br> 创建一个网络,并查看</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1  mynet</span>
7c45f7a7563bb8f14ac11e4f7563b88913135d7f5b14aebfe051f8b170ec3ec6
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker  network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
b8a696ab513c   bridge    bridge    <span class="token builtin class-name">local</span>
e789f4efb1cd   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
7c45f7a7563b   mynet     bridge    <span class="token builtin class-name">local</span>
014233f751ef   none      null      <span class="token builtin class-name">local</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8f/6c/GV8Xd4lR_o.png" alt="在这里插入图片描述"><br> 创建容器centos03和centos04放在同一个网络下mynet</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">#docker  run  -it  --name centos03  --network=mynet  centos   # ctrl+Q+P   不停止退出容器</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">#docker  run  -it  --name centos04  --network=mynet  centos   # ctrl+Q+P   不停止退出容器</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/70/47/87yErRYU_o.png" alt="在这里插入图片描述"><br> ping服务名和ip进行测试<img src="https://images2.imgbox.com/a2/b5/0qmzLR62_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1_151"></a>1.网络互通</h4> 
<p>已知centos01，centos02在一个网段，centos03，centos04在一个网段，他们能互相ping通？<br> 不同网段无法互通<br> <img src="https://images2.imgbox.com/93/ef/4aMlHFTO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d3/79/whQN9M7m_o.png" alt="在这里插入图片描述"><br> 不同Docker网络之间的容器想要连接的话，需要把该容器注册到另一个容器所在的网络上，使用docker connect命令<br> <img src="https://images2.imgbox.com/bc/d8/KvC2ximq_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>docker network connect mynet centos01</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/55/53/5pMgOMTd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/b5/uNRMigbf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/660435d667323f237ef0a6876060dbfe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">npm i 报错：Cannot read properties of null (reading ‘refs‘)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b064133b0f2b1f4c7cfcedd397a91d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx代理转发请求POST变GET请求问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>