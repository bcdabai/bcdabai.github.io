<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MCDF顶层验证方案 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MCDF顶层验证方案" />
<meta property="og:description" content="一、概述 MCDF的主要功能是将输入端的三个通道数据，通过数据整形和过滤，最终输出。
可以将MCDF的设计结构分别四个模块：
上行数据的通道从端（channel slave）仲裁器（arbiter）整形器（formatter）控制寄存器（control registers） 二、reg_env 对于寄存器模块的验证环境reg_env，它的组织包括：
reg_master_agent，提供寄存器接口驱动信号。reg_slave_agent，提供寄存器接口反馈信号。scoreboard，分别从reg_master_agent内的monitor和reg_slave_agent内的monitor获取监测数据，并且进行数据对比。 三、chnl_env 数据通道从端的验证环境chnl_env的组件包括：
chnl_master_agent，提供上行的激励数据。chnl_slave_agent，提供用来模拟arbiter仲裁信号，并且接受流出数据。reg_cfg_agent，用来提供模拟寄存器的配置信号，并且接收内置FIFO的余量信号。scoreboard，分别从chnl_master_agent、chnl_slave_agent、reg_cfg_agent的monitor接收检测数据，并且对channel的流入流出数据进行比对。
四、arb_env 仲裁器的验证环境arb_env的组件包括：
模拟channel输出接口的arbiter_master_agent的三个实例，用来对arbiter提供并行数据输入，同时对arbiter反馈的仲裁信号做出响应。arbiter_slave_agent，用来接收arbiter的输出数据，模拟formatter的行为，对arbiter的输出信号做出响应。reg_cfg_agent，提供用来模拟寄存器的配置信号，对三个channel数据源分别做出不同的优先级配置。scoreboard，从三个arbiter_master_agent、arbiter_slave_agent、reg_cfg_agent中的monitor获取监测数据，对arbiter的仲裁机制做出预测，并且将输入输出数据按照预测的优先级做出比对。 五、fmt_env 整形器的验证环境fmt_env的组件包括：
fmt_master_agent，用来模拟arbiter的输出数据。fmt_slave_agent，用来模拟MCDF的下行数据接收端。reg_cfg_agent，用来模拟寄存器的配置信号，用来指定输出数据包的长度。scoreboard，从fmt_master_agent、fmt_slave_agent、reg_cfg_agent的monitor获取检测数据，通过数据包长度来预测输出的数据包，与formatter输出的数据包进行比对。 六、环境集成方案一 MCDF顶层验证环境复用了这些模块验证环境的组件，reg_master_agent、chnl_master_agent、fmt_slave_agent，通过这三个激励组件可以有效生成新的激励序列，而将各个agent的sequencer句柄合并在一起时，virtual sequencer的作用就体现出来了，可以通过这个中心化的序列分发管道，将各个agent的sequencer也集中管理。MCDF的scoreboard提供了一个完整的数据通路覆盖方案，即从各个agent的monitor的数据检测端口将数据收集起来，同时建立MCDF的参考模型，预测输出数据包，最终进行数据比对。
验证环境结构图
代码实现
class mcdf_env1 extends uvm_env; `uvm_component_utils(mcdf_env1) reg_master_agent reg_mst; chnl_master_agent chnl_mst1; chnl_master_agent chnl_mst2; chnl_master_agent chnl_mst3; fmt_slave_agent fmt_slv; mcdf_virtual_sequencer virt_sqr; mcdf_scoreboard sb; function void build_phase(uvm_phase phase); super.build_phase(phase); reg_mst = reg_master_agent::type_id::create(&#34;reg_mst&#34;, this); chnl_mst1 = chnl_master_agent::type_id::create(&#34;chnl_mst1&#34;, this); chnl_mst2 = chnl_master_agent::type_id::create(&#34;chnl_mst2&#34;, this); chnl_mst3 = chnl_master_agent::type_id::create(&#34;chnl_mst3&#34;, this); fmt_slv = fmt_slave_agent::type_id::create(&#34;fmt_slv&#34;, this); virt_sqr = mcdf_virtual_sequencer::type_id::create(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/8d1cf405fadac2f8352c7a65a29862a0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-26T16:13:24+08:00" />
<meta property="article:modified_time" content="2021-02-26T16:13:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MCDF顶层验证方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、概述</h2> 
<p>MCDF的主要功能是将输入端的三个通道数据，通过数据整形和过滤，最终输出。</p> 
<p>可以将MCDF的设计结构分别四个模块：</p> 
<ul><li>上行数据的通道从端（channel slave）</li><li>仲裁器（arbiter）</li><li>整形器（formatter）</li><li>控制寄存器（control registers）</li></ul> 
<h2><a id="reg_env_10"></a>二、reg_env</h2> 
<p>对于寄存器模块的验证环境<code>reg_env</code>，它的组织包括：</p> 
<ul><li><code>reg_master_agent</code>，提供寄存器接口驱动信号。</li><li><code>reg_slave_agent</code>，提供寄存器接口反馈信号。</li><li><code>scoreboard</code>，分别从<code>reg_master_agent</code>内的<code>monitor</code>和<code>reg_slave_agent</code>内的<code>monitor</code>获取监测数据，并且进行数据对比。</li></ul> 
<p><img src="https://images2.imgbox.com/7d/fb/QqkttvMs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="chnl_env_19"></a>三、chnl_env</h2> 
<p>数据通道从端的验证环境<code>chnl_env</code>的组件包括：</p> 
<ul><li><code>chnl_master_agent</code>，提供上行的激励数据。</li><li><code>chnl_slave_agent</code>，提供用来模拟arbiter仲裁信号，并且接受流出数据。</li><li><code>reg_cfg_agent</code>，用来提供模拟寄存器的配置信号，并且接收内置FIFO的余量信号。</li><li><code>scoreboard</code>，分别从<code>chnl_master_agent</code>、<code>chnl_slave_agent</code>、<code>reg_cfg_agent</code>的<code>monitor</code>接收检测数据，并且对<code>channel</code>的流入流出数据进行比对。<br> <img src="https://images2.imgbox.com/05/2e/ChqDRa0Z_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="arb_env_26"></a>四、arb_env</h2> 
<p>仲裁器的验证环境arb_env的组件包括：</p> 
<ul><li>模拟channel输出接口的arbiter_master_agent的三个实例，用来对arbiter提供并行数据输入，同时对arbiter反馈的仲裁信号做出响应。</li><li>arbiter_slave_agent，用来接收arbiter的输出数据，模拟formatter的行为，对arbiter的输出信号做出响应。</li><li>reg_cfg_agent，提供用来模拟寄存器的配置信号，对三个channel数据源分别做出不同的优先级配置。</li><li>scoreboard，从三个arbiter_master_agent、arbiter_slave_agent、reg_cfg_agent中的monitor获取监测数据，对arbiter的仲裁机制做出预测，并且将输入输出数据按照预测的优先级做出比对。</li></ul> 
<p><img src="https://images2.imgbox.com/3b/61/iX6yI1z6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="fmt_env_36"></a>五、fmt_env</h2> 
<p>整形器的验证环境fmt_env的组件包括：</p> 
<ul><li>fmt_master_agent，用来模拟arbiter的输出数据。</li><li>fmt_slave_agent，用来模拟MCDF的下行数据接收端。</li><li>reg_cfg_agent，用来模拟寄存器的配置信号，用来指定输出数据包的长度。</li><li>scoreboard，从fmt_master_agent、fmt_slave_agent、reg_cfg_agent的monitor获取检测数据，通过数据包长度来预测输出的数据包，与formatter输出的数据包进行比对。</li></ul> 
<p><img src="https://images2.imgbox.com/82/6c/H2CJ7Qbl_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_49"></a>六、环境集成方案一</h2> 
<p>MCDF顶层验证环境复用了这些模块验证环境的组件，<code>reg_master_agent</code>、<code>chnl_master_agent</code>、<code>fmt_slave_agent</code>，通过这三个激励组件可以有效生成新的激励序列，而将各个<code>agent</code>的<code>sequencer</code>句柄合并在一起时，<code>virtual sequencer</code>的作用就体现出来了，可以通过这个中心化的序列分发管道，将各个<code>agent</code>的<code>sequencer</code>也集中管理。MCDF的<code>scoreboard</code>提供了一个完整的数据通路覆盖方案，即从各个<code>agent</code>的<code>monitor</code>的数据检测端口将数据收集起来，同时建立MCDF的参考模型，预测输出数据包，最终进行数据比对。</p> 
<p><strong>验证环境结构图</strong></p> 
<p><img src="https://images2.imgbox.com/2f/70/m4TouI82_o.png" alt="在这里插入图片描述"><br> <strong>代码实现</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">mcdf_env1</span> extends uvm_env<span class="token punctuation">;</span>
	`<span class="token function">uvm_component_utils</span><span class="token punctuation">(</span>mcdf_env1<span class="token punctuation">)</span>
	reg_master_agent reg_mst<span class="token punctuation">;</span>
	chnl_master_agent chnl_mst1<span class="token punctuation">;</span>
	chnl_master_agent chnl_mst2<span class="token punctuation">;</span>
	chnl_master_agent chnl_mst3<span class="token punctuation">;</span>
	fmt_slave_agent fmt_slv<span class="token punctuation">;</span>
	mcdf_virtual_sequencer virt_sqr<span class="token punctuation">;</span>
	mcdf_scoreboard sb<span class="token punctuation">;</span>
	
	function <span class="token keyword">void</span> <span class="token function">build_phase</span><span class="token punctuation">(</span>uvm_phase phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		super<span class="token punctuation">.</span><span class="token function">build_phase</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		reg_mst <span class="token operator">=</span> reg_master_agent<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"reg_mst"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst1 <span class="token operator">=</span> chnl_master_agent<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_mst1"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst2 <span class="token operator">=</span> chnl_master_agent<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_mst2"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst3 <span class="token operator">=</span> chnl_master_agent<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_mst3"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		fmt_slv <span class="token operator">=</span> fmt_slave_agent<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"fmt_slv"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		virt_sqr <span class="token operator">=</span> mcdf_virtual_sequencer<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"virt_sqr"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sb <span class="token operator">=</span> mcdf_scoreboard<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"sb"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endfunction
	
	function <span class="token keyword">void</span> <span class="token function">connect_phase</span><span class="token punctuation">(</span>uvm_phase phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		super<span class="token punctuation">.</span><span class="token function">connect_phase</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//virtual sequencer connect</span>
		virt_sqr<span class="token punctuation">.</span>reg_sqr <span class="token operator">=</span> reg_mst<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr1 <span class="token operator">=</span> chnl_mst1<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr2 <span class="token operator">=</span> chnl_mst2<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr3 <span class="token operator">=</span> chnl_mst3<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>fmt_sqr <span class="token operator">=</span> fmt_slv<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		<span class="token comment">//monitor transactions to scoreboard</span>
		reg_mst<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>ap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span>reg_export<span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst1<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>ap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span>chnl1_export<span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst2<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>ap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span>chnl2_export<span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_mst3<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>ap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span>chnl3_export<span class="token punctuation">)</span><span class="token punctuation">;</span>
		fmt_slv<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>ap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span>fmt_export<span class="token punctuation">)</span><span class="token punctuation">;</span>
	endfunction
endclass
</code></pre> 
<h2><a id="_98"></a>七、环境集成方案二</h2> 
<p>在方案一中最大的额外投入在于需要新建一个<code>scoreboard</code>用来检查MCDF的整体功能，而方案二的目的在于复用底层模块环境的<code>scoreboard</code>，减少顶层环境的额外成本，顶层环境的组件都直接复用了各个模块验证环境，顶层环境在集成模块验证环境时，需要将各个子模块中的<code>agent</code>配置为不同模式(<code>active</code>或者<code>passive</code>)，以此适应顶层场景，所以不需要实现新的<code>scoreboard</code>，而是可以复用原有模块验证环境的<code>scoreboard</code>。</p> 
<p><img src="https://images2.imgbox.com/7d/66/nUbujaOM_o.png" alt="在这里插入图片描述"></p> 
<p>方案一和方案二相同的地方在于，顶层都需要新建<code>virtual sequencer</code>和<code>sequence</code>，用来生成顶层的测试序列。而<code>virtual sequencer</code>也不是从零创建的，它本身也是利用原有模块环境的序列库，进行了有机的组合，最后协调生成了新的测试序列。从方案二可以看出，<code>mcdf_env</code>的子组件不再是<code>uvm_agent</code>类，而是各个模块的验证环境<code>uvm_env</code>类。通过直接复用这些子环境，也间接复用了它们内部的<code>scoreboard</code>，在<code>build</code>阶段，需要将各个子环境中不需要再产生激励的<code>agent</code>，配置为<code>passive</code>模式，而默认情况下这些<code>agent</code>均为<code>active</code>模式。这种复用方式使得我们无需再新建一个MCDF <code>scoreboard</code>，只需要确保MCDF的各个子模块都有<code>scoreboard</code>会检查功能，这样从整体上便可以覆盖完整的数据通路。</p> 
<p><strong>代码实现</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">mcdf_env1</span> extends uvm_env<span class="token punctuation">;</span>
	`<span class="token function">uvm_component_utils</span><span class="token punctuation">(</span>mcdf_env1<span class="token punctuation">)</span>
	reg_env reg_e<span class="token punctuation">;</span>
	chnl_env chnl_e1<span class="token punctuation">;</span>
	chnl_env chnl_e2<span class="token punctuation">;</span>
	chnl_env chnl_e3<span class="token punctuation">;</span>
	fmt_env fmt_e<span class="token punctuation">;</span>
	arb_env arb_e<span class="token punctuation">;</span>
	mcdf_virtual_sequencer virt_sqr<span class="token punctuation">;</span>
	
	function <span class="token keyword">void</span> <span class="token function">build_phase</span><span class="token punctuation">(</span>uvm_phase phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		super<span class="token punctuation">.</span><span class="token function">build_phase</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//将子环境配置为active或者passive模式</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"reg_e.slave"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e1.slave"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e1.reg_cfg"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e2.slave"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e2.reg_cfg"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e3.slave"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"chnl_e3.reg_cfg"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"arb_e.master1"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"arb_e.master2"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"arb_e.master3"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"arb_e.slave"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"arb_e.reg_cfg"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"fmt_e.master"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uvm_config_db#<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"fmt_e.reg_cfg"</span><span class="token punctuation">,</span> <span class="token string">"is_active"</span><span class="token punctuation">,</span> UVM_PASSIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//创建子环境</span>
		reg_e <span class="token operator">=</span> reg_env<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"reg_e"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_e1 <span class="token operator">=</span> chnl_env<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_e1"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_e2 <span class="token operator">=</span> chnl_env<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_e2"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		chnl_e3 <span class="token operator">=</span> chnl_env<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"chnl_e3"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		virt_sqr <span class="token operator">=</span> mcdf_virtual_sequencer<span class="token operator">::</span>type_id<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"virt_sqr"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	endfunction
	
	function <span class="token keyword">void</span> <span class="token function">connect_phase</span><span class="token punctuation">(</span>uvm_phase phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		super<span class="token punctuation">.</span><span class="token function">connect_phase</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//virtual sequencer connection</span>
		virt_sqr<span class="token punctuation">.</span>reg_sqr <span class="token operator">=</span> reg_e<span class="token punctuation">.</span>master<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr1 <span class="token operator">=</span> chnl_e1<span class="token punctuation">.</span>master<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr2 <span class="token operator">=</span> chnl_e2<span class="token punctuation">.</span>master<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>chnl_sqr3 <span class="token operator">=</span> chnl_e3<span class="token punctuation">.</span>master<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
		virt_sqr<span class="token punctuation">.</span>fmt_sqr <span class="token operator">=</span> fmt_e<span class="token punctuation">.</span>slave<span class="token punctuation">.</span>sequencer<span class="token punctuation">;</span>
	endfunction
endclass
</code></pre> 
<h2><a id="_158"></a>八、总结</h2> 
<p>从上面框图和代码中可以看出，UVM带来的环境复用，相比于之前SV验证环境具备了以下几个优势：</p> 
<ul><li>各个模块的验证环境是独立封装的，对外不需要保留数据端口，因此便于环境的进一步集成复用。</li><li>由于UVM自身的phase机制，在顶层协调各个子环境时，无需考虑由于子环境之间的例化顺序而导致的对象句柄引用悬空的问题。</li><li>由于子环境的测试序列是相对独立的，这使得顶层在复用子环境测试序列而构成<code>virtual sequence</code>时，不需要其它额外的迁移成本。</li><li>UVM提供的<code>config_db</code>配置方式，使得整体环境的结构和运行模式都可以从树状的<code>config</code>对象中获取，这也使得顶层环境可以在不同<code>uvm_test</code>进行集中管理配置。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/578b492ea72f8a6391ef5b3ce11d88f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">原生html中echarts的tooltip自动轮播、封装文件与使用（与上篇文章做对比）——（附源码）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5fa792f06b14e042a4e4cc8b18070512/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java真的要没落了？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>