<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s部署自己的web项目 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s部署自己的web项目" />
<meta property="og:description" content="一、静态网页项目 1.前端项目源码下载 链接：https://pan.baidu.com/s/15jCVawpyJxa0xhCJ9SwTCQ
提取码：m4an
2.编写nginx.conf和Dockerfile,放在项目根目录下 （1）. 创建nginx.conf 替换原镜像中的配置文件，并将对应的端口设置到9000（端口可自己设定） worker_processes 1; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; #有字体文件,加载css样式不出错 sendfile on; tcp_nodelay on; keepalive_timeout 30; server { listen 9000; server_name localhost; root /usr/share/nginx/dist; autoindex on; autoindex_exact_size off; autoindex_localtime on; location ~* \.(eot|ttf|ttc|otf|eot|woff|woff2|svg)$i{ try_files $uri $uri/ =404; index index.html index.htm; #设置首页 add_header Access-Control-Allow-Origin *; } } } （2）. 创建构建镜像的文件， Dockerfile FROM nginx RUN mkdir /usr/share/nginx/dist RUN rm -rf /etc/nginx/nginx." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/50357f6d1f0c23daf757ffdd591b5609/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-26T17:05:49+08:00" />
<meta property="article:modified_time" content="2019-11-26T17:05:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s部署自己的web项目</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>一、静态网页项目</h2> 
<h3><a id="1_2"></a>1.前端项目源码下载</h3> 
<p>链接：<a href="https://pan.baidu.com/s/15jCVawpyJxa0xhCJ9SwTCQ" rel="nofollow">https://pan.baidu.com/s/15jCVawpyJxa0xhCJ9SwTCQ</a><br> 提取码：m4an</p> 
<h3><a id="2nginxconfDockerfile_6"></a>2.编写nginx.conf和Dockerfile,放在项目根目录下</h3> 
<h4><a id="1_nginxconf_9000_7"></a>（1）. 创建nginx.conf 替换原镜像中的配置文件，并将对应的端口设置到9000（端口可自己设定）</h4> 
<pre><code class="prism language-key">worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;  #有字体文件,加载css样式不出错
    sendfile         on;
    tcp_nodelay       on;
    keepalive_timeout  30;
    server {
        listen 9000;
        server_name localhost;
        root /usr/share/nginx/dist;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        location  ~* \.(eot|ttf|ttc|otf|eot|woff|woff2|svg)$i{       
            try_files $uri $uri/ =404;
            index index.html index.htm;        #设置首页
            add_header Access-Control-Allow-Origin *;
        }
    }
}

</code></pre> 
<h4><a id="2__Dockerfile_35"></a>（2）. 创建构建镜像的文件， Dockerfile</h4> 
<pre><code class="prism language-dockerfile">FROM nginx
RUN mkdir /usr/share/nginx/dist
RUN rm -rf /etc/nginx/nginx.conf
COPY ./nginx.conf /etc/nginx/nginx.conf
COPY ./ /usr/share/nginx/dist
WORKDIR /usr/share/nginx/dist
EXPOSE 9000
</code></pre> 
<h3><a id="3yaml_46"></a>3.编写yaml文件，运行命令，部署服务</h3> 
<p>Yaml内容如下：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicationController
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaomweb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span>
   <span class="token key atrule">app</span><span class="token punctuation">:</span> xiaomweb
 <span class="token key atrule">template</span><span class="token punctuation">:</span>
   <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
     <span class="token key atrule">labels</span><span class="token punctuation">:</span>
       <span class="token key atrule">app</span><span class="token punctuation">:</span> xiaomweb
   <span class="token key atrule">spec</span><span class="token punctuation">:</span>
     <span class="token key atrule">containers</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaomweb
       <span class="token key atrule">image</span><span class="token punctuation">:</span> xiaomweb<span class="token punctuation">:</span>v1.0

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaomweb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
 <span class="token key atrule">ports</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span>
   <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30122 </span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span>
   <span class="token key atrule">app</span><span class="token punctuation">:</span> xiaomweb
</code></pre> 
<p><img src="https://images2.imgbox.com/5a/d6/yvTB9xlv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4Dockerfile_80"></a>4.通过Dockerfile构建镜像</h3> 
<p>首先k8s上查看pod在那个节点上，运行该节点终端<br> 切换到文件路径，运行命令：</p> 
<pre><code class="prism language-key">docker image build –t xiaomweb:v1.0 .   
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/b2/z3wB3x2o_o.png" alt="在这里插入图片描述"><br> Ps:如果有私有仓库最好，把镜像上传到仓库，配置docker源，就不用每次本地生成了。</p> 
<h3><a id="5_88"></a>5.通过端口访问服务</h3> 
<p>已经通过k8s将容器的端口9000，映射到集群每一台主机端口30122</p> 
<p><img src="https://images2.imgbox.com/09/a5/ATFWO4Jg_o.png" alt="在这里插入图片描述"><br> 在浏览器输入集群任何一台主机名加端口号30122，可以访问了<br> <img src="https://images2.imgbox.com/e4/8f/ADwHvxZA_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="javaweb_98"></a>二．javaweb项目</h2> 
<h3><a id="1_99"></a>1.项目源码下载</h3> 
<p>链接：<a href="https://pan.baidu.com/s/15mS48L9yyaHdyW2eoF7n_Q" rel="nofollow">https://pan.baidu.com/s/15mS48L9yyaHdyW2eoF7n_Q</a><br> 提取码：k7gk</p> 
<h3><a id="2k8smysql_103"></a>2.k8s部署mysql</h3> 
<p>mysql.Yaml:</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicationController
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>rc
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>rc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>pod
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql
        <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.6</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">3306</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MYSQL_ROOT_PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"123456"</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>svc
  <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>svc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">3306</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30306</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>pod
</code></pre> 
<pre><code class="prism language-shell">kubectl apply –f mysql.Yaml
</code></pre> 
<pre><code class="prism language-shell">kubectl get pod 
</code></pre> 
<pre><code class="prism language-shell">kubectl get svc
</code></pre> 
<p>创建表</p> 
<pre><code class="prism language-key">CREATE TABLE `user` (
  `id` int(11) NOT NULL auto_increment,
  `name` varchar(255) NOT NULL,
  `pwd` varchar(255) NOT NULL,
  `sex` varchar(255) NOT NULL,
  `home` varchar(255) NOT NULL,
  `info` varchar(255) NOT NULL,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

INSERT INTO `user` VALUES ('3', '123', '123', '123', '123', '123');
INSERT INTO `user` VALUES ('4', '123123', '123123', '男', '北京', '123123');
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/0f/lQuvZkux_o.png" alt="在这里插入图片描述"></p> 
<p>修改jdbc<br> <img src="https://images2.imgbox.com/49/ff/ooPb4kGH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3javaweb_178"></a>3.打包javaweb镜像</h3> 
<p>将项目打包成war，与dockerfile放一起</p> 
<p>Dockerfile:</p> 
<pre><code class="prism language-key"># 版本信息
FROM tomcat

#打包项目并拷贝到tomcat webapps目录
WORKDIR /usr/local/tomcat/webapps
ADD ./javaweb.war  /usr/local/tomcat/webapps

#开启内部服务端口
EXPOSE 8080

#启动tomcat服务器
CMD ["/usr/local/tomcat/bin/catalina.sh","run"] &amp;&amp; tail -f /usr/local/tomcat//logs/catalina.out
</code></pre> 
<pre><code class="prism language-key">docker build –t xiaoweb:v1.0 .  
</code></pre> 
<h3><a id="4k8sjavaweb_199"></a>4.k8s部署javaweb</h3> 
<p>xiaoweb.Yaml：</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicationController
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
        <span class="token key atrule">image</span><span class="token punctuation">:</span> xiaoweb<span class="token punctuation">:</span>v1.0
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
  <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30030</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoweb<span class="token punctuation">-</span>pod
</code></pre> 
<pre><code class="prism language-shell">kubectl apply -f xiaoweb.yaml
</code></pre> 
<pre><code class="prism language-shell">kubectl get pod
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/b0/xTCjawQ6_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-LPyqo0Rq-1574758557512)(https://note.youdao.com/yws/api/personal/file/WEBdb430fa4a60203dd3e228b7c1d32c715?method=getImage&amp;version=17&amp;cstk=Bm99i71g)]"></p> 
<pre><code class="prism language-shell">kubectl get svc
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/7e/mYjvRL4S_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_254"></a>5.浏览器访问测试</h3> 
<p><img src="https://images2.imgbox.com/62/ad/1x47L2Qf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bfb133a27fac53706c84512c9a5fab48/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UE4 Lerp(蓝图)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0dc2e5af265543fac7b82ebeaeaea706/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">（C语言）删除字符串中连续的重复字符</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>