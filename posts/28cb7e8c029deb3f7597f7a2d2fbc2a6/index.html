<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Delphi XE4中Or, In, CharInSet,哪个更快？ - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Delphi XE4中Or, In, CharInSet,哪个更快？" />
<meta property="og:description" content="在Delphi XE4中测试用Or,In,CharInSet三种方式，实现判断一个字符是否在一个字符数组中。 作者提供了代码： procedure TForm7.FormCreate(Sender: TObject); const Max = 200000000; var S : AnsiString; PBuffer : PByte; Count : Integer; I : Integer; pf : int64; st : int64; et : int64; begin WinApi.Windows.QueryPerformanceFrequency( pf );//获得机器内部定时器的时钟频率 SetLength( S, Max ); for I := 1 to Max do S[i] := AnsiChar( random(128-32) 31 ); WinApi.Windows.QueryPerformanceCounter( st );//取得开始值 Count := 0; PBuffer := @S[1]; while PAnsiChar(PBuffer)^&lt;&gt;#0 do begin if (PAnsiChar(PBuffer)^=&#39;M&#39;) or (PAnsiChar(PBuffer)^=&#39;Z&#39;) or (PAnsiChar(PBuffer)^=&#39;x&#39;) or (PAnsiChar(PBuffer)^=&#39;y&#39;) or (PAnsiChar(PBuffer)^=&#39;*&#39;) then Inc(Count); Inc( PBuffer ); end; WinApi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/28cb7e8c029deb3f7597f7a2d2fbc2a6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-12-31T17:11:21+08:00" />
<meta property="article:modified_time" content="2013-12-31T17:11:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Delphi XE4中Or, In, CharInSet,哪个更快？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <span style="background-color:rgb(255,255,255)"><span style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px">在Delphi XE4中测试用Or,In,CharInSet三种方式，实现判断一个字符是否在一个字符数组中。</span><span style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"></span></span> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">作者提供了代码：</span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)"><br> </span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <pre style="border:1px solid rgb(192,192,192); margin-left:20px; margin-right:20px; padding:5px 20px; font-family:'Courier new',monospace; font-size:12px; line-height:normal"><span style="background-color:rgb(255,255,255)"><code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">procedure</code> TForm7.FormCreate(Sender: TObject);
<code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">const</code>
  Max = 200000000;
<code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">var</code>
  S       : AnsiString;
  PBuffer : PByte;
  Count   : Integer;
  I       : Integer;
  pf      : int64;
  st      : int64;
  et      : int64;
<code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">begin</code>
  WinApi.Windows.QueryPerformanceFrequenc<wbr></wbr>y( pf );//<strong>获得机器内部定时器的时钟频率</strong>

  SetLength( S, Max );
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">for</code> I := 1 <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">to</code> Max <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">do</code> S[i] := AnsiChar( random(128-32) 31 );

  WinApi.Windows.QueryPerformanceCounter( st );<strong>//取得开始值</strong>
  Count := 0;
  PBuffer := @S[1];
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">while</code> PAnsiChar(PBuffer)^&lt;&gt;#0 <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">do</code> <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">begin</code>
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">if</code> (PAnsiChar(PBuffer)^=<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'M'</code>)
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">or</code> (PAnsiChar(PBuffer)^=<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'Z'</code>)
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">or</code> (PAnsiChar(PBuffer)^=<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'x'</code>)
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">or</code> (PAnsiChar(PBuffer)^=<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'y'</code>)
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">or</code> (PAnsiChar(PBuffer)^=<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'*'</code>)
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">then</code>
      Inc(Count);
    Inc( PBuffer );
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">end</code>;
  WinApi.Windows.QueryPerformanceCounter( et );<strong>//取得结束值</strong>
  Caption := Format(<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'%s, or:%d-%f'</code>,[Caption,Count, (et-st) / pf]);//计算出耗用的时长单位为秒

  WinApi.Windows.QueryPerformanceCounter( st );
  Count := 0;
  PBuffer := @S[1];
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">while</code> PAnsiChar(PBuffer)^&lt;&gt;#0 <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">do</code> <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">begin</code>
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">if</code> PAnsiChar(PBuffer)^ <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">in</code> [<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'M'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'Z'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'x'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'y'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'*'</code>]
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">then</code>
      Inc(Count);
    Inc( PBuffer );
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">end</code>;
  WinApi.Windows.QueryPerformanceCounter( et );
  Caption := Format(<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'%s, in:%d-%f'</code>,[Caption,Count, (et-st) / pf]);

  WinApi.Windows.QueryPerformanceCounter( st );
  Count := 0;
  PBuffer := @S[1];
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">while</code> PAnsiChar(PBuffer)^&lt;&gt;#0 <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">do</code> <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">begin</code>
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">if</code> CharInSet( PAnsiChar(PBuffer)^, [<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'M'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'Z'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'x'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'y'</code>,<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'*'</code>] )
    <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">then</code>
      Inc(Count);
    Inc( PBuffer );
  <code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">end</code>;
  WinApi.Windows.QueryPerformanceCounter( et );
  Caption := Format(<code style="font-family:'Courier new',monospace; color:rgb(128,0,0)">'%s, fn:%d-%f'</code>,[Caption,Count, (et-st) / pf]);

<code style="font-family:'Courier new',monospace; color:rgb(0,0,192)">end</code>;
</span></pre> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)"><br> </span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">得出的结论是用IN的方式最快，其次是OR,最愉的是用函数CharInSet。</span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)"><a target="_blank" href="http://photo.blog.sina.com.cn/showpic.html#blogid=44fa172f0101n7iz&amp;url=http://album.sina.com.cn/pic/44fa172ftx6CjbLHEd4c2" rel="nofollow noopener noreferrer" style="text-decoration:none; color:rgb(65,100,111)"><img src="https://images2.imgbox.com/26/09/cHrw5HAM_o.gif" alt="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" title="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" style="margin:0px; padding:0px; border:0px; list-style:none"></a><br> <br> </span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">看后我也用这个代码试了一下，情况与上面不同：</span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">在Debug状态下：</span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)"><a target="_blank" href="http://photo.blog.sina.com.cn/showpic.html#blogid=44fa172f0101n7iz&amp;url=http://album.sina.com.cn/pic/44fa172ftx6CjcHfyHb75" rel="nofollow noopener noreferrer" style="text-decoration:none; color:rgb(65,100,111)"><img src="https://images2.imgbox.com/b2/22/brWKDqCC_o.gif" height="224" width="519" alt="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" title="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" style="margin:0px; padding:0px; border:0px; list-style:none"></a><br> <br> </span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">在Release状态下：</span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)"><a target="_blank" href="http://photo.blog.sina.com.cn/showpic.html#blogid=44fa172f0101n7iz&amp;url=http://album.sina.com.cn/pic/44fa172ftx6CjcLK1Rob2" rel="nofollow noopener noreferrer" style="text-decoration:none; color:rgb(65,100,111)"><img src="https://images2.imgbox.com/25/65/DwQOM6tR_o.gif" height="224" width="519" alt="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" title="Delphi &lt;wbr&gt;XE4中Or, &lt;wbr&gt;In, &lt;wbr&gt;CharInSet,哪个更快？" style="margin:0px; padding:0px; border:0px; list-style:none"></a><br> <br> </span> 
</div> 
<div style="color:rgb(70,70,70); font-family:simsun; font-size:14px; line-height:21px"> 
 <span style="background-color:rgb(255,255,255)">在两种状态下，结果是不一样的，此外，在Release状态下，与原作者也有些偏差。你也一起来试试，看看是什么样的结果？</span> 
</div> 
<span style="background-color:rgb(255,255,255)"><br> </span> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86aca316d0fe505a6e9a630462603e1f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">delphi中in的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f84d631ab64a8f2b156afa3e79209081/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vs遇到异常，这可能是由某个拓展引起的的其他原因及解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>