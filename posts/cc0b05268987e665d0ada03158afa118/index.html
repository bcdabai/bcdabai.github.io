<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>cJson的学习与总结 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="cJson的学习与总结" />
<meta property="og:description" content="场景：需要进行大量数据解析，存储，传输
1.数据结构
typedef struct cJSON { struct cJSON *next,*prev; struct cJSON *child; int type; char *valuestring; int valueint; double valuedouble; char *string; } cJSON; 每个json对象都有一个type，对象的值可以是字符串(valuestring),整形(valueint)，浮点型(valuedouble)
2.创建json对象
cJSON_CreateObject//创建一个json对象-- {对象}
cJSON_AddStringToObject//向json对象中添加一个元素，元素的值是字符串-- {&#34;type&#34;:&#34;&#34;}
cJSON_AddNumberToObject//向json对象中添加一个对象，该对象的值是整形-- {&#34;type&#34;:int}
cJSON_CreateArray();//创建json对象数组-- [{ : } ,{ : }]
cJSON_CreateString//具体解释可参考下面例子
cJSON_CreateNumber//具体解释可参考下面例子
cJSON_Delete//释放内存
cJSON_PrintUnformatted(root) cJSON_Print(root)//将json数据转换成字符串，然后将字符串打印，第二个是含有换行符等格式的
举例：
2.1.创建 {&#34;name&#34;: &#34;fengxin&#34;, &#34;passwd&#34;: &#34;123&#34;, &#34;num&#34;: 1 } #include&lt;stdio.h&gt; #include&lt;stdlib.h&gt; #include&lt;string.h&gt; #include&#34;cJSON.h&#34; int main() { cJSON * usr; cJSON *arry; usr=cJSON_CreateObject(); //创建根数据对象 cJSON_AddStringToObject(usr,&#34;name&#34;,&#34;fengxin&#34;); //加入键值，加字符串 cJSON_AddStringToObject(usr,&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/cc0b05268987e665d0ada03158afa118/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-12T14:26:56+08:00" />
<meta property="article:modified_time" content="2018-04-12T14:26:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">cJson的学习与总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>场景：需要进行大量数据解析，存储，传输</p> 
<p>1.数据结构</p> 
<pre><code class="language-html">typedef struct cJSON {    
 struct cJSON *next,*prev;     
 struct cJSON *child;     
 int type;     
 char *valuestring;     
 int valueint;    
 double valuedouble;     
 char *string;     
} cJSON;  </code></pre> 
<p></p> 
<p>每个json对象都有一个type，对象的值可以是字符串(valuestring),整形(valueint)，浮点型(valuedouble)</p> 
<p>2.创建json对象</p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);">cJSON_CreateObject//创建一个json对象-- {对象}</span><br></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_AddStringToObject//向json对象中添加一个元素，元素的值是字符串-- {"type":""}</span><br></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_AddNumberToObject//向json对象中添加一个对象，该对象的值是整形-- {"type":int}</span><br></span></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_CreateArray();//创建json对象数组-- [{ : } ,{ : }]</span><br></span></span></span></p> 
<p style="text-align:left;"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);">cJSON_CreateString//具体解释可参考下面例子</span><br></p> 
<p style="text-align:left;"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_CreateNumber//<span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);">具体解释可参考下面例子</span></span><br></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_Delete//释放内存</span><br></span></span></span></p> 
<p><span style="background-color:rgb(255,255,255);color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:14px;">cJSON_PrintUnformatted(root)  <span style="color:rgb(85,85,85);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">cJSON_Print(root)//将json数据转换成字符串，然后将字符串打印，第二个是含有换行符等格式的</span></span></p> 
<p style="text-align:left;"></p> 
<p><span style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:#000000;"><span style="font-size:12px;background-color:rgb(248,248,248);">举例：</span></span></p> 
<p><span style="font-family:Consolas, 'Courier New', Courier, mono, serif;color:#000000;"><span style="font-size:12px;background-color:rgb(248,248,248);">2.1.创建 {<!-- --></span></span><span style="background-color:rgb(248,248,248);font-size:12px;color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;text-align:left;">"name": "fengxin", </span><span style="background-color:rgb(248,248,248);font-size:12px;color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;text-align:left;">"passwd":   "123",  </span><span style="background-color:rgb(248,248,248);font-size:12px;color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;text-align:left;">"num":  1  </span><span style="background-color:rgb(248,248,248);font-size:12px;color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;text-align:left;">} </span></p> 
<pre><code class="language-html">#include&lt;stdio.h&gt;  
#include&lt;stdlib.h&gt;  
#include&lt;string.h&gt;  
#include"cJSON.h"  
  
int main()  
{  
        cJSON * usr;  
        cJSON *arry;  
  
        usr=cJSON_CreateObject();   //创建根数据对象  
        cJSON_AddStringToObject(usr,"name","fengxin");  //加入键值，加字符串  
        cJSON_AddStringToObject(usr,"passwd","123");  
        cJSON_AddNumberToObject(usr,"num",1);  //加整数  
          
        char *out = cJSON_Print(usr);   //将json形式打印成正常字符串形式  
        printf("%s\n",out);  
         
        // 释放内存    
        cJSON_Delete(usr);    
        free(out);   
  
          
} </code></pre> 
<p>2.2 创建一个json数组，<span style="margin:0px;padding:0px;border:none;color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">[</span><span class="string" style="margin:0px;padding:0px;border:none;color:rgb(0,0,255);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">"Hello world"</span><span style="margin:0px;padding:0px;border:none;color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">,</span><span class="xcodenumber" style="margin:0px;padding:0px;border:none;color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">1</span><span class="xcodenumber" style="margin:0px;padding:0px;border:none;color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">0</span><span style="margin:0px;padding:0px;border:none;color:rgb(0,0,0);background-color:rgb(255,255,255);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;">] </span></p> 
<pre><code class="language-cpp">int create_js(void)  
{  
    cJSON *root, *js_body;  
    root = cJSON_CreateArray();  
    cJSON_AddItemToArray(root, cJSON_CreateString("Hello world"));  
    cJSON_AddItemToArray(root, cJSON_CreateNumber(10));   
    {  
//      char *s = cJSON_Print(root);  
        char *s = cJSON_PrintUnformatted(root);  
        if(s){  
           printf(" %s \n",s);  
            free(s);  
        }  
    }  
    if(root)  
    cJSON_Delete(root);  
  
    return 0;  
  
}  
  
int main(int argc, char **argv)  
{  
    create_js();  
    return 0;  
}</code></pre> 
<p>2.3  创建json  {"body":[{"name":"fengxin","status":100}]}  元素值是一个json数组，数组里面又含有两个json对象</p> 
<pre><code class="language-cpp">int create_js(void)  
{  
    cJSON *root, *js_body, *js_list;  
    root = cJSON_CreateObject();  
    cJSON_AddItemToObject(root,"body", js_body = cJSON_CreateArray());  
    cJSON_AddItemToArray(js_body, js_list = cJSON_CreateObject());  
    cJSON_AddStringToObject(js_list,"name","fengxin");  
    cJSON_AddNumberToObject(js_list,"status",100);  
  
    {  
        //        char *s = cJSON_Print(root);  
        char *s = cJSON_PrintUnformatted(root);  
        if(s){  
            printf(" %s \n",s);  
            free(s);  
        }  
    }  
    if(root)  
        cJSON_Delete(root);  
  
    return 0;  
}  
  
int main(int argc, char **argv)  
{  
    create_js();  
    return 0;  
}  </code></pre> 
<p>3. 解析json字符串</p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_Parse//将字符串转换成json对象</span><br></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_GetObjectItem//从json元素中获取一个元素</span><br></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);">cJSON_GetArraySize//获取json数组的长度</span><br></span></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);">cJSON_GetArrayItem//从json数组中获取一个对象</span><br></span></span></span></p> 
<p><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,0);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;text-align:left;background-color:rgb(255,255,255);">3.1解析字符串--{\"list\":{\"name\":\"xiao hong\",\"age\":10},\"other\":{\"name\":\"hua hua\"}} </span></span></span></span></p> 
<pre><code class="language-cpp">char *s = "{\"list\":{\"name\":\"xiao hong\",\"age\":10},\"other\":{\"name\":\"hua hua\"}}";  
cJSON *root = cJSON_Parse(s);  
if(!root) {  
    printf("get root faild !\n");  
    return -1;  
}  
  
cJSON *js_list = cJSON_GetObjectItem(root, "list");  
if(!js_list) {  
    printf("no list!\n");  
    return -1;  
}  
printf("list type is %d\n",js_list-&gt;type);  
  
cJSON *name = cJSON_GetObjectItem(js_list, "name");  
if(!name) {  
    printf("No name !\n");  
    return -1;  
}  
printf("name type is %d\n",name-&gt;type);  
printf("name is %s\n",name-&gt;valuestring);  
  
cJSON *age = cJSON_GetObjectItem(js_list, "age");  
if(!age) {  
    printf("no age!\n");  
    return -1;  
}  
printf("age type is %d\n", age-&gt;type);  
printf("age is %d\n",age-&gt;valueint);  
  
cJSON *js_other = cJSON_GetObjectItem(root, "other");  
if(!js_other) {  
    printf("no list!\n");  
    return -1;  
}  
printf("list type is %d\n",js_other-&gt;type);  
  
cJSON *js_name = cJSON_GetObjectItem(js_other, "name");  
if(!js_name) {  
    printf("No name !\n");  
    return -1;  
}  
printf("name type is %d\n",js_name-&gt;type);  
printf("name is %s\n",js_name-&gt;valuestring);  
  
if(root)  
    cJSON_Delete(root);  
    return 0;  </code></pre> 
<p>3.2.解析字符串;{\"list\":[\"name1\",\"name2\"]}</p> 
<pre><code class="language-cpp">int main(int argc, char **argv)  
{  
char *s = "{\"list\":[\"name1\",\"name2\"]}";  
cJSON *root = cJSON_Parse(s);  
if(!root) {  
    printf("get root faild !\n");  
    return -1;  
}  
cJSON *js_list = cJSON_GetObjectItem(root, "list");  
if(!js_list){  
    printf("no list!\n");  
    return -1;  
}  
int array_size = cJSON_GetArraySize(js_list);  
printf("array size is %d\n",array_size);  
int i = 0;  
cJSON *item;  
for(i=0; i&lt; array_size; i++) {  
    item = cJSON_GetArrayItem(js_list, i);  
    printf("item type is %d\n",item-&gt;type);  
    printf("%s\n",item-&gt;valuestring);  
}  
  
if(root)  
    cJSON_Delete(root);  
    return 0;  
} </code></pre> 
<p>3.3 解析字符串：{ \"list\":[{\"name\":\"xiao hong\",\"age\":10},{\"name\":\"hua hua\",\"age\":11}]}  ，注意下面示例中函数</p> 
<p>cJSON_PrintUnformatted的使用<br></p> 
<pre><code class="language-cpp">int main(int argc, char **argv)  
{  
char *s = "{\"list\":[{\"name\":\"xiao hong\",\"age\":10},{\"name\":\"hua hua\",\"age\":11}]}";  
cJSON *root = cJSON_Parse(s);  
if(!root) {  
    printf("get root faild !\n");  
    return -1;  
}  
cJSON *js_list = cJSON_GetObjectItem(root, "list");  
if(!js_list){  
    printf("no list!\n");  
    return -1;  
}  
int array_size = cJSON_GetArraySize(js_list);  
printf("array size is %d\n",array_size);  
int i = 0;  
cJSON *item,*it, *js_name, *js_age;  
char *p  = NULL;  
for(i=0; i&lt; array_size; i++) {  
    item = cJSON_GetArrayItem(js_list, i);  
    if(!item) {  
        //TODO...  
    }  
    p = cJSON_PrintUnformatted(item);  
    it = cJSON_Parse(p);  
    if(!it)  
        continue ;  
    js_name = cJSON_GetObjectItem(it, "name");  
    printf("name is %s\n",js_name-&gt;valuestring);  
    js_age = cJSON_GetObjectItem(it, "age");  
    printf("age is %d\n",js_age-&gt;valueint);  
  
}  
  
if(root)  
    cJSON_Delete(root);  
    return 0;  
}  </code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e0bb3be1074a0f3d09639ce5dfd922d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mask-rcnn训练完自己的数据集之后的测试demo</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/247fefb24972e3bf7ca27638794fed3d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">leetcode题解-Combination Sum系列</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>