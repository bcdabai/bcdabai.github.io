<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java ftp服务器_Java实现FTP服务器功能实例代码 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java ftp服务器_Java实现FTP服务器功能实例代码" />
<meta property="og:description" content="FTP(File Transfer Protocol 文件传输协议)是Internet 上用来传送文件的协议。在Internet上通过FTP 服务器可以进行文件的上传(Upload)或下载(Download)。FTP是实时联机服务，在使用它之前必须是具有该服务的一个用户(用户名和口令)，工作时客户端必须先登录到作为服务器一方的计算机上，用户登录后可以进行文件搜索和文件传送等有关操作，如改变当前工作目录、列文件目录、设置传输参数及传送文件等。使用FTP可以传送所有类型的文件，如文本文件、二进制可执行文件、图象文件、声音文件和数据压缩文件等。
FTP 命令
FTP 的主要操作都是基于各种命令基础之上的。常用的命令有：
设置传输模式，它包括ASCⅡ(文本) 和BINARY 二进制模式;
目录操作，改变或显示远程计算机的当前目录(cd、dir/ls 命令);
连接操作，open命令用于建立同远程计算机的连接；close命令用于关闭连接;
发送操作，put命令用于传送文件到远程计算机；mput 命令用于传送多个文件到远程计算机;
获取操作，get命令用于接收一个文件；mget命令用于接收多个文件。
import java.net.Socket;
import org.apache.log4j.Logger;
/**
* 角色——服务器A
* @author Leon
*
*/
public class ServerA{
public static void main(String[] args){
final String F_DIR = &#34;c:/test&#34;;//根路径
final int PORT = 22;//监听端口号
Logger.getRootLogger();
Logger logger = Logger.getLogger(&#34;com&#34;);
try{
ServerSocket s = new ServerSocket(PORT);
logger.info(&#34;Connecting to server A...&#34;);
logger.info(&#34;Connected Successful! Local Port:&#34;&#43;s.getLocalPort()&#43;&#34;. Default Directory:&#39;&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/61665797e45f2e2032502b2beecc500d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-12T13:00:45+08:00" />
<meta property="article:modified_time" content="2021-02-12T13:00:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java ftp服务器_Java实现FTP服务器功能实例代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>FTP(File Transfer Protocol 文件传输协议)是Internet 上用来传送文件的协议。在Internet上通过FTP 服务器可以进行文件的上传(Upload)或下载(Download)。FTP是实时联机服务，在使用它之前必须是具有该服务的一个用户(用户名和口令)，工作时客户端必须先登录到作为服务器一方的计算机上，用户登录后可以进行文件搜索和文件传送等有关操作，如改变当前工作目录、列文件目录、设置传输参数及传送文件等。使用FTP可以传送所有类型的文件，如文本文件、二进制可执行文件、图象文件、声音文件和数据压缩文件等。</p> 
 <p>FTP 命令</p> 
 <p>FTP 的主要操作都是基于各种命令基础之上的。常用的命令有：</p> 
 <p>设置传输模式，它包括ASCⅡ(文本) 和BINARY 二进制模式;</p> 
 <p>目录操作，改变或显示远程计算机的当前目录(cd、dir/ls 命令);</p> 
 <p>连接操作，open命令用于建立同远程计算机的连接；close命令用于关闭连接;</p> 
 <p>发送操作，put命令用于传送文件到远程计算机；mput 命令用于传送多个文件到远程计算机;</p> 
 <p>获取操作，get命令用于接收一个文件；mget命令用于接收多个文件。</p> 
 <p>import java.net.Socket;</p> 
 <p>import org.apache.log4j.Logger;</p> 
 <p>/**</p> 
 <p>* 角色——服务器A</p> 
 <p>* @author Leon</p> 
 <p>*</p> 
 <p>*/</p> 
 <p>public class ServerA{<!-- --></p> 
 <p>public static void main(String[] args){<!-- --></p> 
 <p>final String F_DIR = "c:/test";//根路径</p> 
 <p>final int PORT = 22;//监听端口号</p> 
 <p>Logger.getRootLogger();</p> 
 <p>Logger logger = Logger.getLogger("com");</p> 
 <p>try{<!-- --></p> 
 <p>ServerSocket s = new ServerSocket(PORT);</p> 
 <p>logger.info("Connecting to server A...");</p> 
 <p>logger.info("Connected Successful! Local Port:"+s.getLocalPort()+". Default Directory:'"+F_DIR+"'.");</p> 
 <p>while( true ){<!-- --></p> 
 <p>//接受客户端请求</p> 
 <p>Socket client = s.accept();</p> 
 <p>//创建服务线程</p> 
 <p>new ClientThread(client, F_DIR).start();</p> 
 <p>}</p> 
 <p>} catch(Exception e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>import java.io.BufferedReader;</p> 
 <p>import java.io.File;</p> 
 <p>import java.io.FileNotFoundException;</p> 
 <p>import java.io.IOException;</p> 
 <p>import java.io.InputStream;</p> 
 <p>import java.io.InputStreamReader;</p> 
 <p>import java.io.OutputStream;</p> 
 <p>import java.io.PrintWriter;</p> 
 <p>import java.io.RandomAccessFile;</p> 
 <p>import java.net.ConnectException;</p> 
 <p>import java.net.InetAddress;</p> 
 <p>import java.net.ServerSocket;</p> 
 <p>import java.net.Socket;</p> 
 <p>import java.net.UnknownHostException;</p> 
 <p>import java.nio.charset.Charset;</p> 
 <p>import java.util.Random;</p> 
 <p>import org.apache.log4j.Logger;</p> 
 <p>/**</p> 
 <p>* 客户端子线程类</p> 
 <p>* @author Leon</p> 
 <p>*</p> 
 <p>*/</p> 
 <p>public class ClientThread extends Thread {<!-- --></p> 
 <p>private Socket socketClient;//客户端socket</p> 
 <p>private Logger logger;//日志对象</p> 
 <p>private String dir;//绝对路径</p> 
 <p>private String pdir = "/";//相对路径</p> 
 <p>private final static Random generator = new Random();//随机数</p> 
 <p>public ClientThread(Socket client, String F_DIR){<!-- --></p> 
 <p>this.socketClient = client;</p> 
 <p>this.dir = F_DIR;</p> 
 <p>}</p> 
 <p>@Override</p> 
 <p>public void run() {<!-- --></p> 
 <p>Logger.getRootLogger();</p> 
 <p>logger = Logger.getLogger("com");</p> 
 <p>InputStream is = null;</p> 
 <p>OutputStream os = null;</p> 
 <p>try {<!-- --></p> 
 <p>is = socketClient.getInputStream();</p> 
 <p>os = socketClient.getOutputStream();</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>BufferedReader br = new BufferedReader(new InputStreamReader(is,</p> 
 <p>Charset.forName("UTF-8")));</p> 
 <p>PrintWriter pw = new PrintWriter(os);</p> 
 <p>String clientIp = socketClient.getInetAddress().toString().substring(1);//记录客户端IP</p> 
 <p>String username = "not logged in";//用户名</p> 
 <p>String password = "";//口令</p> 
 <p>String command = "";//命令</p> 
 <p>boolean loginStuts = false;//登录状态</p> 
 <p>final String LOGIN_WARNING = "530 Please log in with USER and PASS first.";</p> 
 <p>String str = "";//命令内容字符串</p> 
 <p>int port_high = 0;</p> 
 <p>int port_low = 0;</p> 
 <p>String retr_ip = "";//接收文件的IP地址</p> 
 <p>Socket tempsocket = null;</p> 
 <p>//打印欢迎信息</p> 
 <p>pw.println("220-FTP Server A version 1.0 written by Leon Guo");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; Connected, sending welcome message...");</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 220-FTP Server A version 1.0 written by Leon Guo");</p> 
 <p>boolean b = true;</p> 
 <p>while ( b ){<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>//获取用户输入的命令</p> 
 <p>command = br.readLine();</p> 
 <p>if(null == command) break;</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>pw.println("331 Failed to get command");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 331 Failed to get command");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>b = false;</p> 
 <p>}</p> 
 <p>/*</p> 
 <p>* 访问控制命令</p> 
 <p>*/</p> 
 <p>// USER命令</p> 
 <p>if(command.toUpperCase().startsWith("USER")){<!-- --></p> 
 <p>logger.info("(not logged in) ("+clientIp+")&gt; "+command);</p> 
 <p>username = command.substring(4).trim();</p> 
 <p>if("".equals(username)){<!-- --></p> 
 <p>pw.println("501 Syntax error");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("(not logged in) ("+clientIp+")&gt; 501 Syntax error");</p> 
 <p>username = "not logged in";</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println("331 Password required for " + username);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("(not logged in) ("+clientIp+")&gt; 331 Password required for " + username);</p> 
 <p>}</p> 
 <p>loginStuts = false;</p> 
 <p>} //end USER</p> 
 <p>// PASS命令</p> 
 <p>else if(command.toUpperCase().startsWith("PASS")){<!-- --></p> 
 <p>logger.info("(not logged in) ("+clientIp+")&gt; "+command);</p> 
 <p>password = command.substring(4).trim();</p> 
 <p>if(username.equals("root") &amp;&amp; password.equals("root")){<!-- --></p> 
 <p>pw.println("230 Logged on");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 230 Logged on");</p> 
 <p>// logger.info("客户端 "+clientIp+" 通过 "+username+"用户登录");</p> 
 <p>loginStuts = true;</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println("530 Login or password incorrect!");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("(not logged in) ("+clientIp+")&gt; 530 Login or password incorrect!");</p> 
 <p>username = "not logged in";</p> 
 <p>}</p> 
 <p>} //end PASS</p> 
 <p>// PWD命令</p> 
 <p>else if(command.toUpperCase().startsWith("PWD")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行PWD命令");</p> 
 <p>pw.println("257 /""+pdir+"/" is current directory");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 257 /""+pdir+"/" is current directory");</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end PWD</p> 
 <p>// CWD命令</p> 
 <p>else if(command.toUpperCase().startsWith("CWD")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>str = command.substring(3).trim();</p> 
 <p>if("".equals(str)){<!-- --></p> 
 <p>pw.println("250 Broken client detected, missing argument to CWD. /""+pdir+"/" is current directory.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 250 Broken client detected, missing argument to CWD. /""+pdir+"/" is current directory.");</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>//判断目录是否存在</p> 
 <p>String tmpDir = dir + "/" + str;</p> 
 <p>File file = new File(tmpDir);</p> 
 <p>if(file.exists()){//目录存在</p> 
 <p>dir = dir + "/" + str;</p> 
 <p>if("/".equals(pdir)){<!-- --></p> 
 <p>pdir = pdir + str;</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pdir = pdir + "/" + str;</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行CWD命令");</p> 
 <p>pw.println("250 CWD successful. /""+pdir+"/" is current directory");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 250 CWD successful. /""+pdir+"/" is current directory");</p> 
 <p>}</p> 
 <p>else{//目录不存在</p> 
 <p>pw.println("550 CWD failed. /""+pdir+"/": directory not found.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 550 CWD failed. /""+pdir+"/": directory not found.");</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end CWD</p> 
 <p>// QUIT命令</p> 
 <p>else if(command.toUpperCase().startsWith("QUIT")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>b = false;</p> 
 <p>pw.println("221 Goodbye");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 221 Goodbye");</p> 
 <p>try {<!-- --></p> 
 <p>Thread.currentThread();</p> 
 <p>Thread.sleep(1000);</p> 
 <p>} catch (InterruptedException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>} //end QUIT</p> 
 <p>/*</p> 
 <p>* 传输参数命令</p> 
 <p>*/</p> 
 <p>//PORT命令，主动模式传输数据</p> 
 <p>else if(command.toUpperCase().startsWith("PORT")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>str = command.substring(4).trim();</p> 
 <p>port_low = Integer.parseInt(str.substring(str.lastIndexOf(",")+1));</p> 
 <p>port_high = Integer.parseInt(str.substring(0, str.lastIndexOf(","))</p> 
 <p>.substring(str.substring(0, str.lastIndexOf(",")).lastIndexOf(",")+1));</p> 
 <p>String str1 = str.substring(0, str.substring(0, str.lastIndexOf(",")).lastIndexOf(","));</p> 
 <p>retr_ip = str1.replace(",", ".");</p> 
 <p>try {<!-- --></p> 
 <p>//实例化主动模式下的socket</p> 
 <p>tempsocket = new Socket(retr_ip,port_high * 256 + port_low);</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行PORT命令");</p> 
 <p>pw.println("200 port command successful");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 200 port command successful");</p> 
 <p>} catch (ConnectException ce) {<!-- --></p> 
 <p>pw.println("425 Can't open data connection.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 425 Can't open data connection.");</p> 
 <p>logger.error(ce.getMessage());</p> 
 <p>for(StackTraceElement ste : ce.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>} catch (UnknownHostException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>} catch (NumberFormatException e) {<!-- --></p> 
 <p>pw.println("503 Bad sequence of commands.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 503 Bad sequence of commands.");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end PORT</p> 
 <p>//PASV命令，被动模式传输数据</p> 
 <p>else if(command.toUpperCase().startsWith("PASV")) {<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>ServerSocket ss = null;</p> 
 <p>while( true ){<!-- --></p> 
 <p>//获取服务器空闲端口</p> 
 <p>port_high = 1 + generator.nextInt(20);</p> 
 <p>port_low = 100 + generator.nextInt(1000);</p> 
 <p>try {<!-- --></p> 
 <p>//服务器绑定端口</p> 
 <p>ss = new ServerSocket(port_high * 256 + port_low);</p> 
 <p>break;</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>continue;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行PASV命令");</p> 
 <p>InetAddress i = null;</p> 
 <p>try {<!-- --></p> 
 <p>i = InetAddress.getLocalHost();</p> 
 <p>} catch (UnknownHostException e1) {<!-- --></p> 
 <p>e1.printStackTrace();</p> 
 <p>}</p> 
 <p>pw.println("227 Entering Passive Mode ("+i.getHostAddress().replace(".", ",")+","+port_high+","+port_low+")");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 227 Entering Passive Mode ("+i.getHostAddress().replace(".", ",")+","+port_high+","+port_low+")");</p> 
 <p>try {<!-- --></p> 
 <p>//被动模式下的socket</p> 
 <p>tempsocket = ss.accept();</p> 
 <p>ss.close();</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end PASV</p> 
 <p>//RETR命令</p> 
 <p>else if(command.toUpperCase().startsWith("RETR")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>str = command.substring(4).trim();</p> 
 <p>if("".equals(str)){<!-- --></p> 
 <p>pw.println("501 Syntax error");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 501 Syntax error");</p> 
 <p>}</p> 
 <p>else {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>pw.println("150 Opening data channel for file transfer.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 150 Opening data channel for file transfer.");</p> 
 <p>RandomAccessFile outfile = null;</p> 
 <p>OutputStream outsocket = null;</p> 
 <p>try {<!-- --></p> 
 <p>//创建从中读取和向其中写入(可选)的随机访问文件流，该文件具有指定名称</p> 
 <p>outfile = new RandomAccessFile(dir+"/"+str,"r");</p> 
 <p>outsocket = tempsocket.getOutputStream();</p> 
 <p>} catch (FileNotFoundException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>byte bytebuffer[]= new byte[1024];</p> 
 <p>int length;</p> 
 <p>try{<!-- --></p> 
 <p>while((length = outfile.read(bytebuffer)) != -1){<!-- --></p> 
 <p>outsocket.write(bytebuffer, 0, length);</p> 
 <p>}</p> 
 <p>outsocket.close();</p> 
 <p>outfile.close();</p> 
 <p>tempsocket.close();</p> 
 <p>}</p> 
 <p>catch(IOException e){<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行RETR命令");</p> 
 <p>pw.println("226 Transfer OK");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 226 Transfer OK");</p> 
 <p>} catch (Exception e){<!-- --></p> 
 <p>pw.println("503 Bad sequence of commands.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 503 Bad sequence of commands.");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>}//end RETR</p> 
 <p>//STOR命令</p> 
 <p>else if(command.toUpperCase().startsWith("STOR")){<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>str = command.substring(4).trim();</p> 
 <p>if("".equals(str)){<!-- --></p> 
 <p>pw.println("501 Syntax error");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 501 Syntax error");</p> 
 <p>}</p> 
 <p>else {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>pw.println("150 Opening data channel for file transfer.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 150 Opening data channel for file transfer.");</p> 
 <p>RandomAccessFile infile = null;</p> 
 <p>InputStream insocket = null;</p> 
 <p>try {<!-- --></p> 
 <p>infile = new RandomAccessFile(dir+"/"+str,"rw");</p> 
 <p>insocket = tempsocket.getInputStream();</p> 
 <p>} catch (FileNotFoundException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>byte bytebuffer[] = new byte[1024];</p> 
 <p>int length;</p> 
 <p>try{<!-- --></p> 
 <p>while((length =insocket.read(bytebuffer) )!= -1){<!-- --></p> 
 <p>infile.write(bytebuffer, 0, length);</p> 
 <p>}</p> 
 <p>insocket.close();</p> 
 <p>infile.close();</p> 
 <p>tempsocket.close();</p> 
 <p>}</p> 
 <p>catch(IOException e){<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行STOR命令");</p> 
 <p>pw.println("226 Transfer OK");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 226 Transfer OK");</p> 
 <p>} catch (Exception e){<!-- --></p> 
 <p>pw.println("503 Bad sequence of commands.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 503 Bad sequence of commands.");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>} else {<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end STOR</p> 
 <p>//NLST命令</p> 
 <p>else if(command.toUpperCase().startsWith("NLST")) {<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>pw.println("150 Opening data channel for directory list.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 150 Opening data channel for directory list.");</p> 
 <p>PrintWriter pwr = null;</p> 
 <p>try {<!-- --></p> 
 <p>pwr= new PrintWriter(tempsocket.getOutputStream(),true);</p> 
 <p>} catch (IOException e1) {<!-- --></p> 
 <p>e1.printStackTrace();</p> 
 <p>}</p> 
 <p>File file = new File(dir);</p> 
 <p>String[] dirstructure = new String[10];</p> 
 <p>dirstructure= file.list();</p> 
 <p>for(int i=0;i</p> 
 <p>pwr.println(dirstructure[i]);</p> 
 <p>}</p> 
 <p>try {<!-- --></p> 
 <p>tempsocket.close();</p> 
 <p>pwr.close();</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行NLST命令");</p> 
 <p>pw.println("226 Transfer OK");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 226 Transfer OK");</p> 
 <p>} catch (Exception e){<!-- --></p> 
 <p>pw.println("503 Bad sequence of commands.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 503 Bad sequence of commands.");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}else{<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end NLST</p> 
 <p>//LIST命令</p> 
 <p>else if(command.toUpperCase().startsWith("LIST")) {<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>if(loginStuts){<!-- --></p> 
 <p>try{<!-- --></p> 
 <p>pw.println("150 Opening data channel for directory list.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 150 Opening data channel for directory list.");</p> 
 <p>PrintWriter pwr = null;</p> 
 <p>try {<!-- --></p> 
 <p>pwr= new PrintWriter(tempsocket.getOutputStream(),true);</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>FtpUtil.getDetailList(pwr, dir);</p> 
 <p>try {<!-- --></p> 
 <p>tempsocket.close();</p> 
 <p>pwr.close();</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"执行LIST命令");</p> 
 <p>pw.println("226 Transfer OK");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 226 Transfer OK");</p> 
 <p>} catch (Exception e){<!-- --></p> 
 <p>pw.println("503 Bad sequence of commands.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 503 Bad sequence of commands.");</p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>} else {<!-- --></p> 
 <p>pw.println(LOGIN_WARNING);</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+LOGIN_WARNING);</p> 
 <p>}</p> 
 <p>} //end LIST</p> 
 <p>// 输入非法命令</p> 
 <p>else{<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; "+command);</p> 
 <p>pw.println("500 Syntax error, command unrecognized.");</p> 
 <p>pw.flush();</p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; 500 Syntax error, command unrecognized.");</p> 
 <p>}</p> 
 <p>} //end while</p> 
 <p>try {<!-- --></p> 
 <p>logger.info("("+username+") ("+clientIp+")&gt; disconnected.");</p> 
 <p>// logger.info("用户"+clientIp+"："+username+"退出");</p> 
 <p>br.close();</p> 
 <p>socketClient.close();</p> 
 <p>pw.close();</p> 
 <p>if(null != tempsocket){<!-- --></p> 
 <p>tempsocket.close();</p> 
 <p>}</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>logger.error(e.getMessage());</p> 
 <p>for(StackTraceElement ste : e.getStackTrace()){<!-- --></p> 
 <p>logger.error(ste.toString());</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>import java.io.File;</p> 
 <p>import java.io.PrintWriter;</p> 
 <p>import java.text.SimpleDateFormat;</p> 
 <p>import java.util.Date;</p> 
 <p>/**</p> 
 <p>* FTP工具类</p> 
 <p>* @author Leon</p> 
 <p>*</p> 
 <p>*/</p> 
 <p>public class FtpUtil {<!-- --></p> 
 <p>public static void getDetailList(PrintWriter pw, String path){<!-- --></p> 
 <p>File dir = new File(path);</p> 
 <p>if (!dir.isDirectory()) {<!-- --></p> 
 <p>pw.println("500 No such file or directory./r/n");</p> 
 <p>}</p> 
 <p>File[] files = dir.listFiles();</p> 
 <p>String modifyDate;</p> 
 <p>for (int i = 0; i &lt; files.length; i++) {<!-- --></p> 
 <p>modifyDate = new SimpleDateFormat("yyyy/MM/dd hh:mm:ss")</p> 
 <p>.format(new Date(files[i].lastModified()));</p> 
 <p>if (files[i].isDirectory()) {<!-- --></p> 
 <p>pw.println("drwxr-xr-x ftp ftp 0 "</p> 
 <p>+ modifyDate + " " + files[i].getName());</p> 
 <p>} else {<!-- --></p> 
 <p>pw.println("-rw-r-r--1 ftp ftp "</p> 
 <p>+ files[i].length() + " " + modifyDate + " "</p> 
 <p>+ files[i].getName());</p> 
 <p>}</p> 
 <p>pw.flush();</p> 
 <p>}</p> 
 <p>pw.println("total:" + files.length);</p> 
 <p>}</p> 
 <p>}</p> 
 <p>### set log levels ###</p> 
 <p>log4j.logger.com =debug,stdout,D,E</p> 
 <p>### 输出到控制台 ###</p> 
 <p>log4j.appender.stdout=org.apache.log4j.ConsoleAppender</p> 
 <p>log4j.appender.stdout.Target=System.out</p> 
 <p>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</p> 
 <p>log4j.appender.stdout.layout.ConversionPattern = %d{ABSOLUTE} %5p %c{1}:%L - %m%n</p> 
 <p>## 输出DEBUG级别以上的日志</p> 
 <p>log4j.appender.D=org.apache.log4j.DailyRollingFileAppender</p> 
 <p>log4j.appender.D.File=c:/logs/logs.log</p> 
 <p>log4j.appender.D.Append =true</p> 
 <p>## 输出DEBUG级别以上的日志</p> 
 <p>log4j.appender.D.Threshold=DEBUG</p> 
 <p>log4j.appender.D.layout=org.apache.log4j.PatternLayout</p> 
 <p>log4j.appender.D.layout.ConversionPattern = %-d{yyyy-MM-dd HH:mm:ss} [ %t:%r ] - [ %p ] %m%n</p> 
 <p>### 保存异常信息到单独文件 ###</p> 
 <p>log4j.appender.E=org.apache.log4j.DailyRollingFileAppender</p> 
 <p>## 异常日志文件名</p> 
 <p>log4j.appender.E.File=c:/logs/errors.log</p> 
 <p>log4j.appender.E.Append=true</p> 
 <p>## 只输出ERROR级别以上的日志!!!</p> 
 <p>log4j.appender.E.Threshold=ERROR</p> 
 <p>log4j.appender.E.layout=org.apache.log4j.PatternLayout</p> 
 <p>log4j.appender.E.layout.ConversionPattern = %-d{yyyy-MM-dd HH:mm:ss} [ %t:%r ] - [ %p ] %m%n</p> 
 <p>以上内容是小编给大家介绍的Java实现FTP服务器功能实例代码的相关知识，希望大家喜欢。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/75c705ee1ca963564812a0a39ecfbfdb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">flutter 安装部署及开发问题总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/40f162c25e2b191cff94a4455cab9c0b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Shiro报异常org.apache.shiro.authz.AuthorizationException: Not authorized to invoke method:</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>