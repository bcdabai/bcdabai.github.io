<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32F103通过IIC协议实现温湿度（AHT20）的采集 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32F103通过IIC协议实现温湿度（AHT20）的采集" />
<meta property="og:description" content="一、IIC总线协议 1.1、IIC协议简介 ​ IIC通讯协议(Inter－Integrated Circuit)是由 Phiilps 公司开发的，由于它引脚少，硬件实现简单，可扩展性强，不需要 USART、CAN 等通讯协议的外部收发设备，现在被广泛地使用在系统内多个集成电路(IC)间的通讯。
1.2、IIC协议的物理层和协议层 （1）物理层
I2C是一个支持设备的总线。可连接多个 I2C 通讯设备，支持多个通讯主机及多个通讯从机。对于I2C 总线，只使用两条总线线路，一条双向串行数据线(SDA) ，一条串行时钟线(SCL)。
I2C 通讯设备常用连接方式：
它的物理层有如下特点：
① 它是一个支持设备的总线。“总线”指多个设备共用的信号线。在一个IIC通讯总线中，可连接多个IIC通讯设备，支持多个通讯主机及多个通讯从机。
② 一个IIC总线只使用两条总线线路，一条双向串行数据线(SDA) ，一条串行时钟线 (SCL)。数据线即用来表示数据，时钟线用于数据收发同步。
③ 每个连接到总线的设备都有一个独立的地址，主机可以利用这个地址进行不同设备之间的访问。
④ 总线通过上拉电阻接到电源。当IIC设备空闲时，会输出高阻态，而当所有设备都空闲，都输出高阻态时，由上拉电阻把总线拉成高电平。
⑤ 多个主机同时使用总线时，为了防止数据冲突，会利用仲裁方式决定由哪个设备占用总线。
⑥ 具有三种传输模式：标准模式传输速率为 100kbit/s ，快速模式为 400kbit/s ，高速模式下可达 3.4Mbit/s，但目前大多IIC设备尚不支持高速模式。
⑦ 连接到相同总线的 IC 数量受到总线的最大电容 400pF 限制 。
（2）协议层
主要是定义了通讯的起始和停止信号、数据有效性、响应、仲裁、时钟同步和地址广播等。
通讯的起始和停止信号：
数据有效性：
IIC 使用 SDA 信号线来传输数据，使用 SCL 信号线进行数据同步。SDA 数据线在 SCL 的每个时钟周期传输一位数据。传输时，SCL 为高电平的时候 SDA 表示的数据有效，即此时的 SDA 为高电平时表示数据“1”，为低电平时表示数据“0”。当 SCL 为低电平时，SDA 的数据无效，一般在这个时候 SDA 进行电平切换，为下一次表示数据做好准备。
响应：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/f48bae16fa9e010b63fd4cbf1672d6e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-14T20:44:18+08:00" />
<meta property="article:modified_time" content="2023-11-14T20:44:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32F103通过IIC协议实现温湿度（AHT20）的采集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="IIC_0"></a>一、IIC总线协议</h3> 
<h4><a id="11IIC_1"></a>1.1、IIC协议简介</h4> 
<p>​ IIC通讯协议(Inter－Integrated Circuit)是由 Phiilps 公司开发的，由于它引脚少，硬件实现简单，可扩展性强，不需要 USART、CAN 等通讯协议的外部收发设备，现在被广泛地使用在系统内多个集成电路(IC)间的通讯。</p> 
<h4><a id="12IIC_3"></a>1.2、IIC协议的物理层和协议层</h4> 
<p>（1）物理层<br> I2C是一个支持设备的总线。可连接多个 I2C 通讯设备，支持多个通讯主机及多个通讯从机。对于I2C 总线，只使用两条总线线路，一条双向串行数据线(SDA) ，一条串行时钟线(SCL)。<br> I2C 通讯设备常用连接方式：<br> <img src="https://images2.imgbox.com/61/63/0rktQiM4_o.png" alt="在这里插入图片描述"><br> 它的物理层有如下特点：</p> 
<p>① 它是一个支持设备的总线。“总线”指多个设备共用的信号线。在一个IIC通讯总线中，可连接多个IIC通讯设备，支持多个通讯主机及多个通讯从机。<br> ② 一个IIC总线只使用两条总线线路，一条双向串行数据线(SDA) ，一条串行时钟线 (SCL)。数据线即用来表示数据，时钟线用于数据收发同步。<br> ③ 每个连接到总线的设备都有一个独立的地址，主机可以利用这个地址进行不同设备之间的访问。<br> ④ 总线通过上拉电阻接到电源。当IIC设备空闲时，会输出高阻态，而当所有设备都空闲，都输出高阻态时，由上拉电阻把总线拉成高电平。<br> ⑤ 多个主机同时使用总线时，为了防止数据冲突，会利用仲裁方式决定由哪个设备占用总线。<br> ⑥ 具有三种传输模式：标准模式传输速率为 100kbit/s ，快速模式为 400kbit/s ，高速模式下可达 3.4Mbit/s，但目前大多IIC设备尚不支持高速模式。<br> ⑦ 连接到相同总线的 IC 数量受到总线的最大电容 400pF 限制 。</p> 
<p>（2）协议层<br> 主要是定义了通讯的起始和停止信号、数据有效性、响应、仲裁、时钟同步和地址广播等。</p> 
<p>通讯的起始和停止信号：<br> <img src="https://images2.imgbox.com/c5/9a/rEJiKlsq_o.png" alt="在这里插入图片描述"><br> 数据有效性：<br> IIC 使用 SDA 信号线来传输数据，使用 SCL 信号线进行数据同步。SDA 数据线在 SCL 的每个时钟周期传输一位数据。传输时，SCL 为高电平的时候 SDA 表示的数据有效，即此时的 SDA 为高电平时表示数据“1”，为低电平时表示数据“0”。当 SCL 为低电平时，SDA 的数据无效，一般在这个时候 SDA 进行电平切换，为下一次表示数据做好准备。<br> <img src="https://images2.imgbox.com/48/75/l0hn9HOI_o.png" alt="在这里插入图片描述"><br> 响应：<br> 当SDA传输数据后，接收方对接受到的数据进行一个应答。如果希望继续进行传输数据，则回应应答信号（低电平），否则回应非应答信号（高电平）。<br> <img src="https://images2.imgbox.com/ae/64/lJRPetnM_o.png" alt="在这里插入图片描述"><br> （3）硬件IIC和软件IIC<br> 想要控制STM32产生IIC方式的通讯，可以采用硬件IIC或软件模拟 这两种方式。<br> ① 硬件IIC:<br> 硬件IIC是指直接利用 STM32 芯片中的硬件IIC外设，该硬件IIC外设跟 USART串口外设类似，只要配置好对应的寄存器，外设就会产生标准串口协议的时序。使用它的IIC外设则可以方便地通过外设寄存器产生IIC协议方式的通讯，如初始化好IIC外设后，只需要把某寄存器位置 1，那么外设就会控制对应的 SCL 及 SDA 线自动产生IIC起始信号，而不需要内核直接控制引脚的电平。<br> ② 软件模拟：<br> 所谓软件模拟，即直接使用 CPU 内核按照 IIC协议的要求控制 GPIO 输出高低电平。如控制产生IIC的起始信号时，先控制作为 SCL 线的 GPIO 引脚输出高电平，然后控制作为 SDA 线的 GPIO 引脚在此期间完成由高电平至低电平的切换，最后再控制 SCL 线切换为低电平，这样就输出了一个标准的IIC起始信号。<br> ③ 两者区别：<br> 相对来说，硬件IIC直接使用外设来控制引脚，可以减轻 CPU 的负担。不过使用硬件IIC时必须使用某些固定的引脚作为 SCL 和 SDA，软件模拟IIC则可以使用任意GPIO引脚，相对比较灵活。在本开发板中，由于 STM32RCT6 芯片引脚较少，资源比较紧张，在设计硬件时不方便使用硬件IIC指定的引脚连接外部设备（EEPROM 存储器芯片），所以在控制程序上只能使用软件模拟 IIC的方式。</p> 
<h3><a id="_38"></a>二、配置程序实现温湿度采集</h3> 
<h4><a id="21_cubemx_39"></a>2.1 cubemx配置</h4> 
<p>1、选择STN32F103C8T6芯片创建一个新项目<br> 2、RCC<br> <img src="https://images2.imgbox.com/9a/74/Zs5f5gzg_o.png" alt="在这里插入图片描述"><br> 3、SYS<br> <img src="https://images2.imgbox.com/7c/c6/OcVmNsbh_o.png" alt="在这里插入图片描述"><br> 4、USART1<br> <img src="https://images2.imgbox.com/ae/fe/LapLk3sC_o.png" alt="在这里插入图片描述"><br> 5、GPIO<br> <img src="https://images2.imgbox.com/35/ab/J0aXu1TR_o.png" alt="在这里插入图片描述"><br> 6、I2C1<br> <img src="https://images2.imgbox.com/15/d4/P0ibblcE_o.png" alt="在这里插入图片描述"><br> 7、NVIC<br> <img src="https://images2.imgbox.com/d3/eb/Jqkbr1Bv_o.png" alt="在这里插入图片描述"><br> 8、时钟<br> <img src="https://images2.imgbox.com/03/36/1u6bp50p_o.png" alt="在这里插入图片描述"><br> 9、引脚配置<br> <img src="https://images2.imgbox.com/67/12/EhA0BPY2_o.png" alt="在这里插入图片描述"><br> 10、保存创建项目<br> <img src="https://images2.imgbox.com/0c/00/Fh66t2wJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/0b/TkeJI4xr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="22Keil_60"></a>2.2、Keil代码</h4> 
<p>1、AHT20芯片代码官网下载：http://www.aosong.com/class-36-2.html<br> 2、在MDY-ARM中新建AHT文件<br> <img src="https://images2.imgbox.com/9b/0b/zPJBmWAN_o.png" alt="在这里插入图片描述"><br> 3、将下载的代码复制到AHT中<br> <img src="https://images2.imgbox.com/1f/e7/H4q5Fwvk_o.png" alt="在这里插入图片描述"><br> 4、添加到项目中<br> <img src="https://images2.imgbox.com/c3/1c/YrXL1gi9_o.png" alt="在这里插入图片描述"><br> 点击OK<br> 5、点击魔法棒，添加路径<br> <img src="https://images2.imgbox.com/74/89/zYPF3RuP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/47/d9/6UWxJTgt_o.png" alt="在这里插入图片描述"><br> 6、修改AHT20-21_DEMO_V1_3.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_AHT20_DEMO_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_AHT20_DEMO_</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"main.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">Delay_4us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">Delay_5us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token keyword">void</span> <span class="token function">AHT20_Clock_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token punctuation">;</span> <span class="token comment">//将PB15配置为输出 ， 并设置为高电平， PB15作为I2C的SDA</span>
<span class="token keyword">void</span> <span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将P15配置为输出  并设置为低电平</span>
<span class="token keyword">void</span> <span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//SDA配置为浮空输入</span>
<span class="token keyword">void</span> <span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//SCL输出高电平，P14作为I2C的SCL</span>
<span class="token keyword">void</span> <span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//SCL输出低电平</span>
<span class="token keyword">void</span> <span class="token function">Init_I2C_Sensor_Port</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化I2C接口,输出为高电平</span>
<span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		 <span class="token comment">//I2C主机发送START信号</span>
<span class="token keyword">void</span> <span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Byte<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//往AHT20写一个字节</span>
<span class="token class-name">uint8_t</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从AHT20读取一个字节</span>
<span class="token class-name">uint8_t</span> <span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//看AHT20是否有回复ACK</span>
<span class="token keyword">void</span> <span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>	<span class="token punctuation">;</span>	  <span class="token comment">//主机回复ACK信号</span>
<span class="token keyword">void</span> <span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//主机不回复ACK</span>
<span class="token keyword">void</span> <span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  <span class="token comment">//一条协议结束</span>
<span class="token class-name">uint8_t</span> <span class="token function">AHT20_Read_Status</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取AHT20的状态寄存器</span>
<span class="token class-name">uint8_t</span> <span class="token function">AHT20_Read_Cal_Enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查询cal enable位有没有使能</span>
<span class="token keyword">void</span> <span class="token function">AHT20_SendAC</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//向AHT20发送AC命令</span>
<span class="token class-name">uint8_t</span> <span class="token function">Calc_CRC8</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>message<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> Num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">AHT20_Read_CTdata</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>ct<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//没有CRC校验，直接读取AHT20的温度和湿度数据</span>
<span class="token keyword">void</span> <span class="token function">AHT20_Read_CTdata_crc</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>ct<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//CRC校验后，读取AHT20的温度和湿度数据</span>
<span class="token keyword">void</span> <span class="token function">AHT20_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//初始化AHT20</span>
<span class="token keyword">void</span> <span class="token function">JH_Reset_REG</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///重置寄存器</span>
<span class="token keyword">void</span> <span class="token function">AHT20_Start_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///上电初始化进入正常测量状态</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>7、修改AHT20-21_DEMO_V1_3.c</p> 
<pre><code class="prism language-c"><span class="token comment">/*******************************************/</span>
<span class="token comment">/*@版权所有：广州奥松电子有限公司          */</span>
<span class="token comment">/*@作者：温湿度传感器事业部                */</span>
<span class="token comment">/*@版本：V1.2                              */</span>
<span class="token comment">/*******************************************/</span>
<span class="token comment">//#include "main.h" </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AHT20-21_DEMO_V1_3.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"gpio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"i2c.h"</span></span>


<span class="token keyword">void</span> <span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span><span class="token comment">//延时函数</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token class-name">uint32_t</span> k<span class="token punctuation">;</span>

   <span class="token keyword">while</span><span class="token punctuation">(</span>t<span class="token operator">--</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//110</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span><span class="token comment">//延时函数</span>
<span class="token punctuation">{<!-- --></span>
		
	<span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> t<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span> t<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span> t<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Delay_4us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		<span class="token comment">//延时函数</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">Delay_5us</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		<span class="token comment">//延时函数</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_N10us</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> t<span class="token punctuation">)</span>		<span class="token comment">//延时函数</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>t<span class="token operator">--</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时1ms</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//void AHT20_Clock_Init(void)		//延时函数</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//	RCC_APB2PeriphClockCmd(CC_APB2Periph_GPIOB,ENABLE);</span>
<span class="token comment">//}</span>

<span class="token keyword">void</span> <span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">//将PB7配置为输出 ， 并设置为高电平， PB7作为I2C的SDA</span>
<span class="token punctuation">{<!-- --></span>
	GPIO_InitTypeDef  GPIO_InitStruct<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span><span class="token comment">//推挽输出</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_7<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_HIGH<span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_7<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token comment">//将P7配置为输出  并设置为低电平</span>
<span class="token punctuation">{<!-- --></span>
	GPIO_InitTypeDef  GPIO_InitStruct<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span><span class="token comment">//推挽输出</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_7<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_HIGH<span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_7<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token comment">//SDA配置为浮空输入</span>
<span class="token punctuation">{<!-- --></span>
	GPIO_InitTypeDef  GPIO_InitStruct<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_INPUT<span class="token punctuation">;</span><span class="token comment">//浮空</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_7<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_HIGH<span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span> GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//SCL输出高电平，P14作为I2C的SCL</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_6<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//SCL输出低电平</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_6<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Init_I2C_Sensor_Port</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//初始化I2C接口,输出为高电平</span>
<span class="token punctuation">{<!-- --></span>	
	GPIO_InitTypeDef  GPIO_InitStruct<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span><span class="token comment">//推挽输出</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_7<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_HIGH<span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_15<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>

	
	GPIO_InitStruct<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_MODE_OUTPUT_PP<span class="token punctuation">;</span><span class="token comment">//推挽输出</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Pin <span class="token operator">=</span> GPIO_PIN_6<span class="token punctuation">;</span>
	GPIO_InitStruct<span class="token punctuation">.</span>Speed <span class="token operator">=</span> GPIO_SPEED_FREQ_HIGH<span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span><span class="token operator">&amp;</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_15<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		 <span class="token comment">//I2C主机发送START信号</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Byte<span class="token punctuation">)</span> <span class="token comment">//往AHT20写一个字节</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> Data<span class="token punctuation">,</span>N<span class="token punctuation">,</span>i<span class="token punctuation">;</span>	
	Data<span class="token operator">=</span>Byte<span class="token punctuation">;</span>
	i <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>N<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>N<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>N<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token function">Delay_4us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&amp;</span>Data<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>	
			
    <span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Delay_4us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Data <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		 
	<span class="token punctuation">}</span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
	<span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>	


<span class="token class-name">uint8_t</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//从AHT20读取一个字节</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">uint8_t</span> Byte<span class="token punctuation">,</span>i<span class="token punctuation">,</span>a<span class="token punctuation">;</span>
	Byte <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
    <span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token function">Delay_5us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		
		<span class="token comment">//if(GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_15)) a=1;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_7<span class="token punctuation">)</span><span class="token punctuation">)</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
		Byte <span class="token operator">=</span> <span class="token punctuation">(</span>Byte<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">|</span>a<span class="token punctuation">;</span>
		
		<span class="token comment">//SCL_Pin_Output_Low();</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_6<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Delay_5us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  <span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">return</span> Byte<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token class-name">uint8_t</span> <span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">//看AHT20是否有回复ACK</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint16_t</span> CNT<span class="token punctuation">;</span>
	CNT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span>GPIO_PIN_7<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">&amp;&amp;</span> CNT <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> 
	CNT<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>CNT <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>		  <span class="token comment">//主机回复ACK信号</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDA_Pin_IN_FLOATING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>	<span class="token comment">//主机不回复ACK</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	<span class="token function">SCL_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>	  <span class="token comment">//一条协议结束</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">SDA_Pin_Output_Low</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SCL_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDA_Pin_Output_High</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">uint8_t</span> <span class="token function">AHT20_Read_Status</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//读取AHT20的状态寄存器</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token class-name">uint8_t</span> Byte_first<span class="token punctuation">;</span>	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_first <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> Byte_first<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">uint8_t</span> <span class="token function">AHT20_Read_Cal_Enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token comment">//查询cal enable位有没有使能</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//ret = 0,</span>
  val <span class="token operator">=</span> <span class="token function">AHT20_Read_Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val <span class="token operator">&amp;</span> <span class="token number">0x68</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x08</span><span class="token punctuation">)</span>
		 <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">AHT20_SendAC</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//向AHT20发送AC命令</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0xac</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0xAC采集命令</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">//CRC校验类型：CRC8/MAXIM</span>
<span class="token comment">//多项式：X8+X5+X4+1</span>
<span class="token comment">//Poly：0011 0001  0x31</span>
<span class="token comment">//高位放到后面就变成 1000 1100 0x8c</span>
<span class="token comment">//C现实代码：</span>
<span class="token class-name">uint8_t</span> <span class="token function">Calc_CRC8</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>message<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> Num<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> byte<span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> crc<span class="token operator">=</span><span class="token number">0xFF</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>byte<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> byte<span class="token operator">&lt;</span>Num<span class="token punctuation">;</span> byte<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    crc<span class="token operator">^=</span><span class="token punctuation">(</span>message<span class="token punctuation">[</span>byte<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">--</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>crc<span class="token operator">&amp;</span><span class="token number">0x80</span><span class="token punctuation">)</span> crc<span class="token operator">=</span><span class="token punctuation">(</span>crc<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">0x31</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> crc<span class="token operator">=</span><span class="token punctuation">(</span>crc<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
        <span class="token keyword">return</span> crc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">AHT20_Read_CTdata</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>ct<span class="token punctuation">)</span> <span class="token comment">//没有CRC校验，直接读取AHT20的温度和湿度数据</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_1th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_2th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_3th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_4th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_5th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_6th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	 <span class="token class-name">uint32_t</span> RetuData <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token class-name">uint16_t</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_SendAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向AHT10发送AC命令</span>
	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时80ms左右	</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">AHT20_Read_Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//直到状态bit[7]为0，表示为空闲状态，若为1，表示忙状态</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">1508</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>cnt<span class="token operator">++</span><span class="token operator">&gt;=</span><span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
		 <span class="token keyword">break</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_1th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//状态字，查询到状态为0x98,表示为忙状态，bit[7]为1；状态为0x1C，或者0x0C，或者0x08表示为空闲状态，bit[7]为0</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_2th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_3th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_4th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度/温度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_5th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//温度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_6th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//温度</span>
	<span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_2th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_3th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_4th<span class="token punctuation">)</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span>RetuData <span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">;</span>
	ct<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> RetuData<span class="token punctuation">;</span><span class="token comment">//湿度</span>
	RetuData <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_4th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_5th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_6th<span class="token punctuation">)</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> RetuData<span class="token operator">&amp;</span><span class="token number">0xfffff</span><span class="token punctuation">;</span>
	ct<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>RetuData<span class="token punctuation">;</span> <span class="token comment">//温度</span>

<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">AHT20_Read_CTdata_crc</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>ct<span class="token punctuation">)</span> <span class="token comment">//CRC校验后，读取AHT20的温度和湿度数据</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_1th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_2th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_3th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_4th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_5th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_6th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token class-name">uint8_t</span>  Byte_7th<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	 <span class="token class-name">uint32_t</span> RetuData <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	 <span class="token class-name">uint16_t</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">// uint8_t  CRCDATA=0;</span>
	 <span class="token class-name">uint8_t</span>  CTDATA<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//用于CRC传递数组</span>
	
	<span class="token function">AHT20_SendAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向AHT10发送AC命令</span>
	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时80ms左右	</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">AHT20_Read_Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//直到状态bit[7]为0，表示为空闲状态，若为1，表示忙状态</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">SensorDelay_us</span><span class="token punctuation">(</span><span class="token number">1508</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>cnt<span class="token operator">++</span><span class="token operator">&gt;=</span><span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
		 <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_1th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//状态字，查询到状态为0x98,表示为忙状态，bit[7]为1；状态为0x1C，或者0x0C，或者0x08表示为空闲状态，bit[7]为0</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_2th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_3th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_4th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//湿度/温度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_5th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//温度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CTDATA<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span>Byte_6th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//温度</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_7th <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//CRC数据</span>
	<span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">//注意: 最后是发送NAK</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">Calc_CRC8</span><span class="token punctuation">(</span>CTDATA<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">==</span>Byte_7th<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_2th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_3th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_4th<span class="token punctuation">)</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span>RetuData <span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">;</span>
	ct<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> RetuData<span class="token punctuation">;</span><span class="token comment">//湿度</span>
	RetuData <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_4th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_5th<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> <span class="token punctuation">(</span>RetuData<span class="token operator">|</span>Byte_6th<span class="token punctuation">)</span><span class="token punctuation">;</span>
	RetuData <span class="token operator">=</span> RetuData<span class="token operator">&amp;</span><span class="token number">0xfffff</span><span class="token punctuation">;</span>
	ct<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>RetuData<span class="token punctuation">;</span> <span class="token comment">//温度</span>
		
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		ct<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
		ct<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//校验错误返回值，客户可以根据自己需要更改</span>
	<span class="token punctuation">}</span><span class="token comment">//CRC数据</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">AHT20_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">//初始化AHT20</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token function">Init_I2C_Sensor_Port</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0xa8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0xA8进入NOR工作模式</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时10ms左右</span>

	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0xbe</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0xBE初始化命令，AHT20的初始化命令是0xBE,   AHT10的初始化命令是0xE1</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x08</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相关寄存器bit[3]置1，为校准输出</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时10ms左右</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">JH_Reset_REG</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> addr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	
	<span class="token class-name">uint8_t</span> Byte_first<span class="token punctuation">,</span>Byte_second<span class="token punctuation">,</span>Byte_third<span class="token punctuation">;</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//原来是0x70</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时5ms左右</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_first <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_second <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Send_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Byte_third <span class="token operator">=</span> <span class="token function">AHT20_RD_Byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Send_NOT_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  <span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时10ms左右</span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span><span class="token number">0xB0</span><span class="token operator">|</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//寄存器命令</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span>Byte_second<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AHT20_WR_Byte</span><span class="token punctuation">(</span>Byte_third<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Receive_ACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Stop_I2C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	Byte_second<span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
	Byte_third <span class="token operator">=</span><span class="token number">0x00</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">AHT20_Start_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">JH_Reset_REG</span><span class="token punctuation">(</span><span class="token number">0x1b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">JH_Reset_REG</span><span class="token punctuation">(</span><span class="token number">0x1c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">JH_Reset_REG</span><span class="token punctuation">(</span><span class="token number">0x1e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>8、修改main.c<br> 在main.c和usart.c中添加头文件#include “stdio.h”，勾选Target中的use MicroLIB。</p> 
<pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN Header */</span>
<span class="token comment">/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2022 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */</span>
<span class="token comment">/* USER CODE END Header */</span>
<span class="token comment">/* Includes ------------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"main.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"dma.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"i2c.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"usart.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"gpio.h"</span></span>

<span class="token comment">/* Private includes ----------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN Includes */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AHT20-21_DEMO_V1_3.h"</span> </span>
<span class="token comment">/* USER CODE END Includes */</span>

<span class="token comment">/* Private typedef -----------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN PTD */</span>
<span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span>FILE <span class="token operator">*</span>f<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
		<span class="token comment">//等待发送结束	</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">__HAL_UART_GET_FLAG</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span>UART_FLAG_TC<span class="token punctuation">)</span><span class="token operator">!=</span>SET<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span>		

    <span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* USER CODE END PTD */</span>

<span class="token comment">/* Private define ------------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN PD */</span>
<span class="token comment">/* USER CODE END PD */</span>

<span class="token comment">/* Private macro -------------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN PM */</span>

<span class="token comment">/* USER CODE END PM */</span>

<span class="token comment">/* Private variables ---------------------------------------------------------*/</span>

<span class="token comment">/* USER CODE BEGIN PV */</span>

<span class="token comment">/* USER CODE END PV */</span>

<span class="token comment">/* Private function prototypes -----------------------------------------------*/</span>
<span class="token keyword">void</span> <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* USER CODE BEGIN PFP */</span>

<span class="token comment">/* USER CODE END PFP */</span>

<span class="token comment">/* Private user code ---------------------------------------------------------*/</span>
<span class="token comment">/* USER CODE BEGIN 0 */</span>

<span class="token comment">/* USER CODE END 0 */</span>

<span class="token comment">/**
  * @brief  The application entry point.
  * @retval int
  */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN 1 */</span>
	<span class="token class-name">uint32_t</span> CT_data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">int</span>  c1<span class="token punctuation">,</span>t1<span class="token punctuation">;</span>
	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* USER CODE END 1 */</span>

  <span class="token comment">/* MCU Configuration--------------------------------------------------------*/</span>

  <span class="token comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span>
  <span class="token function">HAL_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE BEGIN Init */</span>

  <span class="token comment">/* USER CODE END Init */</span>

  <span class="token comment">/* Configure the system clock */</span>
  <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE BEGIN SysInit */</span>

  <span class="token comment">/* USER CODE END SysInit */</span>

  <span class="token comment">/* Initialize all configured peripherals */</span>
  
  <span class="token function">MX_USART1_UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_DMA_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">MX_I2C1_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  <span class="token function">MX_USART1_UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  <span class="token comment">/* USER CODE BEGIN 2 */</span>
  <span class="token function">AHT20_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay_1ms</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE END 2 */</span>

  <span class="token comment">/* Infinite loop */</span>
  <span class="token comment">/* USER CODE BEGIN WHILE */</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* USER CODE END WHILE */</span>
		<span class="token comment">//AHT20_Read_CTdata(CT_data);       //不经过CRC校验，直接读取AHT20的温度和湿度数据    推荐每隔大于1S读一次</span>
		<span class="token function">AHT20_Read_CTdata_crc</span><span class="token punctuation">(</span>CT_data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//crc校验后，读取AHT20的温度和湿度数据 </span>
	

		c1 <span class="token operator">=</span> CT_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">;</span>  <span class="token comment">//计算得到湿度值c1（放大了10倍）</span>
		t1 <span class="token operator">=</span> CT_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">2000</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">-</span><span class="token number">500</span><span class="token punctuation">;</span><span class="token comment">//计算得到温度值t1（放大了10倍）</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"正在检测"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"温度:%d%d.%d"</span><span class="token punctuation">,</span>t1<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">(</span>t1<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">,</span>t1<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"湿度:%d%d.%d"</span><span class="token punctuation">,</span>c1<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">(</span>c1<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">,</span>c1<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"等待"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* USER CODE BEGIN 3 */</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END 3 */</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief System Clock Configuration
  * @retval None
  */</span>
<span class="token keyword">void</span> <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  RCC_OscInitTypeDef RCC_OscInitStruct <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  RCC_ClkInitTypeDef RCC_ClkInitStruct <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>OscillatorType <span class="token operator">=</span> RCC_OSCILLATORTYPE_HSE<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>HSEState <span class="token operator">=</span> RCC_HSE_ON<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>HSEPredivValue <span class="token operator">=</span> RCC_HSE_PREDIV_DIV1<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>HSIState <span class="token operator">=</span> RCC_HSI_ON<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLState <span class="token operator">=</span> RCC_PLL_ON<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLSource <span class="token operator">=</span> RCC_PLLSOURCE_HSE<span class="token punctuation">;</span>
  RCC_OscInitStruct<span class="token punctuation">.</span>PLL<span class="token punctuation">.</span>PLLMUL <span class="token operator">=</span> RCC_PLL_MUL9<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_RCC_OscConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_OscInitStruct<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Initializes the CPU, AHB and APB buses clocks
  */</span>
  RCC_ClkInitStruct<span class="token punctuation">.</span>ClockType <span class="token operator">=</span> RCC_CLOCKTYPE_HCLK<span class="token operator">|</span>RCC_CLOCKTYPE_SYSCLK
                              <span class="token operator">|</span>RCC_CLOCKTYPE_PCLK1<span class="token operator">|</span>RCC_CLOCKTYPE_PCLK2<span class="token punctuation">;</span>
  RCC_ClkInitStruct<span class="token punctuation">.</span>SYSCLKSource <span class="token operator">=</span> RCC_SYSCLKSOURCE_PLLCLK<span class="token punctuation">;</span>
  RCC_ClkInitStruct<span class="token punctuation">.</span>AHBCLKDivider <span class="token operator">=</span> RCC_SYSCLK_DIV1<span class="token punctuation">;</span>
  RCC_ClkInitStruct<span class="token punctuation">.</span>APB1CLKDivider <span class="token operator">=</span> RCC_HCLK_DIV2<span class="token punctuation">;</span>
  RCC_ClkInitStruct<span class="token punctuation">.</span>APB2CLKDivider <span class="token operator">=</span> RCC_HCLK_DIV1<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_RCC_ClockConfig</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>RCC_ClkInitStruct<span class="token punctuation">,</span> FLASH_LATENCY_2<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* USER CODE BEGIN 4 */</span>

<span class="token comment">/* USER CODE END 4 */</span>

<span class="token comment">/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */</span>
<span class="token keyword">void</span> <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN Error_Handler_Debug */</span>
  <span class="token comment">/* User can add his own implementation to report the HAL error return state */</span>
  <span class="token function">__disable_irq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END Error_Handler_Debug */</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span>  <span class="token expression">USE_FULL_ASSERT</span></span>
<span class="token comment">/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */</span>
<span class="token keyword">void</span> <span class="token function">assert_failed</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>file<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> line<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN 6 */</span>
  <span class="token comment">/* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */</span>
  <span class="token comment">/* USER CODE END 6 */</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* USE_FULL_ASSERT */</span></span>


</code></pre> 
<p>9、编译烧录<br> <img src="https://images2.imgbox.com/59/a3/8cU6jt3Q_o.png" alt="在这里插入图片描述"><br> 10、硬件连接<br> <img src="https://images2.imgbox.com/dd/41/hC9zf0eB_o.png" alt="在这里插入图片描述"><br> 11、运行<br> <img src="https://images2.imgbox.com/62/51/cn6PTjSy_o.png" alt="在这里插入图片描述"><br> 12、总结<br> 此次实验我了解了IIC总线通信协议，能使用STM32F103完成基于I2C协议的AHT20温湿度传感器的数据采集，并将采集的温度-湿度值通过串口输出。</p> 
<h3><a id="_889"></a>三、参考案例</h3> 
<p>1、https://blog.csdn.net/jynyyhd/article/details/127834397?spm=1001.2014.3001.5502<br> 2、https://blog.csdn.net/qq_43279579/article/details/111597278</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53628b12aea394d22ad5be4e89d52484/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Ubuntu20安装maskrcnn_benchmark（CUDA11.0.2）详细步骤</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7ea007b9a88f6bb8911d69e61733e7bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">多页面与单页面应用的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>