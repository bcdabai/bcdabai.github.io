<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vsftpd基本使用 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vsftpd基本使用" />
<meta property="og:description" content="ftp: 文件传输协议
两类连接：
命令连接：传输命令
数据连接：传输数据
两种模式：
主动模式：PORT 20/tcp连接客户端的命令连接使用的端口向后的第一个可用端口
被动模式：PASV 打开一个随机端口，并等待客户端连接
PAM: 插入式认证模块
认证框架：库，高度模块化
协议：C/S
Server: Filezilla proftpd pureftpd vsftpd
Client： ftp Filezilla CuteFTP FlashFXP lftp ftp gftp
vsftpd：
URL：SCHEME://HOST:PORT/PATH/TO/FILE
SCHEME://username:password@HOST:PORT/PATH/FILE
路径映射：用户家目录：每个用户的URL的映射到当前用户的家目录
安装vsftpd：yum install vsftpd
程序环境：
1、主程序：/usr/sbin/vsftpd
2、配置文件：/etc/vsftpd/vsftpd.conf
3、数据跟目录：/var/ftp
4、Systemd Unit File: /usr/lib/systemd/system/vsftpd.service
查看vsftpd的配置文件：
[root@server01 ~]# rpm -qc vsftpd
/etc/logrotate.d/vsftpd
/etc/pam.d/vsftpd
/etc/vsftpd/ftpusers
/etc/vsftpd/user_list
/etc/vsftpd/vsftpd.conf
vsftpd以ftp用户的身份运行进程，默认用户即为ftp用户，匿名用户的默认路径即ftp用户的家目录/var/ftp
查看ftp主机上用户的信息：
[root@server01 ~]# cat /etc/passwd | grep ^ftp
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
启动vsftpd:
向/var/ftp/pub下写一个测试文件： echo &#34;this is a hello world&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ef2627415eaaaa22a1b1897a141882a6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-10T23:20:23+08:00" />
<meta property="article:modified_time" content="2022-02-10T23:20:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vsftpd基本使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>ftp: 文件传输协议<br> 两类连接：<br> 命令连接：传输命令<br> 数据连接：传输数据</p> 
<p>两种模式：<br> 主动模式：PORT 20/tcp连接客户端的命令连接使用的端口向后的第一个可用端口<br> 被动模式：PASV 打开一个随机端口，并等待客户端连接</p> 
<p>PAM: 插入式认证模块<br> 认证框架：库，高度模块化</p> 
<p>协议：C/S<br>         Server: Filezilla proftpd pureftpd vsftpd<br>         Client： ftp Filezilla CuteFTP FlashFXP lftp ftp gftp</p> 
<p>vsftpd：<br>         URL：SCHEME://HOST:PORT/PATH/TO/FILE<br>                   SCHEME://username:password@HOST:PORT/PATH/FILE<br>         路径映射：用户家目录：每个用户的URL的映射到当前用户的家目录</p> 
<p>安装vsftpd：yum install vsftpd</p> 
<p>程序环境：<br> 1、主程序：/usr/sbin/vsftpd<br> 2、配置文件：/etc/vsftpd/vsftpd.conf<br> 3、数据跟目录：/var/ftp<br> 4、Systemd Unit File: /usr/lib/systemd/system/vsftpd.service</p> 
<p>查看vsftpd的配置文件：</p> 
<p>[root@server01 ~]# rpm -qc vsftpd<br> /etc/logrotate.d/vsftpd<br> /etc/pam.d/vsftpd<br> /etc/vsftpd/ftpusers<br> /etc/vsftpd/user_list<br> /etc/vsftpd/vsftpd.conf</p> 
<p><br> vsftpd以ftp用户的身份运行进程，默认用户即为ftp用户，匿名用户的默认路径即ftp用户的家目录/var/ftp<br> 查看ftp主机上用户的信息：</p> 
<p>[root@server01 ~]# cat /etc/passwd | grep ^ftp<br> ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</p> 
<p>启动vsftpd:</p> 
<p><img alt="" height="478" src="https://images2.imgbox.com/9e/40/soHvi5AS_o.png" width="1200"></p> 
<p> 向/var/ftp/pub下写一个测试文件： echo "this is a hello world" &gt; /var/ftp/pub/ftp.txt</p> 
<p>在同一网络内的另一台主机安装ftp客户端：</p> 
<p>[root@proxy ~]# yum install lftp ftp</p> 
<p>用户类别：</p> 
<p>A) 匿名用户</p> 
<p>匿名用户登录：<br> 用lftp客户端测试：</p> 
<p>匿名用户的三种登录方式：</p> 
<p>1、使用ftp作为用户名</p> 
<p><img alt="" height="176" src="https://images2.imgbox.com/d8/9c/2xBjH0Kz_o.png" width="1022"></p> 
<p>2、使用anonymous作为用户名</p> 
<p><img alt="" height="140" src="https://images2.imgbox.com/a6/95/9pO3cw2Q_o.png" width="1018"></p> 
<p> 3、缺省用户名</p> 
<p><img alt="" height="144" src="https://images2.imgbox.com/b4/02/CylkMK0o_o.png" width="1026"></p> 
<p>匿名用户配置：<br> 1、anonymous_enable：控制是否允许匿名登录。如果启用，用户名ftp和anonymous都被识别为匿名登录。默认：Yes<br> 2、anon_world_readable_only：当启用时，用户将只被允许下载为全局可读的文件。这识别为ftp用户可以拥有文件，尤其在出现上传时。默认：yes<br> 3、anon_mkdir_write_enable：如果设置成yes，匿名用户将被允许在某些情况下创建新目录。为了使这个起作用，必须激活write_enbable选项，默认：No<br> 4、anon_other_write_enable：如果设置成yes，匿名用户将被允许执行除了上传和创建目录外还允许执行写操作，诸如删除和重命名。通常不推荐这个，但为了完整性而包括。默认：No。<br> 5、anon_upload_enable：如果设置成Yes，匿名用户将在特定条件下被允许上传文件。为了使这个起作用，必须激活选项write_enable，并且匿名ftp用户必须对所要上传位置有写权限。对于虚拟用户要上传文件，也需要此设置；默认，用匿名权限对待虚拟用户。默认：No<br> 6、anon_umask：匿名长传的掩码<br> 7、anon_max_rate=0 匿名用户的最大上传下载速率。</p> 
<p>在开启anon_upload_enable=YES前，不允许匿名用户上传文件：</p> 
<p>上传一个本地路径下文件：</p> 
<p><img alt="" height="268" src="https://images2.imgbox.com/69/34/OLEJ304d_o.png" width="974"></p> 
<p> 修改/var/ftp/pub的目录所有者和所属组并且修改vsftpd.conf中anon_upload_enable=YES，并且重启vsftpd：</p> 
<p><img alt="" height="142" src="https://images2.imgbox.com/73/3c/DMcZjvIF_o.png" width="840"></p> 
<p> 在客户端测试上传当前路径中一个文件到ftp服务器：<img alt="" height="324" src="https://images2.imgbox.com/11/83/6nCOEh9w_o.png" width="1076"></p> 
<p> 在开启anon_mkdir_write_enable=YES前，不允许匿名用户在服务器上创建新目录：</p> 
<p><img alt="" height="116" src="https://images2.imgbox.com/a8/f9/ltloanZa_o.png" width="848"></p> 
<p> 设置anon_mkdir_write_enable=YES并且重启服务器，创建一个fold目录，显示创建成功：</p> 
<p><img alt="" height="390" src="https://images2.imgbox.com/ce/5c/Y94MRi7Y_o.png" width="1084"></p> 
<p> </p> 
<p> 注意：一个用户通过文件共享服务访问文件系统上的文件的实际权限是文件系统本身权限和共享权限的交集。<br>  </p> 
<p> 在设置anon_other_write_enable=YES前，服务器不允许客户端删除服务器上的文件：</p> 
<p><img alt="" height="176" src="https://images2.imgbox.com/4b/91/5KgdSHmI_o.png" width="886"></p> 
<p>设置anon_other_write_enable=YES，并且重启服务器，删除服务器上的一个文件和目录：</p> 
<p><img alt="" height="324" src="https://images2.imgbox.com/94/0c/U9CwNCQJ_o.png" width="1074"></p> 
<p> </p> 
<p> </p> 
<p>B) 系统用户：至少禁止系统用户访问ftp服务，/etc/vsftpd/ftpusers PAM(/etc/pam.d/vsftpd)</p> 
<p>在ftp服务器端创建一个登录用户并且设置其密码，在其家目录中创建一个文件：</p> 
<p><img alt="" height="266" src="https://images2.imgbox.com/b6/7d/VFi3i6v0_o.png" width="1176"></p> 
<p>用创建的用户名和密码登录ftp服务器，直接进入了这个用户的家目录，此用户可以切换到这个用户拥有访问权限的任何目录中：</p> 
<p><img alt="" height="672" src="https://images2.imgbox.com/15/b4/ODIG7pVA_o.png" width="1200">用户通过vsftpd服务访问到的默认路径，是用户自己家目录；默认可以自己有权限访问的所有路径间切换。<br> 1、local_enable=YES 是否启用本地用户<br> 2、write_enable=YES 本地用户是否可写<br> 3、local_umask=022  本地用户长传文件的掩码<br> 辅助配置文件/etc/vsftpd/ftpusers: 列在此文件中的用户，均禁止使用ftp服务<br> 4、local_max_rate=0 本地用户的上传下载速率<br> 5、chroot_local_user=YES 禁锢所有本地用户于家目录，需要事先去除用户对家目录的写权限<br> 6、chroot_list_enable=YES<br> 7、chroot_list_file=/etc/vsftpd/chroot_list 禁锢列表中文件存在的用户于其家目录中，需要事先去除用户对家目录的写权限</p> 
<p></p> 
<p>并发连接数限制：<br> max_clients=2000<br> max_per_ip=50</p> 
<p>把登录用户名添加到文件/etc/vsftpd/ftpusers后，这个用户就不能连接ftp服务器了。</p> 
<p>把ftpuser添加到/etc/vsftpd/ftpusers末尾后，ftpuser这个用户就不能正常登录ftp服务器了：</p> 
<p><img alt="" height="196" src="https://images2.imgbox.com/ec/ed/mJJxv1Zj_o.png" width="772"></p> 
<p> </p> 
<p>设置vsftpd.conf参数为如下：</p> 
<p>chroot_list_enable=YES<br> chroot_list_file=/etc/vsftpd/chroot_list</p> 
<p>在ftp服务器端，添加两个新用户并且设置密码，把ftpuser1添加到/etc/vsftpd/chroot_list文件末尾并且除去ftpuser1用户对家目录的写权限，重启vsftpd：</p> 
<p><img alt="" height="330" src="https://images2.imgbox.com/ee/fe/kM25yHVh_o.png" width="1024"></p> 
<p> 在客户端进行连接测试，用户ftpuser1被限制在自己的家目录中，而ftpuser2未被限制在家目录中：</p> 
<p><img alt="" height="944" src="https://images2.imgbox.com/1a/88/Uehh8Zjy_o.png" width="1190"></p> 
<p> </p> 
<p>控制可登录vsftpd服务的用户列表：<br> userlist_enable=YES<br> 启用/etc/vsftpd/user_list文件类控制可登录用户<br> userlist_deny=<br>                         YES：黑名单<br>                         NO：白名单</p> 
<p>启用白名单控制，设置userlist_enable=YES和userlist_deny=NO，并且删除/etc/vsftpd/user_list中原先内容，添加一个用户ftpuser1，重启vsftpd后，只有ftpuser1这个用户能够正常登录，其余用户都不能登录：</p> 
<p> <img alt="" height="674" src="https://images2.imgbox.com/7d/1c/ngczp1yJ_o.png" width="786"></p> 
<p> </p> 
<p>C) 虚拟用户：非系统用户，用户账号非为可登录操作系统的用户账号(非/etc/passwd)</p> 
<p>总结中...</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eee255cf64252abb1d6c6ff580d074af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">#Q8022. 十进制转换成八进制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f15a32e2407f4560407aa34c0d7db1da/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">猜数字游戏（java实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>