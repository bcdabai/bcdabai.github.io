<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Unity] Lua 学习笔记 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[Unity] Lua 学习笔记" />
<meta property="og:description" content="内容摘抄自runoob.com
1.Lua特性 1 轻量化
2 可扩展: 提供了非常易于使用的扩展接口和机制，宿主语言C/C&#43;&#43;提供功能，Lua可以直接使用。
3 其它:
支持面向过程和函数式编程自动内存管理：只提供一种通用类型的表(table)，用它可以实现数组，哈希表，集合，对象语言内置模式匹配，闭包，函数也可以看作一个值，提供多线程(协同进程，并非操作系统所支持的线程)支持通过闭包和table可以很方便地支持面向对象编程所需要的一些关键机制，比如数据抽象，虚函数，继承与重载。 2.基本语法 1 所有变量定义是默认为全局，如果访问一个没有定义的变量不会发生错误，得到的结果为nil
2 删除一个全局变量，只需要将变量赋值为nil
3 交互式编程，在命令行中输入程序就可以立即看到效果
4 脚本式编程，可以将lua程序保存到以lua结尾的文件中，使用$ lua xxx.lua可以得到结果。
5 单行注释--，多行注释--[[ xxxxx --]]
3.数据类型 Lua为动态类型语言，变量不需要类型定义，只需要为变量赋值。值可以存储在变量中，作为参数传递或结果返回。共8个基本类型变量。
3.1 nil (空类型) nil类型与C/C&#43;&#43;中的nullptr相类似。表示没有任何的有效值，例如打印一个没有赋值或者声明的变量那么就会输出一个nil值。
注意: 对于全局变量和table，nil还有删除作用，将全局变量或table中的某一个变量赋为nil，那么就相当于把这个值删除。
nil做比较时需要加上双引号，因为使用type(xxx) == &#34;nil&#34;作比较时，type(xxx)的返回值为字符串类型。
3.2 string (字符串类型) 表示字符串的几种方式
单引号 &#39;xxxxxx&#39;双引号 &#34;xxxxxx&#34;一块字符串 [[xxx 可以是多行]] 注意: 在对一个数字字符串进行算数操作时，Lua会自动将该数字字符串转换成为一个数字，并进行计算。
字符串连接使用 .. 进行连接，字符串计算使用#计算
示例：
&gt;print(2 &#43; &#34;2&#34;) &gt;10:48:23.13-346: 4 &gt;print(&#34;2&#34; &#43; &#34;2&#34;) &gt;10:48:33.107-949: 4 &gt;print(&#34;2 &#43; 2&#34;) &gt;10:48:46.700-762: 2 &#43; 2 &gt;print(&#34;-2e2&#34; * 3) &gt;10:49:00." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/a02ca94c41c5f003033d3e39ec7e7205/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-01T11:22:20+08:00" />
<meta property="article:modified_time" content="2021-11-01T11:22:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Unity] Lua 学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>内容摘抄自runoob.com</strong></p> 
<h2><a id="1Lua_1"></a>1.Lua特性</h2> 
<blockquote> 
 <p>1 <strong>轻量化</strong><br> 2 <strong>可扩展:</strong> 提供了非常易于使用的扩展接口和机制，宿主语言C/C++提供功能，Lua可以直接使用。<br> 3 <strong>其它:</strong></p> 
 <ul><li>支持面向过程和函数式编程</li><li>自动内存管理：只提供一种通用类型的表(<code>table</code>)，用它可以实现数组，哈希表，集合，对象</li><li>语言内置模式匹配，闭包，函数也可以看作一个值，提供多线程(协同进程，并非操作系统所支持的线程)支持</li><li>通过闭包和table可以很方便地支持面向对象编程所需要的一些关键机制，比如数据抽象，虚函数，继承与重载。</li></ul> 
</blockquote> 
<h2><a id="2_11"></a>2.基本语法</h2> 
<blockquote> 
 <p>1 所有变量定义是默认为全局，如果访问一个没有定义的变量不会发生错误，得到的结果为<code>nil</code><br> 2 删除一个全局变量，只需要将变量赋值为<code>nil</code><br> 3 交互式编程，在命令行中输入程序就可以立即看到效果<br> 4 脚本式编程，可以将lua程序保存到以lua结尾的文件中，使用<code>$ lua xxx.lua</code>可以得到结果。<br> 5 单行注释<code>--</code>，多行注释<code>--[[ xxxxx --]]</code></p> 
</blockquote> 
<h2><a id="3_19"></a>3.数据类型</h2> 
<p>  Lua为动态类型语言，变量不需要类型定义，只需要为变量赋值。值可以存储在变量中，作为参数传递或结果返回。共8个基本类型变量。<br> <img src="https://images2.imgbox.com/ab/61/JkURw5b1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31_nil__22"></a>3.1 nil (空类型)</h3> 
<p>  <code>nil</code>类型与C/C++中的<code>nullptr</code>相类似。表示没有任何的有效值，例如打印一个没有赋值或者声明的变量那么就会输出一个<code>nil</code>值。<br>    <strong>注意:</strong> 对于<code>全局变量</code>和<code>table</code>，<code>nil</code>还有删除作用，将<code>全局变量</code>或<code>table</code>中的某一个变量赋为<code>nil</code>，那么就相当于把这个值删除。<br> <strong>nil做比较时需要加上双引号</strong>，因为使用<code>type(xxx) == "nil"</code>作比较时，<code>type(xxx)</code>的返回值为字符串类型。</p> 
<h3><a id="32_string__28"></a>3.2 string (字符串类型)</h3> 
<blockquote> 
 <p><strong>表示字符串的几种方式</strong></p> 
 <ul><li>单引号 <code>'xxxxxx'</code></li><li>双引号 <code>"xxxxxx"</code></li><li>一块字符串 <code>[[xxx 可以是多行]]</code></li></ul> 
</blockquote> 
<p><strong>注意:</strong> 在对一个<code>数字字符串</code>进行算数操作时，Lua会自动将该<code>数字字符串</code>转换成为一个数字，并进行计算。<br> <strong>字符串连接使用 <code>..</code> 进行连接，字符串计算使用<code>#</code>计算</strong></p> 
<p><strong>示例：</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">23.13</span><span class="token operator">-</span><span class="token number">346</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"2"</span> <span class="token operator">+</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">33.107</span><span class="token operator">-</span><span class="token number">949</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"2 + 2"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">46.700</span><span class="token operator">-</span><span class="token number">762</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span>

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"-2e2"</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">:</span><span class="token number">00.837</span><span class="token operator">-</span><span class="token number">608</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">600</span>

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"-2e2"</span> <span class="token operator">*</span> <span class="token string">"3"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">:</span><span class="token number">11.445</span><span class="token operator">-</span><span class="token number">243</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">600</span>

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token range operator">..</span> <span class="token string">"b"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">:</span><span class="token number">24.361</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span> ab

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"hello"</span> <span class="token range operator">..</span> <span class="token string">" world"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">:</span><span class="token number">42.610</span><span class="token operator">-</span><span class="token number">106</span><span class="token punctuation">:</span> hello world

<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span>#<span class="token string">"hello world"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">49</span><span class="token punctuation">:</span><span class="token number">57.587</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">11</span>
</code></pre> 
<h3><a id="33_table__67"></a>3.3 table (表)</h3> 
<p><strong>创建方式:</strong></p> 
<blockquote> 
 <ul><li>创建一个空表<br> <code>local tbl1 = {}</code></li><li>直接初始化表<br> <code>local tbl2 = {"apple", "pear", "orange", "grape"}</code></li></ul> 
</blockquote> 
<p>  <strong>在<code>table</code>中可以存储任意类型的数据类型，也就是第一个<code>key-value</code>可以和第二个键值对是完全不同的数据类型，数组的索引可以是<code>数字</code>或<code>字符串</code></strong>.</p> 
<pre><code class="prism language-csharp">a <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
a<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"value"</span>
key <span class="token operator">=</span> <span class="token number">10</span>
a<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">22</span>
a<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">11</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>k <span class="token range operator">..</span> <span class="token string">" : "</span> <span class="token range operator">..</span> v<span class="token punctuation">)</span>
end

结果：
$ lua <span class="token class-name">table_test<span class="token punctuation">.</span>lua</span> 
key <span class="token punctuation">:</span> <span class="token keyword">value</span>
<span class="token number">10</span> <span class="token punctuation">:</span> <span class="token number">33</span>
</code></pre> 
<p>  <strong>在Lua中，表的默认索引为<code>1</code></strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> table_test2<span class="token punctuation">.</span>lua 脚本文件
<span class="token class-name">local</span> tbl <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"pear"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"grape"</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> key<span class="token punctuation">,</span> val <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>tbl<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Key"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
end

脚本执行结果为：
$ lua table_test2<span class="token punctuation">.</span>lua 
Key    <span class="token number">1</span>
Key    <span class="token number">2</span>
Key    <span class="token number">3</span>
Key    <span class="token number">4</span>
</code></pre> 
<p>  <strong><code>table</code>不会固定长度大小，有新数据添加时<code>table</code>长度会自动增长，没初始化的项都是<code>nil</code></strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> table_test3<span class="token punctuation">.</span>lua 脚本文件
a3 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token keyword">do</span>
    a3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i
end
a3<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"val"</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">[</span><span class="token string">"none"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

脚本执行结果为：
$ lua table_test3<span class="token punctuation">.</span>lua 
val
nil
</code></pre> 
<h3><a id="34_function__127"></a>3.4 function (函数)</h3> 
<p>  <code>function</code>可以与C/C++语法中一样，可以将函数值当作指针值，将其存储在变量中，那个变量就相当于函数名，通过那个变量就可以调用函数。</p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> function_test<span class="token punctuation">.</span>lua 脚本文件
<span class="token return-type class-name">function</span> <span class="token function">factorial1</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> then
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial1</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    end
<span class="token return-type class-name">end</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">factorial1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
factorial2 <span class="token operator">=</span> <span class="token return-type class-name">factorial1</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">factorial2</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

脚本执行结果为：
$ lua function_test<span class="token punctuation">.</span>lua 
<span class="token number">120</span>
<span class="token number">120</span>
</code></pre> 
<p><strong>匿名函数</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> function_test2<span class="token punctuation">.</span>lua 脚本文件
<span class="token return-type class-name">function</span> <span class="token function">testFun</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span>fun<span class="token punctuation">)</span>
        <span class="token keyword">for</span> k <span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span> <span class="token keyword">do</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fun</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        end
<span class="token class-name">end</span>

tab<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>key1<span class="token operator">=</span><span class="token string">"val1"</span><span class="token punctuation">,</span>key2<span class="token operator">=</span><span class="token string">"val2"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">testFun</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span>
<span class="token function">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token operator">--</span>匿名函数
        <span class="token keyword">return</span> key<span class="token range operator">..</span><span class="token string">"="</span><span class="token range operator">..</span>val<span class="token punctuation">;</span>
end
<span class="token punctuation">)</span><span class="token punctuation">;</span>

结果<span class="token punctuation">:</span>
$ lua <span class="token class-name">function_test2<span class="token punctuation">.</span>lua</span> 
key1 <span class="token operator">=</span> <span class="token class-name">val1</span>
key2 <span class="token operator">=</span> val2
</code></pre> 
<h3><a id="35_thread__172"></a>3.5 thread (线程)</h3> 
<p>  在 Lua 里，最主要的线程是协同程序（coroutine）。它跟线程（thread）差不多，拥有自己独立的栈、局部变量和指令指针，可以跟其他协同程序共享全局变量和其他大部分东西。</p> 
<p>  线程跟协程的区别：线程可以同时多个运行，而协程任意时刻只能运行一个，并且处于运行状态的协程只有被挂起（suspend）时才会暂停。</p> 
<h3><a id="36_userdata__177"></a>3.6 userdata (自定义类型)</h3> 
<p>  <code>userdata</code> 是一种用户自定义数据，用于表示一种由应用程序或 C/C++ 语言库所创建的类型，可以将任意 C/C++ 的任意数据类型的数据（通常是 struct 和 指针）存储到 Lua 变量中调用。</p> 
<h2><a id="4_181"></a>4.变量</h2> 
<p><strong>变量类型</strong></p> 
<blockquote> 
 <ul><li><strong>全局变量:</strong> 所有变量均为全局变量，在函数中或者语句块中定义的变量也是全局变量</li><li><strong>局部变量:</strong> 使用<code>local</code>显式声明的变量称为局部变量，局部变量的作用域从声明位置开始至所在语句块结束。</li></ul> 
</blockquote> 
<h3><a id="41__186"></a>4.1 变量间赋值</h3> 
<p>  给变量赋值可以改变变量的值，和变量的基本类型。<br>   <strong>Lua可以对多个变量同时赋值，变量列表和值列表用都好隔开，赋值语句右边的值会依次赋给左边的变量</strong></p> 
<pre><code class="prism language-csharp">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> x  <span class="token operator">==</span><span class="token operator">=&gt;</span>  a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> x
</code></pre> 
<p><strong>赋值语句Lua会计算右边所有的值然后再去执行赋值操作，可以利用此特性交换变量的值，不需要像C/C++那样需要使用中间变量进行值的交换</strong></p> 
<pre><code class="prism language-csharp">x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">,</span> x  <span class="token operator">==</span><span class="token operator">=&gt;</span>  swap <span class="token string character">'x'</span> <span class="token keyword">for</span> <span class="token string character">'y'</span>
a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token operator">==</span><span class="token operator">=&gt;</span>  swap 'a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>' <span class="token keyword">for</span> 'a<span class="token punctuation">[</span>j<span class="token punctuation">]</span>'
</code></pre> 
<p><strong>注意</strong></p> 
<blockquote> 
 <p>如果变量个数与给定值的个数不一致时，Lua会以变量个数为基础采取如下策略</p> 
 <ul><li><code>变量个数</code> &gt; <code>值的个数</code> --&gt; 按照变量个数补足<code>nil</code></li><li><code>变量个数</code> &lt; <code>值的个数</code> --&gt; 忽略多余的值</li></ul> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">34.893</span><span class="token operator">-</span><span class="token number">234</span><span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token number">1</span>    nil

<span class="token operator">&gt;</span>a<span class="token punctuation">,</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">+</span> <span class="token number">2</span>
<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">46</span><span class="token punctuation">:</span><span class="token number">01.732</span><span class="token operator">-</span><span class="token number">839</span><span class="token punctuation">:</span> <span class="token number">1</span>    <span class="token number">2</span>

<span class="token operator">&gt;</span>d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f <span class="token operator">=</span> <span class="token number">0</span>
<span class="token operator">&gt;</span><span class="token function">print</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">46</span><span class="token punctuation">:</span><span class="token number">17.848</span><span class="token operator">-</span><span class="token number">803</span><span class="token punctuation">:</span> <span class="token number">0</span>    nil    nil
</code></pre> 
<p><strong>多值赋值常用于交换变量，或者将函数的返回值返回给变量</strong></p> 
<pre><code class="prism language-c">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>返回两个值，第一个赋给a，第二个赋给b。
</code></pre> 
<p><strong>尽可能的使用局部变量，有两个好处：</strong><br> 1.避免命名冲突。<br> 2.访问局部变量的速度比全局变量更快。</p> 
<h3><a id="42__232"></a>4.2 索引</h3> 
<p>对 table 的索引使用方括号<code>[]</code>。Lua也提供了<code>.</code> 操作。</p> 
<blockquote> 
 <p><code>t[i]</code><br> <code>t.i</code> – 当索引为字符串类型时的一种简化写法<br> <code>gettable_event(t,i)</code> – 采用索引访问本质上是一个类似这样的函数调用</p> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> site <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span> site<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"www.runoob.com"</span>
<span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span>site<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
www<span class="token punctuation">.</span>runoob<span class="token punctuation">.</span>com
<span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span>site<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
www<span class="token punctuation">.</span>runoob<span class="token punctuation">.</span>com
</code></pre> 
<h2><a id="5_247"></a>5.循环</h2> 
<h3><a id="51_while_248"></a>5.1 while循环</h3> 
<pre><code class="prism language-csharp"><span class="token keyword">while</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
<span class="token keyword">do</span>
   statements
end
</code></pre> 
<blockquote> 
 <p><code>statements</code>(循环体语句) 可以是一条或多条语句，<code>condition</code>(条件) 可以是任意表达式，在 <code>condition</code>(条件) 为 true 时执行循环体语句</p> 
</blockquote> 
<h3><a id="52_for_258"></a>5.2 for循环</h3> 
<p><strong>1.数值for循环</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">for</span> <span class="token keyword">var</span><span class="token operator">=</span>exp1<span class="token punctuation">,</span>exp2<span class="token punctuation">,</span>exp3 <span class="token keyword">do</span>  
    <span class="token operator">&lt;</span>执行体<span class="token operator">&gt;</span>  
end
</code></pre> 
<blockquote> 
 <p><code>var</code>从<code>exp1</code>变化到<code>exp2</code>，每次变化以<code>exp3</code>为步长递增<code>var</code>，并执行一次 “执行体”。<code>exp3</code>是可选的，如果不指定，默认为1。</p> 
</blockquote> 
<p><strong>2.泛型for循环</strong></p> 
<pre><code class="prism language-csharp">a <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
end 
</code></pre> 
<blockquote> 
 <p><code>i</code>是数组索引值，<code>v</code>是对应索引的数组元素值。<code>ipairs</code>是Lua提供的一个迭代器函数，用来迭代数组。</p> 
</blockquote> 
<h3><a id="53_repeatuntil_279"></a>5.3 repeat…until循环</h3> 
<p>  <code>repeat...until</code>循环语句不同于<code>for</code>和<code>while</code>循环，for 和 while 循环的条件语句在当前循环执行开始时判断，而 <code>repeat...until</code>循环的条件语句在当前循环结束后判断，相当于C/C++中的<code>do{ }while()</code>循环。</p> 
<pre><code class="prism language-csharp">repeat
   <span class="token return-type class-name">statements</span>
<span class="token function">until</span><span class="token punctuation">(</span> condition <span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>循环条件判断语句（condition）在循环体末尾部分，所以在条件进行判断前循环体都会执行一次。<br> 如果条件判断语句（condition）为 false，循环会重新开始执行，直到条件判断语句（condition）为 true 才会停止执行。</p> 
</blockquote> 
<h3><a id="54__291"></a>5.4 循环嵌套</h3> 
<p>Lua 编程语言中 for 循环嵌套语法格式:</p> 
<pre><code class="prism language-csharp"><span class="token keyword">for</span> init<span class="token punctuation">,</span>max<span class="token operator">/</span><span class="token class-name">min</span> <span class="token keyword">value</span><span class="token punctuation">,</span> increment
<span class="token keyword">do</span>
   <span class="token keyword">for</span> init<span class="token punctuation">,</span>max<span class="token operator">/</span><span class="token class-name">min</span> <span class="token keyword">value</span><span class="token punctuation">,</span> increment
   <span class="token keyword">do</span>
      statements
   end
   statements
end
</code></pre> 
<p>Lua 编程语言中 while 循环嵌套语法格式:</p> 
<pre><code class="prism language-csharp"><span class="token keyword">while</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
<span class="token keyword">do</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
   <span class="token keyword">do</span>
      statements
   end
   statements
end
</code></pre> 
<p>Lua 编程语言中 repeat…until 循环嵌套语法格式:</p> 
<pre><code class="prism language-csharp">repeat
   statements
   repeat
      <span class="token return-type class-name">statements</span>
   <span class="token function">until</span><span class="token punctuation">(</span> condition <span class="token punctuation">)</span>
<span class="token function">until</span><span class="token punctuation">(</span> condition <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="55_goto_326"></a>5.5 goto语句</h3> 
<p>语法格式：<code>goto Label</code><br> Label 的格式：<code>:: Label ::</code></p> 
<pre><code class="prism language-csharp"><span class="token class-name">local</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">::</span>label<span class="token punctuation">::</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"--- goto label ---"</span><span class="token punctuation">)</span>

a <span class="token operator">=</span> a<span class="token operator">+</span><span class="token number">1</span>
<span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token number">3</span> then
    <span class="token keyword">goto</span> label   <span class="token operator">--</span> a 小于 <span class="token number">3</span> 的时候跳转到标签 label
end
</code></pre> 
<pre><code class="prism language-csharp">i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">::</span>s1<span class="token punctuation">::</span> <span class="token keyword">do</span>
  <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span>
end
<span class="token keyword">if</span> i<span class="token operator">&gt;</span><span class="token number">3</span> <span class="token return-type class-name">then</span>
  os<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token operator">--</span> i 大于 <span class="token number">3</span> 时退出
end
<span class="token keyword">goto</span> s1
</code></pre> 
<p>有了 goto，我们可以实现 continue 的功能：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">do</span>
    <span class="token keyword">if</span> i <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token return-type class-name">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">"yes continue"</span><span class="token punctuation">)</span>
        <span class="token keyword">goto</span> <span class="token keyword">continue</span>
    <span class="token return-type class-name">end</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">" no continue"</span><span class="token punctuation">)</span>
    <span class="token punctuation">::</span><span class="token keyword">continue</span><span class="token punctuation">::</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>i'<span class="token class-name">m</span> end<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
end
</code></pre> 
<h2><a id="6_365"></a>6.流程控制</h2> 
<p><strong><code>Lua中 0 为 true</code></strong></p> 
<p><strong>if语句</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">if</span><span class="token punctuation">(</span>布尔表达式<span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 在布尔表达式为 <span class="token boolean">true</span> 时执行的语句 <span class="token operator">--</span><span class="token punctuation">]</span>
end
</code></pre> 
<p><strong>if…else语句</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">if</span><span class="token punctuation">(</span>布尔表达式<span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 布尔表达式为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
<span class="token keyword">else</span>
   <span class="token operator">--</span><span class="token punctuation">[</span> 布尔表达式为 <span class="token boolean">false</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
end
</code></pre> 
<p><strong>if…elseif…else 语句</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">if</span><span class="token punctuation">(</span> 布尔表达式 <span class="token number">1</span><span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 在布尔表达式 <span class="token number">1</span> 为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>

<span class="token function">elseif</span><span class="token punctuation">(</span> 布尔表达式 <span class="token number">2</span><span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 在布尔表达式 <span class="token number">2</span> 为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>

<span class="token function">elseif</span><span class="token punctuation">(</span> 布尔表达式 <span class="token number">3</span><span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 在布尔表达式 <span class="token number">3</span> 为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
<span class="token keyword">else</span> 
   <span class="token operator">--</span><span class="token punctuation">[</span> 如果以上布尔表达式都不为 <span class="token boolean">true</span> 则执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
end
</code></pre> 
<p><strong>if嵌套语句</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">if</span><span class="token punctuation">(</span> 布尔表达式 <span class="token number">1</span><span class="token punctuation">)</span>
then
   <span class="token operator">--</span><span class="token punctuation">[</span> 布尔表达式 <span class="token number">1</span> 为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>布尔表达式 <span class="token number">2</span><span class="token punctuation">)</span>
   then
      <span class="token operator">--</span><span class="token punctuation">[</span> 布尔表达式 <span class="token number">2</span> 为 <span class="token boolean">true</span> 时执行该语句块 <span class="token operator">--</span><span class="token punctuation">]</span>
   end
end
</code></pre> 
<h2><a id="7_418"></a>7.函数</h2> 
<p><strong>定义格式</strong></p> 
<pre><code class="prism language-csharp">optional_function_scope <span class="token return-type class-name">function</span> <span class="token function">function_name</span><span class="token punctuation">(</span> argument1<span class="token punctuation">,</span> argument2<span class="token punctuation">,</span> argument3<span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">,</span> argumentn<span class="token punctuation">)</span>
    function_body
    <span class="token keyword">return</span> result_params_comma_separated
end
</code></pre> 
<blockquote> 
 <p><code>optional_function_scope</code>: 该参数是可选的制定函数是全局函数还是局部函数，未设置该参数默认为全局函数，如果你需要设置函数为局部函数需要使用关键字 local。<br> <code>function_name</code>: 指定函数名称。<br> <code>argument1, argument2, argument3..., argumentn</code>: 函数参数，多个参数以逗号隔开，函数也可以不带参数。<br> <code>function_body</code>: 函数体，函数中需要执行的代码语句块。<br> <code>result_params_comma_separated</code>: 函数返回值，Lua语言函数可以返回多个值，每个值以逗号隔开。</p> 
</blockquote> 
<h3><a id="71__434"></a>7.1 函数作为参数</h3> 
<pre><code class="prism language-csharp">myprint <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"这是打印函数 -   ##"</span><span class="token punctuation">,</span>param<span class="token punctuation">,</span><span class="token string">"##"</span><span class="token punctuation">)</span>
end

function <span class="token keyword">add</span><span class="token class-name"><span class="token punctuation">(</span>num1<span class="token punctuation">,</span>num2<span class="token punctuation">,</span>functionPrint<span class="token punctuation">)</span></span>
   result <span class="token operator">=</span> num1 <span class="token operator">+</span> num2
   <span class="token operator">--</span> 调用传递的函数参数
   <span class="token function">functionPrint</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token return-type class-name">end</span>
<span class="token function">myprint</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">--</span> myprint 函数作为参数传递
<span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>myprint<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="72__451"></a>7.2 多返回值</h3> 
<p><strong>接受多返回值时，就可以用到上面说到的多个变量去接收<code>res1, res2,...resn = fun()</code></strong></p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> maximum <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token class-name">local</span> mi <span class="token operator">=</span> <span class="token number">1</span>             <span class="token operator">--</span> 最大值索引
    <span class="token class-name">local</span> m <span class="token operator">=</span> a<span class="token punctuation">[</span>mi<span class="token punctuation">]</span>          <span class="token operator">--</span> 最大值
    <span class="token keyword">for</span> i<span class="token punctuation">,</span>val <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">do</span>
       <span class="token keyword">if</span> val <span class="token operator">&gt;</span> m <span class="token class-name">then</span>
           mi <span class="token operator">=</span> <span class="token class-name">i</span>
           m <span class="token operator">=</span> val
       end
    end
    <span class="token keyword">return</span> m<span class="token punctuation">,</span> mi
<span class="token return-type class-name">end</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">maximum</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="73__470"></a>7.3 可变参数</h3> 
<p>  Lua 函数可以接受可变数目的参数，和 C 语言类似，在函数参数列表中使用三点 … 表示函数有可变的参数。</p> 
<pre><code class="prism language-csharp">function <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  
<span class="token class-name">local</span> s <span class="token operator">=</span> <span class="token number">0</span>  
  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> ipairs<span class="token punctuation">{<!-- --></span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token keyword">do</span>   <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span> 表示一个由所有变长参数构成的数组  
    s <span class="token operator">=</span> s <span class="token operator">+</span> v  
  end  
  <span class="token keyword">return</span> s  
end  

<span class="token comment">// 调用</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">--</span><span class="token operator">-&gt;</span><span class="token number">25</span>
</code></pre> 
<p><strong>例如，计算几个数的平均值：</strong></p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
   result <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token class-name">local</span> arg<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>    <span class="token operator">--</span><span class="token operator">&gt;</span> arg 为一个表，局部变量
   <span class="token keyword">for</span> i<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token keyword">do</span>
      result <span class="token operator">=</span> result <span class="token operator">+</span> v
   <span class="token return-type class-name">end</span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"总共传入 "</span> <span class="token range operator">..</span> #arg <span class="token range operator">..</span> <span class="token string">" 个数"</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> result<span class="token operator">/</span>#arg
<span class="token return-type class-name">end</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"平均值为"</span><span class="token punctuation">,</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>也可以通过 select("#",…) 来获取可变参数的数量:</p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
   result <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token class-name">local</span> arg<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
   <span class="token keyword">for</span> i<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token keyword">do</span>
      result <span class="token operator">=</span> result <span class="token operator">+</span> v
   <span class="token return-type class-name">end</span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"总共传入 "</span> <span class="token range operator">..</span> <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token range operator">..</span> <span class="token string">" 个数"</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> result<span class="token operator">/</span><span class="token keyword">select</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token return-type class-name">end</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"平均值为"</span><span class="token punctuation">,</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>有时候可能需要几个固定参数加上可变参数，固定参数必须放在变长参数之前:</strong></p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> <span class="token function">fwrite</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token operator">--</span><span class="token operator">-&gt;</span> 固定的参数fmt
    <span class="token keyword">return</span> io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>fmt<span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
<span class="token return-type class-name">end</span>

<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token string">"runoob\n"</span><span class="token punctuation">)</span>       <span class="token operator">--</span><span class="token operator">-&gt;</span>fmt <span class="token operator">=</span> <span class="token string">"runoob"</span><span class="token punctuation">,</span> 没有变长参数。  
<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token string">"%d%d\n"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">-&gt;</span>fmt <span class="token operator">=</span> <span class="token string">"%d%d"</span><span class="token punctuation">,</span> 变长参数为 <span class="token number">1</span> 和 <span class="token number">2</span>
</code></pre> 
<p><strong>函数技巧</strong><br>   通常在遍历变长参数的时候只需要使用 {…}，然而变长参数可能会包含一些 nil，那么就可以用 select 函数来访问变长参数了：<code>select('#', …)</code>或者 <code>select(n, …)</code></p> 
<blockquote> 
 <p><code>select('#', …)</code> 返回可变参数的长度。<br> <code>select(n, …)</code> 用于返回从起点 n 开始到结束位置的所有参数列表。</p> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    a <span class="token operator">=</span> <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token operator">--</span><span class="token operator">&gt;</span>从第三个位置开始，变量 a 对应右边变量列表的第一个参数
    print <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    print <span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span>打印所有列表参数
<span class="token return-type class-name">end</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

结果
<span class="token number">2</span>
<span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>       <span class="token number">5</span>
</code></pre> 
<pre><code class="prism language-csharp"><span class="token keyword">do</span>  
    <span class="token return-type class-name">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  
        <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token string character">'#'</span><span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">do</span>  <span class="token operator">--</span><span class="token operator">&gt;</span>获取参数总数
            <span class="token class-name">local</span> arg <span class="token operator">=</span> <span class="token keyword">select</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>读取参数，arg 对应的是右边变量列表的第一个参数
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"arg"</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        end  
    <span class="token return-type class-name">end</span>  
 
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
end

结果<span class="token punctuation">:</span>
arg    <span class="token number">1</span>
arg    <span class="token number">2</span>
arg    <span class="token number">3</span>
arg    <span class="token number">4</span>
</code></pre> 
<h2><a id="8_568"></a>8.运算符优先级</h2> 
<p><img src="https://images2.imgbox.com/eb/c5/hJ18tQkx_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="9_570"></a>9.字符串操作</h2> 
<p><strong>1</strong> 字符串全部转为大写字母: <code>string.upper(argument)</code></p> 
<p><strong>2</strong> 字符串全部转为小写字母: <code>string.lower(argument)</code></p> 
<p><strong>3</strong> 在字符串中替换: <code>string.gsub(mainString,findString,replaceString,num)</code></p> 
<blockquote> 
 <p>mainString 为要操作的字符串， findString 为被替换的字符，replaceString 要替换的字符，num 替换次数（可以忽略，则全部替换），如：</p> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span><span class="token string">"aaaa"</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"z"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zzza    <span class="token number">3</span>
</code></pre> 
<p><strong>4</strong> 在一个指定的目标字符串中搜索指定的内容(第三个参数为索引),返回其具体位置。不存在则返回 nil: <code>string.find (str, substr, [init, [end]])</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"Hello Lua user"</span><span class="token punctuation">,</span> <span class="token string">"Lua"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> 
<span class="token number">7</span>    <span class="token number">9</span>
</code></pre> 
<p><strong>5</strong> 字符串反转: <code>string.reverse(arg)</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">)</span>
auL
</code></pre> 
<p><strong>6</strong> 返回一个类似printf的格式化字符串: <code>string.format(...)</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"the value is:%d"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
the <span class="token keyword">value</span> <span class="token keyword">is</span><span class="token punctuation">:</span><span class="token number">4</span>
</code></pre> 
<p><strong>7</strong> char 将整型数字转成字符并连接， byte 转换字符为整数值(可以指定某个字符，默认第一个字符): <code>string.char(arg) 和 string.byte(arg[,int])</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
abcd
<span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"ABCD"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">68</span>
<span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"ABCD"</span><span class="token punctuation">)</span>
<span class="token number">65</span>
</code></pre> 
<p><strong>8</strong> 计算字符串长度: <code>string.len(arg)</code></p> 
<pre><code class="prism language-csharp"><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span>
<span class="token number">3</span>
</code></pre> 
<p><strong>9</strong> 返回字符串string的n个拷贝: <code>string.rep(string, n)</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">rep</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
abcdabcd
</code></pre> 
<p><strong>10</strong> 链接两个字符串: <code>..</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"www.runoob."</span><span class="token range operator">..</span><span class="token string">"com"</span><span class="token punctuation">)</span>
www<span class="token punctuation">.</span>runoob<span class="token punctuation">.</span>com
</code></pre> 
<p><strong>11</strong> <code>string.gmatch(str, pattern)</code><br>   回一个迭代器函数，每一次调用这个函数，返回一个在字符串 str 找到的下一个符合 pattern 描述的子串。如果参数 pattern 描述的字符串没有找到，迭代函数返回nil。</p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">gmatch</span><span class="token punctuation">(</span><span class="token string">"Hello Lua user"</span><span class="token punctuation">,</span> <span class="token string">"%a+"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token function">print</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> end
Hello
Lua
user
</code></pre> 
<p><strong>12</strong> <code>string.match(str, pattern, init)</code><br>   string.match()只寻找源字串str中的第一个配对. 参数init可选, 指定搜寻过程的起点, 默认为1。<br>   在成功配对时, 函数将返回配对表达式中的所有捕获结果; 如果没有设置捕获标记, 则返回整个配对字符串. 当没有成功的配对时, 返回nil。</p> 
<pre><code class="prism language-csharp"><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"I have 2 questions for you."</span><span class="token punctuation">,</span> <span class="token string">"%d+ %a+"</span><span class="token punctuation">)</span>
<span class="token number">2</span> questions

<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%d, %q"</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"I have 2 questions for you."</span><span class="token punctuation">,</span> <span class="token string">"(%d+) (%a+)"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"questions"</span>
</code></pre> 
<h3><a id="91__660"></a>9.1 字符串截取</h3> 
<p>字符串截取使用 sub() 方法。<br> <code>string.sub()</code> 用于截取字符串，原型为：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i <span class="token punctuation">[</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>

参数说明：
s：要截取的字符串。
i：截取开始位置。
j：截取结束位置，默认为 <span class="token operator">-</span><span class="token number">1</span>，最后一个字符。
</code></pre> 
<h3><a id="92__674"></a>9.2 字符串格式化</h3> 
<p>  <code>string.format()</code>函数来生成具有特定格式的字符串, 函数的第一个参数是格式 , 之后是对应格式中每个代号的各种数据。<br>   由于格式字符串的存在, 使得产生的长字符串可读性大大提高了。这个函数的格式很像 C 语言中的<code>printf()</code>。</p> 
<p><strong>转义码</strong></p> 
<blockquote> 
 <p><code>%c</code> - 接受一个数字, 并将其转化为ASCII码表中对应的字符<br> <code>%d, %i</code> - 接受一个数字并将其转化为有符号的整数格式<br> <code>%o</code> - 接受一个数字并将其转化为八进制数格式<br> <code>%u</code> - 接受一个数字并将其转化为无符号整数格式<br> <code>%x</code> - 接受一个数字并将其转化为十六进制数格式, 使用小写字母<br> <code>%X</code> - 接受一个数字并将其转化为十六进制数格式, 使用大写字母<br> <code>%e</code> - 接受一个数字并将其转化为科学记数法格式, 使用小写字母e<br> <code>%E</code> - 接受一个数字并将其转化为科学记数法格式, 使用大写字母E<br> <code>%f</code> - 接受一个数字并将其转化为浮点数格式<br> <code>%g(%G)</code> - 接受一个数字并将其转化为%e(%E, 对应%G)及%f中较短的一种格式<br> <code>%q</code> - 接受一个字符串并将其转化为可安全被Lua编译器读入的格式<br> <code>%s</code> - 接受一个字符串并按照给定的参数格式化该字符串</p> 
</blockquote> 
<p>为进一步细化格式, 可以在%号后添加参数. 参数将以如下的顺序读入:</p> 
<blockquote> 
 <p>(1) 符号: 一个+号表示其后的数字转义符将让正数显示正号. 默认情况下只有负数显示符号.<br> (2) 占位符: 一个0, 在后面指定了字串宽度时占位用. 不填时的默认占位符是空格.<br> (3) 对齐标识: 在指定了字串宽度时, 默认为右对齐, 增加-号可以改为左对齐.<br> (4) 宽度数值<br> (5) 小数位数/字串裁切: 在宽度数值后增加的小数部分n, 若后接f(浮点数转义符, 如%6.3f)则设定该浮点数的小数只保留n位, 若后接s(字符串转义符, 如%5.3s)则设定该字符串只显示前n位.</p> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">)</span>                 <span class="token operator">--</span> 输出<span class="token return-type class-name">S</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%+d"</span><span class="token punctuation">,</span> <span class="token number">17.0</span><span class="token punctuation">)</span>              <span class="token operator">--</span> 输出<span class="token operator">+</span><span class="token number">17</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%05d"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>               <span class="token operator">--</span> 输出<span class="token number">00017</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%o"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>                 <span class="token operator">--</span> 输出<span class="token number">21</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%u"</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">)</span>               <span class="token operator">--</span> 输出<span class="token number">3</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>                 <span class="token operator">--</span> 输出<span class="token return-type class-name">d</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%X"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>                 <span class="token operator">--</span> 输出<span class="token return-type class-name">D</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%e"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>               <span class="token operator">--</span> 输出<span class="token number">1.000000e+03</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%E"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>               <span class="token operator">--</span> 输出<span class="token number">1.000000E+03</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%6.3f"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>              <span class="token operator">--</span> 输出<span class="token number">13.000</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%q"</span><span class="token punctuation">,</span> <span class="token string">"One\nTwo"</span><span class="token punctuation">)</span>         <span class="token operator">--</span> 输出"One\
                                        <span class="token operator">--</span> 　　Two"
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"monkey"</span><span class="token punctuation">)</span>           <span class="token operator">--</span> 输出<span class="token return-type class-name">monkey</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%10s"</span><span class="token punctuation">,</span> <span class="token string">"monkey"</span><span class="token punctuation">)</span>         <span class="token operator">--</span> 输出    <span class="token return-type class-name">monkey</span>
<span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%5.3s"</span><span class="token punctuation">,</span> <span class="token string">"monkey"</span><span class="token punctuation">)</span>        <span class="token operator">--</span> 输出  mon
</code></pre> 
<h3><a id="93__717"></a>9.3 字符串转整数</h3> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> 字符转换
<span class="token operator">--</span> 转换第一个字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">--</span> 转换第三个字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">--</span> 转换末尾第一个字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">--</span> 第二个字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">--</span> 转换末尾第二个字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">byte</span><span class="token punctuation">(</span><span class="token string">"Lua"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">--</span> 整数 ASCII 码转换为字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


以上代码执行结果为：
<span class="token number">76</span>
<span class="token number">97</span>
<span class="token number">97</span>
<span class="token number">117</span>
<span class="token number">117</span>
a
</code></pre> 
<h3><a id="94__745"></a>9.4 匹配模式</h3> 
<p>  字符类指可以匹配一个特定字符集合内任何字符的模式项。比如，字符类 <code>%d</code> 匹配任意数字。所以你可以使用模式串 <code>%d%d/%d%d/%d%d%d%d</code> 搜索 <code>dd/mm/yyyy</code> 格式的日期：</p> 
<pre><code class="prism language-csharp">s <span class="token operator">=</span> <span class="token string">"Deadline is 30/05/1999, firm"</span>
date <span class="token operator">=</span> <span class="token string">"%d%d/%d%d/%d%d%d%d"</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">05</span><span class="token operator">/</span><span class="token number">1999</span>
</code></pre> 
<p>点链接，看所有匹配模式：https://www.runoob.com/lua/lua-strings.html</p> 
<h2><a id="10__757"></a>10. 数组</h2> 
<p><strong>一维数组</strong></p> 
<pre><code class="prism language-csharp">array <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">for</span> i<span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">do</span>
   array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span><span class="token number">2</span>
end

<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">do</span>
   <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
end
</code></pre> 
<p><strong>多维数组</strong></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> 初始化数组
array <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">do</span>
   array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      <span class="token keyword">for</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">do</span>
         array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">j</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token operator">*</span>j
      end
end

<span class="token operator">--</span> 访问数组
<span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">do</span>
   <span class="token keyword">for</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">do</span>
      <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">j</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   end
end
</code></pre> 
<h2><a id="11_792"></a>11.<em>迭代器</em></h2> 
<h3><a id="111_for_793"></a>11.1 泛型for迭代器</h3> 
<p>  泛型 for 在自己内部保存迭代函数，实际上它保存三个值：迭代函数、状态常量、控制变量。</p> 
<p>泛型 for 迭代器提供了集合的 key/value 对：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> 
<span class="token keyword">do</span>
    <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token class-name">end</span>
k<span class="token punctuation">,</span> v为变量列表；<span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>为表达式列表。
</code></pre> 
<pre><code class="prism language-csharp">array <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Google"</span><span class="token punctuation">,</span> <span class="token string">"Runoob"</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> key<span class="token punctuation">,</span><span class="token keyword">value</span> <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token keyword">do</span>
   <span class="token function">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
end


输出结果为：
<span class="token number">1</span>  Google
<span class="token number">2</span>  Runoob
</code></pre> 
<p><strong>执行过程</strong></p> 
<blockquote> 
 <ul><li>首先，初始化，计算 in 后面表达式的值，表达式应该返回泛型 for 需要的三个值：迭代函数、状态常量、控制变量；与多值赋值一样，如果表达式返回的结果个数不足三个会自动用 nil 补足，多出部分会被忽略。</li><li>第二，将状态常量和控制变量作为参数调用迭代函数（注意：对于 for 结构来说，状态常量没有用处，仅仅在初始化时获取他的值并传递给迭代函数）。</li><li>第三，将迭代函数返回的值赋给变量列表。</li><li>第四，如果返回的第一个值为nil循环结束，否则执行循环体。</li><li>第五，回到第二步再次调用迭代函数</li></ul> 
</blockquote> 
<h3><a id="112__828"></a>11.2 无状态迭代器</h3> 
<p>  无状态的迭代器是指不保留任何状态的迭代器，因此在循环中我们可以利用无状态迭代器避免创建闭包花费额外的代价。<br>   每一次迭代，迭代函数都是用<strong>两个变量（状态常量和控制变量）的值作为参数被调用</strong>，一个无状态的迭代器只利用这两个值可以获取下一个元素。<br>   这种无状态迭代器的典型的简单的例子是 <code>ipairs</code>，它遍历数组的每一个元素，元素的索引需要是数值。</p> 
<p>实现 数字 n 的平方：</p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> <span class="token function">square</span><span class="token punctuation">(</span>iteratorMaxCount<span class="token punctuation">,</span>currentNumber<span class="token punctuation">)</span>
   <span class="token keyword">if</span> currentNumber<span class="token operator">&lt;</span>iteratorMaxCount
   <span class="token class-name">then</span>
      currentNumber <span class="token operator">=</span> currentNumber<span class="token operator">+</span><span class="token number">1</span>
   <span class="token keyword">return</span> currentNumber<span class="token punctuation">,</span> currentNumber<span class="token operator">*</span>currentNumber
   end
end

<span class="token keyword">for</span> i<span class="token punctuation">,</span>n <span class="token keyword">in</span> square<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token keyword">do</span>
   <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
end


结果为：
<span class="token number">1</span>    <span class="token number">1</span>
<span class="token number">2</span>    <span class="token number">4</span>
<span class="token number">3</span>    <span class="token number">9</span>
</code></pre> 
<p>  迭代的状态包括被遍历的表（循环过程中不会改变的状态常量）和当前的索引下标（控制变量），ipairs 和迭代函数都很简单，我们在 Lua 中可以这样实现：</p> 
<pre><code class="prism language-csharp"><span class="token return-type class-name">function</span> iter <span class="token punctuation">(</span>a<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token class-name">local</span> v <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> v then
       <span class="token keyword">return</span> i<span class="token punctuation">,</span> v
    end
end
 
<span class="token return-type class-name">function</span> ipairs <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">return</span> iter<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">0</span>
end
</code></pre> 
<blockquote> 
 <p>当 Lua 调用 ipairs(a) 开始循环时，他获取三个值：迭代函数 iter、状态常量 a、控制变量初始值 0；然后 Lua 调用 iter(a,0) 返回 1, a[1]（除非 a[1]=nil）；第二次迭代调用 iter(a,1) 返回 2, a[2]……直到第一个 nil 元素。</p> 
</blockquote> 
<h3><a id="113__876"></a>11.3 多状态迭代器</h3> 
<p>  很多情况下，迭代器需要保存多个状态信息而不是简单的状态常量和控制变量，最简单的方法是使用闭包，还有一种方法就是将所有的状态信息封装到 table 内，将 table 作为迭代器的状态常量，因为这种情况下可以将所有的信息存放在 table 内，所以迭代函数通常不需要第二个参数。</p> 
<pre><code class="prism language-csharp">array <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Google"</span><span class="token punctuation">,</span> <span class="token string">"Runoob"</span><span class="token punctuation">}</span>

<span class="token return-type class-name">function</span> elementIterator <span class="token punctuation">(</span>collection<span class="token punctuation">)</span>
   <span class="token class-name">local</span> index <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token class-name">local</span> count <span class="token operator">=</span> #collection
   <span class="token operator">--</span> 闭包函数
   <span class="token keyword">return</span> function <span class="token punctuation">(</span><span class="token punctuation">)</span>
      index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">if</span> index <span class="token operator">&lt;=</span> count
      then
         <span class="token operator">--</span>  返回迭代器的当前元素
         <span class="token keyword">return</span> collection<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
      end
   end
end

<span class="token keyword">for</span> element <span class="token keyword">in</span> <span class="token function">elementIterator</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token keyword">do</span>
   <span class="token function">print</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
end


结果为：
Google
Runoob
</code></pre> 
<h2><a id="12table_909"></a>12.table(表)</h2> 
<blockquote> 
 <p>  table 是 Lua 的一种数据结构用来帮助我们创建不同的数据类型，如：数组、字典等。<br>   Lua table 使用关联型数组，你可以用任意类型的值来作数组的索引，但这个值不能是 nil。<br>   Lua table 是不固定大小的，你可以根据自己需要进行扩容。<br>   Lua也是通过table来解决模块（module）、包（package）和对象（Object）的。 例如string.format表示使用"format"来索引table string。</p> 
</blockquote> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> 初始化表
mytable <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token operator">--</span> 指定值
mytable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token string">"Lua"</span>

<span class="token operator">--</span> 移除引用
mytable <span class="token operator">=</span> nil
<span class="token operator">--</span> lua 垃圾回收会释放内存
</code></pre> 
<p>  当我们为 table a 设置元素，然后将 a 赋值给 b，则 a 与 b 都指向同一个内存。如果 a 设置为 nil ，则 b 同样能访问 table 的元素。如果没有指定的变量指向a，Lua的垃圾回收机制会清理相对应的内存。</p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> 简单的 <span class="token class-name">table</span>
mytable <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 的类型是 "</span><span class="token punctuation">,</span><span class="token function">type</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span><span class="token punctuation">)</span>

mytable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token string">"Lua"</span>
mytable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"修改前"</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 索引为 1 的元素是 "</span><span class="token punctuation">,</span> mytable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 索引为 wow 的元素是 "</span><span class="token punctuation">,</span> mytable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">--</span> alternatetable和mytable的是指同一个 <span class="token class-name">table</span>
alternatetable <span class="token operator">=</span> <span class="token return-type class-name">mytable</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"alternatetable 索引为 1 的元素是 "</span><span class="token punctuation">,</span> alternatetable<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 索引为 wow 的元素是 "</span><span class="token punctuation">,</span> alternatetable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

alternatetable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"修改后"</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 索引为 wow 的元素是 "</span><span class="token punctuation">,</span> mytable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">--</span> 释放变量
alternatetable <span class="token operator">=</span> <span class="token return-type class-name">nil</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"alternatetable 是 "</span><span class="token punctuation">,</span> alternatetable<span class="token punctuation">)</span>

<span class="token operator">--</span> mytable 仍然可以访问
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 索引为 wow 的元素是 "</span><span class="token punctuation">,</span> mytable<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

mytable <span class="token operator">=</span> <span class="token return-type class-name">nil</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"mytable 是 "</span><span class="token punctuation">,</span> mytable<span class="token punctuation">)</span>


结果为：
mytable 的类型是     table
mytable 索引为 <span class="token number">1</span> 的元素是     Lua
mytable 索引为 wow 的元素是     修改前
alternatetable 索引为 <span class="token number">1</span> 的元素是     Lua
mytable 索引为 wow 的元素是     修改前
mytable 索引为 wow 的元素是     修改后
alternatetable 是     nil
mytable 索引为 wow 的元素是     修改后
mytable 是     nil
</code></pre> 
<h3><a id="121_table_972"></a>12.1 table常用操作</h3> 
<p><strong>1. table连接</strong></p> 
<blockquote> 
 <p><code>table.concat (table [, sep [, start [, end]]]):</code><br> concat是concatenate(连锁, 连接)的缩写. table.concat()函数列出参数中指定table的数组部分从start位置到end位置的所有元素, 元素间以指定的分隔符(sep)隔开。</p> 
</blockquote> 
<pre><code class="prism language-csharp">fruits <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"banana"</span><span class="token punctuation">,</span><span class="token string">"orange"</span><span class="token punctuation">,</span><span class="token string">"apple"</span><span class="token punctuation">}</span>
<span class="token operator">--</span> 返回 table 连接后的字符串
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"连接后的字符串 "</span><span class="token punctuation">,</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">--</span> 指定连接字符
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"连接后的字符串 "</span><span class="token punctuation">,</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">--</span> 指定索引来连接 <span class="token return-type class-name">table</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"连接后的字符串 "</span><span class="token punctuation">,</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span><span class="token string">", "</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

执行以上代码输出结果为：
连接后的字符串     bananaorangeapple
连接后的字符串     banana<span class="token punctuation">,</span> orange<span class="token punctuation">,</span> apple
连接后的字符串     orange<span class="token punctuation">,</span> apple
</code></pre> 
<p><strong>2. 插入和删除</strong></p> 
<blockquote> 
 <p><strong>插入</strong>：<code>table.insert (table, [pos,] value)</code><br> 在table的数组部分指定位置(pos)插入值为value的一个元素. pos参数可选, 默认为数组部分末尾.<br>   <br> <strong>删除</strong>：table.remove (table [, pos])<br> 返回table数组部分位于pos位置的元素. 其后的元素会被前移. pos参数可选, 默认为table长度, 即从最后一个元素删起。</p> 
</blockquote> 
<pre><code class="prism language-csharp">fruits <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"banana"</span><span class="token punctuation">,</span><span class="token string">"orange"</span><span class="token punctuation">,</span><span class="token string">"apple"</span><span class="token punctuation">}</span>

<span class="token operator">--</span> 在末尾插入
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span><span class="token string">"mango"</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"索引为 4 的元素为 "</span><span class="token punctuation">,</span>fruits<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token operator">--</span> 在索引为 <span class="token number">2</span> 的键处插入
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"grapes"</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"索引为 2 的元素为 "</span><span class="token punctuation">,</span>fruits<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"最后一个元素为 "</span><span class="token punctuation">,</span>fruits<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token keyword">remove</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"移除后最后一个元素为 "</span><span class="token punctuation">,</span>fruits<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

结果为：
索引为 <span class="token number">4</span> 的元素为     mango
索引为 <span class="token number">2</span> 的元素为     grapes
最后一个元素为     mango
移除后最后一个元素为     nil
</code></pre> 
<p><strong>3. 排序</strong></p> 
<blockquote> 
 <p><code>table.sort (table [, comp])</code><br> 对给定的table进行升序排序。</p> 
</blockquote> 
<pre><code class="prism language-csharp">fruits <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"banana"</span><span class="token punctuation">,</span><span class="token string">"orange"</span><span class="token punctuation">,</span><span class="token string">"apple"</span><span class="token punctuation">,</span><span class="token string">"grapes"</span><span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"排序前"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
<span class="token return-type class-name">end</span>

table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"排序后"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>fruits<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
end


结果为：
排序前
<span class="token number">1</span>    banana
<span class="token number">2</span>    orange
<span class="token number">3</span>    apple
<span class="token number">4</span>    grapes
排序后
<span class="token number">1</span>    apple
<span class="token number">2</span>    banana
<span class="token number">3</span>    grapes
<span class="token number">4</span>    orange
</code></pre> 
<h2><a id="13_1054"></a>13.<em>模块与包</em></h2> 
<p>  模块类似于一个封装库，从 Lua 5.1 开始，Lua 加入了标准的模块管理机制，可以把一些公用的代码放在一个文件里，以 API 接口的形式在其他地方调用，有利于代码的重用和降低代码耦合度。<br>   Lua 的模块是由变量、函数等已知元素组成的 table，因此创建一个模块很简单，就是<strong>创建一个 table，然后把需要导出的常量、函数放入其中，最后返回这个 table 就行</strong>。以下为创建自定义模块 module.lua，文件代码格式如下：<br> <code>所以使用这种API的方法是，类似于调用table中的元素那样来操作函数调用模块中的常量或函数</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> 文件名为 module<span class="token punctuation">.</span>lua
<span class="token operator">--</span> 定义一个名为 module 的模块
module <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
 
<span class="token operator">--</span> 定义一个常量
module<span class="token punctuation">.</span>constant <span class="token operator">=</span> <span class="token string">"这是一个常量"</span>
 
<span class="token operator">--</span> 定义一个函数
<span class="token return-type class-name">function</span> module<span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"这是一个公有函数！\n"</span><span class="token punctuation">)</span>
end
 
local <span class="token return-type class-name">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"这是一个私有函数！"</span><span class="token punctuation">)</span>
end
 
<span class="token return-type class-name">function</span> module<span class="token punctuation">.</span><span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end
 
<span class="token keyword">return</span> module
</code></pre> 
<h3><a id="131_require_1083"></a>13.1 require函数</h3> 
<p>Lua提供了一个名为require的函数用来加载模块。要加载一个模块，只需要简单地调用就可以了。例如：<code>require("&lt;模块名&gt;")</code>或者<code>require "&lt;模块名&gt;"</code></p> 
<pre><code class="prism language-csharp"><span class="token operator">--</span> test_module<span class="token punctuation">.</span>lua 文件
<span class="token operator">--</span> module 模块为上文提到到 <span class="token return-type class-name">module<span class="token punctuation">.</span>lua</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"module"</span><span class="token punctuation">)</span>
 
<span class="token function">print</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>constant<span class="token punctuation">)</span>
 
module<span class="token punctuation">.</span><span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

以上代码执行结果为：
这是一个常量
这是一个私有函数！
</code></pre> 
<p>或者给加载的模块定义一个别名变量，方便调用：</p> 
<pre><code class="prism language-csharp">test_module2<span class="token punctuation">.</span>lua 文件
<span class="token operator">--</span> test_module2<span class="token punctuation">.</span>lua 文件
<span class="token operator">--</span> module 模块为上文提到到 module<span class="token punctuation">.</span>lua
<span class="token operator">--</span> 别名变量 m
<span class="token class-name">local</span> m <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"module"</span><span class="token punctuation">)</span>
 
<span class="token function">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>constant<span class="token punctuation">)</span>
 
m<span class="token punctuation">.</span><span class="token function">func3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

以上代码执行结果为：
这是一个常量
这是一个私有函数！
</code></pre> 
<h3><a id="132__1118"></a>13.2 加载机制</h3> 
<p>  对于自定义的模块，模块文件不是放在哪个文件目录都行，函数 require 有它自己的文件路径加载策略，它会尝试从 Lua 文件或 C 程序库中加载模块。<br>   require 用于搜索 Lua 文件的路径是存放在全局变量 package.path 中，当 Lua 启动后，会以环境变量 LUA_PATH 的值来初始这个环境变量。如果没有找到该环境变量，则使用一个编译时定义的默认路径来初始化。<br>   当然，如果没有 LUA_PATH 这个环境变量，也可以自定义设置，在当前用户根目录下打开 .profile 文件（没有则创建，打开 .bashrc 文件也可以），例如把 “~/lua/” 路径加入 LUA_PATH 环境变量里：</p> 
<pre><code class="prism language-csharp"><span class="token preprocessor property">#LUA_PATH</span>
<span class="token class-name">export</span> LUA_PATH<span class="token operator">=</span><span class="token string">"~/lua/?.lua;;"</span>
</code></pre> 
<h3><a id="133_C_1127"></a>13.3 C包</h3> 
<p>  Lua和C是很容易结合的，使用 C 为 Lua 写包。<br>   与Lua中写包不同，C包在使用以前必须首先加载并连接，在大多数系统中最容易的实现方式是通过动态连接库机制。<br>   Lua在一个叫loadlib的函数内提供了所有的动态连接的功能。这个函数有两个参数:库的绝对路径和初始化函数。所以典型的调用的例子如下:</p> 
<pre><code class="prism language-csharp"><span class="token class-name">local</span> path <span class="token operator">=</span> <span class="token string">"/usr/local/lua/lib/libluasocket.so"</span>
<span class="token class-name">local</span> f <span class="token operator">=</span> <span class="token function">loadlib</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"luaopen_socket"</span><span class="token punctuation">)</span>
</code></pre> 
<p>  loadlib 函数加载指定的库并且连接到 Lua，然而它并不打开库（也就是说没有调用初始化函数），反之他返回初始化函数作为 Lua 的一个函数，这样我们就可以直接在Lua中调用他。<br>   如果加载动态库或者查找初始化函数时出错，loadlib 将返回 nil 和错误信息。我们可以修改前面一段代码，使其检测错误然后调用初始化函数：</p> 
<pre><code class="prism language-csharp"><span class="token class-name">local</span> path <span class="token operator">=</span> <span class="token string">"/usr/local/lua/lib/libluasocket.so"</span>
<span class="token operator">--</span> 或者 path <span class="token operator">=</span> <span class="token string">"C:\\windows\\luasocket.dll"</span>，这是 Window 平台下
<span class="token class-name">local</span> f <span class="token operator">=</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">loadlib</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"luaopen_socket"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">--</span> 真正打开库
</code></pre> 
<p>  一般情况下我们期望二进制的发布库包含一个与前面代码段相似的 stub 文件，安装二进制库的时候可以随便放在某个目录，只需要修改 stub 文件对应二进制库的实际路径即可。<br>   将 stub 文件所在的目录加入到 LUA_PATH，这样设定后就可以使用 require 函数加载 C 库了。</p> 
<h2><a id="14_1147"></a>14.元表</h2> 
<p>  在 Lua table 中我们可以访问对应的 key 来得到 value 值，但是却无法对两个 table 进行操作(比如相加)。</p> 
<p>  因此 Lua 提供了元表(Metatable)，允许我们改变 table 的行为，每个行为关联了对应的元方法。</p> 
<p>  例如，使用元表我们可以定义 Lua 如何计算两个 table 的相加操作 a+b。</p> 
<p>  当 Lua 试图对两个表进行相加时，先检查两者之一是否有元表，之后检查是否有一个叫 __add 的字段，若找到，则调用对应的值。 __add 等即时字段，其对应的值（往往是一个函数或是 table）就是"元方法"。</p> 
<p>  有两个很重要的函数来处理元表：</p> 
<blockquote> 
 <p><code>setmetatable(table,metatable)</code>: 对指定 table 设置元表(metatable)，如果元表(metatable)中存在 __metatable 键值，setmetatable 会失败。<br> <code>getmetatable(table)</code>: 返回对象的元表(metatable)。<br> 以下实例演示了如何对指定的表设置元表：</p> 
</blockquote> 
<pre><code class="prism language-csharp">mytable <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>                          <span class="token operator">--</span> 普通表
mymetatable <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>                      <span class="token operator">--</span> 元表
<span class="token function">setmetatable</span><span class="token punctuation">(</span>mytable<span class="token punctuation">,</span>mymetatable<span class="token punctuation">)</span>     <span class="token operator">--</span> 把 mymetatable 设为 mytable 的元表

以上代码也可以直接写成一行：
mytable <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

以下为返回对象元表：
<span class="token function">getmetatable</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span>                 <span class="token operator">--</span> 这会返回 mymetatable
</code></pre> 
<p><strong><code>https://www.runoob.com/lua/lua-metatables.html</code></strong></p> 
<h3><a id="141___index_1177"></a>14.1 __index方法</h3> 
<p>  这是 metatable 最常用的键。<br>   当你通过键来访问 table 的时候，如果这个键没有值，那么Lua就会寻找该table的metatable（假定有metatable）中的__index 键。如果__index包含一个表格，Lua会在表格中查找相应的键。</p> 
<p>  如果__index包含一个函数的话，Lua就会调用那个函数，table和键会作为参数传递给函数。<br>   <strong>__index 元方法查看表中元素是否存在，如果不存在，返回结果为 nil；如果存在则由 __index 返回结果</strong>。</p> 
<pre><code class="prism language-csharp">mytable <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>key1 <span class="token operator">=</span> <span class="token string">"value1"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  __index <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>mytable<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"key2"</span> then
      <span class="token keyword">return</span> <span class="token string">"metatablevalue"</span>
    <span class="token keyword">else</span>
      <span class="token keyword">return</span> nil
    end
  end
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>mytable<span class="token punctuation">.</span>key1<span class="token punctuation">,</span>mytable<span class="token punctuation">.</span>key2<span class="token punctuation">)</span>

实例输出结果为：
value1    metatablevalue
</code></pre> 
<blockquote> 
 <p><strong>1</strong> mytable 表赋值为 {key1 = “value1”}。<br> <strong>2</strong> mytable 设置了元表，元方法为 __index。<br> <strong>3</strong> 在mytable表中查找 key1，如果找到，返回该元素，找不到则继续。<br> <strong>4</strong> 在mytable表中查找 key2，如果找到，返回 metatablevalue，找不到则继续。<br> <strong>5</strong> 判断元表有没有__index方法，如果__index方法是一个函数，则调用该函数。<br> <strong>6</strong> 元方法中查看是否传入 “key2” 键的参数（mytable.key2已设置），如果传入 “key2” 参数返回 “metatablevalue”，否则返回 mytable 对应的键值。</p> 
</blockquote> 
<p>我们可以将以上代码简单写成：<br> <code>mytable = setmetatable({key1 = "value1"}, { __index = { key2 = "metatablevalue" } }) print(mytable.key1,mytable.key2)</code></p> 
<p><strong>总结</strong></p> 
<blockquote> 
 <p>Lua 查找一个表元素时的规则，其实就是如下 3 个步骤:</p> 
 <ul><li>1.在表中查找，如果找到，返回该元素，找不到则继续</li><li>2.判断该表是否有元表，如果没有元表，返回 nil，有元表则继续。</li><li>3.判断元表有没有 __index 方法，如果 __index 方法为 nil，则返回 nil；如果 __index 方法是一个表，则重复 1、2、3；如果 __index 方法是一个函数，则返回该函数的返回值。</li></ul> 
</blockquote> 
<h3><a id="142___newindex_1219"></a>14.2 __newindex方法</h3> 
<p>  <code>__newindex</code> 元方法用来对表更新，<code>__index</code>则用来对表访问 。<br>   当你给表的一个缺少的索引赋值，解释器就会查找<code>__newindex</code> 元方法：如果存在则调用这个函数而不进行赋值操作。</p> 
<pre><code class="prism language-csharp">mymetatable <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
mytable <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>key1 <span class="token operator">=</span> <span class="token string">"value1"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> __newindex <span class="token operator">=</span> mymetatable <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>mytable<span class="token punctuation">.</span>key1<span class="token punctuation">)</span>

mytable<span class="token punctuation">.</span>newkey <span class="token operator">=</span> <span class="token string">"新值2"</span>
<span class="token function">print</span><span class="token punctuation">(</span>mytable<span class="token punctuation">.</span>newkey<span class="token punctuation">,</span>mymetatable<span class="token punctuation">.</span>newkey<span class="token punctuation">)</span>

mytable<span class="token punctuation">.</span>key1 <span class="token operator">=</span> <span class="token string">"新值1"</span>
<span class="token function">print</span><span class="token punctuation">(</span>mytable<span class="token punctuation">.</span>key1<span class="token punctuation">,</span>mymetatable<span class="token punctuation">.</span>key1<span class="token punctuation">)</span>

以上实例执行输出结果为：
value1
nil    新值<span class="token number">2</span>
新值<span class="token number">1</span>    nil
</code></pre> 
<p>  以上实例中表设置了元方法 __newindex，在对新索引键（newkey）赋值时（mytable.newkey = “新值2”），会调用元方法，而不进行赋值。而如果对已存在的索引键（key1），则会进行赋值，而不调用元方法 __newindex。</p> 
<h2><a id="15_1243"></a>15.协同程序</h2> 
<p>  协同程序，具有独立的堆栈、局部变量、指令指针，与其他协同程序共享全局变量和其它大部分东西。</p> 
<p><strong>协同程序和线程的区别</strong></p> 
<blockquote> 
 <p>多线程程序可以同时运行，而协同程序需要彼此协作运行<br> 在任一时刻只能由一个协同程序运行，并且只有这个程序在要求被挂起时才会被 挂起<br> 协同程序类似于同步的多线程</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eea068a297adb1d6a47aff97ff15ebc0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SecureCRT运行Python脚本简单的实现过程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9de4fa7ff8ec1235a15027c2bc3d28d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用until编写一段shell程序,计算1~10的平方</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>