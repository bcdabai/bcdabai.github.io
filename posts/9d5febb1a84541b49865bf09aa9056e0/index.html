<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ITextSharp 导出pdf - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ITextSharp 导出pdf" />
<meta property="og:description" content="前台页面：
&lt;div id=&#34;search01&#34; style=&#34;padding:2px 5px;&#34;&gt;
合同编号： &lt;input class=&#34;easyui-textbox&#34; style=&#34;width:80px&#34; id=&#34;key_CCode&#34;&gt;&amp;nbsp;&amp;nbsp; 单位名称： &lt;input class=&#34;easyui-textbox&#34; style=&#34;width:80px&#34; id=&#34;key_JiGouMingChen&#34;&gt;&amp;nbsp;&amp;nbsp; 健康顾问： &lt;input class=&#34;easyui-textbox&#34; style=&#34;width:90px&#34; id=&#34;key_jkgw&#34;&gt;&amp;nbsp;&amp;nbsp;
体检日期： &lt;input class=&#34;easyui-datebox&#34; style=&#34;width:90px&#34; id=&#34;key_tjrqA&#34;&gt;—&lt;input class=&#34;easyui-datebox&#34; style=&#34;width:90px&#34; id=&#34;key_tjrqB&#34;&gt; &amp;nbsp;&amp;nbsp&lt;br /&gt; 收款日期： &lt;input class=&#34;easyui-datebox&#34; style=&#34;width:90px&#34; id=&#34;key_skrqA&#34;&gt;—&lt;input class=&#34;easyui-datebox&#34; style=&#34;width:90px&#34; id=&#34;key_skrqB&#34;&gt; &amp;nbsp;&amp;nbsp &lt;a href=&#34;#&#34; class=&#34;easyui-linkbutton&#34; iconCls=&#34;icon-sum&#34; style=&#34;width:120px&#34; OnClick=&#34;$(&#39;#list_gd_02&#39;).datagrid(&#39;load&#39;);&#34;&gt;查询&lt;/a&gt; &lt;a href=&#34;javascript:void(0)&#34; class=&#34;easyui-linkbutton&#34; data-options=&#34;iconCls:&#39;icon-redo&#39;,plain:true&#34; style=&#34;float:right;&#34; οnclick=&#34;exportPDF();&#34;&gt;导出到PDF&lt;/a&gt; &lt;br/&gt;
&lt;font style=&#34;line-height:32px;&#34;&gt;
应收金额（所有工单之和）：&lt;input class=&#34;easyui-numberbox&#34; style=&#34;width:90px&#34; id=&#34;ysMoney&#34; value=&#34;0.00&#34; data-options=&#34;precision:2&#34; readonly&gt; 元&amp;nbsp;&amp;nbsp;
已收金额（所有已收）：&lt;input class=&#34;easyui-numberbox&#34; style=&#34;width:90px&#34; id=&#34;ssMoney&#34; value=&#34;0.00&#34; data-options=&#34;precision:2&#34; readonly&gt; 元&amp;nbsp;&amp;nbsp;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9d5febb1a84541b49865bf09aa9056e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-01-06T16:04:58+08:00" />
<meta property="article:modified_time" content="2017-01-06T16:04:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ITextSharp 导出pdf</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前台页面：</p> 
<p>&lt;div id="search01" style="padding:2px 5px;"&gt;<br> <span style="white-space:pre"></span>合同编号： &lt;input class="easyui-textbox" style="width:80px" id="key_CCode"&gt;&amp;nbsp;&amp;nbsp; <br>         单位名称： &lt;input class="easyui-textbox" style="width:80px" id="key_JiGouMingChen"&gt;&amp;nbsp;&amp;nbsp; <br>         健康顾问： &lt;input class="easyui-textbox" style="width:90px" id="key_jkgw"&gt;&amp;nbsp;&amp;nbsp;<br>         体检日期： &lt;input class="easyui-datebox" style="width:90px" id="key_tjrqA"&gt;—&lt;input class="easyui-datebox" style="width:90px" id="key_tjrqB"&gt; &amp;nbsp;&amp;nbsp&lt;br /&gt; <br>         收款日期： &lt;input class="easyui-datebox" style="width:90px" id="key_skrqA"&gt;—&lt;input class="easyui-datebox" style="width:90px" id="key_skrqB"&gt; &amp;nbsp;&amp;nbsp <br> <span style="white-space:pre"></span>&lt;a href="#" class="easyui-linkbutton" iconCls="icon-sum" style="width:120px" OnClick="$('#list_gd_02').datagrid('load');"&gt;查询&lt;/a&gt;  <br> <span style="white-space:pre"></span>&lt;a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-redo',plain:true" style="float:right;" οnclick="exportPDF();"&gt;导出到PDF&lt;/a&gt;<span style="white-space:pre"> </span><br> <span style="white-space:pre"></span>&lt;br/&gt;<br> <span style="white-space:pre"></span>&lt;font style="line-height:32px;"&gt;<br> <span style="white-space:pre"></span>应收金额（所有工单之和）：&lt;input class="easyui-numberbox" style="width:90px" id="ysMoney" value="0.00" data-options="precision:2" readonly&gt; 元&amp;nbsp;&amp;nbsp;<br> <span style="white-space:pre"></span>已收金额（所有已收）：&lt;input class="easyui-numberbox" style="width:90px" id="ssMoney" value="0.00" data-options="precision:2" readonly&gt; 元&amp;nbsp;&amp;nbsp;<br> <span style="white-space:pre"></span>公司尾款：&lt;input class="easyui-numberbox" style="width:90px" id="wkMoney" value="0.00" data-options="precision:2" readonly&gt; 元&amp;nbsp;&amp;nbsp;<br> <span style="white-space:pre"></span>&lt;/font&gt;<br> <span style="white-space:pre"></span>&lt;/div&gt;<br> </p> 
<p>js方法：</p> 
<p><br> <br>     function exportPDF() {<!-- --><br>         debugger;<br>         $.ajax({<!-- --><br>             type: "POST",<br>             url: '../module_gdgl/do.aspx?Action=list_js1&amp;key_CCode=' + $('#key_CCode').val()<br> <span style="white-space:pre"></span>           + "&amp;key_JiGouMingChen=" + $('#key_JiGouMingChen').val()<br> <span style="white-space:pre"></span>           + "&amp;key_tjrqA=" + $('#key_tjrqA').datebox('getValue')<br> <span style="white-space:pre"></span>           + "&amp;key_tjrqB=" + $('#key_tjrqB').datebox('getValue')<br> <span style="white-space:pre"></span>           + "&amp;key_skrqA=" + $('#key_skrqA').datebox('getValue')<br> <span style="white-space:pre"></span>           + "&amp;key_skrqB=" + $('#key_skrqB').datebox('getValue')<br> <br> <br>                     + "&amp;ysMoney=" + $('#ysMoney').val()<br> <span style="white-space:pre"></span>           + "&amp;ssMoney=" + $('#ssMoney').val()<br> <span style="white-space:pre"></span>           + "&amp;wkMoney=" + $('#wkMoney').val()<br> <span style="white-space:pre"></span>         ,<br>             cache: false,<br>             contentType: "application/json;charset=utf-8",<br>             dataType: "json"<br>         });<br> <br> <br> 后台方法：</p> 
<p>    private string appPath = System.Configuration.ConfigurationManager.AppSettings["PDFFilePath"];<br> </p> 
<p>if (pAction.Equals("list_js1"))<br>         {<!-- --><br>             Double ysMoney =Convert.ToDouble(HttpContext.Current.Request.QueryString["ysMoney"] );    // ??前null 则取后<br>             Double ssMoney = Convert.ToDouble(HttpContext.Current.Request.QueryString["ssMoney"]);    // ??前null 则取后<br>             Double wkMoney = Convert.ToDouble(HttpContext.Current.Request.QueryString["wkMoney"]);    // ??前null 则取后<br> <br> <br>             DownloadPDF(ysMoney, ssMoney, wkMoney);<br>         }<br> </p> 
<p>[WebMethod]<br>     public void DownloadPDF(Double ysMoney, Double ssMoney, Double wkMoney)<br>     {<!-- --><br>         try<br>         {<!-- --><br>             string fileName = "JSQD"+DateTime.Now.ToString("yyyymmddhhmmss")+ ".pdf";<br>             string filePath = appPath + "\\" + fileName;<br>             if (!string.IsNullOrEmpty(filePath))<br>             {<!-- --><br>                 if (GeneralPDF.GeneralPDFFile(filePath, ysMoney,ssMoney,wkMoney))<br>                 {<!-- --><br>                     //lblMsg.Text = "抱歉，数据或文件不齐备，暂时不能下载报告！";<br>                 }<br>                 //foreach (string file in System.IO.Directory.GetFiles(appPath))<br>                 //{<!-- --><br>                 //    if (file.IndexOf(filePre) &gt;= 0)<br>                 //    {<!-- --><br>                 //        filePath = file;<br>                 //        fileName = new System.IO.FileInfo(file).Name;<br>                 //        break;<br>                 //    }<br>                 //}<br>             }<br>             if (File.Exists(filePath))<br>             {<!-- --><br>                 //lblMsg.Text = "报告下载完成！";<br> <br> <br>                 string customerID = "";<br>                 DownFile(filePath, fileName, customerID);<br>             }<br>             else<br>             {<!-- --><br>                 //lblMsg.Text = "文件路径不存在！";<br>                 //log4net.LogManager.GetLogger("ADVASite").Error("【操作日志 - 报告下载】filePath不存在，下载失败！");<br>             }<br> <br> <br>         }<br>         catch (Exception ex)<br>         {<!-- --><br>             log4net.LogManager.GetLogger("ADVASite").Error("【异常日志 - 报告下载】ReportDownload.btnDownload_Click出现异常： " + ex.Message.ToString() + "--------------StackTrace：" + ex.StackTrace.ToString());<br>             if (ex.Message.Contains("(404) Not Found"))<br>             {<!-- --><br>                 //lblMsg.Text = "抱歉您的体检报告单数据尚未齐备，暂时不能下载，如有疑问请联系华兆客服：68335258。";<br>             }<br>             else<br>             {<!-- --><br>                 //lblMsg.Text = "电子报告下载异常：" + ex.Message.ToString();<br>             }<br>         }<br>     }<br> <br> <br>     /// &lt;summary&gt;<br>     /// 从服务器下载文件<br>     /// &lt;/summary&gt;<br>     /// &lt;param name="filePath"&gt;&lt;/param&gt;<br>     /// &lt;param name="fileName"&gt;&lt;/param&gt;<br>     private void DownFile(string filePath, string fileName, string customerID)<br>     {<!-- --><br>         FileInfo fileInfo = new FileInfo(filePath);<br> <br> <br>         System.IO.Stream iStream = null;<br>         byte[] buffer = new Byte[10000];<br>         int length;<br>         long dataToRead;<br> <br> <br>         try<br>         {<!-- --><br>             iStream = new System.IO.FileStream(filePath, System.IO.FileMode.Open, System.IO.FileAccess.Read, System.IO.FileShare.Read);<br>             dataToRead = iStream.Length;<br>             Response.Clear();<br>             Response.ClearHeaders();<br>             Response.ClearContent();<br>             Response.ContentType = "application/pdf"; //文件类型  <br>             Response.AddHeader("Content-Length", dataToRead.ToString());//添加文件长度，进而显示进度  <br>             Response.AddHeader("Content-Disposition", "attachment; filename=" + HttpUtility.UrlEncode(fileName, System.Text.Encoding.UTF8));<br>             while (dataToRead &gt; 0)<br>             {<!-- --><br>                 if (Response.IsClientConnected)<br>                 {<!-- --><br>                     length = iStream.Read(buffer, 0, 10000);<br>                     Response.OutputStream.Write(buffer, 0, length);<br>                     Response.Flush();<br> <br> <br>                     buffer = new Byte[10000];<br>                     dataToRead = dataToRead - length;<br>                 }<br>                 else<br>                 {<!-- --><br>                     dataToRead = -1;<br>                 }<br>             }<br>         }<br>         catch (Exception ex)<br>         {<!-- --><br>             Response.Write("文件下载时出现错误!");<br>             log4net.LogManager.GetLogger("ADVASite").Error("【异常日志 - 报告下载】ReportDownload.DownFile出现异常： " + ex.Message.ToString() + "--------------StackTrace：" + ex.StackTrace.ToString());<br>         }<br>         finally<br>         {<!-- --><br>             if (iStream != null)<br>             {<!-- --><br>                 iStream.Close();<br>             }<br>             //结束响应，否则将导致网页内容被输出到文件，进而文件无法打开  <br>             try<br>             {<!-- --><br>                 Response.End();<br>             }<br>             catch<br>             {<!-- --><br>                 Server.ClearError();<br>             }<br>         }<br>     }<br> </p> 
<p>GeneralPDF.cs 文件内容：<br> </p> 
<p>using System;<br> using System.Collections.Generic;<br> using System.Linq;<br> using System.Web;<br> <br> <br> using iTextSharp.text.pdf;<br> using iTextSharp.text;<br> using iTextSharp;<br> using System.Runtime.InteropServices;<br> <br> <br> using System.Text;<br> using System.Net;<br> <br> <br> using System.Data;<br> using System.Data.SqlClient;<br> using System.IO;<br> <br> <br> /// &lt;summary&gt;<br> /// Summary description for GeneralPDF<br> /// &lt;/summary&gt;<br> public static class GeneralPDF<br> {<!-- --><br>     private static string appPath = System.Configuration.ConfigurationManager.AppSettings["PDFFilePath"];<br> <br> <br>     //下面是正式环境对应的数据库连接配置m_HzNewDB_Head、m_HZYS_Server_Head<br>     //private String m_HzNewDB_Head = "[253HZNEWDB].";<br>     private static String m_HZYS_Server_Head = "[80HZYS_Server].";<br>     private static String m_HzNewDB_Head = "";<br> <br> <br>     //下面是测试环境对应的数据库链接配置m_HzNewDB_Head、m_HZYS_Server_Head<br>     //private String m_HzNewDB_Head = "";<br>     //private String m_HZYS_Server_Head = "";<br> <br> <br> <br> <br>     #region GeneralPDFCRYG<br>     public static bool GeneralPDFFile(string fileName,Double ysMoney, Double ssMoney, Double wkMoney)<br>     {<!-- --><br>         DataTable healthData = getListJsqd();<br> <br> <br>         if (healthData == null )<br>             return false;<br> <br> <br>         //string fileName = appPath + ".Pdf";<br>         File.Delete(fileName);<br> <br> <br>         Document document = new Document(PageSize.A3, 70, 50, 50, 50);<br> <br> <br>         #region font setting<br>         BaseFont baseFont = BaseFont.CreateFont(appPath + @"\font\MSYH.TTF", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);<br>         BaseFont baseFontBD = BaseFont.CreateFont(appPath + @"\font\MSYHBD.TTF", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);<br>         BaseFont baseFontBD_ST = BaseFont.CreateFont(appPath + @"\font\SIMSUN.TTC,0", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);<br> <br> <br>         iTextSharp.text.Font font9 = new iTextSharp.text.Font(baseFont, 9);<br>         iTextSharp.text.Font font10 = new iTextSharp.text.Font(baseFont, 10);<br>         iTextSharp.text.Font font11 = new iTextSharp.text.Font(baseFont, 11);<br>         iTextSharp.text.Font font12 = new iTextSharp.text.Font(baseFontBD, 12);<br>         iTextSharp.text.Font font24 = new iTextSharp.text.Font(baseFontBD, 24);<br>         iTextSharp.text.Font font11BD = new iTextSharp.text.Font(baseFontBD, 11);<br>         iTextSharp.text.Font font11BDST = new iTextSharp.text.Font(baseFontBD_ST, 11);<br>         #endregion<br> <br> <br>         try<br>         {<!-- --><br>             PdfWriter writer = PdfWriter.GetInstance(document, new FileStream(fileName, FileMode.Create));<br>             writer.PageEvent = new HeaderAndFooterEvent();<br>             HeaderAndFooterEvent.WHETHER_SHOW_FOOTERHEADER = true;<br>             HeaderAndFooterEvent.WHETHER_YG = true;<br>             document.Open();<br>             HeaderAndFooterEvent.tpl = writer.DirectContent.CreateTemplate(100, 100);<br> <br> <br>             PdfContentByte cb = writer.DirectContent;<br>             cb.AddTemplate(HeaderAndFooterEvent.tpl, 50, 50);<br> <br> <br>             #region first page content<br>             Paragraph p = new Paragraph("结 算 清 单", font24);<br>             p.Alignment = iTextSharp.text.Element.ALIGN_CENTER;<br>             document.Add(p);<br>           <br> <br> <br>             #region barcode<br>             //Barcode39 bc39 = new Barcode39();<br>             //bc39.Code = healthData.Customer.WorkNo;<br>             //bc39.AltText = healthData.Customer.WorkNo;<br>             //bc39.TextAlignment = Element.ALIGN_CENTER;<br>             //bc39.Font = BaseFont.CreateFont(appPath + @"\font\MSYHBD.TTF", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);<br>             //document.Add(bc39.CreateImageWithBarcode(cb, null, null));<br>             #endregion<br> <br> <br>             iTextSharp.text.pdf.PdfPTable table = new PdfPTable(4);<br>             table.WidthPercentage = 100;<br>             table.HorizontalAlignment = 500;<br>             <br>             table.SetWidths(new float[] { 5f, 10f, 5f, 10f });<br> <br> <br>             iTextSharp.text.pdf.PdfPCell cell = new PdfPCell();<br> <br> <br>             <br> <br> <br>             p = new Paragraph("\n");<br>             document.Add(p);<br> <br> <br>             #region YG consult<br>             table = new PdfPTable(14);<br>             table.WidthPercentage = 100;<br>             table.HeaderRows = 1;<br>             //table.SetWidths(new float[] { 10f, 5f, 5f, 5f, 5f, 5f });<br> <br> <br>             p = new Paragraph("工单编号", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("单位名称", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("所在部门", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("客户姓名", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("性别", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("年龄", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("产品编号/加项内容", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("价格", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br>             p = new Paragraph("结算方式", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br>             p = new Paragraph("结算金额", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br>             p = new Paragraph("已收金额", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br>             p = new Paragraph("预约日期", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br>             p = new Paragraph("体检日期", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br>             p = new Paragraph("发票号/收据号/结算清单号", font12);<br>             p.Alignment = Element.ALIGN_CENTER;<br>             cell = new PdfPCell();<br>             cell.AddElement(p);<br>             cell.BackgroundColor = BaseColor.LIGHT_GRAY;<br>             table.AddCell(cell);<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>             foreach (DataRow entity in healthData.Rows)<br>             {<!-- --><br>                 p = new Paragraph(entity["WKCode"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br>                 p = new Paragraph(entity["JiGouMingChen"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br>                 p = new Paragraph(entity["Bumen"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["NAME"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["Sex"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br> <br> <br>                 p = new Paragraph(entity["Birthday"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br>                 p = new Paragraph(entity["WKProductID"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["WKPrice"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["WKJsfs"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["WKPriceJs"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br>                 p = new Paragraph(entity["WKPricePayed"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["YuyueRiqi"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br> <br> <br>                 p = new Paragraph(entity["TiJianRiQi"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br>                 p = new Paragraph(entity["CPName"].ToString(), font9);<br>                 cell = new PdfPCell();<br>                 cell.AddElement(p);<br>                 table.AddCell(cell);<br> <br> <br>               <br>             }<br> <br> <br> <br> <br> <br> <br>             //document.Add(table);<br>         <br> <br> <br> <br> <br>             document.Add(table);<br>             #endregion<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>             p = new Paragraph("\n");<br>             document.Add(p);<br> <br> <br>             p = new Paragraph("应收金额（所有工单之和）：" + ysMoney.ToString(), font12);<br>             document.Add(p);<br> <br> <br>             p = new Paragraph("已收金额（所有已收）:" + ssMoney.ToString(), font12);<br>             document.Add(p);<br> <br> <br> <br> <br> <br> <br>             p = new Paragraph("公司尾款:" + wkMoney.ToString(), font12);<br>             document.Add(p);<br> <br> <br>             p = new Paragraph("\n");<br>             document.Add(p);<br> <br> <br>             p = new Paragraph("华兆益生健康管理机构",font24);<br>             p.Alignment = Element.ALIGN_RIGHT;<br>            <br>             document.Add(p);<br> <br> <br> <br> <br>             //PdfContentByte over = stamp.getOverContent(2);<br>             //over.beginText();<br>             //BaseFont bf = BaseFont.createFont(BaseFont.HELVETICA, BaseFont.WINANSI,<br>             //        BaseFont.EMBEDDED);<br>             //over.setFontAndSize(bf, 18);<br>             //over.setTextMatrix(30, 30);<br>             //over.showTextAligned(Element.ALIGN_LEFT, "DUPLICATE", 230, 430, 45);<br>             //over.endText();  <br> <br> <br> <br> <br> <br> <br>             document.NewPage();<br>        <br>            <br>             #endregion<br> <br> <br>             writer.Flush();<br>             writer.CloseStream = true;<br>             document.Close();<br>         }<br>         catch (Exception ex)<br>         {<!-- --><br>             throw ex;<br>             return false;<br>         }<br>         finally<br>         {<!-- --><br>             if (document.IsOpen())<br>                 document.Close();<br>         }<br>         return true;<br>     }<br>     #endregion<br> <br> <br>     #region HeaderAndFooterEvent<br>     public class HeaderAndFooterEvent : PdfPageEventHelper, IPdfPageEvent<br>     {<!-- --><br>         public static PdfTemplate tpl = null;<br>         public static bool WHETHER_SHOW_FOOTERHEADER = false;<br>         public static bool WHETHER_YG = false;<br> <br> <br>         public override void OnEndPage(PdfWriter writer, Document document)<br>         {<!-- --><br>             if (WHETHER_SHOW_FOOTERHEADER)<br>             {<!-- --><br>                 BaseFont baseFont = BaseFont.CreateFont(appPath + @"\font\MSYH.TTF", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);<br>                 iTextSharp.text.Font font = new iTextSharp.text.Font(baseFont, 10);<br> <br> <br>                 Phrase header = new Phrase("", font);<br>                 Phrase footer = new Phrase("第" + (writer.PageNumber) + "页/共     页", font);<br>                 PdfContentByte cb = writer.DirectContent;<br>                 //模版 显示总共页数 <br>                 if (writer.PageNumber == 1 &amp;&amp; WHETHER_YG == false)<br>                 {<!-- --><br>                     cb.AddTemplate(tpl, document.Right - 76 - 50 + document.LeftMargin - 5, document.Bottom - 10);//调节模版显示的位置  <br>                     //页脚显示的位置  <br>                     ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, footer, document.Right - 90 + document.LeftMargin - 50, document.Bottom - 10, 0);<br>                 }<br>                 else<br>                 {<!-- --><br>                     cb.AddTemplate(tpl, document.Right - 76 + document.LeftMargin - 5, document.Bottom - 10);//调节模版显示的位置  <br>                     //页眉显示的位置  <br>                     //ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, header, document.Right - 200 + document.LeftMargin, document.Top + 10, 0);<br>                     //页脚显示的位置  <br>                     ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, footer, document.Right - 90 + document.LeftMargin, document.Bottom - 10, 0);<br>                 }<br>             }<br>         }<br> <br> <br>         //重写 打开一个新页面时  <br>         public override void OnStartPage(PdfWriter writer, Document document)<br>         {<!-- --><br>             /*if (WHETHER_SHOW_FOOTERHEADER)<br>             {<!-- --><br>                 writer.PageCount = writer.PageNumber - 1;<br>             }*/<br>         }<br> <br> <br>         //关闭PDF文档时发生该事件  <br>         public override void OnCloseDocument(PdfWriter writer, Document document)<br>         {<!-- --><br>             BaseFont bf = BaseFont.CreateFont(appPath + @"\font\MSYH.TTF", BaseFont.IDENTITY_H, false);<br> <br> <br>             tpl.BeginText();<br>             tpl.SetFontAndSize(bf, 10);//生成的模版的字体、颜色  <br>             tpl.ShowText((writer.PageNumber - 1).ToString());//模版显示的内容  <br>             tpl.EndText();<br>             tpl.ClosePath();<br>         }<br>     }<br>     #endregion<br> <br> <br>     #region 检查FTP文件是否存在<br>     public static string[] GetFileList(string ftpPath, string ftpUserName, string ftpPwd)<br>     {<!-- --><br>         string[] downloadFiles;<br>         StringBuilder result = new StringBuilder();<br>         FtpWebRequest reqFTP;<br>         try<br>         {<!-- --><br>             reqFTP = (FtpWebRequest)FtpWebRequest.Create(new Uri(ftpPath));<br>             reqFTP.UseBinary = true;<br>             reqFTP.Credentials = new NetworkCredential(ftpUserName, ftpPwd);<br>             reqFTP.Method = WebRequestMethods.Ftp.ListDirectory;<br> <br> <br>             WebResponse response = reqFTP.GetResponse();<br>             StreamReader reader = new StreamReader(response.GetResponseStream());<br>             string line = reader.ReadLine();<br> <br> <br>             while (line != null)<br>             {<!-- --><br>                 result.Append(line);<br>                 result.Append(" ");<br>                 line = reader.ReadLine();<br>             }<br>             // to remove the trailing ' '        <br>             result.Remove(result.ToString().LastIndexOf(' '), 1);<br>             reader.Close();<br>             response.Close();<br>             return result.ToString().Split(' ');<br>         }<br>         catch (Exception ex)<br>         {<!-- --><br>             downloadFiles = null;<br>             return downloadFiles;<br>         }<br>     }<br>     #endregion<br> <br> <br>     /// &lt;summary&gt;<br>     /// 生成结算清单查询表单<br>     /// &lt;/summary&gt;<br>     /// &lt;returns&gt;&lt;/returns&gt;<br>     public static DataTable getListJsqd()<br>     {<!-- --><br>         String ret = "";<br>         String connString = "";<br>         //读取连接字符串<br>         connString = System.Configuration.ConfigurationManager.ConnectionStrings["IBMDB"].ToString();<br>         String SQL = "";<br>         SqlConnection conn;<br>         DataSet myDataSet;<br>         SqlDataAdapter adapter0;<br> <br> <br>         try<br>         {<!-- --><br>             String key_CCode = HttpContext.Current.Request.QueryString["key_CCode"] ?? "";<br>             String subsql = "";<br>             String sql = "";<br>             String sqlstr = "";<br>             if (HttpContext.Current.Request.QueryString["key_JiGouMingChen"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_JiGouMingChen"].ToString().Equals(""))<br>                 sql += " and J.JiGouMingChen like '%" + HttpContext.Current.Request.QueryString["key_JiGouMingChen"].ToString().Trim() + "%' ";<br> <br> <br>             if (HttpContext.Current.Request.QueryString["key_jkgw"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_jkgw"].ToString().Equals(""))<br>                 sql += " and J.XiaoShouYuan like '%" + HttpContext.Current.Request.QueryString["key_jkgw"].ToString().Trim() + "%' ";<br> <br> <br>             if (HttpContext.Current.Request.QueryString["key_tjrqA"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_tjrqA"].ToString().Equals(""))<br>                 sql += " and J.TiJianRiQi &gt;= '" + HttpContext.Current.Request.QueryString["key_tjrqA"].ToString() + " 00:00:00' ";<br>             if (HttpContext.Current.Request.QueryString["key_tjrqB"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_tjrqB"].ToString().Equals(""))<br>                 sql += " and J.TiJianRiQi &lt;= '" + HttpContext.Current.Request.QueryString["key_tjrqB"].ToString() + " 23:59:59' ";<br> <br> <br>             if (HttpContext.Current.Request.QueryString["key_skrqA"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_skrqA"].ToString().Equals(""))<br>                 sqlstr += " and I.ItemSkTime &gt;= '" + HttpContext.Current.Request.QueryString["key_skrqA"].ToString() + " 00:00:00' ";<br>             if (HttpContext.Current.Request.QueryString["key_skrqB"] != null &amp;&amp; !HttpContext.Current.Request.QueryString["key_skrqB"].ToString().Equals(""))<br>                 sqlstr += " and I.ItemSkTime &lt;= '" + HttpContext.Current.Request.QueryString["key_skrqB"].ToString() + " 23:59:59' ";<br> <br> <br>             //建立连接<br>             conn = new SqlConnection(connString);<br>             // 创建DataSet，用于存储数据.<br>             myDataSet = new DataSet();<br> <br> <br>             ret += "{\"total\":100,\"rows\":[";<br> <br> <br>             //分页信息<br>             subsql = " from T_IBM_WorkForm as W left join " + m_HzNewDB_Head + "[HZNewDB].[dbo].[T_Guest_Info] as G on W.GID=G.Gid  left join " + m_HzNewDB_Head + "[HZNewDB].[dbo].[T_TiJian] as J on J.HuZhaoHao=W.QzCode and W.WKType='2'  where (W.WKType='1' or W.WKType='2')   ";<br>             subsql += " and W.WKCode like '" + HttpContext.Current.Request.QueryString["key_CCode"].ToString().Trim() + "%'" + sql;<br>             String SQL1 = "select W.WKID,W.WKCode,J.JiGouMingChen,J.Bumen,G.NAME,G.Sex,datediff(yyyy,G.Birthday,GETDATE()) as Birthday,W.WKProductID,W.WKPrice,W.WKJsfs,W.WKPrice as WKPriceJs,W.WKPricePayed,convert(varchar(10),J.YuyueRiqi,121) as YuyueRiqi,convert(varchar(10),J.TiJianRiQi,121) as TiJianRiQi,( select PayCode +','  from T_IBM_Pay where WKCode=W.WKCode for xml path('')) as CPName,W.WKType " + subsql + "";<br>             /* ,G.Mobile,G.PaperValue,W.WKDateCreate,W.WKBgjffs,W.WKGdjfdz,W.WKCpdj,W.WKDateStart,W.WKDateEnd,W.WKQzfs,W.WKYyfs,W.WKFwlx,W.REMARK,W.WKStatus,W.Deal_USER_Name,W.WKDateDeal,W.WKPrice */<br> <br> <br>             //加项部分的查询结果<br>             subsql = " from T_IBM_WorkForm as W inner join T_IBM_Item as I on W.WKCode=I.WKCode left join " + m_HzNewDB_Head + "[HZNewDB].[dbo].[T_Guest_Info] as G on W.GID=G.Gid  left join " + m_HzNewDB_Head + "[HZNewDB].[dbo].[T_TiJian] as J on J.HuZhaoHao=W.QzCode and W.WKType='2' where (W.WKType='1' or W.WKType='2')  ";<br>             subsql += " and W.WKCode like '" + HttpContext.Current.Request.QueryString["key_CCode"].ToString().Trim() + "%'" + sql;<br> <br> <br>             String SQL2 = "select W.WKID,W.WKCode,J.JiGouMingChen,J.Bumen,G.NAME,G.Sex,FLOOR(datediff(DY, (CASE G.Birthday WHEN '' THEN getdate() ELSE G.Birthday END), getdate())/365.25) as Birthday,I.GName,I.GPriced,I.ItemJsfs as WKJsfs,I.GPriced as GPriceJs,I.GPricePayed,convert(varchar(10),J.YuyueRiqi,121) as YuyueRiqi,convert(varchar(10),J.TiJianRiQi,121) as TiJianRiQi,I.ItemPayCode,'3' as WKType " + subsql + "" + sqlstr;<br> <br> <br>             SQL = " ( " + SQL1 + " ) UNION ( " + SQL2 + " )  order by WKCode ASC,WKType ASC";<br> <br> <br>             adapter0 = new SqlDataAdapter(SQL, conn);<br>             adapter0.Fill(myDataSet, "T_IBM_Contract");<br> <br> <br>             return myDataSet.Tables["T_IBM_Contract"];<br>         }<br>         catch<br>         {<!-- --><br>             return new DataTable();<br>         }<br>     }<br> }<br> </p> 
<p><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb1f90ab2ff813f52031221e91f1bd5f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">opencv创建滚动条&#43;canny</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/76856502115b9eb2639d132cd21cfa20/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">还算全面的Android性能内存分析优化实战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>