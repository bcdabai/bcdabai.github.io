<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据库-实验八 综合实验 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据库-实验八 综合实验" />
<meta property="og:description" content="文章目录 一、实验目的与要求：二、实验内容：1.在订单详情表orderitems插入新订单时自动获得水果数量，如果水果数量小于插入的新订单的水果数量，则插入失败。2.统计每个月份销量最高的三个水果，方便下次进货的时候多进货。3.随着用户消费增多，修改VIP等级 三 、实验小结 一、实验目的与要求： 利用本学期所学知识，综合运用
二、实验内容： 1.在订单详情表orderitems插入新订单时自动获得水果数量，如果水果数量小于插入的新订单的水果数量，则插入失败。 源码:
CREATE TRIGGER or_insert before INSERT on orderitems FOR EACH ROW BEGIN DECLARE qquantity int; SELECT quantity INTO qquantity FROM fruits where fruits.f_id=new.f_id; IF qquantity&lt;new.quantity THEN signal sqlstate &#39;HY000&#39; set message_text = &#39;水果数量不足&#39;; end IF; END 测试截图:
2.统计每个月份销量最高的三个水果，方便下次进货的时候多进货。 源码:
SELECT* FROM ( select f_id,sum(quantity) from orderitems group by f_id ORDER BY sum(quantity) DESC)s LIMIT 3 测试效果截图:
3.随着用户消费增多，修改VIP等级 源码:
CREATE TRIGGER up_VIP AFTER UPDATE on orders FOR EACH ROW BEGIN DECLARE s_pay DECIMAL(10,2); SELECT SUM(original_price) INTO s_pay FROM orders WHERE orders." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/51a138ef9f87b595cb475bf8d66e80cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-05T15:10:00+08:00" />
<meta property="article:modified_time" content="2021-05-05T15:10:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据库-实验八 综合实验</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_9" rel="nofollow">一、实验目的与要求：</a></li><li><a href="#_16" rel="nofollow">二、实验内容：</a></li><li><ul><li><a href="#1orderitems_17" rel="nofollow">1.在订单详情表orderitems插入新订单时自动获得水果数量，如果水果数量小于插入的新订单的水果数量，则插入失败。</a></li><li><a href="#2_34" rel="nofollow">2.统计每个月份销量最高的三个水果，方便下次进货的时候多进货。</a></li><li><a href="#3VIP_49" rel="nofollow">3.随着用户消费增多，修改VIP等级</a></li></ul> 
  </li><li><a href="#__75" rel="nofollow">三 、实验小结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_9"></a>一、实验目的与要求：</h2> 
<p>利用本学期所学知识，综合运用</p> 
<h2><a id="_16"></a>二、实验内容：</h2> 
<h3><a id="1orderitems_17"></a>1.在订单详情表orderitems插入新订单时自动获得水果数量，如果水果数量小于插入的新订单的水果数量，则插入失败。</h3> 
<p>源码:</p> 
<pre><code class="prism language-bash">CREATE TRIGGER or_insert before INSERT on orderitems FOR EACH ROW
BEGIN 
   DECLARE qquantity int<span class="token punctuation">;</span>
   SELECT quantity INTO qquantity FROM fruits
   where fruits.f_id<span class="token operator">=</span>new.f_id<span class="token punctuation">;</span>
   IF qquantity<span class="token operator">&lt;</span>new.quantity THEN
    signal sqlstate <span class="token string">'HY000'</span> <span class="token keyword">set</span> message_text <span class="token operator">=</span> <span class="token string">'水果数量不足'</span><span class="token punctuation">;</span>
   end IF<span class="token punctuation">;</span>
END

</code></pre> 
<p>测试截图:<br> <img src="https://images2.imgbox.com/4c/70/gMaNGboS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_34"></a>2.统计每个月份销量最高的三个水果，方便下次进货的时候多进货。</h3> 
<p>源码:</p> 
<pre><code class="prism language-bash">SELECT*
FROM
<span class="token punctuation">(</span>
<span class="token keyword">select</span> f_id,sum<span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> 
from orderitems
group by f_id
ORDER BY sum<span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> DESC<span class="token punctuation">)</span>s LIMIT 3

</code></pre> 
<p>测试效果截图:<br> <img src="https://images2.imgbox.com/5c/e4/30mMVVg4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3VIP_49"></a>3.随着用户消费增多，修改VIP等级</h3> 
<p>源码:</p> 
<pre><code class="prism language-bash">CREATE TRIGGER up_VIP AFTER UPDATE on orders FOR EACH ROW
BEGIN 
     DECLARE s_pay DECIMAL<span class="token punctuation">(</span>10,2<span class="token punctuation">)</span><span class="token punctuation">;</span>
     SELECT SUM<span class="token punctuation">(</span>original_price<span class="token punctuation">)</span> INTO s_pay FROM orders
     WHERE orders.c_id<span class="token operator">=</span>new.c_id<span class="token punctuation">;</span>
     UPDATE customers SET VIP<span class="token operator">=</span>
     CASE WHEN s_pay BETWEEN 0 AND 100 THEN 0
          WHEN s_pay BETWEEN 100 AND 199 THEN 1
          WHEN s_pay BETWEEN 200 AND 499 THEN 2
          WHEN s_pay BETWEEN 500 AND 999 THEN 3
          WHEN s_pay BETWEEN 1000 AND 1999 THEN 4
          WHEN s_pay<span class="token operator">&gt;</span>1999 THEN 5
         END
     WHERE customers.c_id<span class="token operator">=</span>new.c_id<span class="token punctuation">;</span>
END

</code></pre> 
<p>测试结果:<br> <img src="https://images2.imgbox.com/00/cf/Wvby5jS7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cb/96/z7FFvHrR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ef/0d/yLzh3X7k_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__75"></a>三 、实验小结</h2> 
<p>1．实验中遇到的问题及解决过程<br> 一开始第一题的插入失败这个知识点之前没用过，就不知道要怎么取用。<br> 后来上网查了查发现可以手动抛出异常。后来采用了发现这个方法可以。<br> 在修改vip等级的时候和同学交流，有出现这样一个疑惑，就是在你原来的订单然后你vip升级了，你下第二单订单的时候可以享受优惠，但是你原来的订单取消了，那你的第二单优惠是否也应该取消。我觉得这个问题我就参考了淘宝，淘宝有些津贴活动，比如300-30，尽管你整单购买才能享受这个优惠，但是有人通过在这300元的单子中进行拆单，也可以以少量的价钱获得到这个津贴。所以我这边也只写了在orders的更新操作后进行VIP等级的修改。删除这个就没有写。<br> 2.实验中产生的错误及原因分析<br> 一开始第二题的测试查询，我出现了一个这样的错误<br> <img src="https://images2.imgbox.com/44/76/evkeNpcg_o.png" alt="在这里插入图片描述"><br> 这个错误是由于<br> <img src="https://images2.imgbox.com/a1/25/kDo0Ju28_o.png" alt="在这里插入图片描述"><br> 即 sql中select后面的字段必须出现在group by后面，或者被聚合函数包裹，不然会抛出上面的错误。<br> 所以我就把原来的quantity改成聚合函数的形式即sum(quantity)就可以解决这个问题了。<br> 3．实验体会和收获。<br> 在之前的实验中都是配合着老师的问题来进行实验的，这次实验是自己去发现问题，解决问题，有点不一样。<br> 或许在实际的生活应用中随着业务需求的增加，我们的功能也需要不断地完善。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bbbc5487e908fcfb53d2e59991438abd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java 获取当前时间并转化为yyyy-MM-dd HH:mm:ss格式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d99837f475d013a49481252460159e3c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图解排序算法(三)之折半插入排序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>