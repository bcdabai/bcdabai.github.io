<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vs2013&#43;cuda8.0&#43;xtion运行bundlefusion - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vs2013&#43;cuda8.0&#43;xtion运行bundlefusion" />
<meta property="og:description" content="1、代码下载：https://github.com/niessner/BundleFusion
2、依赖库MLib：https://github.com/niessner/mLib
依赖库mLib external libraries：http://kaldir.vc.in.tum.de/mLib/mLibExternal.zip
3、最终的目录结构如下：
BundleFusion-master/ external/ mLib/ # this is the submodule you replaced data/ src/ [...] FriedLiver/ [...] FriedLiver.sln [...] mLibExternal/ # you downloaded this from Dropbox include libsWindows [...] 4、推荐使用NotePad&#43;&#43;打开“FriedLiver.vcxproj”，或是使用VSCODE打开工程对其属性进行修改，一共有两处需要修改（当然前提是你的电脑已经安装好了CUDA8.0，参考：https://blog.csdn.net/ffcjjhv/article/details/89221992）
5、安装DirectX SDK：https://www.microsoft.com/en-us/download/details.aspx?id=6812
直接安装即可，如果出现错误，通过控制面板卸载以下两项
如果还不行，参考博客：https://blog.csdn.net/ffcjjhv/article/details/89221992
6、打开工程，先不急编译，需要修改一些内容
首先：打开GlobalAppState.h文档，将相机模块全部注释掉：
然后，将前面安装的DirectX SDK库添加到工程：包括头文件和库文件以及可执行文件
添加好了后，确认工程为Release x64版本，确认所有的三方库路径正确，确认自己的GPU运算能力，
可以通过下面网址查找自己的显卡运算能力：https://developer.nvidia.com/cuda-gpus#collapseOne，注意运算能力一定要对应，否则可能出错。
添加对应的CUDA工具：
完成以上确认后，开始编译，如果没有意外，则编译通过：
7、由于我是win7系统，用不了KineceV2，所以使用xtion试试，参考：
kinectv1：https://blog.csdn.net/ffcjjhv/article/details/89221992
kinectv2：https://blog.csdn.net/weixin_36788761/article/details/100702469
xtion：https://blog.csdn.net/renye_lpl/article/details/80599408
首先安装OpenNI2：https://structure.io/openni 直接下载对应的版本安装即可，同样地，需要将一下三项配置到工程当中：
取消GlobalAppState.h文件中OpenNI的注释
//#define KINECT //#define KINECT_ONE #define OPEN_NI //#define BINARY_DUMP_READER //#define INTEL_SENSOR //#define REAL_SENSE //#define STRUCTURE_SENSOR 然后找到PrimeSenseSensor.h文件，在其中添加一个函数getSensorName()：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/9bfa0f29f9a8643965ca2034eef8edc6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-05T18:50:56+08:00" />
<meta property="article:modified_time" content="2020-09-05T18:50:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vs2013&#43;cuda8.0&#43;xtion运行bundlefusion</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、代码下载：<a href="https://github.com/niessner/BundleFusion">https://github.com/niessner/BundleFusion</a></p> 
<p>2、依赖库MLib：<a href="https://github.com/niessner/mLib">https://github.com/niessner/mLib</a></p> 
<p>依赖库mLib external libraries：<a href="http://kaldir.vc.in.tum.de/mLib/mLibExternal.zip" rel="nofollow">http://kaldir.vc.in.tum.de/mLib/mLibExternal.zip</a></p> 
<p>3、最终的目录结构如下：</p> 
<pre><code>BundleFusion-master/
  external/
    mLib/ # this is the submodule you replaced
      data/
      src/
      [...]
  FriedLiver/
    [...]
    FriedLiver.sln
    [...]
mLibExternal/ # you downloaded this from Dropbox
  include
  libsWindows
  [...]</code></pre> 
<p>4、推荐使用NotePad++打开“FriedLiver.vcxproj”，或是使用VSCODE打开工程对其属性进行修改，一共有两处需要修改（当然前提是你的电脑已经安装好了CUDA8.0，参考：<a href="https://blog.csdn.net/ffcjjhv/article/details/89221992">https://blog.csdn.net/ffcjjhv/article/details/89221992</a>）</p> 
<p> </p> 
<p style="text-align:center;"><img alt="" height="146" src="https://images2.imgbox.com/fe/87/tnsCiDnN_o.png" width="961"></p> 
<p style="text-align:center;"><img alt="" height="118" src="https://images2.imgbox.com/b9/28/wOxl7s2E_o.png" width="849"></p> 
<p>5、安装DirectX SDK：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=6812" rel="nofollow">https://www.microsoft.com/en-us/download/details.aspx?id=6812</a></p> 
<p>直接安装即可，如果出现错误，通过控制面板卸载以下两项</p> 
<p style="text-align:center;"><img alt="" height="39" src="https://images2.imgbox.com/de/bc/U9IPIyK9_o.png" width="502"></p> 
<p>如果还不行，参考博客：<a href="https://blog.csdn.net/ffcjjhv/article/details/89221992">https://blog.csdn.net/ffcjjhv/article/details/89221992</a></p> 
<p>6、打开工程，先不急编译，需要修改一些内容</p> 
<p>首先：打开GlobalAppState.h文档，将相机模块全部注释掉：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/43/d8/HHTPZMkw_o.png"></p> 
<p>然后，将前面安装的DirectX SDK库添加到工程：包括头文件和库文件以及可执行文件</p> 
<p style="text-align:center;"><img alt="" height="68" src="https://images2.imgbox.com/a2/12/FI7yRuX8_o.png" width="464"></p> 
<p>添加好了后，确认工程为Release x64版本，确认所有的三方库路径正确，确认自己的GPU运算能力，</p> 
<p style="text-align:center;"><img alt="" height="134" src="https://images2.imgbox.com/b7/ff/HiYM8huZ_o.png" width="527"></p> 
<p>可以通过下面网址查找自己的显卡运算能力：<a href="https://developer.nvidia.com/cuda-gpus#collapseOne" rel="nofollow">https://developer.nvidia.com/cuda-gpus#collapseOne</a>，注意运算能力一定要对应，否则可能出错。</p> 
<p>添加对应的CUDA工具：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ad/1d/uB8MqU9l_o.png"></p> 
<p>完成以上确认后，开始编译，如果没有意外，则编译通过：</p> 
<p style="text-align:center;"><img alt="" height="195" src="https://images2.imgbox.com/3e/a8/3z0bWMga_o.png" width="738"></p> 
<p>7、由于我是win7系统，用不了KineceV2，所以使用xtion试试，参考：</p> 
<p>kinectv1：<a href="https://blog.csdn.net/ffcjjhv/article/details/89221992">https://blog.csdn.net/ffcjjhv/article/details/89221992</a></p> 
<p>kinectv2：<a href="https://blog.csdn.net/weixin_36788761/article/details/100702469">https://blog.csdn.net/weixin_36788761/article/details/100702469</a></p> 
<p>xtion：<a href="https://blog.csdn.net/renye_lpl/article/details/80599408">https://blog.csdn.net/renye_lpl/article/details/80599408</a></p> 
<p>首先安装OpenNI2：<a href="https://structure.io/openni" rel="nofollow">https://structure.io/openni</a> 直接下载对应的版本安装即可，同样地，需要将一下三项配置到工程当中：</p> 
<p style="text-align:center;"><img alt="" height="98" src="https://images2.imgbox.com/17/71/l8Y0WXdI_o.png" width="660"></p> 
<p>取消GlobalAppState.h文件中OpenNI的注释</p> 
<pre><code>//#define KINECT
//#define KINECT_ONE
#define OPEN_NI
//#define BINARY_DUMP_READER
//#define INTEL_SENSOR
//#define REAL_SENSE
//#define STRUCTURE_SENSOR</code></pre> 
<p>然后找到PrimeSenseSensor.h文件，在其中添加一个函数getSensorName()：</p> 
<pre><code>	//! Processes the Kinect color data
	bool processColor()
	{
		return true;
	}

	//! Returns the sensor name
	std::string getSensorName() const {
		return "Xtion";
	}</code></pre> 
<p>找到DepthSensing.cpp，对其中进行修改，修改完成购编译。</p> 
<pre><code># 将986行
bool bGotDepth = g_CudaImageManager-&gt;process()
# 替换为
bool bGotDepth;
while (!(bGotDepth = g_CudaImageManager-&gt;process()));</code></pre> 
<p>8、当然我们需要测试一下openni2能否打开xtion，测试代码如下：</p> 
<pre><code>#include &lt;opencv2/core/core.hpp&gt;
#include &lt;opencv2/imgproc/imgproc.hpp&gt;
#include &lt;opencv2/highgui/highgui.hpp&gt;
#include &lt;opencv2/opencv.hpp&gt;
#include &lt;iostream&gt;

#include "OpenNI.h"

using namespace openni;
using namespace cv;
using namespace std;


int main()
{
	Status rc = STATUS_OK; // OpenNI函数执行结果

	// 初始化OpenNI  
	rc = OpenNI::initialize();

	// 获取设备信息  
	Array&lt;DeviceInfo&gt; aDeviceList;
	OpenNI::enumerateDevices(&amp;aDeviceList);

	// output information  
	//vector&lt;CDevice&gt;  vDevices;  
	cout &lt;&lt; "电脑上连接着 " &lt;&lt; aDeviceList.getSize() &lt;&lt; " 个体感设备." &lt;&lt; endl;

	for (int i = 0; i &lt; aDeviceList.getSize(); ++i)
	{
		cout &lt;&lt; "设备 " &lt;&lt; i &lt;&lt; endl;
		const DeviceInfo&amp; rDevInfo = aDeviceList[i];
		cout &lt;&lt; "设备名： " &lt;&lt; rDevInfo.getName() &lt;&lt; endl;
		cout &lt;&lt; "设备Id： " &lt;&lt; rDevInfo.getUsbProductId() &lt;&lt; endl;
		cout &lt;&lt; "供应商名： " &lt;&lt; rDevInfo.getVendor() &lt;&lt; endl;
		cout &lt;&lt; "供应商Id: " &lt;&lt; rDevInfo.getUsbVendorId() &lt;&lt; endl;
		cout &lt;&lt; "设备URI: " &lt;&lt; rDevInfo.getUri() &lt;&lt; endl;

	}

	//OpenNI2图
	VideoFrameRef oniDepthImg, oniColorImg;

	//OpenCV图
	Mat cvDepthImg, cvBGRImg;

	//打开Kinect或Xtion设备
	Device device;
	const char * deviceURL = openni::ANY_DEVICE;  //设备名
	rc = device.open(deviceURL);

	//创建并打开深度数据流
	VideoStream oniDepthStream; //深度数据流
	rc = oniDepthStream.create(device, SENSOR_DEPTH); //创建深度数据流
	if (STATUS_OK == rc)
	{
		//设置深度视频模式
		VideoMode modeDepth;
		modeDepth.setResolution(640, 480/*640,480*/); //分辨率
		modeDepth.setFps(30); //帧率
		modeDepth.setPixelFormat(PIXEL_FORMAT_DEPTH_1_MM); //深度像素格式
		oniDepthStream.setVideoMode(modeDepth);

		oniDepthStream.start(); // 打开深度数据流
		if (STATUS_OK != rc)
		{
			cerr &lt;&lt; "无法打开深度数据流：" &lt;&lt; OpenNI::getExtendedError() &lt;&lt; endl;
			oniDepthStream.destroy();
		}
	}
	else
	{
		cerr &lt;&lt; "无法创建深度数据流：" &lt;&lt; OpenNI::getExtendedError() &lt;&lt; endl;
	}

	//创建并打开彩色数据流
	VideoStream oniColorStream;  //RGB数据流
	rc = oniColorStream.create(device, SENSOR_COLOR);
	if (STATUS_OK == rc)
	{
		//设置彩色视频模式
		VideoMode modeColor;
		//不知道为什么，彩色图的分辨率无论如何设置始终都是320*240
		modeColor.setResolution(320, 240/*1280,1040*/);//分辨率
		modeColor.setFps(30);//帧率
		modeColor.setPixelFormat(PIXEL_FORMAT_RGB888);

		//设置深度图和彩色图的配准模式
		if (device.isImageRegistrationModeSupported(IMAGE_REGISTRATION_DEPTH_TO_COLOR))
		{
			device.setImageRegistrationMode(IMAGE_REGISTRATION_DEPTH_TO_COLOR); //深度到彩色图配准
		}

		rc = oniColorStream.start(); //打开彩色数据流
		if (STATUS_OK != rc)
		{
			cerr &lt;&lt; "无法打开彩色数据流：" &lt;&lt; OpenNI::getExtendedError() &lt;&lt; endl;
			oniColorStream.destroy();
		}
	}
	else
	{
		cerr &lt;&lt; "无法创建彩色数据流：" &lt;&lt; OpenNI::getExtendedError() &lt;&lt; endl;
	}

	if (!oniDepthStream.isValid() || !oniColorStream.isValid())
	{
		cerr &lt;&lt; "彩色或深度数据流不合法" &lt;&lt; endl;
		OpenNI::shutdown();
		return 1;
	}

	namedWindow("depth");
	namedWindow("RGB");

	while (true)
	{
		//读取一帧深度图
		if (STATUS_OK == oniDepthStream.readFrame(&amp;oniDepthImg))
		{
			Mat cvRawImg16U(oniDepthImg.getHeight(), oniDepthImg.getWidth(), CV_16UC1, (void*)oniDepthImg.getData());
			cvRawImg16U.convertTo(cvDepthImg, CV_8U, 255.0 / (oniDepthStream.getMaxPixelValue()));
			flip(cvDepthImg, cvDepthImg, 1);//水平翻转
			imshow("depth", cvDepthImg);
		}

		//读取一帧彩色图
		if (STATUS_OK == oniColorStream.readFrame(&amp;oniColorImg))
		{
			Mat cvRGBImg(oniColorImg.getHeight(), oniColorImg.getWidth(), CV_8UC3, (void*)oniColorImg.getData());
			cvtColor(cvRGBImg, cvBGRImg, CV_RGB2BGR);
			flip(cvBGRImg, cvBGRImg, 1);//水平翻转
			imshow("RGB", cvBGRImg);
		}
		waitKey(30);//没有waitKey不显示图像
	}

	destroyWindow("depth");
	destroyWindow("RGB");

	oniDepthStream.destroy();
	oniColorStream.destroy();
	device.close();
	OpenNI::shutdown();

	return 0;
}</code></pre> 
<p>9、修改配置文档，将配置文档和一些dll文件直接放到工程目录下:</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a2/da/tUvrinhg_o.png"></p> 
<p>修改zParametersDefault.txt文档中的配置：</p> 
<pre><code>// 0=Kinect; 1=PrimeSense; 2=KinectOne; 3=BinaryDumpReader; 4=NetworkSensor; 5=IntelSensor; 6=RealSense; 7=StructureSensor; 8=SensorDataReader (for offline processing)
s_sensorIdx = 1;

...

s_hashNumBuckets = 800000;				//smaller voxels require more space
s_hashNumSDFBlocks = 100000;//100000;	//smaller voxels require more space</code></pre> 
<p>然后就可以运行了</p> 
<p>10、运行结果：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/1a/89/PAOBADkL_o.png"></p> 
<p>至此，该算法配置完成！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f5973be1c68396c384094f328ea4f1d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《黑马》——C&#43;&#43;提高编程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b754d47a947c3f64049ddd185fb6716/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">error:could not open ...jvm.cfg解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>