<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vite 配置环境变量 - 编程大白的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vite 配置环境变量" />
<meta property="og:description" content="在做项目环境变量配置前，可以先到官网回忆一下环境变量的基本使用， 环境变量和模式 | Vite 官方中文文档
一、环境模式 首先环境变量是可以分模式的，常用模式如下：
.env # 所有情况下都会加载 .env.local # 所有情况下都会加载，但会被 git 忽略 .env.[mode] # 只在指定模式下加载 .env.[mode].local # 只在指定模式下加载，但会被 git 忽略 默认 dev 环境下使用 .env.development 环境变量配置， build 环境下使用 .env.production ，所以不需要在 package.json 中再指定模式了
&#34;scripts&#34;: { &#34;dev&#34;: &#34;vite --mode development&#34;, // --mode development可以省略，运行 npm run dev 自动指定 &#34;build&#34;: &#34;vue-tsc --noEmit &amp;&amp; vite build --mode production&#34;, // --mode production可以省略，运行 npm run build 自动指定 &#34;preview&#34;: &#34;vite preview&#34; }, --mode 一般在其他特殊自定义下指定使用。
二、环境变量分类 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcdabai.github.io/posts/ad0b584120b86b55d32e46cb45d3ab84/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-23T18:04:07+08:00" />
<meta property="article:modified_time" content="2022-06-23T18:04:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大白的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大白的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vite 配置环境变量</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在做项目环境变量配置前，可以先到官网回忆一下环境变量的基本使用， <a href="https://cn.vitejs.dev/guide/env-and-mode.html" rel="nofollow" title="环境变量和模式 | Vite 官方中文文档">环境变量和模式 | Vite 官方中文文档</a></p> 
<h3 id="heading-0">一、环境模式</h3> 
<p>首先环境变量是可以分模式的，常用模式如下：</p> 
<pre><code>.env                # 所有情况下都会加载
.env.local          # 所有情况下都会加载，但会被 git 忽略
.env.[mode]         # 只在指定模式下加载
.env.[mode].local   # 只在指定模式下加载，但会被 git 忽略</code></pre> 
<p>默认 dev 环境下使用 .env.development 环境变量配置， build 环境下使用 .env.production ，所以不需要在 package.json 中再指定模式了</p> 
<pre><code>"scripts": {
  "dev": "vite --mode development", // --mode development可以省略，运行 <a href="https://www.fly63.com/tag/npm" rel="nofollow" title="npm">npm</a> run dev 自动指定
  "build": "<a href="https://www.fly63.com/tag/vue" rel="nofollow" title="vue">vue</a>-tsc --noEmit &amp;&amp; vite build --mode production", // --mode production可以省略，运行 npm run build 自动指定
  "preview": "vite preview"
},</code></pre> 
<p>--mode 一般在其他特殊自定义下指定使用。</p> 
<h3 id="heading-1">二、环境变量分类</h3> 
<h4 id="heading-2">2.1 默认环境变量</h4> 
<ul><li>import.meta.env.MODE: {string} 应用运行的模式</li><li>import.meta.env.BASE_URL: {string} 部署应用时的基本 URL</li><li>import.meta.env.PROD: {boolean} 应用是否运行在生产环境</li><li>import.meta.env.DEV: {boolean} 应用是否运行在开发环境 (永远与 import.meta.env.PROD相反)</li></ul> 
<h4 id="heading-3">2.2 应用级环境变量</h4> 
<p>以 VITE_ 开头，这样会被vite处理，如下：</p> 
<p>.env.developlent</p> 
<pre><code class="language-javascript">​
VITE_api_URL=/api/ 
VITE_LOCATION_ORIGIN=http://localhost:3000/

​</code></pre> 
<p>另外自定义的环境变量，还需要在 env.d.ts 中声明变量类型</p> 
<pre><code class="language-javascript">/// &lt;reference types="vite/client" /&gt;

interface ImportMetaEnv {
  readonly VITE_TITLE: string
  readonly VITE_API_URL: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}

declare module '*.vue' {
  import type { DefineComponent } from 'vue'
  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types
  const component: DefineComponent&lt;{}, {}, any&gt;
  export default component
}</code></pre> 
<h3 id="heading-4">三、加载优先级</h3> 
<p>模式覆盖通用，如：在生产环境下， .env.production 中的同名环境变量会覆盖 .env 中同名配置，其他同理</p> 
<h3 id="heading-5">四、环境变量使用</h3> 
<p>Vite把环境变量通过 import.meta.env 暴露出来，在 .vue 中使用方式如下：</p> 
<pre><code class="language-javascript">&lt;script setup lang="ts"&gt;
  console.log(import.meta.env)
&lt;/script&gt;</code></pre> 
<p>但如果要在 axios 中使用就需要特别配置了，需要在 vite.config.js 中加载环境变量，我们可以像以下这种方式处理：</p> 
<pre><code class="language-javascript">import { defineConfig, loadEnv } from 'vite'

// https://vitejs.dev/config/
export default ({ mode }) =&gt; defineConfig({
  define: {
    'process.env': loadEnv(mode, process.cwd())
  },
}</code></pre> 
<p>这样配置完成后就可以在 plugins 下 axios.ts 中使用了</p> 
<pre><code class="language-javascript">const {
  VITE_API_URL
} = process.env

const instance = axios.create({
  baseURL: VITE_API_URL
});

export default instance</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/517f9140712a89b49fbdee703df5ffc8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git 如何合并commits成一个（squash）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7331a40a3e3e3f2f7e1c3f6cf0782651/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">示波器 符号</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大白的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>